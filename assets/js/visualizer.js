/*
 WordPress Gallery Extra Audio Visulizer 1.0.1
 All rights reserved to iProDev (https://www.iprodev.com)
*/
var pixelRatio=window.devicePixelRatio,audio=document.getElementById("player"),fftSize=1024,background_color="rgba(0, 0, 1, 1)",background_gradient_color_1="rgba(0,0,17, 0.7)",background_gradient_color_2="rgba(6,13,31, 0.7)",background_gradient_color_3="rgba(2,36,63, 0.7)",stars_color="#465677",stars_color_2="#B5BFD4",stars_color_special="#F451BA",TOTAL_STARS=1500,STARS_BREAK_POINT=140,stars=[],waveform_color="rgba(29, 36, 57, 0.05)",waveform_color_2="rgba(0,0,0,0)",waveform_line_color="rgba(77, 218, 248, 0.3)",
waveform_line_color_2="rgba(157, 242, 157, 1)",waveform_tick=.05,TOTAL_POINTS=fftSize/2,points=[],bubble_avg_color="rgba(29, 36, 57, 0.1)",bubble_avg_color_2="rgba(29, 36, 57, 0.05)",bubble_avg_line_color="rgba(77, 218, 248, 1)",bubble_avg_line_color_2="rgba(157, 242, 157, 0.5)",bubble_avg_tick=.001,TOTAL_AVG_POINTS=64,AVG_BREAK_POINT=100,avg_points=[],SHOW_STAR_FIELD=!0,SHOW_WAVEFORM=!0,SHOW_AVERAGE=!0,AudioContext=window.AudioContext||window.webkitAudioContext,floor=Math.floor,round=Math.round,
random=Math.random,sin=Math.sin,cos=Math.cos,PI=Math.PI,PI_TWO=2*PI,PI_HALF=PI/180,w=0,h=0,cx=0,cy=0,rotation=0,avg,ctx,actx,elementSource,asource,gainNode,analyser,frequencyData,frequencyDataLength,timeData,rAF;window.addEventListener("resize",resizeHandler,!1);
function initializeVisualizer(){AudioContext&&(audio.length||(audio=document.getElementsByTagName("audio")[0]),ctx=document.getElementById("canvas").getContext("2d"),actx=new AudioContext,elementSource=actx.createMediaElementSource(audio),resizeHandler(),initializeAudio())}
function initializeAudio(){analyser=actx.createAnalyser();analyser.fftSize=fftSize;analyser.minDecibels=-100;analyser.maxDecibels=-30;analyser.smoothingTimeConstant=.8;gainNode=actx.createGain();gainNode.connect(analyser);elementSource.connect(analyser);analyser.connect(actx.destination);frequencyDataLength=analyser.frequencyBinCount;frequencyData=new Uint8Array(frequencyDataLength);timeData=new Uint8Array(frequencyDataLength);createStarField();createPoints()}
function playVisualizer(){actx&&(asource=null,asource=actx.createBufferSource(),asource.connect(gainNode),animate())}function pauseVisualizer(){rAF&&cancelAnimationFrame(rAF)}function getAvg(b){var d=0;b.forEach(function(a){d+=a});return d/b.length}
function drawBackground(){var b=ctx.createLinearGradient(0,0,0,h);b.addColorStop(0,background_gradient_color_1);b.addColorStop(.96,background_gradient_color_2);b.addColorStop(1,background_gradient_color_3);ctx.beginPath();ctx.globalCompositeOperation="source-over";ctx.fillStyle=b;ctx.fillRect(0,0,w,h);ctx.fill();ctx.closePath()}
function drawStarField(){var b;var d=0;for(b=stars.length;d<b;d++){var a=stars[d];var c=avg>AVG_BREAK_POINT?avg/20:avg/50;a.x+=a.dx*c;a.y+=a.dy*c;a.z+=a.dz;a.dx+=a.ddx;a.dy+=a.ddy;a.radius=.2+.1*(a.max_depth-a.z);a.x<-cx||a.x>cx||a.y<-cy||a.y>cy?stars[d]=new Star:(ctx.beginPath(),ctx.globalCompositeOperation="lighter",ctx.fillStyle=a.color,ctx.arc(a.x+cx,a.y+cy,a.radius,PI_TWO,!1),ctx.fill(),ctx.closePath())}}
function drawAverageCircle(){var b;if(avg>AVG_BREAK_POINT){rotation+=-bubble_avg_tick;var d=avg+10*random();ctx.strokeStyle=bubble_avg_line_color_2;ctx.fillStyle=bubble_avg_color_2}else rotation+=bubble_avg_tick,d=avg,ctx.strokeStyle=bubble_avg_line_color,ctx.fillStyle=bubble_avg_color;ctx.beginPath();ctx.lineWidth=1;ctx.lineCap="round";ctx.save();ctx.translate(cx,cy);ctx.rotate(rotation);ctx.translate(-cx,-cy);ctx.moveTo(avg_points[0].dx,avg_points[0].dy);var a=0;for(b=TOTAL_AVG_POINTS;a<b-1;a++){var c=
avg_points[a];c.dx=c.x+d*sin(PI_HALF*c.angle);c.dy=c.y+d*cos(PI_HALF*c.angle);var e=(c.dx+avg_points[a+1].dx)/2;var f=(c.dy+avg_points[a+1].dy)/2;ctx.quadraticCurveTo(c.dx,c.dy,e,f)}c=avg_points[a];c.dx=c.x+d*sin(PI_HALF*c.angle);c.dy=c.y+d*cos(PI_HALF*c.angle);e=(c.dx+avg_points[0].dx)/2;f=(c.dy+avg_points[0].dy)/2;ctx.quadraticCurveTo(c.dx,c.dy,e,f);ctx.quadraticCurveTo(e,f,avg_points[0].dx,avg_points[0].dy);ctx.stroke();ctx.fill();ctx.restore();ctx.closePath()}
function drawWaveform(){var b;avg>AVG_BREAK_POINT?(rotation+=waveform_tick,ctx.strokeStyle=waveform_line_color_2,ctx.fillStyle=waveform_color_2):(rotation+=-waveform_tick,ctx.strokeStyle=waveform_line_color,ctx.fillStyle=waveform_color);ctx.beginPath();ctx.lineWidth=1;ctx.lineCap="round";ctx.save();ctx.translate(cx,cy);ctx.rotate(rotation);ctx.translate(-cx,-cy);ctx.moveTo(points[0].dx,points[0].dy);var d=0;for(b=TOTAL_POINTS;d<b-1;d++){var a=points[d];var c=timeData[d];a.dx=a.x+c*sin(PI_HALF*a.angle);
a.dy=a.y+c*cos(PI_HALF*a.angle);c=(a.dx+points[d+1].dx)/2;var e=(a.dy+points[d+1].dy)/2;ctx.quadraticCurveTo(a.dx,a.dy,c,e)}c=timeData[d];a=points[d];a.dx=a.x+c*sin(PI_HALF*a.angle);a.dy=a.y+c*cos(PI_HALF*a.angle);c=(a.dx+points[0].dx)/2;e=(a.dy+points[0].dy)/2;ctx.quadraticCurveTo(a.dx,a.dy,c,e);ctx.quadraticCurveTo(c,e,points[0].dx,points[0].dy);ctx.stroke();ctx.fill();ctx.restore();ctx.closePath()}
function animate(){rAF=window.requestAnimationFrame(animate);analyser.getByteFrequencyData(frequencyData);analyser.getByteTimeDomainData(timeData);avg=getAvg([].slice.call(frequencyData))*gainNode.gain.value;ctx.clearRect(0,0,window.innerWidth,window.innerHeight);drawBackground();SHOW_STAR_FIELD&&drawStarField();SHOW_AVERAGE&&drawAverageCircle();SHOW_WAVEFORM&&drawWaveform()}
function Star(){this.x=Math.random()*w-cx;this.y=Math.random()*h-cy;this.z=this.max_depth=Math.max(w/h);this.radius=.2;var b=0<this.x?1:-1;var d=0<this.y?1:-1;Math.abs(this.x)>Math.abs(this.y)?(this.dx=1,this.dy=Math.abs(this.y/this.x)):(this.dx=Math.abs(this.x/this.y),this.dy=1);this.dx*=b;this.dy*=d;this.dz=-.1;this.ddx=.001*this.dx;this.ddy=.001*this.dy;this.color=this.y>cy/2?stars_color_2:avg>AVG_BREAK_POINT+10?stars_color_2:avg>STARS_BREAK_POINT?stars_color_special:stars_color}
function createStarField(){for(var b=-1;++b<TOTAL_STARS;)stars.push(new Star)}function Point(b){this.index=b.index;this.angle=360*this.index/TOTAL_POINTS;this.updateDynamics=function(){this.radius=Math.abs(w,h)/10;this.x=cx+this.radius*sin(PI_HALF*this.angle);this.y=cy+this.radius*cos(PI_HALF*this.angle)};this.updateDynamics();this.value=256*Math.random();this.dx=this.x+this.value*sin(PI_HALF*this.angle);this.dy=this.y+this.value*cos(PI_HALF*this.angle)}
function AvgPoint(b){this.index=b.index;this.angle=360*this.index/TOTAL_AVG_POINTS;this.updateDynamics=function(){this.radius=Math.abs(w,h)/10;this.x=cx+this.radius*sin(PI_HALF*this.angle);this.y=cy+this.radius*cos(PI_HALF*this.angle)};this.updateDynamics();this.value=256*Math.random();this.dx=this.x+this.value*sin(PI_HALF*this.angle);this.dy=this.y+this.value*cos(PI_HALF*this.angle)}
function createPoints(){var b;for(b=-1;++b<TOTAL_POINTS;)points.push(new Point({index:b+1}));for(b=-1;++b<TOTAL_AVG_POINTS;)avg_points.push(new AvgPoint({index:b+1}))}function resizeHandler(){w=window.innerWidth;h=window.innerHeight;cx=w/2;cy=h/2;ctx.canvas.width=w*pixelRatio;ctx.canvas.height=h*pixelRatio;ctx.scale(pixelRatio,pixelRatio);points.forEach(function(b){b.updateDynamics()});avg_points.forEach(function(b){b.updateDynamics()})};