(function(m,F){"object"===typeof exports&&"undefined"!==typeof module?module.exports=F():"function"===typeof define&&define.amd?define(F):m.CodeMirror=F()})(this,function(){function m(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}function F(a){for(var b=a.childNodes.length;0<b;--b)a.removeChild(a.firstChild);return a}function E(a,b){return F(a).appendChild(b)}function v(a,b,c,d){a=document.createElement(a);c&&(a.className=c);d&&(a.style.cssText=d);if("string"==typeof b)a.appendChild(document.createTextNode(b));
else if(b)for(c=0;c<b.length;++c)a.appendChild(b[c]);return a}function t(a,b,c,d){a=v(a,b,c,d);a.setAttribute("role","presentation");return a}function B(a,b){3==b.nodeType&&(b=b.parentNode);if(a.contains)return a.contains(b);do if(11==b.nodeType&&(b=b.host),b==a)return!0;while(b=b.parentNode)}function z(){var a;try{a=document.activeElement}catch(b){a=document.body||null}for(;a&&a.shadowRoot&&a.shadowRoot.activeElement;)a=a.shadowRoot.activeElement;return a}function w(a,b){var c=a.className;m(b).test(c)||
(a.className+=(c?" ":"")+b)}function r(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)c[d]&&!m(c[d]).test(b)&&(b+=" "+c[d]);return b}function G(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function h(a,b,c){b||(b={});for(var d in a)!a.hasOwnProperty(d)||!1===c&&b.hasOwnProperty(d)||(b[d]=a[d]);return b}function q(a,b,c,d,f){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));d=d||0;for(f=f||0;;){var k=a.indexOf("\t",d);if(0>k||k>=b)return f+(b-d);
f+=k-d;f+=c-f%c;d=k+1}}function e(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return c;return-1}function I(a,b,c){for(var d=0,f=0;;){var k=a.indexOf("\t",d);-1==k&&(k=a.length);var l=k-d;if(k==a.length||f+l>=b)return d+Math.min(l,b-f);f+=k-d;f+=c-f%c;d=k+1;if(f>=b)return d}}function g(a){for(;Qc.length<=a;)Qc.push(p(Qc)+" ");return Qc[a]}function p(a){return a[a.length-1]}function y(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=b(a[d],d);return c}function D(a,b,c){for(var d=0,f=c(b);d<a.length&&c(a[d])<=
f;)d++;a.splice(d,0,b)}function H(){}function X(a,b){var c;Object.create?c=Object.create(a):(H.prototype=a,c=new H);b&&h(b,c);return c}function O(a){return/\w/.test(a)||"\u0080"<a&&(a.toUpperCase()!=a.toLowerCase()||Tf.test(a))}function fa(a,b){return b?-1<b.source.indexOf("\\w")&&O(a)?!0:b.test(a):O(a)}function Fa(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function Q(a){return 768<=a.charCodeAt(0)&&Uf.test(a)}function ca(a,b,c){for(;(0>c?0<b:b<a.length)&&Q(a.charAt(b));)b+=
c;return b}function R(a,b,c){for(;;){if(1>=Math.abs(b-c))return a(b)?b:c;var d=Math.floor((b+c)/2);a(d)?c=d:b=d}}function ga(a,b,c){this.input=c;this.scrollbarFiller=v("div",null,"CodeMirror-scrollbar-filler");this.scrollbarFiller.setAttribute("cm-not-content","true");this.gutterFiller=v("div",null,"CodeMirror-gutter-filler");this.gutterFiller.setAttribute("cm-not-content","true");this.lineDiv=t("div",null,"CodeMirror-code");this.selectionDiv=v("div",null,null,"position: relative; z-index: 1");this.cursorDiv=
v("div",null,"CodeMirror-cursors");this.measure=v("div",null,"CodeMirror-measure");this.lineMeasure=v("div",null,"CodeMirror-measure");this.lineSpace=t("div",[this.measure,this.lineMeasure,this.selectionDiv,this.cursorDiv,this.lineDiv],null,"position: relative; outline: none");var d=t("div",[this.lineSpace],"CodeMirror-lines");this.mover=v("div",[d],null,"position: relative");this.sizer=v("div",[this.mover],"CodeMirror-sizer");this.sizerWidth=null;this.heightForcer=v("div",null,null,"position: absolute; height: 30px; width: 1px;");
this.gutters=v("div",null,"CodeMirror-gutters");this.lineGutter=null;this.scroller=v("div",[this.sizer,this.heightForcer,this.gutters],"CodeMirror-scroll");this.scroller.setAttribute("tabIndex","-1");this.wrapper=v("div",[this.scrollbarFiller,this.gutterFiller,this.scroller],"CodeMirror");S&&8>aa&&(this.gutters.style.zIndex=-1,this.scroller.style.paddingRight=0);oa||hb&&gc||(this.scroller.draggable=!0);a&&(a.appendChild?a.appendChild(this.wrapper):a(this.wrapper));this.reportedViewFrom=this.reportedViewTo=
this.viewFrom=this.viewTo=b.first;this.view=[];this.externalMeasured=this.renderedView=null;this.lastWrapHeight=this.lastWrapWidth=this.viewOffset=0;this.updateLineNumbers=null;this.nativeBarWidth=this.barHeight=this.barWidth=0;this.scrollbarsClipped=!1;this.lineNumWidth=this.lineNumInnerWidth=this.lineNumChars=null;this.alignWidgets=!1;this.maxLine=this.cachedCharWidth=this.cachedTextHeight=this.cachedPaddingH=null;this.maxLineLength=0;this.maxLineChanged=!1;this.wheelDX=this.wheelDY=this.wheelStartX=
this.wheelStartY=null;this.shift=!1;this.activeTouch=this.selForContextMenu=null;c.init(this)}function C(a,b){b-=a.first;if(0>b||b>=a.size)throw Error("There is no line "+(b+a.first)+" in the document.");for(var c=a;!c.lines;)for(var d=0;;++d){var f=c.children[d],k=f.chunkSize();if(b<k){c=f;break}b-=k}return c.lines[b]}function ba(a,b,c){var d=[],f=b.line;a.iter(b.line,c.line+1,function(a){a=a.text;f==c.line&&(a=a.slice(0,c.ch));f==b.line&&(a=a.slice(b.ch));d.push(a);++f});return d}function hc(a,
b,c){var d=[];a.iter(b,c,function(a){d.push(a.text)});return d}function Ga(a,b){var c=b-a.height;if(c)for(var d=a;d;d=d.parent)d.height+=c}function T(a){if(null==a.parent)return null;var b=a.parent;a=e(b.lines,a);for(var c=b.parent;c;b=c,c=c.parent)for(var d=0;c.children[d]!=b;++d)a+=c.children[d].chunkSize();return a+b.first}function Ya(a,b){var c=a.first;a:do{for(var d=0;d<a.children.length;++d){var f=a.children[d],k=f.height;if(b<k){a=f;continue a}b-=k;c+=f.chunkSize()}return c}while(!a.lines);
for(d=0;d<a.lines.length;++d){f=a.lines[d].height;if(b<f)break;b-=f}return c+d}function tb(a,b){return b>=a.first&&b<a.first+a.size}function ic(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}function A(a,b,c){void 0===c&&(c=null);if(!(this instanceof A))return new A(a,b,c);this.line=a;this.ch=b;this.sticky=c}function M(a,b){return a.line-b.line||a.ch-b.ch}function ub(a,b){return a.sticky==b.sticky&&0==M(a,b)}function jc(a){return A(a.line,a.ch)}function Ma(a,b){return 0>M(a,b)?b:a}
function va(a,b){return 0>M(a,b)?a:b}function K(a,b){if(b.line<a.first)return A(a.first,0);var c=a.first+a.size-1;if(b.line>c)return A(c,C(a,c).text.length);var c=C(a,b.line).text.length,d=b.ch,c=null==d||d>c?A(b.line,c):0>d?A(b.line,0):b;return c}function vb(a,b){for(var c=[],d=0;d<b.length;d++)c[d]=K(a,b[d]);return c}function Za(a,b,c){this.marker=a;this.from=b;this.to=c}function ia(a,b){if(a)for(var c=0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function Ja(a,b){if(b.full)return null;
var c=tb(a,b.from.line)&&C(a,b.from.line).markedSpans,d=tb(a,b.to.line)&&C(a,b.to.line).markedSpans;if(!c&&!d)return null;var f=b.from.ch,k=b.to.ch,l=0==M(b.from,b.to),u;if(c)for(var x=0;x<c.length;++x){var U=c[x],e=U.marker;if(null==U.from||(e.inclusiveLeft?U.from<=f:U.from<f)||!(U.from!=f||"bookmark"!=e.type||l&&U.marker.insertLeft)){var n=null==U.to||(e.inclusiveRight?U.to>=f:U.to>f);(u||(u=[])).push(new Za(e,U.from,n?null:U.to))}}var c=u,N;if(d)for(u=0;u<d.length;++u)if(x=d[u],U=x.marker,null==
x.to||(U.inclusiveRight?x.to>=k:x.to>k)||x.from==k&&"bookmark"==U.type&&(!l||x.marker.insertLeft))e=null==x.from||(U.inclusiveLeft?x.from<=k:x.from<k),(N||(N=[])).push(new Za(U,e?null:x.from-k,null==x.to?null:x.to-k));d=N;k=1==b.text.length;l=p(b.text).length+(k?f:0);if(c)for(N=0;N<c.length;++N)if(u=c[N],null==u.to)(x=ia(d,u.marker),x)?k&&(u.to=null==x.to?null:x.to+l):u.to=f;if(d)for(f=0;f<d.length;++f)N=d[f],null!=N.to&&(N.to+=l),null==N.from?ia(c,N.marker)||(N.from=l,k&&(c||(c=[])).push(N)):(N.from+=
l,k&&(c||(c=[])).push(N));c&&(c=ib(c));d&&d!=c&&(d=ib(d));f=[c];if(!k){var k=b.text.length-2,g;if(0<k&&c)for(l=0;l<c.length;++l)null==c[l].to&&(g||(g=[])).push(new Za(c[l].marker,null,null));for(c=0;c<k;++c)f.push(g);f.push(d)}return f}function ib(a){for(var b=0;b<a.length;++b){var c=a[b];null!=c.from&&c.from==c.to&&!1!==c.marker.clearWhenEmpty&&a.splice(b--,1)}return a.length?a:null}function jb(a,b,c){var d=null;a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=
a.markedSpans[b].marker;!c.readOnly||d&&-1!=e(d,c)||(d||(d=[])).push(c)}});if(!d)return null;a=[{from:b,to:c}];for(b=0;b<d.length;++b){c=d[b];for(var f=c.find(0),k=0;k<a.length;++k){var l=a[k];if(!(0>M(l.to,f.from)||0<M(l.from,f.to))){var u=[k,1],x=M(l.from,f.from),U=M(l.to,f.to);(0>x||!c.inclusiveLeft&&!x)&&u.push({from:l.from,to:f.from});(0<U||!c.inclusiveRight&&!U)&&u.push({from:f.to,to:l.to});a.splice.apply(a,u);k+=u.length-3}}}return a}function V(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);
a.markedSpans=null}}function sa(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function ra(a,b){var c=a.lines.length-b.lines.length;if(0!=c)return c;var c=a.find(),d=b.find(),f=M(c.from,d.from)||(a.inclusiveLeft?-1:0)-(b.inclusiveLeft?-1:0);return f?-f:(c=M(c.to,d.to)||(a.inclusiveRight?1:0)-(b.inclusiveRight?1:0))?c:b.id-a.id}function $a(a,b){var c=kb&&a.markedSpans,d;if(c)for(var f,k=0;k<c.length;++k)f=c[k],f.marker.collapsed&&null==(b?f.from:f.to)&&(!d||0>ra(d,
f.marker))&&(d=f.marker);return d}function Z(a,b,c,d,f){a=C(a,b);if(a=kb&&a.markedSpans)for(b=0;b<a.length;++b){var k=a[b];if(k.marker.collapsed){var l=k.marker.find(0),u=M(l.from,c)||(k.marker.inclusiveLeft?-1:0)-(f.inclusiveLeft?-1:0),x=M(l.to,d)||(k.marker.inclusiveRight?1:0)-(f.inclusiveRight?1:0);if(!(0<=u&&0>=x||0>=u&&0<=x)&&(0>=u&&(k.marker.inclusiveRight&&f.inclusiveLeft?0<=M(l.to,c):0<M(l.to,c))||0<=u&&(k.marker.inclusiveRight&&f.inclusiveLeft?0>=M(l.from,d):0>M(l.from,d))))return!0}}}function Ka(a){for(var b;b=
$a(a,!0);)a=b.find(-1,!0).line;return a}function Kb(a,b){var c=C(a,b),d=Ka(c);return c==d?b:T(d)}function Rc(a,b){if(b>a.lastLine())return b;var c=C(a,b),d;if(!ab(a,c))return b;for(;d=$a(c,!1);)c=d.find(1,!0).line;return T(c)+1}function ab(a,b){var c=kb&&b.markedSpans;if(c)for(var d,f=0;f<c.length;++f)if(d=c[f],d.marker.collapsed&&(null==d.from||!d.marker.widgetNode&&0==d.from&&d.marker.inclusiveLeft&&kc(a,b,d)))return!0}function kc(a,b,c){if(null==c.to)return b=c.marker.find(1,!0),kc(a,b.line,ia(b.line.markedSpans,
c.marker));if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var d,f=0;f<b.markedSpans.length;++f)if(d=b.markedSpans[f],d.marker.collapsed&&!d.marker.widgetNode&&d.from==c.to&&(null==d.to||d.to!=c.from)&&(d.marker.inclusiveLeft||c.marker.inclusiveRight)&&kc(a,b,d))return!0}function wa(a){a=Ka(a);for(var b=0,c=a.parent,d=0;d<c.lines.length;++d){var f=c.lines[d];if(f==a)break;else b+=f.height}for(a=c.parent;a;c=a,a=c.parent)for(d=0;d<a.children.length&&(f=a.children[d],f!=c);++d)b+=f.height;
return b}function wb(a){if(0==a.height)return 0;for(var b=a.text.length,c,d=a;c=$a(d,!0);)c=c.find(0,!0),d=c.from.line,b+=c.from.ch-c.to.ch;for(d=a;c=$a(d,!1);)a=c.find(0,!0),b-=d.text.length-a.from.ch,d=a.to.line,b+=d.text.length-a.to.ch;return b}function Ca(a){var b=a.display;a=a.doc;b.maxLine=C(a,a.first);b.maxLineLength=wb(b.maxLine);b.maxLineChanged=!0;a.iter(function(a){var d=wb(a);d>b.maxLineLength&&(b.maxLineLength=d,b.maxLine=a)})}function lc(a,b,c,d){if(!a)return d(b,c,"ltr");for(var f=
!1,k=0;k<a.length;++k){var l=a[k];if(l.from<c&&l.to>b||b==c&&l.to==b)d(Math.max(l.from,b),Math.min(l.to,c),1==l.level?"rtl":"ltr"),f=!0}f||d(b,c,"ltr")}function mc(a,b,c){var d;nc=null;for(var f=0;f<a.length;++f){var k=a[f];if(k.from<b&&k.to>b)return f;k.to==b&&(k.from!=k.to&&"before"==c?d=f:nc=f);k.from==b&&(k.from!=k.to&&"before"!=c?d=f:nc=f)}return null!=d?d:nc}function Na(a,b){var c=a.order;null==c&&(c=a.order=Vf(a.text,b));return c}function lb(a,b,c){b=ca(a.text,b+c,c);return 0>b||b>a.text.length?
null:b}function Oa(a,b,c){a=lb(a,b.ch,c);return null==a?null:new A(b.line,a,0>c?"after":"before")}function xb(a,b,c,d,f){if(a&&(a=Na(c,b.doc.direction))){a=0>f?p(a):a[0];var k=0>f==(1==a.level)?"after":"before",l;if(0<a.level){var u=Lb(b,c);l=0>f?c.text.length-1:0;var x=bb(b,u,l).top;l=R(function(a){return bb(b,u,a).top==x},0>f==(1==a.level)?a.from:a.to-1,l);"before"==k&&(l=lb(c,l,1,!0))}else l=0>f?a.to:a.from;return new A(d,l,k)}return new A(d,0>f?c.text.length:0,0>f?"before":"after")}function Sc(a,
b,c,d){var f=Na(b,a.doc.direction);if(!f)return Oa(b,c,d);c.ch>=b.text.length?(c.ch=b.text.length,c.sticky="before"):0>=c.ch&&(c.ch=0,c.sticky="after");var k=mc(f,c.ch,c.sticky),l=f[k];if("ltr"==a.doc.direction&&0==l.level%2&&(0<d?l.to>c.ch:l.from<c.ch))return Oa(b,c,d);var u=function(a,d){return lb(b,a instanceof A?a.ch:a,d)},x,e=function(d){if(!a.options.lineWrapping)return{begin:0,end:b.text.length};var c=x=x||Lb(a,b);d=yb(a,b,bb(a,c,d),"line").top;return fe(a,b,c,d)},n=e("before"==c.sticky?u(c,
-1):c.ch);if("rtl"==a.doc.direction||1==l.level){var p=1==l.level==0>d,N=u(c,p?1:-1);if(null!=N&&(p?N<=l.to&&N<=n.end:N>=l.from&&N>=n.begin))return new A(c.line,N,p?"before":"after")}l=function(a,b,d){for(var k=function(a,b){return b?new A(c.line,u(a,1),"before"):new A(c.line,a,"after")};0<=a&&a<f.length;a+=b){var l=f[a],x=0<b==(1!=l.level),e=x?d.begin:u(d.end,-1);if(l.from<=e&&e<l.to)return k(e,x);e=x?l.from:u(l.to,-1);if(d.begin<=e&&e<d.end)return k(e,x)}};if(k=l(k+d,d,n))return k;n=0<d?n.end:u(n.begin,
-1);return null==n||0<d&&n==b.text.length||!(k=l(0<d?0:f.length-1,d,e(n)))?null:k}function ta(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else{var d=(a=a._handlers)&&a[b];d&&(c=e(d,c),-1<c&&(a[b]=d.slice(0,c).concat(d.slice(c+1))))}}function ha(a,b){var c=a._handlers&&a._handlers[b]||Tc;if(c.length)for(var d=Array.prototype.slice.call(arguments,2),f=0;f<c.length;++f)c[f].apply(null,d)}function ea(a,b,c){"string"==typeof b&&(b={type:b,
preventDefault:function(){this.defaultPrevented=!0}});ha(a,c||b.type,a,b);return Mb(b)||b.codemirrorIgnore}function oc(a){var b=a._handlers&&a._handlers.cursorActivity;if(b){a=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=[]);for(var c=0;c<b.length;++c)-1==e(a,b[c])&&a.push(b[c])}}function Da(a,b){return 0<(a._handlers&&a._handlers[b]||Tc).length}function Ua(a){a.prototype.on=function(a,c){L(this,a,c)};a.prototype.off=function(a,c){ta(this,a,c)}}function ka(a){a.preventDefault?a.preventDefault():
a.returnValue=!1}function cb(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function Mb(a){return null!=a.defaultPrevented?a.defaultPrevented:0==a.returnValue}function Va(a){ka(a);cb(a)}function db(a){var b=a.which;null==b&&(a.button&1?b=1:a.button&2?b=3:a.button&4&&(b=2));Pa&&a.ctrlKey&&1==b&&(b=3);return b}function La(a){if(null==ud){var b=v("span","\u200b");E(a,v("span",[b,document.createTextNode("x")]));0!=a.firstChild.offsetHeight&&(ud=1>=b.offsetWidth&&2<b.offsetHeight&&!(S&&8>aa))}a=
ud?v("span","\u200b"):v("span","\u00a0",null,"display: inline-block; width: 1px; margin-right: -1px");a.setAttribute("cm-text","");return a}function pc(a,b){2<arguments.length&&(b.dependencies=Array.prototype.slice.call(arguments,2));vd[a]=b}function zb(a){if("string"==typeof a&&Nb.hasOwnProperty(a))a=Nb[a];else if(a&&"string"==typeof a.name&&Nb.hasOwnProperty(a.name)){var b=Nb[a.name];"string"==typeof b&&(b={name:b});a=X(b,a);a.name=b.name}else{if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a))return zb("application/xml");
if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+json$/.test(a))return zb("application/json")}return"string"==typeof a?{name:a}:a||{name:"null"}}function mb(a,b){b=zb(b);var c=vd[b.name];if(!c)return mb(a,"text/plain");c=c(a,b);if(Ob.hasOwnProperty(b.name)){var d=Ob[b.name],f;for(f in d)d.hasOwnProperty(f)&&(c.hasOwnProperty(f)&&(c["_"+f]=c[f]),c[f]=d[f])}c.name=b.name;b.helperType&&(c.helperType=b.helperType);if(b.modeProps)for(var k in b.modeProps)c[k]=b.modeProps[k];return c}function wd(a,b){var c=Ob.hasOwnProperty(a)?
Ob[a]:Ob[a]={};h(b,c)}function xa(a,b){if(!0===b)return b;if(a.copyState)return a.copyState(b);var c={},d;for(d in b){var f=b[d];f instanceof Array&&(f=f.concat([]));c[d]=f}return c}function nb(a,b){for(var c;a.innerMode;){c=a.innerMode(b);if(!c||c.mode==a)break;b=c.state;a=c.mode}return c||{mode:a,state:b}}function Uc(a,b,c){return a.startState?a.startState(b,c):!0}function J(a,b,c,d){var f=[a.state.modeGen],k={};ge(a,b.text,a.doc.mode,c,function(a,b){return f.push(a,b)},k,d);c=function(d){var c=
a.state.overlays[d],l=1,e=0;ge(a,b.text,c.mode,!0,function(a,b){for(var d=l;e<a;){var k=f[l];k>a&&f.splice(l,1,a,f[l+1],k);l+=2;e=Math.min(a,k)}if(b)if(c.opaque)f.splice(d,l-d,a,"overlay "+b),l=d+2;else for(;d<l;d+=2)k=f[d+1],f[d+1]=(k?k+" ":"")+"overlay "+b},k)};for(d=0;d<a.state.overlays.length;++d)c(d);return{styles:f,classes:k.bgClass||k.textClass?k:null}}function Vc(a,b,c){if(!b.styles||b.styles[0]!=a.state.modeGen){var d=n(a,T(b)),f=J(a,b,b.text.length>a.options.maxHighlightLength?xa(a.doc.mode,
d):d);b.stateAfter=d;b.styles=f.styles;f.classes?b.styleClasses=f.classes:b.styleClasses&&(b.styleClasses=null);c===a.doc.frontier&&a.doc.frontier++}return b.styles}function n(a,b,c){var d=a.doc,f=a.display;if(!d.mode.startState)return!0;var k=Wf(a,b,c),l=k>d.first&&C(d,k-1).stateAfter,l=l?xa(d.mode,l):Uc(d.mode);d.iter(k,b,function(c){P(a,c.text,l);c.stateAfter=k==b-1||0==k%5||k>=f.viewFrom&&k<f.viewTo?xa(d.mode,l):null;++k});c&&(d.frontier=k);return l}function P(a,b,c,d){var f=a.doc.mode;a=new la(b,
a.options.tabSize);a.start=a.pos=d||0;for(""==b&&he(f,c);!a.eol();)xd(f,a,c),a.start=a.pos}function he(a,b){if(a.blankLine)return a.blankLine(b);if(a.innerMode){var c=nb(a,b);if(c.mode.blankLine)return c.mode.blankLine(c.state)}}function xd(a,b,c,d){for(var f=0;10>f;f++){d&&(d[0]=nb(a,c).mode);var k=a.token(b,c);if(b.pos>b.start)return k}throw Error("Mode "+a.name+" failed to advance stream.");}function ie(a,b,c,d){var f=function(a){return{start:p.start,end:p.pos,string:p.current(),type:u||null,state:a?
xa(k.mode,e):e}},k=a.doc,l=k.mode,u;b=K(k,b);var x=C(k,b.line),e=n(a,b.line,c),p=new la(x.text,a.options.tabSize),g;for(d&&(g=[]);(d||p.pos<b.ch)&&!p.eol();)p.start=p.pos,u=xd(l,p,e),d&&g.push(f(!0));return d?g:f()}function je(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!c)break;a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var d=c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:(new RegExp("(?:^|s)"+c[2]+"(?:$|s)")).test(b[d])||(b[d]+=" "+c[2])}return a}function ge(a,
b,c,d,f,k,l){var u=c.flattenSpans;null==u&&(u=a.options.flattenSpans);var x=0,e=null,n=new la(b,a.options.tabSize),p,N=a.options.addModeClass&&[null];for(""==b&&je(he(c,d),k);!n.eol();){n.pos>a.options.maxHighlightLength?(u=!1,l&&P(a,b,d,n.pos),n.pos=b.length,p=null):p=je(xd(c,n,d,N),k);if(N){var g=N[0].name;g&&(p="m-"+(p?g+" "+p:g))}if(!u||e!=p){for(;x<n.start;)x=Math.min(n.start,x+5E3),f(x,e);e=p}n.start=n.pos}for(;x<n.pos;)a=Math.min(n.pos,x+5E3),f(a,e),x=a}function Wf(a,b,c){for(var d,f,k=a.doc,
l=c?-1:b-(a.doc.mode.innerMode?1E3:100);b>l;--b){if(b<=k.first)return k.first;var u=C(k,b-1);if(u.stateAfter&&(!c||b<=k.frontier))return b;u=q(u.text,null,a.options.tabSize);if(null==f||d>u)f=b-1,d=u}return f}function ke(a,b){if(!a||/^\s*$/.test(a))return null;var c=b.addModeClass?Xf:Yf;return c[a]||(c[a]=a.replace(/\S+/g,"cm-$&"))}function le(a,b){var c=t("span",null,null,oa?"padding-right: .1px":null),c={pre:t("pre",[c],"CodeMirror-line"),content:c,col:0,pos:0,cm:a,trailingSpace:!1,splitSpaces:(S||
oa)&&a.getOption("lineWrapping")};b.measure={};for(var d=0;d<=(b.rest?b.rest.length:0);d++){var f=d?b.rest[d-1]:b.line,k=void 0;c.pos=0;c.addToken=Zf;var l;l=a.display.measure;if(null!=yd)l=yd;else{var u=E(l,document.createTextNode("A\u062eA")),x=Pb(u,0,1).getBoundingClientRect(),u=Pb(u,1,2).getBoundingClientRect();F(l);l=x&&x.left!=x.right?yd=3>u.right-x.right:!1}l&&(k=Na(f,a.doc.direction))&&(c.addToken=$f(c.addToken,k));c.map=[];var e=b!=a.display.externalMeasured&&T(f);a:{var n=u=x=l=void 0,p=
void 0,g=void 0,q=void 0,k=c,e=Vc(a,f,e),h=f.markedSpans,m=f.text,y=0;if(h)for(var I=m.length,P=0,w=1,v="",D=0;;){if(D==P){p=n=u=x=g="";l=null;for(var D=Infinity,ba=[],Z=void 0,H=0;H<h.length;++H){var z=h[H],G=z.marker;"bookmark"==G.type&&z.from==P&&G.widgetNode?ba.push(G):z.from<=P&&(null==z.to||z.to>P||G.collapsed&&z.to==P&&z.from==P)?(null!=z.to&&z.to!=P&&D>z.to&&(D=z.to,n=""),G.className&&(p+=" "+G.className),G.css&&(g=(g?g+";":"")+G.css),G.startStyle&&z.from==P&&(u+=" "+G.startStyle),G.endStyle&&
z.to==D&&(Z||(Z=[])).push(G.endStyle,z.to),G.title&&!x&&(x=G.title),G.collapsed&&(!l||0>ra(l.marker,G))&&(l=z)):z.from>P&&D>z.from&&(D=z.from)}if(Z)for(H=0;H<Z.length;H+=2)Z[H+1]==D&&(n+=" "+Z[H]);if(!l||l.from==P)for(Z=0;Z<ba.length;++Z)me(k,0,ba[Z]);if(l&&(l.from||0)==P){me(k,(null==l.to?I+1:l.to)-P,l.marker,null==l.from);if(null==l.to)break a;l.to==P&&(l=!1)}}if(P>=I)break;for(ba=Math.min(I,D);;){if(v){Z=P+v.length;l||(H=Z>ba?v.slice(0,ba-P):v,k.addToken(k,H,q?q+p:p,u,P+H.length==D?n:"",x,g));
if(Z>=ba){v=v.slice(ba-P);P=ba;break}P=Z;u=""}v=m.slice(y,y=e[w++]);q=ke(e[w++],k.cm.options)}}else for(l=1;l<e.length;l+=2)k.addToken(k,m.slice(y,y=e[l]),ke(e[l+1],k.cm.options))}f.styleClasses&&(f.styleClasses.bgClass&&(c.bgClass=r(f.styleClasses.bgClass,c.bgClass||"")),f.styleClasses.textClass&&(c.textClass=r(f.styleClasses.textClass,c.textClass||"")));0==c.map.length&&c.map.push(0,0,c.content.appendChild(La(a.display.measure)));0==d?(b.measure.map=c.map,b.measure.cache={}):((b.measure.maps||(b.measure.maps=
[])).push(c.map),(b.measure.caches||(b.measure.caches=[])).push({}))}oa&&(d=c.content.lastChild,/\bcm-tab\b/.test(d.className)||d.querySelector&&d.querySelector(".cm-tab"))&&(c.content.className="cm-tab-wrap-hack");ha(a,"renderLine",a,b.line,c.pre);c.pre.className&&(c.textClass=r(c.pre.className,c.textClass||""));return c}function ag(a){var b=v("span","\u2022","cm-invalidchar");b.title="\\u"+a.charCodeAt(0).toString(16);b.setAttribute("aria-label",b.title);return b}function Zf(a,b,c,d,f,k,l){if(b){var u;
if(a.splitSpaces)if(u=a.trailingSpace,1<b.length&&!/  /.test(b))u=b;else{for(var x="",e=0;e<b.length;e++){var n=b.charAt(e);" "!=n||!u||e!=b.length-1&&32!=b.charCodeAt(e+1)||(n="\u00a0");x+=n;u=" "==n}u=x}else u=b;x=u;e=a.cm.state.specialChars;n=!1;if(e.test(b)){u=document.createDocumentFragment();for(var p=0;;){e.lastIndex=p;var N=e.exec(b),q=N?N.index-p:b.length-p;if(q){var h=document.createTextNode(x.slice(p,p+q));S&&9>aa?u.appendChild(v("span",[h])):u.appendChild(h);a.map.push(a.pos,a.pos+q,h);
a.col+=q;a.pos+=q}if(!N)break;p+=q+1;"\t"==N[0]?(N=a.cm.options.tabSize,N-=a.col%N,q=u.appendChild(v("span",g(N),"cm-tab")),q.setAttribute("role","presentation"),q.setAttribute("cm-text","\t"),a.col+=N):("\r"==N[0]||"\n"==N[0]?(q=u.appendChild(v("span","\r"==N[0]?"\u240d":"\u2424","cm-invalidchar")),q.setAttribute("cm-text",N[0])):(q=a.cm.options.specialCharPlaceholder(N[0]),q.setAttribute("cm-text",N[0]),S&&9>aa?u.appendChild(v("span",[q])):u.appendChild(q)),a.col+=1);a.map.push(a.pos,a.pos+1,q);
a.pos++}}else a.col+=b.length,u=document.createTextNode(x),a.map.push(a.pos,a.pos+b.length,u),S&&9>aa&&(n=!0),a.pos+=b.length;a.trailingSpace=32==x.charCodeAt(b.length-1);if(c||d||f||n||l)return b=c||"",d&&(b+=d),f&&(b+=f),d=v("span",[u],b,l),k&&(d.title=k),a.content.appendChild(d);a.content.appendChild(u)}}function $f(a,b){return function(c,d,f,k,l,u,x){f=f?f+" cm-force-border":"cm-force-border";for(var e=c.pos,n=e+d.length;;){for(var p=void 0,g=0;g<b.length&&!(p=b[g],p.to>e&&p.from<=e);g++);if(p.to>=
n)return a(c,d,f,k,l,u,x);a(c,d.slice(0,p.to-e),f,k,null,u,x);k=null;d=d.slice(p.to-e);e=p.to}}}function me(a,b,c,d){var f=!d&&c.widgetNode;f&&a.map.push(a.pos,a.pos+b,f);!d&&a.cm.display.input.needsContentAttribute&&(f||(f=a.content.appendChild(document.createElement("span"))),f.setAttribute("cm-marker",c.id));f&&(a.cm.display.input.setUneditable(f),a.content.appendChild(f));a.pos+=b;a.trailingSpace=!1}function ne(a,b,c){for(var d=this.line=b,f;d=$a(d,!1);)d=d.find(1,!0).line,(f||(f=[])).push(d);
this.size=(this.rest=f)?T(p(this.rest))-c+1:1;this.node=this.text=null;this.hidden=ab(a,b)}function Wc(a,b,c){var d=[],f;for(f=b;f<c;)b=new ne(a.doc,C(a.doc,f),f),f+=b.size,d.push(b);return d}function bg(a,b){var c=a.ownsGroup;if(c)try{var d=c.delayedCallbacks,f=0;do{for(;f<d.length;f++)d[f].call(null);for(var k=0;k<c.ops.length;k++){var l=c.ops[k];if(l.cursorActivityHandlers)for(;l.cursorActivityCalled<l.cursorActivityHandlers.length;)l.cursorActivityHandlers[l.cursorActivityCalled++].call(null,
l.cm)}}while(f<d.length)}finally{Qb=null,b(c)}}function pa(a,b){var c=a._handlers&&a._handlers[b]||Tc;if(c.length){var d=Array.prototype.slice.call(arguments,2),f;Qb?f=Qb.delayedCallbacks:qc?f=qc:(f=qc=[],setTimeout(cg,0));for(var k=function(a){f.push(function(){return c[a].apply(null,d)})},l=0;l<c.length;++l)k(l)}}function cg(){var a=qc;qc=null;for(var b=0;b<a.length;++b)a[b]()}function oe(a,b,c,d){for(var f=0;f<b.changes.length;f++){var k=b.changes[f];if("text"==k){var k=a,l=b,u=l.text.className,
x=pe(k,l);l.text==l.node&&(l.node=x.pre);l.text.parentNode.replaceChild(x.pre,l.text);l.text=x.pre;x.bgClass!=l.bgClass||x.textClass!=l.textClass?(l.bgClass=x.bgClass,l.textClass=x.textClass,zd(k,l)):u&&(l.text.className=u)}else if("gutter"==k)qe(a,b,c,d);else if("class"==k)zd(a,b);else if("widget"==k){k=a;l=b;u=d;l.alignable&&(l.alignable=null);for(var x=l.node.firstChild,e;x;x=e)e=x.nextSibling,"CodeMirror-linewidget"==x.className&&l.node.removeChild(x);re(k,l,u)}}b.changes=null}function rc(a){a.node==
a.text&&(a.node=v("div",null,null,"position: relative"),a.text.parentNode&&a.text.parentNode.replaceChild(a.node,a.text),a.node.appendChild(a.text),S&&8>aa&&(a.node.style.zIndex=2));return a.node}function pe(a,b){var c=a.display.externalMeasured;return c&&c.line==b.line?(a.display.externalMeasured=null,b.measure=c.measure,c.built):le(a,b)}function zd(a,b){var c=b.bgClass?b.bgClass+" "+(b.line.bgClass||""):b.line.bgClass;c&&(c+=" CodeMirror-linebackground");if(b.background)c?b.background.className=
c:(b.background.parentNode.removeChild(b.background),b.background=null);else if(c){var d=rc(b);b.background=d.insertBefore(v("div",null,c),d.firstChild);a.display.input.setUneditable(b.background)}b.line.wrapClass?rc(b).className=b.line.wrapClass:b.node!=b.text&&(b.node.className="");b.text.className=(b.textClass?b.textClass+" "+(b.line.textClass||""):b.line.textClass)||""}function qe(a,b,c,d){b.gutter&&(b.node.removeChild(b.gutter),b.gutter=null);b.gutterBackground&&(b.node.removeChild(b.gutterBackground),
b.gutterBackground=null);if(b.line.gutterClass){var f=rc(b);b.gutterBackground=v("div",null,"CodeMirror-gutter-background "+b.line.gutterClass,"left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px; width: "+d.gutterTotalWidth+"px");a.display.input.setUneditable(b.gutterBackground);f.insertBefore(b.gutterBackground,b.text)}f=b.line.gutterMarkers;if(a.options.lineNumbers||f){var k=rc(b),l=b.gutter=v("div",null,"CodeMirror-gutter-wrapper","left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+
"px");a.display.input.setUneditable(l);k.insertBefore(l,b.text);b.line.gutterClass&&(l.className+=" "+b.line.gutterClass);!a.options.lineNumbers||f&&f["CodeMirror-linenumbers"]||(b.lineNumber=l.appendChild(v("div",ic(a.options,c),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+d.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+a.display.lineNumInnerWidth+"px")));if(f)for(b=0;b<a.options.gutters.length;++b)c=a.options.gutters[b],(k=f.hasOwnProperty(c)&&f[c])&&l.appendChild(v("div",[k],"CodeMirror-gutter-elt",
"left: "+d.gutterLeft[c]+"px; width: "+d.gutterWidth[c]+"px"))}}function dg(a,b,c,d){var f=pe(a,b);b.text=b.node=f.pre;f.bgClass&&(b.bgClass=f.bgClass);f.textClass&&(b.textClass=f.textClass);zd(a,b);qe(a,b,c,d);re(a,b,d);return b.node}function re(a,b,c){se(a,b.line,b,c,!0);if(b.rest)for(var d=0;d<b.rest.length;d++)se(a,b.rest[d],b,c,!1)}function se(a,b,c,d,f){if(b.widgets){var k=rc(c),l=0;for(b=b.widgets;l<b.length;++l){var u=b[l],x=v("div",[u.node],"CodeMirror-linewidget");u.handleMouseEvents||x.setAttribute("cm-ignore-events",
"true");var e=u,n=x,p=d;if(e.noHScroll){(c.alignable||(c.alignable=[])).push(n);var g=p.wrapperWidth;n.style.left=p.fixedPos+"px";e.coverGutter||(g-=p.gutterTotalWidth,n.style.paddingLeft=p.gutterTotalWidth+"px");n.style.width=g+"px"}e.coverGutter&&(n.style.zIndex=5,n.style.position="relative",e.noHScroll||(n.style.marginLeft=-p.gutterTotalWidth+"px"));a.display.input.setUneditable(x);f&&u.above?k.insertBefore(x,c.gutter||c.text):k.appendChild(x);pa(u,"redraw")}}}function sc(a){if(null!=a.height)return a.height;
var b=a.doc.cm;if(!b)return 0;if(!B(document.body,a.node)){var c="position: relative;";a.coverGutter&&(c+="margin-left: -"+b.display.gutters.offsetWidth+"px;");a.noHScroll&&(c+="width: "+b.display.wrapper.clientWidth+"px;");E(b.display.measure,v("div",[a.node],null,c))}return a.height=a.node.parentNode.offsetHeight}function eb(a,b){for(var c=b.target||b.srcElement;c!=a.wrapper;c=c.parentNode)if(!c||1==c.nodeType&&"true"==c.getAttribute("cm-ignore-events")||c.parentNode==a.sizer&&c!=a.mover)return!0}
function Ad(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function te(a){if(a.cachedPaddingH)return a.cachedPaddingH;var b=E(a.measure,v("pre","x")),b=window.getComputedStyle?window.getComputedStyle(b):b.currentStyle,b={left:parseInt(b.paddingLeft),right:parseInt(b.paddingRight)};isNaN(b.left)||isNaN(b.right)||(a.cachedPaddingH=b);return b}function Wa(a){return 30-a.display.nativeBarWidth}function Ab(a){return a.display.scroller.clientWidth-Wa(a)-a.display.barWidth}function Bd(a){return a.display.scroller.clientHeight-
Wa(a)-a.display.barHeight}function ue(a,b,c){if(a.line==b)return{map:a.measure.map,cache:a.measure.cache};for(var d=0;d<a.rest.length;d++)if(a.rest[d]==b)return{map:a.measure.maps[d],cache:a.measure.caches[d]};for(b=0;b<a.rest.length;b++)if(T(a.rest[b])>c)return{map:a.measure.maps[b],cache:a.measure.caches[b],before:!0}}function Cd(a,b){if(b>=a.display.viewFrom&&b<a.display.viewTo)return a.display.view[Bb(a,b)];var c=a.display.externalMeasured;if(c&&b>=c.lineN&&b<c.lineN+c.size)return c}function Lb(a,
b){var c=T(b),d=Cd(a,c);d&&!d.text?d=null:d&&d.changes&&(oe(a,d,c,Dd(a)),a.curOp.forceUpdate=!0);if(!d){var f;f=Ka(b);d=T(f);f=a.display.externalMeasured=new ne(a.doc,f,d);f.lineN=d;d=f.built=le(a,f);f.text=d.pre;E(a.display.lineMeasure,d.pre);d=f}c=ue(d,b,c);return{line:b,view:d,rect:null,map:c.map,cache:c.cache,before:c.before,hasHeights:!1}}function bb(a,b,c,d,f){b.before&&(c=-1);var k=c+(d||"");if(b.cache.hasOwnProperty(k))a=b.cache[k];else{b.rect||(b.rect=b.view.text.getBoundingClientRect());
if(!b.hasHeights){var l=b.view,u=b.rect,x=a.options.lineWrapping,e=x&&Ab(a);if(!l.measure.heights||x&&l.measure.width!=e){var n=l.measure.heights=[];if(x)for(l.measure.width=e,l=l.text.firstChild.getClientRects(),x=0;x<l.length-1;x++){var e=l[x],p=l[x+1];2<Math.abs(e.bottom-p.bottom)&&n.push((e.bottom+p.top)/2-u.top)}n.push(u.bottom-u.top)}b.hasHeights=!0}n=d;l=ve(b.map,c,n);d=l.node;u=l.start;x=l.end;c=l.collapse;var g;if(3==d.nodeType){for(var q=0;4>q;q++){for(;u&&Q(b.line.text.charAt(l.coverStart+
u));)--u;for(;l.coverStart+x<l.coverEnd&&Q(b.line.text.charAt(l.coverStart+x));)++x;if(S&&9>aa&&0==u&&x==l.coverEnd-l.coverStart)g=d.parentNode.getBoundingClientRect();else{g=Pb(d,u,x).getClientRects();x=we;if("left"==n)for(e=0;e<g.length&&(x=g[e]).left==x.right;e++);else for(e=g.length-1;0<=e&&(x=g[e]).left==x.right;e--);g=x}if(g.left||g.right||0==u)break;x=u;--u;c="right"}S&&11>aa&&((q=!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI)||(null!=Ed?q=Ed:(n=E(a.display.measure,
v("span","x")),q=n.getBoundingClientRect(),n=Pb(n,0,1).getBoundingClientRect(),q=Ed=1<Math.abs(q.left-n.left)),q=!q),q||(q=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI,g={left:g.left*q,right:g.right*q,top:g.top*n,bottom:g.bottom*n}))}else 0<u&&(c=n="right"),g=a.options.lineWrapping&&1<(q=d.getClientRects()).length?q["right"==n?q.length-1:0]:d.getBoundingClientRect();!(S&&9>aa)||u||g&&(g.left||g.right)||(g=(g=d.parentNode.getClientRects()[0])?{left:g.left,right:g.left+
tc(a.display),top:g.top,bottom:g.bottom}:we);d=g.top-b.rect.top;u=g.bottom-b.rect.top;q=(d+u)/2;n=b.view.measure.heights;for(l=0;l<n.length-1&&!(q<n[l]);l++);c={left:("right"==c?g.right:g.left)-b.rect.left,right:("left"==c?g.left:g.right)-b.rect.left,top:l?n[l-1]:0,bottom:n[l]};g.left||g.right||(c.bogus=!0);a.options.singleCursorHeightPerLine||(c.rtop=d,c.rbottom=u);a=c;a.bogus||(b.cache[k]=a)}return{left:a.left,right:a.right,top:f?a.rtop:a.top,bottom:f?a.rbottom:a.bottom}}function ve(a,b,c){for(var d,
f,k,l,u,x,e=0;e<a.length;e+=3){u=a[e];x=a[e+1];if(b<u)f=0,k=1,l="left";else if(b<x)f=b-u,k=f+1;else if(e==a.length-3||b==x&&a[e+3]>b)k=x-u,f=k-1,b>=x&&(l="right");if(null!=f){d=a[e+2];u==x&&c==(d.insertLeft?"left":"right")&&(l=c);if("left"==c&&0==f)for(;e&&a[e-2]==a[e-3]&&a[e-1].insertLeft;)d=a[(e-=3)+2],l="left";if("right"==c&&f==x-u)for(;e<a.length-3&&a[e+3]==a[e+4]&&!a[e+5].insertLeft;)d=a[(e+=3)+2],l="right";break}}return{node:d,start:f,end:k,collapse:l,coverStart:u,coverEnd:x}}function xe(a){if(a.measure&&
(a.measure.cache={},a.measure.heights=null,a.rest))for(var b=0;b<a.rest.length;b++)a.measure.caches[b]={}}function ye(a){a.display.externalMeasure=null;F(a.display.lineMeasure);for(var b=0;b<a.display.view.length;b++)xe(a.display.view[b])}function uc(a){ye(a);a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null;a.options.lineWrapping||(a.display.maxLineChanged=!0);a.display.lineNumChars=null}function ze(){return Xc&&Yc?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):
window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Ae(){return Xc&&Yc?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function yb(a,b,c,d,f){if(!f&&b.widgets)for(f=0;f<b.widgets.length;++f)if(b.widgets[f].above){var k=sc(b.widgets[f]);c.top+=k;c.bottom+=k}if("line"==d)return c;d||(d="local");b=wa(b);b="local"==d?b+a.display.lineSpace.offsetTop:b-a.display.viewOffset;
if("page"==d||"window"==d)a=a.display.lineSpace.getBoundingClientRect(),b+=a.top+("window"==d?0:Ae()),d=a.left+("window"==d?0:ze()),c.left+=d,c.right+=d;c.top+=b;c.bottom+=b;return c}function Be(a,b,c){if("div"==c)return b;var d=b.left;b=b.top;"page"==c?(d-=ze(),b-=Ae()):"local"!=c&&c||(c=a.display.sizer.getBoundingClientRect(),d+=c.left,b+=c.top);a=a.display.lineSpace.getBoundingClientRect();return{left:d-a.left,top:b-a.top}}function Zc(a,b,c,d,f){d||(d=C(a.doc,b.line));var k=d;b=b.ch;d=bb(a,Lb(a,
d),b,f);return yb(a,k,d,c)}function Qa(a,b,c,d,f,k){function l(b,l){var u=bb(a,f,b,l?"right":"left",k);l?u.left=u.right:u.right=u.left;return yb(a,d,u,c)}function u(a,b,d){return l(d?a-1:a,0!=e[b].level%2!=d)}d=d||C(a.doc,b.line);f||(f=Lb(a,d));var e=Na(d,a.doc.direction),n=b.ch;b=b.sticky;n>=d.text.length?(n=d.text.length,b="before"):0>=n&&(n=0,b="after");if(!e)return l("before"==b?n-1:n,"before"==b);var p=mc(e,n,b),g=nc,p=u(n,p,"before"==b);null!=g&&(p.other=u(n,g,"before"!=b));return p}function Ce(a,
b){var c=0;b=K(a.doc,b);a.options.lineWrapping||(c=tc(a.display)*b.ch);var d=C(a.doc,b.line),f=wa(d)+a.display.lineSpace.offsetTop;return{left:c,right:c,top:f,bottom:f+d.height}}function Fd(a,b,c){var d=a.doc;c+=a.display.viewOffset;if(0>c)return a=A(d.first,0,null),a.xRel=-1,a.outside=!0,a;var f=Ya(d,c),k=d.first+d.size-1;if(f>k)return a=C(d,k).text.length,a=A(d.first+d.size-1,a,null),a.xRel=1,a.outside=!0,a;0>b&&(b=0);for(k=C(d,f);;)if(d=eg(a,k,f,b,c),k=(f=$a(k,!1))&&f.find(0,!0),f&&(d.ch>k.from.ch||
d.ch==k.from.ch&&0<d.xRel))f=T(k=k.to.line);else return d}function fe(a,b,c,d){var f=b.text.length,k=R(function(f){return yb(a,b,bb(a,c,f-1),"line").bottom<=d},f,0),f=R(function(f){return yb(a,b,bb(a,c,f),"line").top>d},k,f);return{begin:k,end:f}}function eg(a,b,c,d,f){f-=wa(b);var k=0,l=b.text.length,u=Lb(a,b);if(Na(b,a.doc.direction)){if(a.options.lineWrapping){var e;e=fe(a,b,u,f);k=e.begin;l=e.end;e}c=new A(c,k);var n=Qa(a,c,"line",b,u).left;e=n<d?1:-1;var p=n-d,g;do{n=p;g=c;c=Sc(a,b,c,e);if(null==
c||c.ch<k||l<=("before"==c.sticky?c.ch-1:c.ch)){c=g;break}p=Qa(a,c,"line",b,u).left-d}while(0>e!=0>p&&Math.abs(p)<=Math.abs(n));if(Math.abs(p)>Math.abs(n)){if(0>p==0>n)throw Error("Broke out of infinite loop in coordsCharInner");c=g}}else k=R(function(c){var k=yb(a,b,bb(a,u,c),"line");return k.top>f?(l=Math.min(c,l),!0):k.bottom<=f?!1:k.left>d?!0:k.right<d?!1:d-k.left<k.right-d},k,l),k=ca(b.text,k,1),c=new A(c,k,k==l?"before":"after");k=Qa(a,c,"line",b,u);if(f<k.top||k.bottom<f)c.outside=!0;c.xRel=
d<k.left?-1:d>k.right?1:0;return c}function Cb(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==Db){Db=v("pre");for(var b=0;49>b;++b)Db.appendChild(document.createTextNode("x")),Db.appendChild(v("br"));Db.appendChild(document.createTextNode("x"))}E(a.measure,Db);b=Db.offsetHeight/50;3<b&&(a.cachedTextHeight=b);F(a.measure);return b||1}function tc(a){if(null!=a.cachedCharWidth)return a.cachedCharWidth;var b=v("span","xxxxxxxxxx"),c=v("pre",[b]);E(a.measure,c);b=b.getBoundingClientRect();
b=(b.right-b.left)/10;2<b&&(a.cachedCharWidth=b);return b||10}function Dd(a){for(var b=a.display,c={},d={},f=b.gutters.clientLeft,k=b.gutters.firstChild,l=0;k;k=k.nextSibling,++l)c[a.options.gutters[l]]=k.offsetLeft+k.clientLeft+f,d[a.options.gutters[l]]=k.clientWidth;return{fixedPos:Gd(b),gutterTotalWidth:b.gutters.offsetWidth,gutterLeft:c,gutterWidth:d,wrapperWidth:b.wrapper.clientWidth}}function Gd(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function De(a){var b=
Cb(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/tc(a.display)-3);return function(f){if(ab(a.doc,f))return 0;var k=0;if(f.widgets)for(var l=0;l<f.widgets.length;l++)f.widgets[l].height&&(k+=f.widgets[l].height);return c?k+(Math.ceil(f.text.length/d)||1)*b:k+b}}function Hd(a){var b=a.doc,c=De(a);b.iter(function(a){var b=c(a);b!=a.height&&Ga(a,b)})}function Eb(a,b,c,d){var f=a.display;if(!c&&"true"==(b.target||b.srcElement).getAttribute("cm-not-content"))return null;
var k,l;c=f.lineSpace.getBoundingClientRect();try{k=b.clientX-c.left,l=b.clientY-c.top}catch(x){return null}b=Fd(a,k,l);var u;d&&1==b.xRel&&(u=C(a.doc,b.line).text).length==b.ch&&(d=q(u,u.length,a.options.tabSize)-u.length,b=A(b.line,Math.max(0,Math.round((k-te(a.display).left)/tc(a.display))-d)));return b}function Bb(a,b){if(b>=a.display.viewTo)return null;b-=a.display.viewFrom;if(0>b)return null;for(var c=a.display.view,d=0;d<c.length;d++)if(b-=c[d].size,0>b)return d}function vc(a){a.display.input.showSelection(a.display.input.prepareSelection())}
function Ee(a,b){for(var c=a.doc,d={},f=d.cursors=document.createDocumentFragment(),k=d.selection=document.createDocumentFragment(),l=0;l<c.sel.ranges.length;l++)if(!1!==b||l!=c.sel.primIndex){var u=c.sel.ranges[l];if(!(u.from().line>=a.display.viewTo||u.to().line<a.display.viewFrom)){var e=u.empty();(e||a.options.showCursorWhenSelecting)&&Fe(a,u.head,f);e||fg(a,u,k)}}return d}function Fe(a,b,c){b=Qa(a,b,"div",null,null,!a.options.singleCursorHeightPerLine);var d=c.appendChild(v("div","\u00a0","CodeMirror-cursor"));
d.style.left=b.left+"px";d.style.top=b.top+"px";d.style.height=Math.max(0,b.bottom-b.top)*a.options.cursorHeight+"px";b.other&&(a=c.appendChild(v("div","\u00a0","CodeMirror-cursor CodeMirror-secondarycursor")),a.style.display="",a.style.left=b.other.left+"px",a.style.top=b.other.top+"px",a.style.height=.85*(b.other.bottom-b.other.top)+"px")}function fg(a,b,c){function d(a,b,d,c){0>b&&(b=0);b=Math.round(b);c=Math.round(c);u.appendChild(v("div",null,"CodeMirror-selected","position: absolute; left: "+
a+"px;\n                             top: "+b+"px; width: "+(null==d?p-a:d)+"px;\n                             height: "+(c-b)+"px"))}function f(b,c,f){var k=C(l,b),u=k.text.length,e,x;lc(Na(k,l.direction),c||0,null==f?u:f,function(l,g,U){var q=Zc(a,A(b,l),"div",k,"left"),h,m;l==g?(h=q,U=m=q.left):(h=Zc(a,A(b,g-1),"div",k,"right"),"rtl"==U&&(U=q,q=h,h=U),U=q.left,m=h.right);null==c&&0==l&&(U=n);3<h.top-q.top&&(d(U,q.top,null,q.bottom),U=n,q.bottom<h.top&&d(U,q.bottom,null,h.top));null==f&&g==u&&(m=
p);if(!e||q.top<e.top||q.top==e.top&&q.left<e.left)e=q;if(!x||h.bottom>x.bottom||h.bottom==x.bottom&&h.right>x.right)x=h;U<n+1&&(U=n);d(U,h.top,m-U,h.bottom)});return{start:e,end:x}}var k=a.display,l=a.doc,u=document.createDocumentFragment(),e=te(a.display),n=e.left,p=Math.max(k.sizerWidth,Ab(a)-k.sizer.offsetLeft)-e.right,k=b.from();b=b.to();if(k.line==b.line)f(k.line,k.ch,b.ch);else{var g=C(l,k.line),e=C(l,b.line),e=Ka(g)==Ka(e),k=f(k.line,k.ch,e?g.text.length+1:null).end;b=f(b.line,e?0:null,b.ch).start;
e&&(k.top<b.top-2?(d(k.right,k.top,null,k.bottom),d(n,b.top,b.left,b.bottom)):d(k.right,k.top,b.left-k.right,k.bottom));k.bottom<b.top&&d(n,k.bottom,null,b.top)}c.appendChild(u)}function Id(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursorDiv.style.visibility="";0<a.options.cursorBlinkRate?b.blinker=setInterval(function(){return b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate):0>a.options.cursorBlinkRate&&(b.cursorDiv.style.visibility="hidden")}}
function Ge(a){a.state.focused||(a.display.input.focus(),Jd(a))}function He(a){a.state.delayingBlurEvent=!0;setTimeout(function(){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1,wc(a))},100)}function Jd(a,b){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1);"nocursor"!=a.options.readOnly&&(a.state.focused||(ha(a,"focus",a,b),a.state.focused=!0,w(a.display.wrapper,"CodeMirror-focused"),a.curOp||a.display.selForContextMenu==a.doc.sel||(a.display.input.reset(),oa&&setTimeout(function(){return a.display.input.reset(!0)},
20)),a.display.input.receivedFocus()),Id(a))}function wc(a,b){a.state.delayingBlurEvent||(a.state.focused&&(ha(a,"blur",a,b),a.state.focused=!1,Fb(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||(a.display.shift=!1)},150))}function Kd(a){var b=a.display,c=b.view;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var d=Gd(b)-b.scroller.scrollLeft+a.doc.scrollLeft,f=b.gutters.offsetWidth,k=d+"px",l=0;l<c.length;l++)if(!c[l].hidden){a.options.fixedGutter&&
(c[l].gutter&&(c[l].gutter.style.left=k),c[l].gutterBackground&&(c[l].gutterBackground.style.left=k));var u=c[l].alignable;if(u)for(var e=0;e<u.length;e++)u[e].style.left=k}a.options.fixedGutter&&(b.gutters.style.left=d+f+"px")}}function Ie(a){if(!a.options.lineNumbers)return!1;var b=a.doc,b=ic(a.options,b.first+b.size-1),c=a.display;if(b.length!=c.lineNumChars){var d=c.measure.appendChild(v("div",[v("div",b)],"CodeMirror-linenumber CodeMirror-gutter-elt")),f=d.firstChild.offsetWidth,d=d.offsetWidth-
f;c.lineGutter.style.width="";c.lineNumInnerWidth=Math.max(f,c.lineGutter.offsetWidth-d)+1;c.lineNumWidth=c.lineNumInnerWidth+d;c.lineNumChars=c.lineNumInnerWidth?b.length:-1;c.lineGutter.style.width=c.lineNumWidth+"px";Ld(a);return!0}return!1}function $c(a){a=a.display;for(var b=a.lineDiv.offsetTop,c=0;c<a.view.length;c++){var d=a.view[c],f;if(!d.hidden){if(S&&8>aa){var k=d.node.offsetTop+d.node.offsetHeight;f=k-b;b=k}else f=d.node.getBoundingClientRect(),f=f.bottom-f.top;k=d.line.height-f;2>f&&
(f=Cb(a));if(.001<k||-.001>k)if(Ga(d.line,f),Je(d.line),d.rest)for(f=0;f<d.rest.length;f++)Je(d.rest[f])}}}function Je(a){if(a.widgets)for(var b=0;b<a.widgets.length;++b)a.widgets[b].height=a.widgets[b].node.parentNode.offsetHeight}function Md(a,b,c){var d=c&&null!=c.top?Math.max(0,c.top):a.scroller.scrollTop,d=Math.floor(d-a.lineSpace.offsetTop),f=c&&null!=c.bottom?c.bottom:d+a.wrapper.clientHeight,d=Ya(b,d),f=Ya(b,f);if(c&&c.ensure){var k=c.ensure.from.line;c=c.ensure.to.line;k<d?(d=k,f=Ya(b,wa(C(b,
k))+a.wrapper.clientHeight)):Math.min(c,b.lastLine())>=f&&(d=Ya(b,wa(C(b,c))-a.wrapper.clientHeight),f=c)}return{from:d,to:Math.max(f,d+1)}}function xc(a,b){2>Math.abs(a.doc.scrollTop-b)||(a.doc.scrollTop=b,hb||Nd(a,{top:b}),a.display.scroller.scrollTop!=b&&(a.display.scroller.scrollTop=b),a.display.scrollbars.setScrollTop(b),hb&&Nd(a),yc(a,100))}function Rb(a,b,c){(c?b==a.doc.scrollLeft:2>Math.abs(a.doc.scrollLeft-b))||(b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth),
a.doc.scrollLeft=b,Kd(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbars.setScrollLeft(b))}function Ke(a){var b=a.wheelDeltaX,c=a.wheelDeltaY;null==b&&a.detail&&a.axis==a.HORIZONTAL_AXIS&&(b=a.detail);null==c&&a.detail&&a.axis==a.VERTICAL_AXIS?c=a.detail:null==c&&(c=a.wheelDelta);return{x:b,y:c}}function gg(a){a=Ke(a);a.x*=Ha;a.y*=Ha;return a}function Le(a,b){var c=Ke(b),d=c.x,c=c.y,f=a.display,k=f.scroller,l=k.scrollWidth>k.clientWidth,u=k.scrollHeight>k.clientHeight;
if(d&&l||c&&u){if(c&&Pa&&oa){var l=b.target,e=f.view;a:for(;l!=k;l=l.parentNode)for(var n=0;n<e.length;n++)if(e[n].node==l){a.display.currentWheelTarget=l;break a}}!d||hb||Ra||null==Ha?(c&&null!=Ha&&(u=c*Ha,l=a.doc.scrollTop,e=l+f.wrapper.clientHeight,0>u?l=Math.max(0,l+u-50):e=Math.min(a.doc.height,e+u+50),Nd(a,{top:l,bottom:e})),20>ad&&(null==f.wheelStartX?(f.wheelStartX=k.scrollLeft,f.wheelStartY=k.scrollTop,f.wheelDX=d,f.wheelDY=c,setTimeout(function(){if(null!=f.wheelStartX){var a=k.scrollLeft-
f.wheelStartX,b=k.scrollTop-f.wheelStartY,a=b&&f.wheelDY&&b/f.wheelDY||a&&f.wheelDX&&a/f.wheelDX;f.wheelStartX=f.wheelStartY=null;a&&(Ha=(Ha*ad+a)/(ad+1),++ad)}},200)):(f.wheelDX+=d,f.wheelDY+=c))):(c&&u&&xc(a,Math.max(0,Math.min(k.scrollTop+c*Ha,k.scrollHeight-k.clientHeight))),Rb(a,Math.max(0,Math.min(k.scrollLeft+d*Ha,k.scrollWidth-k.clientWidth))),(!c||c&&u)&&ka(b),f.wheelStartX=null)}}function zc(a){var b=a.display,c=b.gutters.offsetWidth,d=Math.round(a.doc.height+Ad(a.display));return{clientHeight:b.scroller.clientHeight,
viewHeight:b.wrapper.clientHeight,scrollWidth:b.scroller.scrollWidth,clientWidth:b.scroller.clientWidth,viewWidth:b.wrapper.clientWidth,barLeft:a.options.fixedGutter?c:0,docHeight:d,scrollHeight:d+Wa(a)+b.barHeight,nativeBarWidth:b.nativeBarWidth,gutterWidth:c}}function Sb(a,b){b||(b=zc(a));var c=a.display.barWidth,d=a.display.barHeight;Me(a,b);for(var f=0;4>f&&c!=a.display.barWidth||d!=a.display.barHeight;f++)c!=a.display.barWidth&&a.options.lineWrapping&&$c(a),Me(a,zc(a)),c=a.display.barWidth,d=
a.display.barHeight}function Me(a,b){var c=a.display,d=c.scrollbars.update(b);c.sizer.style.paddingRight=(c.barWidth=d.right)+"px";c.sizer.style.paddingBottom=(c.barHeight=d.bottom)+"px";c.heightForcer.style.borderBottom=d.bottom+"px solid transparent";d.right&&d.bottom?(c.scrollbarFiller.style.display="block",c.scrollbarFiller.style.height=d.bottom+"px",c.scrollbarFiller.style.width=d.right+"px"):c.scrollbarFiller.style.display="";d.bottom&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?
(c.gutterFiller.style.display="block",c.gutterFiller.style.height=d.bottom+"px",c.gutterFiller.style.width=b.gutterWidth+"px"):c.gutterFiller.style.display=""}function Ne(a){a.display.scrollbars&&(a.display.scrollbars.clear(),a.display.scrollbars.addClass&&Fb(a.display.wrapper,a.display.scrollbars.addClass));a.display.scrollbars=new Oe[a.options.scrollbarStyle](function(b){a.display.wrapper.insertBefore(b,a.display.scrollbarFiller);L(b,"mousedown",function(){a.state.focused&&setTimeout(function(){return a.display.input.focus()},
0)});b.setAttribute("cm-not-content","true")},function(b,c){"horizontal"==c?Rb(a,b):xc(a,b)},a);a.display.scrollbars.addClass&&w(a.display.wrapper,a.display.scrollbars.addClass)}function bd(a,b){var c=a.display,d=Cb(a.display);0>b.top&&(b.top=0);var f=a.curOp&&null!=a.curOp.scrollTop?a.curOp.scrollTop:c.scroller.scrollTop,k=Bd(a),l={};b.bottom-b.top>k&&(b.bottom=b.top+k);var u=a.doc.height+Ad(c),e=b.top<d,d=b.bottom>u-d;b.top<f?l.scrollTop=e?0:b.top:b.bottom>f+k&&(k=Math.min(b.top,(d?u:b.bottom)-
k),k!=f&&(l.scrollTop=k));f=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:c.scroller.scrollLeft;c=Ab(a)-(a.options.fixedGutter?c.gutters.offsetWidth:0);if(k=b.right-b.left>c)b.right=b.left+c;10>b.left?l.scrollLeft=0:b.left<f?l.scrollLeft=Math.max(0,b.left-(k?0:10)):b.right>c+f-3&&(l.scrollLeft=b.right+(k?0:10)-c);return l}function cd(a,b,c){null==b&&null==c||dd(a);null!=b&&(a.curOp.scrollLeft=(null==a.curOp.scrollLeft?a.doc.scrollLeft:a.curOp.scrollLeft)+b);null!=c&&(a.curOp.scrollTop=(null==
a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+c)}function Tb(a){dd(a);var b=a.getCursor(),c=b,d=b;a.options.lineWrapping||(c=b.ch?A(b.line,b.ch-1):b,d=A(b.line,b.ch+1));a.curOp.scrollToPos={from:c,to:d,margin:a.options.cursorScrollMargin}}function dd(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=Ce(a,b.from),d=Ce(a,b.to),b=bd(a,{left:Math.min(c.left,d.left),top:Math.min(c.top,d.top)-b.margin,right:Math.max(c.right,d.right),bottom:Math.max(c.bottom,d.bottom)+b.margin});a.scrollTo(b.scrollLeft,
b.scrollTop)}}function Ub(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++hg};a=a.curOp;Qb?Qb.ops.push(a):a.ownsGroup=Qb={ops:[a],delayedCallbacks:[]}}function Vb(a){bg(a.curOp,function(a){for(var b=0;b<a.ops.length;b++)a.ops[b].cm.curOp=null;a=a.ops;for(b=0;b<a.length;b++){var d=a[b],
f=d.cm,k=f.display,l=f.display;!l.scrollbarsClipped&&l.scroller.offsetWidth&&(l.nativeBarWidth=l.scroller.offsetWidth-l.scroller.clientWidth,l.heightForcer.style.height=Wa(f)+"px",l.sizer.style.marginBottom=-l.nativeBarWidth+"px",l.sizer.style.borderRightWidth=Wa(f)+"px",l.scrollbarsClipped=!0);d.updateMaxLine&&Ca(f);d.mustUpdate=d.viewChanged||d.forceUpdate||null!=d.scrollTop||d.scrollToPos&&(d.scrollToPos.from.line<k.viewFrom||d.scrollToPos.to.line>=k.viewTo)||k.maxLineChanged&&f.options.lineWrapping;
d.update=d.mustUpdate&&new ed(f,d.mustUpdate&&{top:d.scrollTop,ensure:d.scrollToPos},d.forceUpdate)}for(b=0;b<a.length;b++)d=a[b],d.updatedDisplay=d.mustUpdate&&Od(d.cm,d.update);for(b=0;b<a.length;b++)if(d=a[b],f=d.cm,k=f.display,d.updatedDisplay&&$c(f),d.barMeasure=zc(f),k.maxLineChanged&&!f.options.lineWrapping&&(l=k.maxLine.text.length,l=bb(f,Lb(f,k.maxLine),l,void 0),d.adjustWidthTo=l.left+3,f.display.sizerWidth=d.adjustWidthTo,d.barMeasure.scrollWidth=Math.max(k.scroller.clientWidth,k.sizer.offsetLeft+
d.adjustWidthTo+Wa(f)+f.display.barWidth),d.maxScrollLeft=Math.max(0,k.sizer.offsetLeft+d.adjustWidthTo-Ab(f))),d.updatedDisplay||d.selectionChanged)d.preparedSelection=k.input.prepareSelection(d.focus);for(b=0;b<a.length;b++)d=a[b],f=d.cm,null!=d.adjustWidthTo&&(f.display.sizer.style.minWidth=d.adjustWidthTo+"px",d.maxScrollLeft<f.doc.scrollLeft&&Rb(f,Math.min(f.display.scroller.scrollLeft,d.maxScrollLeft),!0),f.display.maxLineChanged=!1),k=d.focus&&d.focus==z()&&(!document.hasFocus||document.hasFocus()),
d.preparedSelection&&f.display.input.showSelection(d.preparedSelection,k),(d.updatedDisplay||d.startHeight!=f.doc.height)&&Sb(f,d.barMeasure),d.updatedDisplay&&Pd(f,d.barMeasure),d.selectionChanged&&Id(f),f.state.focused&&d.updateInput&&f.display.input.reset(d.typing),k&&Ge(d.cm);for(b=0;b<a.length;b++){var u=void 0,d=a[b],f=d.cm,k=f.display,l=f.doc;d.updatedDisplay&&Pe(f,d.update);null==k.wheelStartX||null==d.scrollTop&&null==d.scrollLeft&&!d.scrollToPos||(k.wheelStartX=k.wheelStartY=null);null==
d.scrollTop||k.scroller.scrollTop==d.scrollTop&&!d.forceScroll||(l.scrollTop=Math.max(0,Math.min(k.scroller.scrollHeight-k.scroller.clientHeight,d.scrollTop)),k.scrollbars.setScrollTop(l.scrollTop),k.scroller.scrollTop=l.scrollTop);null==d.scrollLeft||k.scroller.scrollLeft==d.scrollLeft&&!d.forceScroll||(l.scrollLeft=Math.max(0,Math.min(k.scroller.scrollWidth-k.scroller.clientWidth,d.scrollLeft)),k.scrollbars.setScrollLeft(l.scrollLeft),k.scroller.scrollLeft=l.scrollLeft,Kd(f));if(d.scrollToPos){var e=
K(l,d.scrollToPos.from),n=K(l,d.scrollToPos.to),p=d.scrollToPos.margin;null==p&&(p=0);for(var g=0;5>g;g++){var q=!1,u=Qa(f,e),h=n&&n!=e?Qa(f,n):u,u={left:Math.min(u.left,h.left),top:Math.min(u.top,h.top)-p,right:Math.max(u.left,h.left),bottom:Math.max(u.bottom,h.bottom)+p},h=bd(f,u),m=f.doc.scrollTop,y=f.doc.scrollLeft;null!=h.scrollTop&&(xc(f,h.scrollTop),1<Math.abs(f.doc.scrollTop-m)&&(q=!0));null!=h.scrollLeft&&(Rb(f,h.scrollLeft),1<Math.abs(f.doc.scrollLeft-y)&&(q=!0));if(!q)break}n=u;ea(f,"scrollCursorIntoView")||
(p=f.display,g=p.sizer.getBoundingClientRect(),e=null,0>n.top+g.top?e=!0:n.bottom+g.top>(window.innerHeight||document.documentElement.clientHeight)&&(e=!1),null==e||ig||(n=v("div","\u200b",null,"position: absolute;\n                         top: "+(n.top-p.viewOffset-f.display.lineSpace.offsetTop)+"px;\n                         height: "+(n.bottom-n.top+Wa(f)+p.barHeight)+"px;\n                         left: "+n.left+"px; width: "+Math.max(2,n.right-n.left)+"px;"),f.display.lineSpace.appendChild(n),
n.scrollIntoView(e),f.display.lineSpace.removeChild(n)))}n=d.maybeHiddenMarkers;e=d.maybeUnhiddenMarkers;if(n)for(p=0;p<n.length;++p)n[p].lines.length||ha(n[p],"hide");if(e)for(n=0;n<e.length;++n)e[n].lines.length&&ha(e[n],"unhide");k.wrapper.offsetHeight&&(l.scrollTop=f.display.scroller.scrollTop);d.changeObjs&&ha(f,"changes",f,d.changeObjs);d.update&&d.update.finish()}})}function Ea(a,b){if(a.curOp)return b();Ub(a);try{return b()}finally{Vb(a)}}function ma(a,b){return function(){if(a.curOp)return b.apply(a,
arguments);Ub(a);try{return b.apply(a,arguments)}finally{Vb(a)}}}function ya(a){return function(){if(this.curOp)return a.apply(this,arguments);Ub(this);try{return a.apply(this,arguments)}finally{Vb(this)}}}function na(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);Ub(b);try{return a.apply(this,arguments)}finally{Vb(b)}}}function za(a,b,c,d){null==b&&(b=a.doc.first);null==c&&(c=a.doc.first+a.doc.size);d||(d=0);var f=a.display;d&&c<f.viewTo&&(null==f.updateLineNumbers||
f.updateLineNumbers>b)&&(f.updateLineNumbers=b);a.curOp.viewChanged=!0;if(b>=f.viewTo)kb&&Kb(a.doc,b)<f.viewTo&&ob(a);else if(c<=f.viewFrom)kb&&Rc(a.doc,c+d)>f.viewFrom?ob(a):(f.viewFrom+=d,f.viewTo+=d);else if(b<=f.viewFrom&&c>=f.viewTo)ob(a);else if(b<=f.viewFrom){var k=fd(a,c,c+d,1);k?(f.view=f.view.slice(k.index),f.viewFrom=k.lineN,f.viewTo+=d):ob(a)}else if(c>=f.viewTo)(k=fd(a,b,b,-1))?(f.view=f.view.slice(0,k.index),f.viewTo=k.lineN):ob(a);else{var k=fd(a,b,b,-1),l=fd(a,c,c+d,1);k&&l?(f.view=
f.view.slice(0,k.index).concat(Wc(a,k.lineN,l.lineN)).concat(f.view.slice(l.index)),f.viewTo+=d):ob(a)}if(a=f.externalMeasured)c<a.lineN?a.lineN+=d:b<a.lineN+a.size&&(f.externalMeasured=null)}function pb(a,b,c){a.curOp.viewChanged=!0;var d=a.display,f=a.display.externalMeasured;f&&b>=f.lineN&&b<f.lineN+f.size&&(d.externalMeasured=null);b<d.viewFrom||b>=d.viewTo||(a=d.view[Bb(a,b)],null!=a.node&&(a=a.changes||(a.changes=[]),-1==e(a,c)&&a.push(c)))}function ob(a){a.display.viewFrom=a.display.viewTo=
a.doc.first;a.display.view=[];a.display.viewOffset=0}function fd(a,b,c,d){var f=Bb(a,b),k=a.display.view;if(!kb||c==a.doc.first+a.doc.size)return{index:f,lineN:c};for(var l=a.display.viewFrom,u=0;u<f;u++)l+=k[u].size;if(l!=b){if(0<d){if(f==k.length-1)return null;b=l+k[f].size-b;f++}else b=l-b;c+=b}for(;Kb(a.doc,c)!=c;){if(f==(0>d?0:k.length-1))return null;c+=d*k[f-(0>d?1:0)].size;f+=d}return{index:f,lineN:c}}function Qe(a){a=a.display.view;for(var b=0,c=0;c<a.length;c++){var d=a[c];d.hidden||d.node&&
!d.changes||++b}return b}function yc(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.viewTo&&a.state.highlight.set(b,G(jg,a))}function jg(a){var b=a.doc;b.frontier<b.first&&(b.frontier=b.first);if(!(b.frontier>=a.display.viewTo)){var c=+new Date+a.options.workTime,d=xa(b.mode,n(a,b.frontier)),f=[];b.iter(b.frontier,Math.min(b.first+b.size,a.display.viewTo+500),function(k){if(b.frontier>=a.display.viewFrom){var l=k.styles,u=k.text.length>a.options.maxHighlightLength,e=J(a,k,u?xa(b.mode,d):d,!0);
k.styles=e.styles;var n=k.styleClasses;(e=e.classes)?k.styleClasses=e:n&&(k.styleClasses=null);n=!l||l.length!=k.styles.length||n!=e&&(!n||!e||n.bgClass!=e.bgClass||n.textClass!=e.textClass);for(e=0;!n&&e<l.length;++e)n=l[e]!=k.styles[e];n&&f.push(b.frontier);k.stateAfter=u?d:xa(b.mode,d)}else k.text.length<=a.options.maxHighlightLength&&P(a,k.text,d),k.stateAfter=0==b.frontier%5?xa(b.mode,d):null;++b.frontier;if(+new Date>c)return yc(a,a.options.workDelay),!0});f.length&&Ea(a,function(){for(var b=
0;b<f.length;b++)pb(a,f[b],"text")})}}function Od(a,b){var c=a.display,d=a.doc;if(b.editorIsHidden)return ob(a),!1;if(!b.force&&b.visible.from>=c.viewFrom&&b.visible.to<=c.viewTo&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo)&&c.renderedView==c.view&&0==Qe(a))return!1;Ie(a)&&(ob(a),b.dims=Dd(a));var f=d.first+d.size,k=Math.max(b.visible.from-a.options.viewportMargin,d.first),l=Math.min(f,b.visible.to+a.options.viewportMargin);c.viewFrom<k&&20>k-c.viewFrom&&(k=Math.max(d.first,c.viewFrom));
c.viewTo>l&&20>c.viewTo-l&&(l=Math.min(f,c.viewTo));kb&&(k=Kb(a.doc,k),l=Rc(a.doc,l));d=k!=c.viewFrom||l!=c.viewTo||c.lastWrapHeight!=b.wrapperHeight||c.lastWrapWidth!=b.wrapperWidth;f=a.display;0==f.view.length||k>=f.viewTo||l<=f.viewFrom?(f.view=Wc(a,k,l),f.viewFrom=k):(f.viewFrom>k?f.view=Wc(a,k,f.viewFrom).concat(f.view):f.viewFrom<k&&(f.view=f.view.slice(Bb(a,k))),f.viewFrom=k,f.viewTo<l?f.view=f.view.concat(Wc(a,f.viewTo,l)):f.viewTo>l&&(f.view=f.view.slice(0,Bb(a,l))));f.viewTo=l;c.viewOffset=
wa(C(a.doc,c.viewFrom));a.display.mover.style.top=c.viewOffset+"px";l=Qe(a);if(!d&&0==l&&!b.force&&c.renderedView==c.view&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo))return!1;k=z();4<l&&(c.lineDiv.style.display="none");kg(a,c.updateLineNumbers,b.dims);4<l&&(c.lineDiv.style.display="");c.renderedView=c.view;k&&z()!=k&&k.offsetHeight&&k.focus();F(c.cursorDiv);F(c.selectionDiv);c.gutters.style.height=c.sizer.style.minHeight=0;d&&(c.lastWrapHeight=b.wrapperHeight,c.lastWrapWidth=b.wrapperWidth,
yc(a,400));c.updateLineNumbers=null;return!0}function Pe(a,b){for(var c=b.viewport,d=!0;;d=!1){if(!d||!a.options.lineWrapping||b.oldDisplayWidth==Ab(a))if(c&&null!=c.top&&(c={top:Math.min(a.doc.height+Ad(a.display)-Bd(a),c.top)}),b.visible=Md(a.display,a.doc,c),b.visible.from>=a.display.viewFrom&&b.visible.to<=a.display.viewTo)break;if(!Od(a,b))break;$c(a);d=zc(a);vc(a);Sb(a,d);Pd(a,d)}b.signal(a,"update",a);if(a.display.viewFrom!=a.display.reportedViewFrom||a.display.viewTo!=a.display.reportedViewTo)b.signal(a,
"viewportChange",a,a.display.viewFrom,a.display.viewTo),a.display.reportedViewFrom=a.display.viewFrom,a.display.reportedViewTo=a.display.viewTo}function Nd(a,b){var c=new ed(a,b);if(Od(a,c)){$c(a);Pe(a,c);var d=zc(a);vc(a);Sb(a,d);Pd(a,d);c.finish()}}function kg(a,b,c){function d(b){var d=b.nextSibling;oa&&Pa&&a.display.currentWheelTarget==b?b.style.display="none":b.parentNode.removeChild(b);return d}for(var f=a.display,k=a.options.lineNumbers,l=f.lineDiv,u=l.firstChild,n=f.view,f=f.viewFrom,p=0;p<
n.length;p++){var g=n[p];if(!g.hidden)if(g.node&&g.node.parentNode==l){for(;u!=g.node;)u=d(u);u=k&&null!=b&&b<=f&&g.lineNumber;g.changes&&(-1<e(g.changes,"gutter")&&(u=!1),oe(a,g,f,c));u&&(F(g.lineNumber),g.lineNumber.appendChild(document.createTextNode(ic(a.options,f))));u=g.node.nextSibling}else{var q=dg(a,g,f,c);l.insertBefore(q,u)}f+=g.size}for(;u;)u=d(u)}function Ld(a){a.display.sizer.style.marginLeft=a.display.gutters.offsetWidth+"px"}function Pd(a,b){a.display.sizer.style.minHeight=b.docHeight+
"px";a.display.heightForcer.style.top=b.docHeight+"px";a.display.gutters.style.height=b.docHeight+a.display.barHeight+Wa(a)+"px"}function Re(a){var b=a.display.gutters,c=a.options.gutters;F(b);for(var d=0;d<c.length;++d){var f=c[d],k=b.appendChild(v("div",null,"CodeMirror-gutter "+f));"CodeMirror-linenumbers"==f&&(a.display.lineGutter=k,k.style.width=(a.display.lineNumWidth||1)+"px")}b.style.display=d?"":"none";Ld(a)}function Qd(a){var b=e(a.gutters,"CodeMirror-linenumbers");-1==b&&a.lineNumbers?
a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):-1<b&&!a.lineNumbers&&(a.gutters=a.gutters.slice(0),a.gutters.splice(b,1))}function Sa(a,b){var c=a[b];a.sort(function(a,b){return M(a.from(),b.from())});b=e(a,c);for(c=1;c<a.length;c++){var d=a[c],f=a[c-1];if(0<=M(f.to(),d.from())){var k=va(f.from(),d.from()),l=Ma(f.to(),d.to()),d=f.empty()?d.from()==d.head:f.from()==f.head;c<=b&&--b;a.splice(--c,2,new W(d?l:k,d?k:l))}}return new Ia(a,b)}function fb(a,b){return new Ia([new W(a,b||a)],0)}function qb(a){return a.text?
A(a.from.line+a.text.length-1,p(a.text).length+(1==a.text.length?a.from.ch:0)):a.to}function Se(a,b){if(0>M(a,b.from))return a;if(0>=M(a,b.to))return qb(b);var c=a.line+b.text.length-(b.to.line-b.from.line)-1,d=a.ch;a.line==b.to.line&&(d+=qb(b).ch-b.to.ch);return A(c,d)}function Rd(a,b){for(var c=[],d=0;d<a.sel.ranges.length;d++){var f=a.sel.ranges[d];c.push(new W(Se(f.anchor,b),Se(f.head,b)))}return Sa(c,a.sel.primIndex)}function Te(a,b,c){return a.line==b.line?A(c.line,a.ch-b.ch+c.ch):A(c.line+
(a.line-b.line),a.ch)}function Sd(a){a.doc.mode=mb(a.options,a.doc.modeOption);Ac(a)}function Ac(a){a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null)});a.doc.frontier=a.doc.first;yc(a,100);a.state.modeGen++;a.curOp&&za(a)}function Ue(a,b){return 0==b.from.ch&&0==b.to.ch&&""==p(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function Td(a,b,c,d){function f(a,c,f){a.text=c;a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null);null!=a.order&&(a.order=null);
V(a);sa(a,f);c=d?d(a):1;c!=a.height&&Ga(a,c);pa(a,"change",a,b)}function k(a,b){for(var f=[],k=a;k<b;++k)f.push(new Wb(e[k],c?c[k]:null,d));return f}var l=b.from,u=b.to,e=b.text,n=C(a,l.line),g=C(a,u.line),q=p(e),h=c?c[e.length-1]:null,m=u.line-l.line;b.full?(a.insert(0,k(0,e.length)),a.remove(e.length,a.size-e.length)):Ue(a,b)?(u=k(0,e.length-1),f(g,g.text,h),m&&a.remove(l.line,m),u.length&&a.insert(l.line,u)):n==g?1==e.length?f(n,n.text.slice(0,l.ch)+q+n.text.slice(u.ch),h):(m=k(1,e.length-1),m.push(new Wb(q+
n.text.slice(u.ch),h,d)),f(n,n.text.slice(0,l.ch)+e[0],c?c[0]:null),a.insert(l.line+1,m)):1==e.length?(f(n,n.text.slice(0,l.ch)+e[0]+g.text.slice(u.ch),c?c[0]:null),a.remove(l.line+1,m)):(f(n,n.text.slice(0,l.ch)+e[0],c?c[0]:null),f(g,q+g.text.slice(u.ch),h),h=k(1,e.length-1),1<m&&a.remove(l.line+1,m-1),a.insert(l.line+1,h));pa(a,"change",a,b)}function Gb(a,b,c){function d(a,k,l){if(a.linked)for(var f=0;f<a.linked.length;++f){var e=a.linked[f];if(e.doc!=k){var n=l&&e.sharedHist;if(!c||n)b(e.doc,n),
d(e.doc,a,n)}}}d(a,null,!0)}function Ve(a,b){if(b.cm)throw Error("This document is already in use.");a.doc=b;b.cm=a;Hd(a);Sd(a);We(a);a.options.lineWrapping||Ca(a);a.options.mode=b.modeOption;za(a)}function We(a){("rtl"==a.doc.direction?w:Fb)(a.display.lineDiv,"CodeMirror-rtl")}function lg(a){Ea(a,function(){We(a);za(a)})}function gd(a){this.done=[];this.undone=[];this.undoDepth=Infinity;this.lastModTime=this.lastSelTime=0;this.lastOrigin=this.lastSelOrigin=this.lastOp=this.lastSelOp=null;this.generation=
this.maxGeneration=a||1}function Ud(a,b){var c={from:jc(b.from),to:qb(b),text:ba(a,b.from,b.to)};Xe(a,c,b.from.line,b.to.line+1);Gb(a,function(a){return Xe(a,c,b.from.line,b.to.line+1)},!0);return c}function Ye(a){for(;a.length;)if(p(a).ranges)a.pop();else break}function Ze(a,b,c,d){var f=a.history;f.undone.length=0;var k=+new Date,l,u,e;if(e=f.lastOp==d||f.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&f.lastModTime>k-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0)))f.lastOp==
d?(Ye(f.done),l=p(f.done)):f.done.length&&!p(f.done).ranges?l=p(f.done):1<f.done.length&&!f.done[f.done.length-2].ranges?(f.done.pop(),l=p(f.done)):l=void 0,e=l;if(e)u=p(l.changes),0==M(b.from,b.to)&&0==M(b.from,u.to)?u.to=qb(b):l.changes.push(Ud(a,b));else for((l=p(f.done))&&l.ranges||hd(a.sel,f.done),l={changes:[Ud(a,b)],generation:f.generation},f.done.push(l);f.done.length>f.undoDepth;)f.done.shift(),f.done[0].ranges||f.done.shift();f.done.push(c);f.generation=++f.maxGeneration;f.lastModTime=f.lastSelTime=
k;f.lastOp=f.lastSelOp=d;f.lastOrigin=f.lastSelOrigin=b.origin;u||ha(a,"historyAdded")}function hd(a,b){var c=p(b);c&&c.ranges&&c.equals(a)||b.push(a)}function Xe(a,b,c,d){var f=b["spans_"+a.id],k=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(d){d.markedSpans&&((f||(f=b["spans_"+a.id]={}))[k]=d.markedSpans);++k})}function mg(a){if(!a)return null;for(var b,c=0;c<a.length;++c)a[c].marker.explicitlyCleared?b||(b=a.slice(0,c)):b&&b.push(a[c]);return b?b.length?b:null:a}function $e(a,
b){var c;if(c=b["spans_"+a.id]){for(var d=[],f=0;f<b.text.length;++f)d.push(mg(c[f]));c=d}else c=null;d=Ja(a,b);if(!c)return d;if(!d)return c;for(f=0;f<c.length;++f){var k=c[f],l=d[f];if(k&&l){var u=0;a:for(;u<l.length;++u){for(var e=l[u],n=0;n<k.length;++n)if(k[n].marker==e.marker)continue a;k.push(e)}}else l&&(c[f]=l)}return c}function Xb(a,b,c){for(var d=[],f=0;f<a.length;++f){var k=a[f];if(k.ranges)d.push(c?Ia.prototype.deepCopy.call(k):k);else{var k=k.changes,l=[];d.push({changes:l});for(var u=
0;u<k.length;++u){var n=k[u],g;l.push({from:n.from,to:n.to,text:n.text});if(b)for(var q in n)(g=q.match(/^spans_(\d+)$/))&&-1<e(b,Number(g[1]))&&(p(l)[q]=n[q],delete n[q])}}}return d}function Bc(a,b,c,d){return a.cm&&a.cm.display.shift||a.extend?(a=b.anchor,d&&(b=0>M(c,a),b!=0>M(d,a)?(a=c,c=d):b!=0>M(c,d)&&(c=d)),new W(a,c)):new W(d||c,c)}function id(a,b,c,d){qa(a,new Ia([Bc(a,a.sel.primary(),b,c)],0),d)}function af(a,b,c){for(var d=[],f=0;f<a.sel.ranges.length;f++)d[f]=Bc(a,a.sel.ranges[f],b[f],
null);b=Sa(d,a.sel.primIndex);qa(a,b,c)}function Vd(a,b,c,d){var f=a.sel.ranges.slice(0);f[b]=c;qa(a,Sa(f,a.sel.primIndex),d)}function ng(a,b,c){c={ranges:b.ranges,update:function(b){this.ranges=[];for(var d=0;d<b.length;d++)this.ranges[d]=new W(K(a,b[d].anchor),K(a,b[d].head))},origin:c&&c.origin};ha(a,"beforeSelectionChange",a,c);a.cm&&ha(a.cm,"beforeSelectionChange",a.cm,c);return c.ranges!=b.ranges?Sa(c.ranges,c.ranges.length-1):b}function bf(a,b,c){var d=a.history.done,f=p(d);f&&f.ranges?(d[d.length-
1]=b,jd(a,b,c)):qa(a,b,c)}function qa(a,b,c){jd(a,b,c);b=a.sel;var d=a.cm?a.cm.curOp.id:NaN,f=a.history,k=c&&c.origin,l;if(!(l=d==f.lastSelOp)&&(l=k&&f.lastSelOrigin==k)&&!(l=f.lastModTime==f.lastSelTime&&f.lastOrigin==k)){l=p(f.done);var e=k.charAt(0);l="*"==e||"+"==e&&l.ranges.length==b.ranges.length&&l.somethingSelected()==b.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}l?f.done[f.done.length-1]=b:hd(b,f.done);f.lastSelTime=+new Date;f.lastSelOrigin=
k;f.lastSelOp=d;c&&!1!==c.clearRedo&&Ye(f.undone)}function jd(a,b,c){if(Da(a,"beforeSelectionChange")||a.cm&&Da(a.cm,"beforeSelectionChange"))b=ng(a,b,c);var d=c&&c.bias||(0>M(b.primary().head,a.sel.primary().head)?-1:1);cf(a,df(a,b,d,!0));c&&!1===c.scroll||!a.cm||Tb(a.cm)}function cf(a,b){b.equals(a.sel)||(a.sel=b,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0,oc(a.cm)),pa(a,"cursorActivity",a))}function ef(a){cf(a,df(a,a.sel,null,!1),Ta)}function df(a,b,c,d){for(var f,k=0;k<b.ranges.length;k++){var l=
b.ranges[k],e=b.ranges.length==a.sel.ranges.length&&a.sel.ranges[k],n=Wd(a,l.anchor,e&&e.anchor,c,d),e=Wd(a,l.head,e&&e.head,c,d);if(f||n!=l.anchor||e!=l.head)f||(f=b.ranges.slice(0,k)),f[k]=new W(n,e)}return f?Sa(f,b.primIndex):b}function Yb(a,b,c,d,f){var k=C(a,b.line);if(k.markedSpans)for(var l=0;l<k.markedSpans.length;++l){var e=k.markedSpans[l],n=e.marker;if((null==e.from||(n.inclusiveLeft?e.from<=b.ch:e.from<b.ch))&&(null==e.to||(n.inclusiveRight?e.to>=b.ch:e.to>b.ch))){if(f&&(ha(n,"beforeCursorEnter"),
n.explicitlyCleared))if(k.markedSpans){--l;continue}else break;if(n.atomic){if(c){l=n.find(0>d?1:-1);e=void 0;if(0>d?n.inclusiveRight:n.inclusiveLeft)l=ff(a,l,-d,l&&l.line==b.line?k:null);if(l&&l.line==b.line&&(e=M(l,c))&&(0>d?0>e:0<e))return Yb(a,l,b,d,f)}c=n.find(0>d?-1:1);if(0>d?n.inclusiveLeft:n.inclusiveRight)c=ff(a,c,d,c.line==b.line?k:null);return c?Yb(a,c,b,d,f):null}}}return b}function Wd(a,b,c,d,f){d=d||1;b=Yb(a,b,c,d,f)||!f&&Yb(a,b,c,d,!0)||Yb(a,b,c,-d,f)||!f&&Yb(a,b,c,-d,!0);return b?
b:(a.cantEdit=!0,A(a.first,0))}function ff(a,b,c,d){return 0>c&&0==b.ch?b.line>a.first?K(a,A(b.line-1)):null:0<c&&b.ch==(d||C(a,b.line)).text.length?b.line<a.first+a.size-1?A(b.line+1,0):null:new A(b.line,b.ch+c)}function gf(a){a.setSelection(A(a.firstLine(),0),A(a.lastLine()),Ta)}function hf(a,b,c){var d={canceled:!1,from:b.from,to:b.to,text:b.text,origin:b.origin,cancel:function(){return d.canceled=!0}};c&&(d.update=function(b,c,l,e){b&&(d.from=K(a,b));c&&(d.to=K(a,c));l&&(d.text=l);void 0!==e&&
(d.origin=e)});ha(a,"beforeChange",a,d);a.cm&&ha(a.cm,"beforeChange",a.cm,d);return d.canceled?null:{from:d.from,to:d.to,text:d.text,origin:d.origin}}function Zb(a,b,c){if(a.cm){if(!a.cm.curOp)return ma(a.cm,Zb)(a,b,c);if(a.cm.state.suppressEdits)return}if(Da(a,"beforeChange")||a.cm&&Da(a.cm,"beforeChange"))if(b=hf(a,b,!0),!b)return;if(c=jf&&!c&&jb(a,b.from,b.to))for(var d=c.length-1;0<=d;--d)kf(a,{from:c[d].from,to:c[d].to,text:d?[""]:b.text});else kf(a,b)}function kf(a,b){if(1!=b.text.length||""!=
b.text[0]||0!=M(b.from,b.to)){var c=Rd(a,b);Ze(a,b,c,a.cm?a.cm.curOp.id:NaN);Cc(a,b,c,Ja(a,b));var d=[];Gb(a,function(a,c){c||-1!=e(d,a.history)||(lf(a.history,b),d.push(a.history));Cc(a,b,null,Ja(a,b))})}}function kd(a,b,c){if(!a.cm||!a.cm.state.suppressEdits||c){for(var d=a.history,f,k=a.sel,l="undo"==b?d.done:d.undone,u="undo"==b?d.undone:d.done,n=0;n<l.length&&(f=l[n],c?!f.ranges||f.equals(a.sel):f.ranges);n++);if(n!=l.length){for(d.lastOrigin=d.lastSelOrigin=null;;)if(f=l.pop(),f.ranges){hd(f,
u);if(c&&!f.equals(a.sel)){qa(a,f,{clearRedo:!1});return}k=f}else break;var g=[];hd(k,u);u.push({changes:g,generation:d.generation});d.generation=f.generation||++d.maxGeneration;var q=Da(a,"beforeChange")||a.cm&&Da(a.cm,"beforeChange");c=function(d){var c=f.changes[d];c.origin=b;if(q&&!hf(a,c,!1))return l.length=0,{};g.push(Ud(a,c));var k=d?Rd(a,c):p(l);Cc(a,c,k,$e(a,c));!d&&a.cm&&a.cm.scrollIntoView({from:c.from,to:qb(c)});var u=[];Gb(a,function(a,b){b||-1!=e(u,a.history)||(lf(a.history,c),u.push(a.history));
Cc(a,c,null,$e(a,c))})};for(d=f.changes.length-1;0<=d;--d)if(k=c(d))return k.v}}}function mf(a,b){if(0!=b&&(a.first+=b,a.sel=new Ia(y(a.sel.ranges,function(a){return new W(A(a.anchor.line+b,a.anchor.ch),A(a.head.line+b,a.head.ch))}),a.sel.primIndex),a.cm)){za(a.cm,a.first,a.first-b,b);for(var c=a.cm.display,d=c.viewFrom;d<c.viewTo;d++)pb(a.cm,d,"gutter")}}function Cc(a,b,c,d){if(a.cm&&!a.cm.curOp)return ma(a.cm,Cc)(a,b,c,d);if(b.to.line<a.first)mf(a,b.text.length-1-(b.to.line-b.from.line));else if(!(b.from.line>
a.lastLine())){if(b.from.line<a.first){var f=b.text.length-1-(a.first-b.from.line);mf(a,f);b={from:A(a.first,0),to:A(b.to.line+f,b.to.ch),text:[p(b.text)],origin:b.origin}}f=a.lastLine();b.to.line>f&&(b={from:b.from,to:A(f,C(a,f).text.length),text:[b.text[0]],origin:b.origin});b.removed=ba(a,b.from,b.to);c||(c=Rd(a,b));a.cm?og(a.cm,b,d):Td(a,b,d);jd(a,c,Ta)}}function og(a,b,c){var d=a.doc,f=a.display,k=b.from,l=b.to,e=!1,n=k.line;a.options.lineWrapping||(n=T(Ka(C(d,k.line))),d.iter(n,l.line+1,function(a){if(a==
f.maxLine)return e=!0}));-1<d.sel.contains(b.from,b.to)&&oc(a);Td(d,b,c,De(a));a.options.lineWrapping||(d.iter(n,k.line+b.text.length,function(a){var b=wb(a);b>f.maxLineLength&&(f.maxLine=a,f.maxLineLength=b,f.maxLineChanged=!0,e=!1)}),e&&(a.curOp.updateMaxLine=!0));d.frontier=Math.min(d.frontier,k.line);yc(a,400);c=b.text.length-(l.line-k.line)-1;b.full?za(a):k.line!=l.line||1!=b.text.length||Ue(a.doc,b)?za(a,k.line,l.line+1,c):pb(a,k.line,"text");c=Da(a,"changes");if((d=Da(a,"change"))||c)b={from:k,
to:l,text:b.text,removed:b.removed,origin:b.origin},d&&pa(a,"change",a,b),c&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(b);a.display.selForContextMenu=null}function $b(a,b,c,d,f){d||(d=c);if(0>M(d,c)){var k=d;d=c;c=k}"string"==typeof b&&(b=a.splitLines(b));Zb(a,{from:c,to:d,text:b,origin:f})}function nf(a,b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)}function of(a,b,c,d){for(var f=0;f<a.length;++f){var k=a[f],l=!0;if(k.ranges)for(k.copied||(k=a[f]=k.deepCopy(),k.copied=!0),l=0;l<k.ranges.length;l++)nf(k.ranges[l].anchor,
b,c,d),nf(k.ranges[l].head,b,c,d);else{for(var e=0;e<k.changes.length;++e){var n=k.changes[e];if(c<n.from.line)n.from=A(n.from.line+d,n.from.ch),n.to=A(n.to.line+d,n.to.ch);else if(b<=n.to.line){l=!1;break}}l||(a.splice(0,f+1),f=0)}}}function lf(a,b){var c=b.from.line,d=b.to.line,f=b.text.length-(d-c)-1;of(a.done,c,d,f);of(a.undone,c,d,f)}function Dc(a,b,c,d){var f=b,k=b;"number"==typeof b?k=C(a,Math.max(a.first,Math.min(b,a.first+a.size-1))):f=T(b);if(null==f)return null;d(k,f)&&a.cm&&pb(a.cm,f,
c);return k}function pg(a,b,c,d){var f=new Ec(a,c,d),k=a.cm;k&&f.noHScroll&&(k.display.alignWidgets=!0);Dc(a,b,"widget",function(b){var d=b.widgets||(b.widgets=[]);null==f.insertAt?d.push(f):d.splice(Math.min(d.length-1,Math.max(0,f.insertAt)),0,f);f.line=b;k&&!ab(a,b)&&(d=wa(b)<a.scrollTop,Ga(b,b.height+sc(f)),d&&cd(k,null,f.height),k.curOp.forceUpdate=!0);return!0});pa(k,"lineWidgetAdded",k,f,"number"==typeof b?b:T(b));return f}function ac(a,b,c,d,f){if(d&&d.shared)return qg(a,b,c,d,f);if(a.cm&&
!a.cm.curOp)return ma(a.cm,ac)(a,b,c,d,f);var k=new rb(a,f);f=M(b,c);d&&h(d,k,!1);if(0<f||0==f&&!1!==k.clearWhenEmpty)return k;k.replacedWith&&(k.collapsed=!0,k.widgetNode=t("span",[k.replacedWith],"CodeMirror-widget"),d.handleMouseEvents||k.widgetNode.setAttribute("cm-ignore-events","true"),d.insertLeft&&(k.widgetNode.insertLeft=!0));if(k.collapsed){if(Z(a,b.line,b,c,k)||b.line!=c.line&&Z(a,c.line,b,c,k))throw Error("Inserting collapsed marker partially overlapping an existing one");kb=!0}k.addToHistory&&
Ze(a,{from:b,to:c,origin:"markText"},a.sel,NaN);var l=b.line,e=a.cm,n;a.iter(l,c.line+1,function(a){e&&k.collapsed&&!e.options.lineWrapping&&Ka(a)==e.display.maxLine&&(n=!0);k.collapsed&&l!=b.line&&Ga(a,0);var d=new Za(k,l==b.line?b.ch:null,l==c.line?c.ch:null);a.markedSpans=a.markedSpans?a.markedSpans.concat([d]):[d];d.marker.attachLine(a);++l});k.collapsed&&a.iter(b.line,c.line+1,function(b){ab(a,b)&&Ga(b,0)});k.clearOnEnter&&L(k,"beforeCursorEnter",function(){return k.clear()});k.readOnly&&(jf=
!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory());k.collapsed&&(k.id=++pf,k.atomic=!0);if(e){n&&(e.curOp.updateMaxLine=!0);if(k.collapsed)za(e,b.line,c.line+1);else if(k.className||k.title||k.startStyle||k.endStyle||k.css)for(d=b.line;d<=c.line;d++)pb(e,d,"text");k.atomic&&ef(e.doc);pa(e,"markerAdded",e,k)}return k}function qg(a,b,c,d,f){d=h(d);d.shared=!1;var k=[ac(a,b,c,d,f)],l=k[0],e=d.widgetNode;Gb(a,function(a){e&&(d.widgetNode=e.cloneNode(!0));k.push(ac(a,K(a,b),K(a,c),
d,f));for(var u=0;u<a.linked.length;++u)if(a.linked[u].isParent)return;l=p(k)});return new Fc(k,l)}function qf(a){return a.findMarks(A(a.first,0),a.clipPos(A(a.lastLine())),function(a){return a.parent})}function rg(a){for(var b=function(b){b=a[b];var d=[b.primary.doc];Gb(b.primary.doc,function(a){return d.push(a)});for(var c=0;c<b.markers.length;c++){var l=b.markers[c];-1==e(d,l.doc)&&(l.parent=null,b.markers.splice(c--,1))}},c=0;c<a.length;c++)b(c)}function sg(a){var b=this;rf(b);if(!ea(b,a)&&!eb(b.display,
a)){ka(a);S&&(sf=+new Date);var c=Eb(b,a,!0),d=a.dataTransfer.files;if(c&&!b.isReadOnly())if(d&&d.length&&window.FileReader&&window.File)for(var f=d.length,k=Array(f),l=0,u=function(a,d){if(!b.options.allowDropFileTypes||-1!=e(b.options.allowDropFileTypes,a.type)){var n=new FileReader;n.onload=ma(b,function(){var a=n.result;/[\x00-\x08\x0e-\x1f]{2}/.test(a)&&(a="");k[d]=a;++l==f&&(c=K(b.doc,c),a={from:c,to:c,text:b.doc.splitLines(k.join(b.doc.lineSeparator())),origin:"paste"},Zb(b.doc,a),bf(b.doc,
fb(c,qb(a))))});n.readAsText(a)}},n=0;n<f;++n)u(d[n],n);else if(b.state.draggingText&&-1<b.doc.sel.contains(c))b.state.draggingText(a),setTimeout(function(){return b.display.input.focus()},20);else try{if(u=a.dataTransfer.getData("Text")){b.state.draggingText&&!b.state.draggingText.copy&&(n=b.listSelections());jd(b.doc,fb(c,c));if(n)for(d=0;d<n.length;++d)$b(b.doc,"",n[d].anchor,n[d].head,"drag");b.replaceSelection(u,"around","paste");b.display.input.focus()}}catch(U){}}}function rf(a){a.display.dragCursor&&
(a.display.lineSpace.removeChild(a.display.dragCursor),a.display.dragCursor=null)}function tf(a){if(document.body.getElementsByClassName)for(var b=document.body.getElementsByClassName("CodeMirror"),c=0;c<b.length;c++){var d=b[c].CodeMirror;d&&a(d)}}function tg(){var a;L(window,"resize",function(){null==a&&(a=setTimeout(function(){a=null;tf(ug)},100))});L(window,"blur",function(){return tf(wc)})}function ug(a){var b=a.display;if(b.lastWrapHeight!=b.wrapper.clientHeight||b.lastWrapWidth!=b.wrapper.clientWidth)b.cachedCharWidth=
b.cachedTextHeight=b.cachedPaddingH=null,b.scrollbarsClipped=!1,a.setSize()}function vg(a){var b=a.split(/-(?!$)/);a=b[b.length-1];for(var c,d,f,k,l=0;l<b.length-1;l++){var e=b[l];if(/^(cmd|meta|m)$/i.test(e))k=!0;else if(/^a(lt)?$/i.test(e))c=!0;else if(/^(c|ctrl|control)$/i.test(e))d=!0;else if(/^s(hift)?$/i.test(e))f=!0;else throw Error("Unrecognized modifier name: "+e);}c&&(a="Alt-"+a);d&&(a="Ctrl-"+a);k&&(a="Cmd-"+a);f&&(a="Shift-"+a);return a}function wg(a){var b={},c;for(c in a)if(a.hasOwnProperty(c)){var d=
a[c];if(!/^(name|fallthrough|(de|at)tach)$/.test(c)){if("..."!=d)for(var f=y(c.split(" "),vg),k=0;k<f.length;k++){var l,e;k==f.length-1?(e=f.join(" "),l=d):(e=f.slice(0,k+1).join(" "),l="...");var n=b[e];if(!n)b[e]=l;else if(n!=l)throw Error("Inconsistent bindings for "+e);}delete a[c]}}for(var g in b)a[g]=b[g];return a}function bc(a,b,c,d){b=ld(b);var f=b.call?b.call(a,d):b[a];if(!1===f)return"nothing";if("..."===f)return"multi";if(null!=f&&c(f))return"handled";if(b.fallthrough){if("[object Array]"!=
Object.prototype.toString.call(b.fallthrough))return bc(a,b.fallthrough,c,d);for(f=0;f<b.fallthrough.length;f++){var k=bc(a,b.fallthrough[f],c,d);if(k)return k}}}function uf(a){a="string"==typeof a?a:sb[a.keyCode];return"Ctrl"==a||"Alt"==a||"Shift"==a||"Mod"==a}function vf(a,b){if(Ra&&34==a.keyCode&&a["char"])return!1;var c=sb[a.keyCode],d=c;if(null==d||a.altGraphKey)return!1;a.altKey&&"Alt"!=c&&(d="Alt-"+d);(wf?a.metaKey:a.ctrlKey)&&"Ctrl"!=c&&(d="Ctrl-"+d);(wf?a.ctrlKey:a.metaKey)&&"Cmd"!=c&&(d=
"Cmd-"+d);!b&&a.shiftKey&&"Shift"!=c&&(d="Shift-"+d);return d}function ld(a){return"string"==typeof a?Gc[a]:a}function cc(a,b){for(var c=a.doc.sel.ranges,d=[],f=0;f<c.length;f++){for(var k=b(c[f]);d.length&&0>=M(k.from,p(d).to);){var l=d.pop();if(0>M(l.from,k.from)){k.from=l.from;break}}d.push(k)}Ea(a,function(){for(var b=d.length-1;0<=b;b--)$b(a.doc,"",d[b].from,d[b].to,"+delete");Tb(a)})}function xf(a,b){var c=C(a.doc,b),d=Ka(c);d!=c&&(b=T(d));return xb(!0,a,d,b,1)}function yf(a,b){var c=xf(a,b.line),
d=C(a.doc,c.line),f=Na(d,a.doc.direction);return f&&0!=f[0].level?c:(d=Math.max(0,d.text.search(/\S/)),A(c.line,b.line==c.line&&b.ch<=d&&b.ch?0:d,c.sticky))}function md(a,b,c){if("string"==typeof b&&(b=nd[b],!b))return!1;a.display.input.ensurePolled();var d=a.display.shift,f=!1;try{a.isReadOnly()&&(a.state.suppressEdits=!0),c&&(a.display.shift=!1),f=b(a)!=Xd}finally{a.display.shift=d,a.state.suppressEdits=!1}return f}function xg(a,b,c){for(var d=0;d<a.state.keyMaps.length;d++){var f=bc(b,a.state.keyMaps[d],
c,a);if(f)return f}return a.options.extraKeys&&bc(b,a.options.extraKeys,c,a)||bc(b,a.options.keyMap,c,a)}function od(a,b,c,d){var f=a.state.keySeq;if(f){if(uf(b))return"handled";yg.set(50,function(){a.state.keySeq==f&&(a.state.keySeq=null,a.display.input.reset())});b=f+" "+b}d=xg(a,b,d);"multi"==d&&(a.state.keySeq=b);"handled"==d&&pa(a,"keyHandled",a,b,c);if("handled"==d||"multi"==d)ka(c),Id(a);return f&&!d&&/\'$/.test(b)?(ka(c),!0):!!d}function zf(a,b){var c=vf(b,!0);return c?b.shiftKey&&!a.state.keySeq?
od(a,"Shift-"+c,b,function(b){return md(a,b,!0)})||od(a,c,b,function(b){if("string"==typeof b?/^go[A-Z]/.test(b):b.motion)return md(a,b)}):od(a,c,b,function(b){return md(a,b)}):!1}function zg(a,b,c){return od(a,"'"+c+"'",b,function(b){return md(a,b,!0)})}function Af(a){this.curOp.focus=z();if(!ea(this,a)){S&&11>aa&&27==a.keyCode&&(a.returnValue=!1);var b=a.keyCode;this.display.shift=16==b||a.shiftKey;var c=zf(this,a);Ra&&(Yd=c?b:null,!c&&88==b&&!Bf&&(Pa?a.metaKey:a.ctrlKey)&&this.replaceSelection("",
null,"cut"));18!=b||/\bCodeMirror-crosshair\b/.test(this.display.lineDiv.className)||Ag(this)}}function Ag(a){function b(a){18!=a.keyCode&&a.altKey||(Fb(c,"CodeMirror-crosshair"),ta(document,"keyup",b),ta(document,"mouseover",b))}var c=a.display.lineDiv;w(c,"CodeMirror-crosshair");L(document,"keyup",b);L(document,"mouseover",b)}function Cf(a){16==a.keyCode&&(this.doc.sel.shift=!1);ea(this,a)}function Df(a){if(!(eb(this.display,a)||ea(this,a)||a.ctrlKey&&!a.altKey||Pa&&a.metaKey)){var b=a.keyCode,
c=a.charCode;if(Ra&&b==Yd)Yd=null,ka(a);else if(!Ra||a.which&&!(10>a.which)||!zf(this,a))if(b=String.fromCharCode(null==c?b:c),"\b"!=b&&!zg(this,a,b))this.display.input.onKeyPress(a)}}function Bg(a){var b=this.display;if(!(ea(this,a)||b.activeTouch&&b.input.supportsTouch()))if(b.input.ensurePolled(),b.shift=a.shiftKey,eb(b,a))oa||(b.scroller.draggable=!1,setTimeout(function(){return b.scroller.draggable=!0},100));else if(!Zd(this,a,"gutterClick",!0)){var c=Eb(this,a);window.focus();switch(db(a)){case 1:this.state.selectingText?
this.state.selectingText(a):c?Cg(this,a,c):(a.target||a.srcElement)==b.scroller&&ka(a);break;case 2:oa&&(this.state.lastMiddleDown=+new Date);c&&id(this.doc,c);setTimeout(function(){return b.input.focus()},20);ka(a);break;case 3:$d?Ef(this,a):He(this)}}}function Cg(a,b,c){S?setTimeout(G(Ge,a),0):a.curOp.focus=z();var d=+new Date,f;pd&&pd.time>d-400&&0==M(pd.pos,c)?f="triple":qd&&qd.time>d-400&&0==M(qd.pos,c)?(f="double",pd={time:d,pos:c}):(f="single",qd={time:d,pos:c});var d=a.doc.sel,k=Pa?b.metaKey:
b.ctrlKey,l;a.options.dragDrop&&Dg&&!a.isReadOnly()&&"single"==f&&-1<(l=d.contains(c))&&(0>M((l=d.ranges[l]).from(),c)||0<c.xRel)&&(0<M(l.to(),c)||0>c.xRel)?Eg(a,b,c,k):Fg(a,b,c,f,k)}function Eg(a,b,c,d){var f=a.display,k=!1,l=ma(a,function(b){oa&&(f.scroller.draggable=!1);a.state.draggingText=!1;ta(document,"mouseup",l);ta(document,"mousemove",e);ta(f.scroller,"dragstart",n);ta(f.scroller,"drop",l);k||(ka(b),d||id(a.doc,c),oa||S&&9==aa?setTimeout(function(){document.body.focus();f.input.focus()},
20):f.input.focus())}),e=function(a){k=k||10<=Math.abs(b.clientX-a.clientX)+Math.abs(b.clientY-a.clientY)},n=function(){return k=!0};oa&&(f.scroller.draggable=!0);a.state.draggingText=l;l.copy=Pa?b.altKey:b.ctrlKey;f.scroller.dragDrop&&f.scroller.dragDrop();L(document,"mouseup",l);L(document,"mousemove",e);L(f.scroller,"dragstart",n);L(f.scroller,"drop",l);He(a);setTimeout(function(){return f.input.focus()},20)}function Fg(a,b,c,d,f){function k(b){if(0!=M(ra,b))if(ra=b,"rect"==d){for(var f=[],k=a.options.tabSize,
l=q(C(g,c.line).text,c.ch,k),e=q(C(g,b.line).text,b.ch,k),n=Math.min(l,e),l=Math.max(l,e),e=Math.min(c.line,b.line),u=Math.min(a.lastLine(),Math.max(c.line,b.line));e<=u;e++){var x=C(g,e).text,y=I(x,n,k);n==l?f.push(new W(A(e,y),A(e,y))):x.length>y&&f.push(new W(A(e,y),A(e,I(x,l,k))))}f.length||f.push(new W(c,c));qa(g,Sa(m.ranges.slice(0,h).concat(f),h),{origin:"*mouse",scroll:!1});a.scrollIntoView(b)}else n=p,f=n.anchor,k=b,"single"!=d&&(b="double"==d?a.findWordAt(b):new W(A(b.line,0),K(g,A(b.line+
1,0))),0<M(b.anchor,f)?(k=b.head,f=va(n.from(),b.anchor)):(k=b.anchor,f=Ma(n.to(),b.head))),b=m.ranges.slice(0),b[h]=new W(K(g,f),k),qa(g,Sa(b,h),ae)}function l(b){var c=++w,f=Eb(a,b,!0,"rect"==d);if(f)if(0!=M(f,ra)){a.curOp.focus=z();k(f);var e=Md(n,g);(f.line>=e.to||f.line<e.from)&&setTimeout(ma(a,function(){w==c&&l(b)}),150)}else{var u=b.clientY<r.top?-20:b.clientY>r.bottom?20:0;u&&setTimeout(ma(a,function(){w==c&&(n.scroller.scrollTop+=u,l(b))}),50)}}function e(b){a.state.selectingText=!1;w=Infinity;
ka(b);n.input.focus();ta(document,"mousemove",D);ta(document,"mouseup",Z);g.history.lastSelOrigin=null}var n=a.display,g=a.doc;ka(b);var p,h,m=g.sel,y=m.ranges;f&&!b.shiftKey?(h=g.sel.contains(c),p=-1<h?y[h]:new W(c,c)):(p=g.sel.primary(),h=g.sel.primIndex);if(Gg?b.shiftKey&&b.metaKey:b.altKey)d="rect",f||(p=new W(c,c)),c=Eb(a,b,!0,!0),h=-1;else if("double"==d){var P=a.findWordAt(c);p=a.display.shift||g.extend?Bc(g,p,P.anchor,P.head):P}else"triple"==d?(P=new W(A(c.line,0),K(g,A(c.line+1,0))),p=a.display.shift||
g.extend?Bc(g,p,P.anchor,P.head):P):p=Bc(g,p,c);f?-1==h?(h=y.length,qa(g,Sa(y.concat([p]),h),{scroll:!1,origin:"*mouse"})):1<y.length&&y[h].empty()&&"single"==d&&!b.shiftKey?(qa(g,Sa(y.slice(0,h).concat(y.slice(h+1)),0),{scroll:!1,origin:"*mouse"}),m=g.sel):Vd(g,h,p,ae):(h=0,qa(g,new Ia([p],0),ae),m=g.sel);var ra=c,r=n.wrapper.getBoundingClientRect(),w=0,D=ma(a,function(a){db(a)?l(a):e(a)}),Z=ma(a,e);a.state.selectingText=Z;L(document,"mousemove",D);L(document,"mouseup",Z)}function Zd(a,b,c,d){var f,
k;try{f=b.clientX,k=b.clientY}catch(x){return!1}if(f>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;d&&ka(b);d=a.display;var l=d.lineDiv.getBoundingClientRect();if(k>l.bottom||!Da(a,c))return Mb(b);k-=l.top-d.viewOffset;for(l=0;l<a.options.gutters.length;++l){var e=d.gutters.childNodes[l];if(e&&e.getBoundingClientRect().right>=f)return f=Ya(a.doc,k),ha(a,c,a,f,a.options.gutters[l],b),Mb(b)}}function Ef(a,b){var c;(c=eb(a.display,b))||(c=Da(a,"gutterContextMenu")?Zd(a,b,"gutterContextMenu",
!1):!1);if(!c&&!ea(a,b,"contextmenu"))a.display.input.onContextMenu(b)}function Ff(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-");uc(a)}function Hc(a){Re(a);za(a);Kd(a)}function Hg(a,b,c){!b!=!(c&&c!=dc)&&(c=a.display.dragFunctions,b=b?L:ta,b(a.display.scroller,"dragstart",c.start),b(a.display.scroller,"dragenter",c.enter),b(a.display.scroller,"dragover",c.over),b(a.display.scroller,"dragleave",c.leave),b(a.display.scroller,
"drop",c.drop))}function Ig(a){a.options.lineWrapping?(w(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth="",a.display.sizerWidth=null):(Fb(a.display.wrapper,"CodeMirror-wrap"),Ca(a));Hd(a);za(a);uc(a);setTimeout(function(){return Sb(a)},100)}function da(a,b){var c=this;if(!(this instanceof da))return new da(a,b);this.options=b=b?h(b):{};h(Gf,b,!1);Qd(b);var d=b.value;"string"==typeof d&&(d=new Aa(d,b.mode,null,b.lineSeparator,b.direction));this.doc=d;var f=new da.inputStyles[b.inputStyle](this),
f=this.display=new ga(a,d,f);f.wrapper.CodeMirror=this;Re(this);Ff(this);b.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");Ne(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new Hb,keySeq:null,specialChars:null};b.autofocus&&!gc&&f.input.focus();S&&11>aa&&setTimeout(function(){return c.display.input.reset(!0)},20);Jg(this);Hf||(tg(),Hf=!0);
Ub(this);this.curOp.forceUpdate=!0;Ve(this,d);b.autofocus&&!gc||this.hasFocus()?setTimeout(G(Jd,this),20):wc(this);for(var k in rd)if(rd.hasOwnProperty(k))rd[k](c,b[k],dc);Ie(this);b.finishInit&&b.finishInit(this);for(d=0;d<be.length;++d)be[d](c);Vb(this);oa&&b.lineWrapping&&"optimizelegibility"==getComputedStyle(f.lineDiv).textRendering&&(f.lineDiv.style.textRendering="auto")}function Jg(a){function b(){d.activeTouch&&(f=setTimeout(function(){return d.activeTouch=null},1E3),k=d.activeTouch,k.end=
+new Date)}function c(a,b){if(null==b.left)return!0;var d=b.left-a.left,c=b.top-a.top;return 400<d*d+c*c}var d=a.display;L(d.scroller,"mousedown",ma(a,Bg));S&&11>aa?L(d.scroller,"dblclick",ma(a,function(b){if(!ea(a,b)){var d=Eb(a,b);!d||Zd(a,b,"gutterClick",!0)||eb(a.display,b)||(ka(b),b=a.findWordAt(d),id(a.doc,b.anchor,b.head))}})):L(d.scroller,"dblclick",function(b){return ea(a,b)||ka(b)});$d||L(d.scroller,"contextmenu",function(b){return Ef(a,b)});var f,k={end:0};L(d.scroller,"touchstart",function(b){var c;
if(c=!ea(a,b))1!=b.touches.length?c=!1:(c=b.touches[0],c=1>=c.radiusX&&1>=c.radiusY),c=!c;c&&(d.input.ensurePolled(),clearTimeout(f),c=+new Date,d.activeTouch={start:c,moved:!1,prev:300>=c-k.end?k:null},1==b.touches.length&&(d.activeTouch.left=b.touches[0].pageX,d.activeTouch.top=b.touches[0].pageY))});L(d.scroller,"touchmove",function(){d.activeTouch&&(d.activeTouch.moved=!0)});L(d.scroller,"touchend",function(f){var k=d.activeTouch;if(k&&!eb(d,f)&&null!=k.left&&!k.moved&&300>new Date-k.start){var l=
a.coordsChar(d.activeTouch,"page"),k=!k.prev||c(k,k.prev)?new W(l,l):!k.prev.prev||c(k,k.prev.prev)?a.findWordAt(l):new W(A(l.line,0),K(a.doc,A(l.line+1,0)));a.setSelection(k.anchor,k.head);a.focus();ka(f)}b()});L(d.scroller,"touchcancel",b);L(d.scroller,"scroll",function(){d.scroller.clientHeight&&(xc(a,d.scroller.scrollTop),Rb(a,d.scroller.scrollLeft,!0),ha(a,"scroll",a))});L(d.scroller,"mousewheel",function(b){return Le(a,b)});L(d.scroller,"DOMMouseScroll",function(b){return Le(a,b)});L(d.wrapper,
"scroll",function(){return d.wrapper.scrollTop=d.wrapper.scrollLeft=0});d.dragFunctions={enter:function(b){ea(a,b)||Va(b)},over:function(b){if(!ea(a,b)){var d=Eb(a,b);if(d){var c=document.createDocumentFragment();Fe(a,d,c);a.display.dragCursor||(a.display.dragCursor=v("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),a.display.lineSpace.insertBefore(a.display.dragCursor,a.display.cursorDiv));E(a.display.dragCursor,c)}Va(b)}},start:function(b){if(S&&(!a.state.draggingText||100>+new Date-sf))Va(b);
else if(!ea(a,b)&&!eb(a.display,b)&&(b.dataTransfer.setData("Text",a.getSelection()),b.dataTransfer.effectAllowed="copyMove",b.dataTransfer.setDragImage&&!If)){var d=v("img",null,null,"position: fixed; left: 0; top: 0;");d.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";Ra&&(d.width=d.height=1,a.display.wrapper.appendChild(d),d._top=d.offsetTop);b.dataTransfer.setDragImage(d,0,0);Ra&&d.parentNode.removeChild(d)}},drop:ma(a,sg),leave:function(b){ea(a,b)||rf(a)}};var l=
d.input.getField();L(l,"keyup",function(b){return Cf.call(a,b)});L(l,"keydown",ma(a,Af));L(l,"keypress",ma(a,Df));L(l,"focus",function(b){return Jd(a,b)});L(l,"blur",function(b){return wc(a,b)})}function Ic(a,b,c,d){var f=a.doc,k;null==c&&(c="add");"smart"==c&&(f.mode.indent?k=n(a,b):c="prev");var l=a.options.tabSize,e=C(f,b),p=q(e.text,null,l);e.stateAfter&&(e.stateAfter=null);var h=e.text.match(/^\s*/)[0],m;if(!d&&!/\S/.test(e.text))m=0,c="not";else if("smart"==c&&(m=f.mode.indent(k,e.text.slice(h.length),
e.text),m==Xd||150<m)){if(!d)return;c="prev"}"prev"==c?m=b>f.first?q(C(f,b-1).text,null,l):0:"add"==c?m=p+a.options.indentUnit:"subtract"==c?m=p-a.options.indentUnit:"number"==typeof c&&(m=p+c);m=Math.max(0,m);c="";d=0;if(a.options.indentWithTabs)for(a=Math.floor(m/l);a;--a)d+=l,c+="\t";d<m&&(c+=g(m-d));if(c!=h)return $b(f,c,A(b,0),A(b,h.length),"+input"),e.stateAfter=null,!0;for(l=0;l<f.sel.ranges.length;l++)if(e=f.sel.ranges[l],e.head.line==b&&e.head.ch<h.length){b=A(b,h.length);Vd(f,l,new W(b,
b));break}}function ce(a,b,c,d,f){var k=a.doc;a.display.shift=!1;d||(d=k.sel);var l=a.state.pasteIncoming||"paste"==f,e=de(b),n=null;if(l&&1<d.ranges.length)if(Ba&&Ba.text.join("\n")==b){if(0==d.ranges.length%Ba.text.length)for(var n=[],g=0;g<Ba.text.length;g++)n.push(k.splitLines(Ba.text[g]))}else e.length==d.ranges.length&&(n=y(e,function(a){return[a]}));for(var q,g=d.ranges.length-1;0<=g;g--){q=d.ranges[g];var h=q.from(),m=q.to();q.empty()&&(c&&0<c?h=A(h.line,h.ch-c):a.state.overwrite&&!l?m=A(m.line,
Math.min(C(k,m.line).text.length,m.ch+p(e).length)):Ba&&Ba.lineWise&&Ba.text.join("\n")==b&&(h=m=A(h.line,0)));q=a.curOp.updateInput;h={from:h,to:m,text:n?n[g%n.length]:e,origin:f||(l?"paste":a.state.cutIncoming?"cut":"+input")};Zb(a.doc,h);pa(a,"inputRead",a,h)}b&&!l&&Jf(a,b);Tb(a);a.curOp.updateInput=q;a.curOp.typing=!0;a.state.pasteIncoming=a.state.cutIncoming=!1}function Kf(a,b){var c=a.clipboardData&&a.clipboardData.getData("Text");if(c)return a.preventDefault(),b.isReadOnly()||b.options.disableInput||
Ea(b,function(){return ce(b,c,0,null,"paste")}),!0}function Jf(a,b){if(a.options.electricChars&&a.options.smartIndent)for(var c=a.doc.sel,d=c.ranges.length-1;0<=d;d--){var f=c.ranges[d];if(!(100<f.head.ch||d&&c.ranges[d-1].head.line==f.head.line)){var k=a.getModeAt(f.head),l=!1;if(k.electricChars)for(var e=0;e<k.electricChars.length;e++){if(-1<b.indexOf(k.electricChars.charAt(e))){l=Ic(a,f.head.line,"smart");break}}else k.electricInput&&k.electricInput.test(C(a.doc,f.head.line).text.slice(0,f.head.ch))&&
(l=Ic(a,f.head.line,"smart"));l&&pa(a,"electricInput",a,f.head.line)}}}function Lf(a){for(var b=[],c=[],d=0;d<a.doc.sel.ranges.length;d++){var f=a.doc.sel.ranges[d].head.line,f={anchor:A(f,0),head:A(f+1,0)};c.push(f);b.push(a.getRange(f.anchor,f.head))}return{text:b,ranges:c}}function Mf(a,b){a.setAttribute("autocorrect","off");a.setAttribute("autocapitalize","off");a.setAttribute("spellcheck",!!b)}function Nf(){var a=v("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),
b=v("div",[a],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");oa?a.style.width="1000px":a.setAttribute("wrap","off");Jc&&(a.style.border="1px solid black");Mf(a);return b}function ee(a,b,c,d,f){function k(d){var k;k=f?Sc(a.cm,n,b,c):Oa(n,b,c);if(null==k){if(d=!d)d=b.line+c,d<a.first||d>=a.first+a.size?d=!1:(b=new A(d,b.ch,b.sticky),d=n=C(a,d));if(d)b=xb(f,a.cm,n,b.line,c);else return!1}else b=k;return!0}var l=b,e=c,n=C(a,b.line);if("char"==d)k();else if("column"==d)k(!0);else if("word"==
d||"group"==d){var g=null;d="group"==d;for(var p=a.cm&&a.cm.getHelper(b,"wordChars"),q=!0;!(0>c)||k(!q);q=!1){var h=n.text.charAt(b.ch)||"\n",h=fa(h,p)?"w":d&&"\n"==h?"n":!d||/\s/.test(h)?null:"p";!d||q||h||(h="s");if(g&&g!=h){0>c&&(c=1,k(),b.sticky="after");break}h&&(g=h);if(0<c&&!k(!q))break}}e=Wd(a,b,l,e,!0);ub(l,e)&&(e.hitSide=!0);return e}function Of(a,b,c,d){var f=a.doc,k=b.left,l;"page"==d?(l=Math.max(Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight)-
.5*Cb(a.display),3),l=(0<c?b.bottom:b.top)+c*l):"line"==d&&(l=0<c?b.bottom+3:b.top-3);for(;;){b=Fd(a,k,l);if(!b.outside)break;if(0>c?0>=l:l>=f.height){b.hitSide=!0;break}l+=5*c}return b}function Pf(a,b){var c=Cd(a,b.line);if(!c||c.hidden)return null;var d=C(a.doc,b.line),c=ue(c,d,b.line),d=Na(d,a.doc.direction),f="left";d&&(f=mc(d,b.ch)%2?"right":"left");c=ve(c.map,b.ch,f);c.offset="right"==c.collapse?c.end:c.start;return c}function Kg(a){for(;a;a=a.parentNode)if(/CodeMirror-gutter-wrapper/.test(a.className))return!0;
return!1}function ec(a,b){b&&(a.bad=!0);return a}function Lg(a,b,c,d,f){function k(a){return function(b){return b.id==a}}function l(a){a&&(g&&(n+=p,g=!1),n+=a)}function e(b){if(1==b.nodeType){var c=b.getAttribute("cm-text");if(null!=c)l(c||b.textContent.replace(/\u200b/g,""));else{var c=b.getAttribute("cm-marker"),u;if(c)b=a.findMarks(A(d,0),A(f+1,0),k(+c)),b.length&&(u=b[0].find())&&l(ba(a.doc,u.from,u.to).join(p));else if("false"!=b.getAttribute("contenteditable")){(u=/^(pre|div|p)$/i.test(b.nodeName))&&
g&&(n+=p,g=!1);for(c=0;c<b.childNodes.length;c++)e(b.childNodes[c]);u&&(g=!0)}}}else 3==b.nodeType&&l(b.nodeValue)}for(var n="",g=!1,p=a.doc.lineSeparator();;){e(b);if(b==c)break;b=b.nextSibling}return n}function sd(a,b,c){var d;if(b==a.display.lineDiv){d=a.display.lineDiv.childNodes[c];if(!d)return ec(a.clipPos(A(a.display.viewTo-1)),!0);b=null;c=0}else for(d=b;;d=d.parentNode){if(!d||d==a.display.lineDiv)return null;if(d.parentNode&&d.parentNode==a.display.lineDiv)break}for(var f=0;f<a.display.view.length;f++){var k=
a.display.view[f];if(k.node==d)return Mg(k,b,c)}}function Mg(a,b,c){function d(b,d,c){for(var f=-1;f<(g?g.length:0);f++)for(var k=0>f?n.map:g[f],l=0;l<k.length;l+=3){var e=k[l+2];if(e==b||e==d){d=T(0>f?a.line:a.rest[f]);f=k[l]+c;if(0>c||e!=b)f=k[l+(c?1:0)];return A(d,f)}}}var f=a.text.firstChild,k=!1;if(!b||!B(f,b))return ec(A(T(a.line),0),!0);if(b==f&&(k=!0,b=f.childNodes[c],c=0,!b))return c=a.rest?p(a.rest):a.line,ec(A(T(c),c.text.length),k);var l=3==b.nodeType?b:null,e=b;l||1!=b.childNodes.length||
3!=b.firstChild.nodeType||(l=b.firstChild,c&&(c=l.nodeValue.length));for(;e.parentNode!=f;)e=e.parentNode;var n=a.measure,g=n.maps;if(b=d(l,e,c))return ec(b,k);f=e.nextSibling;for(l=l?l.nodeValue.length-c:0;f;f=f.nextSibling){if(b=d(f,f.firstChild,0))return ec(A(b.line,b.ch-l),k);l+=f.textContent.length}for(e=e.previousSibling;e;e=e.previousSibling){if(b=d(e,e.firstChild,-1))return ec(A(b.line,b.ch+c),k);c+=e.textContent.length}}var ua=navigator.userAgent,Qf=navigator.platform,hb=/gecko\/\d/i.test(ua),
Rf=/MSIE \d/.test(ua),Sf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ua),Kc=/Edge\/(\d+)/.exec(ua),S=Rf||Sf||Kc,aa=S&&(Rf?document.documentMode||6:+(Kc||Sf)[1]),oa=!Kc&&/WebKit\//.test(ua),Ng=oa&&/Qt\/\d+\.\d+/.test(ua),Xc=!Kc&&/Chrome\//.test(ua),Ra=/Opera\//.test(ua),If=/Apple Computer/.test(navigator.vendor),Og=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(ua),ig=/PhantomJS/.test(ua),Jc=!Kc&&/AppleWebKit/.test(ua)&&/Mobile\/\w+/.test(ua),Yc=/Android/.test(ua),gc=Jc||Yc||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(ua),
Pa=Jc||/Mac/.test(Qf),Gg=/\bCrOS\b/.test(ua),Pg=/win/i.test(Qf),Ib=Ra&&ua.match(/Version\/(\d*\.\d*)/);Ib&&(Ib=Number(Ib[1]));Ib&&15<=Ib&&(Ra=!1,oa=!0);var wf=Pa&&(Ng||Ra&&(null==Ib||12.11>Ib)),$d=hb||S&&9<=aa,Fb=function(a,b){var c=a.className,d=m(b).exec(c);if(d){var f=c.slice(d.index+d[0].length);a.className=c.slice(0,d.index)+(f?d[1]+f:"")}},Pb;Pb=document.createRange?function(a,b,c,d){var f=document.createRange();f.setEnd(d||a,c);f.setStart(a,b);return f}:function(a,b,c){var d=document.body.createTextRange();
try{d.moveToElementText(a.parentNode)}catch(f){return d}d.collapse(!0);d.moveEnd("character",c);d.moveStart("character",b);return d};var fc=function(a){a.select()};Jc?fc=function(a){a.selectionStart=0;a.selectionEnd=a.value.length}:S&&(fc=function(a){try{a.select()}catch(b){}});var Hb=function(){this.id=null};Hb.prototype.set=function(a,b){clearTimeout(this.id);this.id=setTimeout(b,a)};var Xd={toString:function(){return"CodeMirror.Pass"}},Ta={scroll:!1},ae={origin:"*mouse"},Lc={origin:"+move"},Qc=
[""],Tf=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Uf=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,
jf=!1,kb=!1,nc=null,Vf=function(){function a(a){return 247>=a?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(a):1424<=a&&1524>=a?"R":1536<=a&&1785>=a?"nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111".charAt(a-
1536):1774<=a&&2220>=a?"r":8192<=a&&8203>=a?"w":8204==a?"b":"L"}function b(a,b,d){this.level=a;this.from=b;this.to=d}var c=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,d=/[stwN]/,f=/[LRr]/,k=/[Lb1n]/,l=/[1n]/;return function(e,n){var g="ltr"==n?"L":"R";if(0==e.length||"ltr"==n&&!c.test(e))return!1;for(var u=e.length,q=[],h=0;h<u;++h)q.push(a(e.charCodeAt(h)));for(var h=0,m=g;h<u;++h){var x=q[h];"m"==x?q[h]=m:m=x}h=0;for(m=g;h<u;++h)x=q[h],"1"==x&&"r"==m?q[h]="n":f.test(x)&&(m=x,"r"==x&&(q[h]="R"));
h=1;for(m=q[0];h<u-1;++h)x=q[h],"+"==x&&"1"==m&&"1"==q[h+1]?q[h]="1":","!=x||m!=q[h+1]||"1"!=m&&"n"!=m||(q[h]=m),m=x;for(h=0;h<u;++h)if(m=q[h],","==m)q[h]="N";else if("%"==m){for(m=h+1;m<u&&"%"==q[m];++m);for(x=h&&"!"==q[h-1]||m<u&&"1"==q[m]?"1":"N";h<m;++h)q[h]=x;h=m-1}h=0;for(m=g;h<u;++h)x=q[h],"L"==m&&"1"==x?q[h]="L":f.test(x)&&(m=x);for(m=0;m<u;++m)if(d.test(q[m])){for(h=m+1;h<u&&d.test(q[h]);++h);x="L"==(m?q[m-1]:g);for(x=x==("L"==(h<u?q[h]:g))?x?"L":"R":g;m<h;++m)q[m]=x;m=h-1}for(var g=[],y,
h=0;h<u;)if(k.test(q[h])){m=h;for(++h;h<u&&k.test(q[h]);++h);g.push(new b(0,m,h))}else{var P=h,m=g.length;for(++h;h<u&&"L"!=q[h];++h);for(x=P;x<h;)if(l.test(q[x])){P<x&&g.splice(m,0,new b(1,P,x));P=x;for(++x;x<h&&l.test(q[x]);++x);g.splice(m,0,new b(2,P,x));P=x}else++x;P<h&&g.splice(m,0,new b(1,P,h))}1==g[0].level&&(y=e.match(/^\s+/))&&(g[0].from=y[0].length,g.unshift(new b(0,0,y[0].length)));1==p(g).level&&(y=e.match(/\s+$/))&&(p(g).to-=y[0].length,g.push(new b(0,u-y[0].length,u)));return"rtl"==
n?g.reverse():g}}(),Tc=[],L=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):(a=a._handlers||(a._handlers={}),a[b]=(a[b]||Tc).concat(c))},Dg=function(){if(S&&9>aa)return!1;var a=v("div");return"draggable"in a||"dragDrop"in a}(),ud,yd,de=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;b<=d;){var f=a.indexOf("\n",b);-1==f&&(f=a.length);var k=a.slice(b,"\r"==a.charAt(f-1)?f-1:f),l=k.indexOf("\r");-1!=l?(c.push(k.slice(0,l)),b+=
l+1):(c.push(k),b=f+1)}return c}:function(a){return a.split(/\r\n?|\n/)},Qg=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(b){return!1}}:function(a){var b;try{b=a.ownerDocument.selection.createRange()}catch(c){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},Bf=function(){var a=v("div");if("oncopy"in a)return!0;a.setAttribute("oncopy","return;");return"function"==typeof a.oncopy}(),Ed=null,vd={},Nb={},Ob={},la=function(a,b){this.pos=this.start=
0;this.string=a;this.tabSize=b||8;this.lineStart=this.lastColumnPos=this.lastColumnValue=0};la.prototype.eol=function(){return this.pos>=this.string.length};la.prototype.sol=function(){return this.pos==this.lineStart};la.prototype.peek=function(){return this.string.charAt(this.pos)||void 0};la.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)};la.prototype.eat=function(a){var b=this.string.charAt(this.pos);if("string"==typeof a?b==a:b&&(a.test?a.test(b):
a(b)))return++this.pos,b};la.prototype.eatWhile=function(a){for(var b=this.pos;this.eat(a););return this.pos>b};la.prototype.eatSpace=function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a};la.prototype.skipToEnd=function(){this.pos=this.string.length};la.prototype.skipTo=function(a){a=this.string.indexOf(a,this.pos);if(-1<a)return this.pos=a,!0};la.prototype.backUp=function(a){this.pos-=a};la.prototype.column=function(){this.lastColumnPos<this.start&&
(this.lastColumnValue=q(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start);return this.lastColumnValue-(this.lineStart?q(this.string,this.lineStart,this.tabSize):0)};la.prototype.indentation=function(){return q(this.string,null,this.tabSize)-(this.lineStart?q(this.string,this.lineStart,this.tabSize):0)};la.prototype.match=function(a,b,c){if("string"==typeof a){var d=function(a){return c?a.toLowerCase():a},f=this.string.substr(this.pos,a.length);
if(d(f)==d(a))return!1!==b&&(this.pos+=a.length),!0}else{if((a=this.string.slice(this.pos).match(a))&&0<a.index)return null;a&&!1!==b&&(this.pos+=a[0].length);return a}};la.prototype.current=function(){return this.string.slice(this.start,this.pos)};la.prototype.hideFirstChars=function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}};var Wb=function(a,b,c){this.text=a;sa(this,b);this.height=c?c(this):1};Wb.prototype.lineNo=function(){return T(this)};Ua(Wb);var Yf={},Xf={},Qb=null,
qc=null,we={left:0,right:0,top:0,bottom:0},Db,ad=0,Ha=null;S?Ha=-.53:hb?Ha=15:Xc?Ha=-.7:If&&(Ha=-1/3);var Jb=function(a,b,c){this.cm=c;var d=this.vert=v("div",[v("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),f=this.horiz=v("div",[v("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");a(d);a(f);L(d,"scroll",function(){d.clientHeight&&b(d.scrollTop,"vertical")});L(f,"scroll",function(){f.clientWidth&&b(f.scrollLeft,"horizontal")});this.checkedZeroWidth=!1;S&&8>aa&&
(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};Jb.prototype.update=function(a){var b=a.scrollWidth>a.clientWidth+1,c=a.scrollHeight>a.clientHeight+1,d=a.nativeBarWidth;c?(this.vert.style.display="block",this.vert.style.bottom=b?d+"px":"0",this.vert.firstChild.style.height=Math.max(0,a.scrollHeight-a.clientHeight+(a.viewHeight-(b?d:0)))+"px"):(this.vert.style.display="",this.vert.firstChild.style.height="0");b?(this.horiz.style.display="block",this.horiz.style.right=c?d+"px":"0",this.horiz.style.left=
a.barLeft+"px",this.horiz.firstChild.style.width=Math.max(0,a.scrollWidth-a.clientWidth+(a.viewWidth-a.barLeft-(c?d:0)))+"px"):(this.horiz.style.display="",this.horiz.firstChild.style.width="0");!this.checkedZeroWidth&&0<a.clientHeight&&(0==d&&this.zeroWidthHack(),this.checkedZeroWidth=!0);return{right:c?d:0,bottom:b?d:0}};Jb.prototype.setScrollLeft=function(a){this.horiz.scrollLeft!=a&&(this.horiz.scrollLeft=a);this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")};Jb.prototype.setScrollTop=
function(a){this.vert.scrollTop!=a&&(this.vert.scrollTop=a);this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")};Jb.prototype.zeroWidthHack=function(){this.horiz.style.height=this.vert.style.width=Pa&&!Og?"12px":"18px";this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none";this.disableHoriz=new Hb;this.disableVert=new Hb};Jb.prototype.enableZeroWidthBar=function(a,b,c){function d(){var f=a.getBoundingClientRect();("vert"==c?document.elementFromPoint(f.right-1,
(f.top+f.bottom)/2):document.elementFromPoint((f.right+f.left)/2,f.bottom-1))!=a?a.style.pointerEvents="none":b.set(1E3,d)}a.style.pointerEvents="auto";b.set(1E3,d)};Jb.prototype.clear=function(){var a=this.horiz.parentNode;a.removeChild(this.horiz);a.removeChild(this.vert)};var Mc=function(){};Mc.prototype.update=function(){return{bottom:0,right:0}};Mc.prototype.setScrollLeft=function(){};Mc.prototype.setScrollTop=function(){};Mc.prototype.clear=function(){};var Oe={"native":Jb,"null":Mc},hg=0,ed=
function(a,b,c){var d=a.display;this.viewport=b;this.visible=Md(d,a.doc,b);this.editorIsHidden=!d.wrapper.offsetWidth;this.wrapperHeight=d.wrapper.clientHeight;this.wrapperWidth=d.wrapper.clientWidth;this.oldDisplayWidth=Ab(a);this.force=c;this.dims=Dd(a);this.events=[]};ed.prototype.signal=function(a,b){Da(a,b)&&this.events.push(arguments)};ed.prototype.finish=function(){for(var a=0;a<this.events.length;a++)ha.apply(null,this.events[a])};var Ia=function(a,b){this.ranges=a;this.primIndex=b};Ia.prototype.primary=
function(){return this.ranges[this.primIndex]};Ia.prototype.equals=function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=a.ranges[b];if(!ub(c.anchor,d.anchor)||!ub(c.head,d.head))return!1}return!0};Ia.prototype.deepCopy=function(){for(var a=[],b=0;b<this.ranges.length;b++)a[b]=new W(jc(this.ranges[b].anchor),jc(this.ranges[b].head));return new Ia(a,this.primIndex)};Ia.prototype.somethingSelected=
function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1};Ia.prototype.contains=function(a,b){b||(b=a);for(var c=0;c<this.ranges.length;c++){var d=this.ranges[c];if(0<=M(b,d.from())&&0>=M(a,d.to()))return c}return-1};var W=function(a,b){this.anchor=a;this.head=b};W.prototype.from=function(){return va(this.anchor,this.head)};W.prototype.to=function(){return Ma(this.anchor,this.head)};W.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==
this.anchor.ch};var gb=function(a){this.lines=a;this.parent=null;for(var b=0,c=0;c<a.length;++c)a[c].parent=this,b+=a[c].height;this.height=b};gb.prototype.chunkSize=function(){return this.lines.length};gb.prototype.removeInner=function(a,b){for(var c=a,d=a+b;c<d;++c){var f=this.lines[c];this.height-=f.height;var k=f;k.parent=null;V(k);pa(f,"delete")}this.lines.splice(a,b)};gb.prototype.collapse=function(a){a.push.apply(a,this.lines)};gb.prototype.insertInner=function(a,b,c){this.height+=c;this.lines=
this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));for(a=0;a<b.length;++a)b[a].parent=this};gb.prototype.iterN=function(a,b,c){for(b=a+b;a<b;++a)if(c(this.lines[a]))return!0};var Xa=function(a){this.children=a;for(var b=0,c=0,d=0;d<a.length;++d){var f=a[d],b=b+f.chunkSize(),c=c+f.height;f.parent=this}this.size=b;this.height=c;this.parent=null};Xa.prototype.chunkSize=function(){return this.size};Xa.prototype.removeInner=function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var d=
this.children[c],f=d.chunkSize();if(a<f){var k=Math.min(b,f-a),l=d.height;d.removeInner(a,k);this.height-=l-d.height;f==k&&(this.children.splice(c--,1),d.parent=null);if(0==(b-=k))break;a=0}else a-=f}25>this.size-b&&(1<this.children.length||!(this.children[0]instanceof gb))&&(c=[],this.collapse(c),this.children=[new gb(c)],this.children[0].parent=this)};Xa.prototype.collapse=function(a){for(var b=0;b<this.children.length;++b)this.children[b].collapse(a)};Xa.prototype.insertInner=function(a,b,c){this.size+=
b.length;this.height+=c;for(var d=0;d<this.children.length;++d){var f=this.children[d],k=f.chunkSize();if(a<=k){f.insertInner(a,b,c);if(f.lines&&50<f.lines.length){for(b=a=f.lines.length%25+25;b<f.lines.length;)c=new gb(f.lines.slice(b,b+=25)),f.height-=c.height,this.children.splice(++d,0,c),c.parent=this;f.lines=f.lines.slice(0,a);this.maybeSpill()}break}a-=k}};Xa.prototype.maybeSpill=function(){if(!(10>=this.children.length)){var a=this;do{var b=a.children.splice(a.children.length-5,5),b=new Xa(b);
if(a.parent){a.size-=b.size;a.height-=b.height;var c=e(a.parent.children,a);a.parent.children.splice(c+1,0,b)}else c=new Xa(a.children),c.parent=a,a.children=[c,b],a=c;b.parent=a.parent}while(10<a.children.length);a.parent.maybeSpill()}};Xa.prototype.iterN=function(a,b,c){for(var d=0;d<this.children.length;++d){var f=this.children[d],k=f.chunkSize();if(a<k){k=Math.min(b,k-a);if(f.iterN(a,k,c))return!0;if(0==(b-=k))break;a=0}else a-=k}};var Ec=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&
(this[d]=c[d]);this.doc=a;this.node=b};Ec.prototype.clear=function(){var a=this.doc.cm,b=this.line.widgets,c=this.line,d=T(c);if(null!=d&&b){for(var f=0;f<b.length;++f)b[f]==this&&b.splice(f--,1);b.length||(c.widgets=null);var k=sc(this);Ga(c,Math.max(0,c.height-k));a&&(Ea(a,function(){var b=-k;wa(c)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&cd(a,null,b);pb(a,d,"widget")}),pa(a,"lineWidgetCleared",a,this,d))}};Ec.prototype.changed=function(){var a=this,b=this.height,c=this.doc.cm,d=this.line;
this.height=null;var f=sc(this)-b;f&&(Ga(d,d.height+f),c&&Ea(c,function(){c.curOp.forceUpdate=!0;wa(d)<(c.curOp&&c.curOp.scrollTop||c.doc.scrollTop)&&cd(c,null,f);pa(c,"lineWidgetChanged",c,a,T(d))}))};Ua(Ec);var pf=0,rb=function(a,b){this.lines=[];this.type=b;this.doc=a;this.id=++pf};rb.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;b&&Ub(a);if(Da(this,"clear")){var c=this.find();c&&pa(this,"clear",c.from,c.to)}for(var d=c=null,f=0;f<this.lines.length;++f){var k=
this.lines[f],l=ia(k.markedSpans,this);a&&!this.collapsed?pb(a,T(k),"text"):a&&(null!=l.to&&(d=T(k)),null!=l.from&&(c=T(k)));for(var e=k,n=void 0,g=k.markedSpans,p=l,h=0;h<g.length;++h)g[h]!=p&&(n||(n=[])).push(g[h]);e.markedSpans=n;null==l.from&&this.collapsed&&!ab(this.doc,k)&&a&&Ga(k,Cb(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(f=0;f<this.lines.length;++f)k=Ka(this.lines[f]),l=wb(k),l>a.display.maxLineLength&&(a.display.maxLine=k,a.display.maxLineLength=l,a.display.maxLineChanged=
!0);null!=c&&a&&this.collapsed&&za(a,c,d+1);this.lines.length=0;this.explicitlyCleared=!0;this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&ef(a.doc));a&&pa(a,"markerCleared",a,this,c,d);b&&Vb(a);this.parent&&this.parent.clear()}};rb.prototype.find=function(a,b){null==a&&"bookmark"==this.type&&(a=1);for(var c,d,f=0;f<this.lines.length;++f){var k=this.lines[f],l=ia(k.markedSpans,this);if(null!=l.from&&(c=A(b?k:T(k),l.from),-1==a))return c;if(null!=l.to&&(d=A(b?k:T(k),l.to),1==a))return d}return c&&
{from:c,to:d}};rb.prototype.changed=function(){var a=this,b=this.find(-1,!0),c=this,d=this.doc.cm;b&&d&&Ea(d,function(){var f=b.line,k=T(b.line);if(k=Cd(d,k))xe(k),d.curOp.selectionChanged=d.curOp.forceUpdate=!0;d.curOp.updateMaxLine=!0;ab(c.doc,f)||null==c.height||(k=c.height,c.height=null,(k=sc(c)-k)&&Ga(f,f.height+k));pa(d,"markerChanged",d,a)})};rb.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=e(b.maybeHiddenMarkers,this)||
(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)};rb.prototype.detachLine=function(a){this.lines.splice(e(this.lines,a),1);!this.lines.length&&this.doc.cm&&(a=this.doc.cm.curOp,(a.maybeHiddenMarkers||(a.maybeHiddenMarkers=[])).push(this))};Ua(rb);var Fc=function(a,b){this.markers=a;this.primary=b;for(var c=0;c<a.length;++c)a[c].parent=this};Fc.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();
pa(this,"clear")}};Fc.prototype.find=function(a,b){return this.primary.find(a,b)};Ua(Fc);var Rg=0,Aa=function(a,b,c,d,f){if(!(this instanceof Aa))return new Aa(a,b,c,d,f);null==c&&(c=0);Xa.call(this,[new gb([new Wb("",null)])]);this.first=c;this.scrollTop=this.scrollLeft=0;this.cantEdit=!1;this.cleanGeneration=1;this.frontier=c;c=A(c,0);this.sel=fb(c);this.history=new gd(null);this.id=++Rg;this.modeOption=b;this.lineSep=d;this.direction="rtl"==f?"rtl":"ltr";this.extend=!1;"string"==typeof a&&(a=this.splitLines(a));
Td(this,{from:c,to:c,text:a});qa(this,fb(c),Ta)};Aa.prototype=X(Xa.prototype,{constructor:Aa,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,d=0;d<b.length;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=hc(this,this.first,this.first+this.size);return!1===a?b:b.join(a||this.lineSeparator())},setValue:na(function(a){var b=A(this.first,
0),c=this.first+this.size-1;Zb(this,{from:b,to:A(c,C(this,c).text.length),text:this.splitLines(a),origin:"setValue",full:!0},!0);this.cm&&this.cm.scrollTo(0,0);qa(this,fb(b),Ta)}),replaceRange:function(a,b,c,d){b=K(this,b);c=c?K(this,c):b;$b(this,a,b,c,d)},getRange:function(a,b,c){a=ba(this,K(this,a),K(this,b));return!1===c?a:a.join(c||this.lineSeparator())},getLine:function(a){return(a=this.getLineHandle(a))&&a.text},getLineHandle:function(a){if(tb(this,a))return C(this,a)},getLineNumber:function(a){return T(a)},
getLineHandleVisualStart:function(a){"number"==typeof a&&(a=C(this,a));return Ka(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return K(this,a)},getCursor:function(a){var b=this.sel.primary();return null==a||"head"==a?b.head:"anchor"==a?b.anchor:"end"==a||"to"==a||!1===a?b.to():b.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},
setCursor:na(function(a,b,c){a=K(this,"number"==typeof a?A(a,b||0):a);qa(this,fb(a,null),c)}),setSelection:na(function(a,b,c){var d=K(this,a);a=K(this,b||a);qa(this,fb(d,a),c)}),extendSelection:na(function(a,b,c){id(this,K(this,a),b&&K(this,b),c)}),extendSelections:na(function(a,b){af(this,vb(this,a),b)}),extendSelectionsBy:na(function(a,b){var c=y(this.sel.ranges,a);af(this,vb(this,c),b)}),setSelections:na(function(a,b,c){if(a.length){for(var d=[],f=0;f<a.length;f++)d[f]=new W(K(this,a[f].anchor),
K(this,a[f].head));null==b&&(b=Math.min(a.length-1,this.sel.primIndex));qa(this,Sa(d,b),c)}}),addSelection:na(function(a,b,c){var d=this.sel.ranges.slice(0);d.push(new W(K(this,a),K(this,b||a)));qa(this,Sa(d,d.length-1),c)}),getSelection:function(a){for(var b=this.sel.ranges,c,d=0;d<b.length;d++){var f=ba(this,b[d].from(),b[d].to());c=c?c.concat(f):f}return!1===a?c:c.join(a||this.lineSeparator())},getSelections:function(a){for(var b=[],c=this.sel.ranges,d=0;d<c.length;d++){var f=ba(this,c[d].from(),
c[d].to());!1!==a&&(f=f.join(a||this.lineSeparator()));b[d]=f}return b},replaceSelection:function(a,b,c){for(var d=[],f=0;f<this.sel.ranges.length;f++)d[f]=a;this.replaceSelections(d,b,c||"+input")},replaceSelections:na(function(a,b,c){for(var d=[],f=this.sel,k=0;k<f.ranges.length;k++){var l=f.ranges[k];d[k]={from:l.from(),to:l.to(),text:this.splitLines(a[k]),origin:c}}if(a=b&&"end"!=b){a=[];f=c=A(this.first,0);for(k=0;k<d.length;k++){var e=d[k],l=Te(e.from,c,f),n=Te(qb(e),c,f);c=e.to;f=n;"around"==
b?(e=this.sel.ranges[k],e=0>M(e.head,e.anchor),a[k]=new W(e?n:l,e?l:n)):a[k]=new W(l,l)}a=new Ia(a,this.sel.primIndex)}b=a;for(a=d.length-1;0<=a;a--)Zb(this,d[a]);b?bf(this,b):this.cm&&Tb(this.cm)}),undo:na(function(){kd(this,"undo")}),redo:na(function(){kd(this,"redo")}),undoSelection:na(function(){kd(this,"undo",!0)}),redoSelection:na(function(){kd(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,
b=0,c=0,d=0;d<a.done.length;d++)a.done[d].ranges||++b;for(d=0;d<a.undone.length;d++)a.undone[d].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=new gd(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null);return this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:Xb(this.history.done),
undone:Xb(this.history.undone)}},setHistory:function(a){var b=this.history=new gd(this.history.maxGeneration);b.done=Xb(a.done.slice(0),null,!0);b.undone=Xb(a.undone.slice(0),null,!0)},setGutterMarker:na(function(a,b,c){return Dc(this,a,"gutter",function(a){var d=a.gutterMarkers||(a.gutterMarkers={});d[b]=c;!c&&Fa(d)&&(a.gutterMarkers=null);return!0})}),clearGutter:na(function(a){var b=this;this.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&Dc(b,c,"gutter",function(){c.gutterMarkers[a]=null;
Fa(c.gutterMarkers)&&(c.gutterMarkers=null);return!0})})}),lineInfo:function(a){var b;if("number"==typeof a){if(!tb(this,a))return null;b=a;a=C(this,a);if(!a)return null}else if(b=T(a),null==b)return null;return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},addLineClass:na(function(a,b,c){return Dc(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==
b?"gutterClass":"wrapClass";if(a[d]){if(m(c).test(a[d]))return!1;a[d]+=" "+c}else a[d]=c;return!0})}),removeLineClass:na(function(a,b,c){return Dc(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass",k=a[d];if(k)if(null==c)a[d]=null;else{var l=k.match(m(c));if(!l)return!1;var e=l.index+l[0].length;a[d]=k.slice(0,l.index)+(l.index&&e!=k.length?" ":"")+k.slice(e)||null}else return!1;return!0})}),addLineWidget:na(function(a,
b,c){return pg(this,a,b,c)}),removeLineWidget:function(a){a.clear()},markText:function(a,b,c){return ac(this,K(this,a),K(this,b),c,c&&c.type||"range")},setBookmark:function(a,b){var c={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared,handleMouseEvents:b&&b.handleMouseEvents};a=K(this,a);return ac(this,a,a,c,"bookmark")},findMarksAt:function(a){a=K(this,a);var b=[],c=C(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var f=c[d];
(null==f.from||f.from<=a.ch)&&(null==f.to||f.to>=a.ch)&&b.push(f.marker.parent||f.marker)}return b},findMarks:function(a,b,c){a=K(this,a);b=K(this,b);var d=[],f=a.line;this.iter(a.line,b.line+1,function(k){if(k=k.markedSpans)for(var l=0;l<k.length;l++){var e=k[l];null!=e.to&&f==a.line&&a.ch>=e.to||null==e.from&&f!=a.line||null!=e.from&&f==b.line&&e.from>=b.ch||c&&!c(e.marker)||d.push(e.marker.parent||e.marker)}++f});return d},getAllMarks:function(){var a=[];this.iter(function(b){if(b=b.markedSpans)for(var c=
0;c<b.length;++c)null!=b[c].from&&a.push(b[c].marker)});return a},posFromIndex:function(a){var b,c=this.first,d=this.lineSeparator().length;this.iter(function(f){f=f.text.length+d;if(f>a)return b=a,!0;a-=f;++c});return K(this,A(c,b))},indexFromPos:function(a){a=K(this,a);var b=a.ch;if(a.line<this.first||0>a.ch)return 0;var c=this.lineSeparator().length;this.iter(this.first,a.line,function(a){b+=a.text.length+c});return b},copy:function(a){var b=new Aa(hc(this,this.first,this.first+this.size),this.modeOption,
this.first,this.lineSep,this.direction);b.scrollTop=this.scrollTop;b.scrollLeft=this.scrollLeft;b.sel=this.sel;b.extend=!1;a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory()));return b},linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from);null!=a.to&&a.to<c&&(c=a.to);b=new Aa(hc(this,b,c),a.mode||this.modeOption,b,this.lineSep,this.direction);a.sharedHist&&(b.history=this.history);(this.linked||(this.linked=[])).push({doc:b,
sharedHist:a.sharedHist});b.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}];a=qf(this);for(c=0;c<a.length;c++){var d=a[c],f=d.find(),k=b.clipPos(f.from),f=b.clipPos(f.to);M(k,f)&&(k=ac(b,k,f,d.primary,d.primary.type),d.markers.push(k),k.parent=d)}return b},unlinkDoc:function(a){a instanceof da&&(a=a.doc);if(this.linked)for(var b=0;b<this.linked.length;++b)if(this.linked[b].doc==a){this.linked.splice(b,1);a.unlinkDoc(this);rg(qf(this));break}if(a.history==this.history){var c=[a.id];Gb(a,function(a){return c.push(a.id)},
!0);a.history=new gd(null);a.history.done=Xb(this.history.done,c);a.history.undone=Xb(this.history.undone,c)}},iterLinkedDocs:function(a){Gb(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(a){return this.lineSep?a.split(this.lineSep):de(a)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:na(function(a){"rtl"!=a&&(a="ltr");a!=this.direction&&(this.direction=a,this.iter(function(a){return a.order=null}),this.cm&&lg(this.cm))})});
Aa.prototype.eachLine=Aa.prototype.iter;for(var sf=0,Hf=!1,sb={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",
63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Nc=0;10>Nc;Nc++)sb[Nc+48]=sb[Nc+96]=String(Nc);for(var td=65;90>=td;td++)sb[td]=String.fromCharCode(td);for(var Oc=1;12>=Oc;Oc++)sb[Oc+111]=sb[Oc+63235]="F"+Oc;var Gc={basic:{Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore",
"Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},pcDefault:{"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter",
"Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},emacsy:{"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp",
"Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},macDefault:{"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter",
"Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]}};Gc["default"]=Pa?Gc.macDefault:Gc.pcDefault;var nd={selectAll:gf,singleSelection:function(a){return a.setSelection(a.getCursor("anchor"),
a.getCursor("head"),Ta)},killLine:function(a){return cc(a,function(b){if(b.empty()){var c=C(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?{from:b.head,to:A(b.head.line+1,0)}:{from:b.head,to:A(b.head.line,c)}}return{from:b.from(),to:b.to()}})},deleteLine:function(a){return cc(a,function(b){return{from:A(b.from().line,0),to:K(a.doc,A(b.to().line+1,0))}})},delLineLeft:function(a){return cc(a,function(a){return{from:A(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){return cc(a,
function(b){var c=a.charCoords(b.head,"div").top+5;return{from:a.coordsChar({left:0,top:c},"div"),to:b.from()}})},delWrappedLineRight:function(a){return cc(a,function(b){var c=a.charCoords(b.head,"div").top+5,c=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div");return{from:b.from(),to:c}})},undo:function(a){return a.undo()},redo:function(a){return a.redo()},undoSelection:function(a){return a.undoSelection()},redoSelection:function(a){return a.redoSelection()},goDocStart:function(a){return a.extendSelection(A(a.firstLine(),
0))},goDocEnd:function(a){return a.extendSelection(A(a.lastLine()))},goLineStart:function(a){return a.extendSelectionsBy(function(b){return xf(a,b.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(a){return a.extendSelectionsBy(function(b){return yf(a,b.head)},{origin:"+move",bias:1})},goLineEnd:function(a){return a.extendSelectionsBy(function(b){b=b.head.line;var c=C(a.doc,b),d;d=c;for(var f;f=$a(d,!1);)d=f.find(1,!0).line;d!=c&&(b=T(d));return xb(!0,a,c,b,-1)},{origin:"+move",bias:-1})},
goLineRight:function(a){return a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:b},"div")},Lc)},goLineLeft:function(a){return a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:0,top:b},"div")},Lc)},goLineLeftSmart:function(a){return a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5,c=a.coordsChar({left:0,top:c},"div");return c.ch<a.getLine(c.line).search(/\S/)?
yf(a,b.head):c},Lc)},goLineUp:function(a){return a.moveV(-1,"line")},goLineDown:function(a){return a.moveV(1,"line")},goPageUp:function(a){return a.moveV(-1,"page")},goPageDown:function(a){return a.moveV(1,"page")},goCharLeft:function(a){return a.moveH(-1,"char")},goCharRight:function(a){return a.moveH(1,"char")},goColumnLeft:function(a){return a.moveH(-1,"column")},goColumnRight:function(a){return a.moveH(1,"column")},goWordLeft:function(a){return a.moveH(-1,"word")},goGroupRight:function(a){return a.moveH(1,
"group")},goGroupLeft:function(a){return a.moveH(-1,"group")},goWordRight:function(a){return a.moveH(1,"word")},delCharBefore:function(a){return a.deleteH(-1,"char")},delCharAfter:function(a){return a.deleteH(1,"char")},delWordBefore:function(a){return a.deleteH(-1,"word")},delWordAfter:function(a){return a.deleteH(1,"word")},delGroupBefore:function(a){return a.deleteH(-1,"group")},delGroupAfter:function(a){return a.deleteH(1,"group")},indentAuto:function(a){return a.indentSelection("smart")},indentMore:function(a){return a.indentSelection("add")},
indentLess:function(a){return a.indentSelection("subtract")},insertTab:function(a){return a.replaceSelection("\t")},insertSoftTab:function(a){for(var b=[],c=a.listSelections(),d=a.options.tabSize,f=0;f<c.length;f++){var k=c[f].from(),k=q(a.getLine(k.line),k.ch,d);b.push(g(d-k%d))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){return Ea(a,function(){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++)if(b[d].empty()){var f=
b[d].head,k=C(a.doc,f.line).text;if(k)if(f.ch==k.length&&(f=new A(f.line,f.ch-1)),0<f.ch)f=new A(f.line,f.ch+1),a.replaceRange(k.charAt(f.ch-1)+k.charAt(f.ch-2),A(f.line,f.ch-2),f,"+transpose");else if(f.line>a.doc.first){var l=C(a.doc,f.line-1).text;l&&(f=new A(f.line,1),a.replaceRange(k.charAt(0)+a.doc.lineSeparator()+l.charAt(l.length-1),A(f.line-1,l.length-1),f,"+transpose"))}c.push(new W(f,f))}a.setSelections(c)})},newlineAndIndent:function(a){return Ea(a,function(){for(var b=a.listSelections(),
c=b.length-1;0<=c;c--)a.replaceRange(a.doc.lineSeparator(),b[c].anchor,b[c].head,"+input");b=a.listSelections();for(c=0;c<b.length;c++)a.indentLine(b[c].from().line,null,!0);Tb(a)})},openLine:function(a){return a.replaceSelection("\n","start")},toggleOverwrite:function(a){return a.toggleOverwrite()}},yg=new Hb,Yd=null,qd,pd,dc={toString:function(){return"CodeMirror.Init"}},Gf={},rd={};da.defaults=Gf;da.optionHandlers=rd;var be=[];da.defineInitHook=function(a){return be.push(a)};var Ba=null,Y=function(a){this.cm=
a;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new Hb;this.composing=null;this.gracePeriod=!1;this.readDOMTimeout=null};Y.prototype.init=function(a){function b(a){if(!ea(f,a)){if(f.somethingSelected())Ba={lineWise:!1,text:f.getSelections()},"cut"==a.type&&f.replaceSelection("",null,"cut");else if(f.options.lineWiseCopyCut){var b=Lf(f);Ba={lineWise:!0,text:b.text};"cut"==a.type&&f.operation(function(){f.setSelections(b.ranges,0,Ta);f.replaceSelection("",
null,"cut")})}else return;if(a.clipboardData){a.clipboardData.clearData();var c=Ba.text.join("\n");a.clipboardData.setData("Text",c);if(a.clipboardData.getData("Text")==c){a.preventDefault();return}}var e=Nf();a=e.firstChild;f.display.lineSpace.insertBefore(e,f.display.lineSpace.firstChild);a.value=Ba.text.join("\n");var l=document.activeElement;fc(a);setTimeout(function(){f.display.lineSpace.removeChild(e);l.focus();l==k&&d.showPrimarySelection()},50)}}var c=this,d=this,f=d.cm,k=d.div=a.lineDiv;
Mf(k,f.options.spellcheck);L(k,"paste",function(a){ea(f,a)||Kf(a,f)||11>=aa&&setTimeout(ma(f,function(){return c.updateFromDOM()}),20)});L(k,"compositionstart",function(a){c.composing={data:a.data,done:!1}});L(k,"compositionupdate",function(a){c.composing||(c.composing={data:a.data,done:!1})});L(k,"compositionend",function(a){c.composing&&(a.data!=c.composing.data&&c.readFromDOMSoon(),c.composing.done=!0)});L(k,"touchstart",function(){return d.forceCompositionEnd()});L(k,"input",function(){c.composing||
c.readFromDOMSoon()});L(k,"copy",b);L(k,"cut",b)};Y.prototype.prepareSelection=function(){var a=Ee(this.cm,!1);a.focus=this.cm.state.focused;return a};Y.prototype.showSelection=function(a,b){a&&this.cm.display.view.length&&((a.focus||b)&&this.showPrimarySelection(),this.showMultipleSelections(a))};Y.prototype.showPrimarySelection=function(){var a=window.getSelection(),b=this.cm,c=b.doc.sel.primary(),d=c.from(),c=c.to();if(b.display.viewTo==b.display.viewFrom||d.line>=b.display.viewTo||c.line<b.display.viewFrom)a.removeAllRanges();
else{var f=sd(b,a.anchorNode,a.anchorOffset),k=sd(b,a.focusNode,a.focusOffset);if(!f||f.bad||!k||k.bad||0!=M(va(f,k),d)||0!=M(Ma(f,k),c))if(f=b.display.view,d=d.line>=b.display.viewFrom&&Pf(b,d)||{node:f[0].measure.map[2],offset:0},c=c.line<b.display.viewTo&&Pf(b,c),c||(c=f[f.length-1].measure,c=c.maps?c.maps[c.maps.length-1]:c.map,c={node:c[c.length-1],offset:c[c.length-2]-c[c.length-3]}),d&&c){var f=a.rangeCount&&a.getRangeAt(0),e;try{e=Pb(d.node,d.offset,c.offset,c.node)}catch(u){}e&&(!hb&&b.state.focused?
(a.collapse(d.node,d.offset),e.collapsed||(a.removeAllRanges(),a.addRange(e))):(a.removeAllRanges(),a.addRange(e)),f&&null==a.anchorNode?a.addRange(f):hb&&this.startGracePeriod());this.rememberSelection()}else a.removeAllRanges()}};Y.prototype.startGracePeriod=function(){var a=this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){a.gracePeriod=!1;a.selectionChanged()&&a.cm.operation(function(){return a.cm.curOp.selectionChanged=!0})},20)};Y.prototype.showMultipleSelections=function(a){E(this.cm.display.cursorDiv,
a.cursors);E(this.cm.display.selectionDiv,a.selection)};Y.prototype.rememberSelection=function(){var a=window.getSelection();this.lastAnchorNode=a.anchorNode;this.lastAnchorOffset=a.anchorOffset;this.lastFocusNode=a.focusNode;this.lastFocusOffset=a.focusOffset};Y.prototype.selectionInEditor=function(){var a=window.getSelection();if(!a.rangeCount)return!1;a=a.getRangeAt(0).commonAncestorContainer;return B(this.div,a)};Y.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||
this.showSelection(this.prepareSelection(),!0),this.div.focus())};Y.prototype.blur=function(){this.div.blur()};Y.prototype.getField=function(){return this.div};Y.prototype.supportsTouch=function(){return!0};Y.prototype.receivedFocus=function(){function a(){b.cm.state.focused&&(b.pollSelection(),b.polling.set(b.cm.options.pollInterval,a))}var b=this;this.selectionInEditor()?this.pollSelection():Ea(this.cm,function(){return b.cm.curOp.selectionChanged=!0});this.polling.set(this.cm.options.pollInterval,
a)};Y.prototype.selectionChanged=function(){var a=window.getSelection();return a.anchorNode!=this.lastAnchorNode||a.anchorOffset!=this.lastAnchorOffset||a.focusNode!=this.lastFocusNode||a.focusOffset!=this.lastFocusOffset};Y.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var a=window.getSelection(),b=this.cm;if(Yc&&Xc&&this.cm.options.gutters.length&&Kg(a.anchorNode))this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),
this.blur(),this.focus();else if(!this.composing){this.rememberSelection();var c=sd(b,a.anchorNode,a.anchorOffset),d=sd(b,a.focusNode,a.focusOffset);c&&d&&Ea(b,function(){qa(b.doc,fb(c,d),Ta);if(c.bad||d.bad)b.curOp.selectionChanged=!0})}}};Y.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var a=this.cm,b=a.display,c=a.doc.sel.primary(),d=c.from(),f=c.to();0==d.ch&&d.line>a.firstLine()&&(d=A(d.line-1,C(a.doc,d.line-1).length));
f.ch==C(a.doc,f.line).text.length&&f.line<a.lastLine()&&(f=A(f.line+1,0));if(d.line<b.viewFrom||f.line>b.viewTo-1)return!1;var k;d.line==b.viewFrom||0==(k=Bb(a,d.line))?(c=T(b.view[0].line),k=b.view[0].node):(c=T(b.view[k].line),k=b.view[k-1].node.nextSibling);var e=Bb(a,f.line);e==b.view.length-1?(f=b.viewTo-1,b=b.lineDiv.lastChild):(f=T(b.view[e+1].line)-1,b=b.view[e+1].node.previousSibling);if(!k)return!1;b=a.doc.splitLines(Lg(a,k,b,c,f));for(k=ba(a.doc,A(c,0),A(f,C(a.doc,f).text.length));1<b.length&&
1<k.length;)if(p(b)==p(k))b.pop(),k.pop(),f--;else if(b[0]==k[0])b.shift(),k.shift(),c++;else break;for(var n=0,e=0,g=b[0],h=k[0],q=Math.min(g.length,h.length);n<q&&g.charCodeAt(n)==h.charCodeAt(n);)++n;g=p(b);h=p(k);for(q=Math.min(g.length-(1==b.length?n:0),h.length-(1==k.length?n:0));e<q&&g.charCodeAt(g.length-e-1)==h.charCodeAt(h.length-e-1);)++e;if(1==b.length&&1==k.length&&c==d.line)for(;n&&n>d.ch&&g.charCodeAt(g.length-e-1)==h.charCodeAt(h.length-e-1);)n--,e++;b[b.length-1]=g.slice(0,g.length-
e).replace(/^\u200b+/,"");b[0]=b[0].slice(n).replace(/\u200b+$/,"");d=A(c,n);c=A(f,k.length?p(k).length-e:0);if(1<b.length||b[0]||M(d,c))return $b(a.doc,b,d,c,"+input"),!0};Y.prototype.ensurePolled=function(){this.forceCompositionEnd()};Y.prototype.reset=function(){this.forceCompositionEnd()};Y.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())};Y.prototype.readFromDOMSoon=function(){var a=
this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){a.readDOMTimeout=null;if(a.composing)if(a.composing.done)a.composing=null;else return;a.updateFromDOM()},80))};Y.prototype.updateFromDOM=function(){var a=this;!this.cm.isReadOnly()&&this.pollContent()||Ea(this.cm,function(){return za(a.cm)})};Y.prototype.setUneditable=function(a){a.contentEditable="false"};Y.prototype.onKeyPress=function(a){0!=a.charCode&&(a.preventDefault(),this.cm.isReadOnly()||ma(this.cm,ce)(this.cm,String.fromCharCode(null==
a.charCode?a.keyCode:a.charCode),0))};Y.prototype.readOnlyChanged=function(a){this.div.contentEditable=String("nocursor"!=a)};Y.prototype.onContextMenu=function(){};Y.prototype.resetPosition=function(){};Y.prototype.needsContentAttribute=!0;var ja=function(a){this.cm=a;this.prevInput="";this.pollingFast=!1;this.polling=new Hb;this.hasSelection=this.inaccurateSelection=!1;this.composing=null};ja.prototype.init=function(a){function b(a){if(!ea(f,a)){if(f.somethingSelected())Ba={lineWise:!1,text:f.getSelections()},
d.inaccurateSelection&&(d.prevInput="",d.inaccurateSelection=!1,e.value=Ba.text.join("\n"),fc(e));else if(f.options.lineWiseCopyCut){var b=Lf(f);Ba={lineWise:!0,text:b.text};"cut"==a.type?f.setSelections(b.ranges,null,Ta):(d.prevInput="",e.value=b.text.join("\n"),fc(e))}else return;"cut"==a.type&&(f.state.cutIncoming=!0)}}var c=this,d=this,f=this.cm,k=this.wrapper=Nf(),e=this.textarea=k.firstChild;a.wrapper.insertBefore(k,a.wrapper.firstChild);Jc&&(e.style.width="0px");L(e,"input",function(){S&&9<=
aa&&c.hasSelection&&(c.hasSelection=null);d.poll()});L(e,"paste",function(a){ea(f,a)||Kf(a,f)||(f.state.pasteIncoming=!0,d.fastPoll())});L(e,"cut",b);L(e,"copy",b);L(a.scroller,"paste",function(b){eb(a,b)||ea(f,b)||(f.state.pasteIncoming=!0,d.focus())});L(a.lineSpace,"selectstart",function(b){eb(a,b)||ka(b)});L(e,"compositionstart",function(){var a=f.getCursor("from");d.composing&&d.composing.range.clear();d.composing={start:a,range:f.markText(a,f.getCursor("to"),{className:"CodeMirror-composing"})}});
L(e,"compositionend",function(){d.composing&&(d.poll(),d.composing.range.clear(),d.composing=null)})};ja.prototype.prepareSelection=function(){var a=this.cm,b=a.display,c=a.doc,d=Ee(a);if(a.options.moveInputWithCursor){var a=Qa(a,c.sel.primary().head,"div"),c=b.wrapper.getBoundingClientRect(),f=b.lineDiv.getBoundingClientRect();d.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,a.top+f.top-c.top));d.teLeft=Math.max(0,Math.min(b.wrapper.clientWidth-10,a.left+f.left-c.left))}return d};ja.prototype.showSelection=
function(a){var b=this.cm.display;E(b.cursorDiv,a.cursors);E(b.selectionDiv,a.selection);null!=a.teTop&&(this.wrapper.style.top=a.teTop+"px",this.wrapper.style.left=a.teLeft+"px")};ja.prototype.reset=function(a){if(!this.contextMenuPending){var b,c,d=this.cm,f=d.doc;d.somethingSelected()?(this.prevInput="",b=f.sel.primary(),c=(b=Bf&&(100<b.to().line-b.from().line||1E3<(c=d.getSelection()).length))?"-":c||d.getSelection(),this.textarea.value=c,d.state.focused&&fc(this.textarea),S&&9<=aa&&(this.hasSelection=
c)):a||(this.prevInput=this.textarea.value="",S&&9<=aa&&(this.hasSelection=null));this.inaccurateSelection=b}};ja.prototype.getField=function(){return this.textarea};ja.prototype.supportsTouch=function(){return!1};ja.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!gc||z()!=this.textarea))try{this.textarea.focus()}catch(a){}};ja.prototype.blur=function(){this.textarea.blur()};ja.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0};ja.prototype.receivedFocus=
function(){this.slowPoll()};ja.prototype.slowPoll=function(){var a=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){a.poll();a.cm.state.focused&&a.slowPoll()})};ja.prototype.fastPoll=function(){function a(){c.poll()||b?(c.pollingFast=!1,c.slowPoll()):(b=!0,c.polling.set(60,a))}var b=!1,c=this;c.pollingFast=!0;c.polling.set(20,a)};ja.prototype.poll=function(){var a=this,b=this.cm,c=this.textarea,d=this.prevInput;if(this.contextMenuPending||!b.state.focused||Qg(c)&&!d&&
!this.composing||b.isReadOnly()||b.options.disableInput||b.state.keySeq)return!1;var f=c.value;if(f==d&&!b.somethingSelected())return!1;if(S&&9<=aa&&this.hasSelection===f||Pa&&/[\uf700-\uf7ff]/.test(f))return b.display.input.reset(),!1;if(b.doc.sel==b.display.selForContextMenu){var k=f.charCodeAt(0);8203!=k||d||(d="\u200b");if(8666==k)return this.reset(),this.cm.execCommand("undo")}for(var e=0,k=Math.min(d.length,f.length);e<k&&d.charCodeAt(e)==f.charCodeAt(e);)++e;Ea(b,function(){ce(b,f.slice(e),
d.length-e,null,a.composing?"*compose":null);1E3<f.length||-1<f.indexOf("\n")?c.value=a.prevInput="":a.prevInput=f;a.composing&&(a.composing.range.clear(),a.composing.range=b.markText(a.composing.start,b.getCursor("to"),{className:"CodeMirror-composing"}))});return!0};ja.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)};ja.prototype.onKeyPress=function(){S&&9<=aa&&(this.hasSelection=null);this.fastPoll()};ja.prototype.onContextMenu=function(a){function b(){if(null!=
e.selectionStart){var a=f.somethingSelected(),b="\u200b"+(a?e.value:"");e.value="\u21da";e.value=b;d.prevInput=a?"":"\u200b";e.selectionStart=1;e.selectionEnd=b.length;k.selForContextMenu=f.doc.sel}}function c(){d.contextMenuPending=!1;d.wrapper.style.cssText=p;e.style.cssText=h;S&&9>aa&&k.scrollbars.setScrollTop(k.scroller.scrollTop=g);if(null!=e.selectionStart){(!S||S&&9>aa)&&b();var a=0,c=function(){k.selForContextMenu==f.doc.sel&&0==e.selectionStart&&0<e.selectionEnd&&"\u200b"==d.prevInput?ma(f,
gf)(f):10>a++?k.detectingSelectAll=setTimeout(c,500):(k.selForContextMenu=null,k.input.reset())};k.detectingSelectAll=setTimeout(c,200)}}var d=this,f=d.cm,k=f.display,e=d.textarea,n=Eb(f,a),g=k.scroller.scrollTop;if(n&&!Ra){f.options.resetSelectionOnContextMenu&&-1==f.doc.sel.contains(n)&&ma(f,qa)(f.doc,fb(n),Ta);var h=e.style.cssText,p=d.wrapper.style.cssText;d.wrapper.style.cssText="position: absolute";n=d.wrapper.getBoundingClientRect();e.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+
(a.clientY-n.top-5)+"px; left: "+(a.clientX-n.left-5)+"px;\n      z-index: 1000; background: "+(S?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";var q;oa&&(q=window.scrollY);k.input.focus();oa&&window.scrollTo(null,q);k.input.reset();f.somethingSelected()||(e.value=d.prevInput=" ");d.contextMenuPending=!0;k.selForContextMenu=f.doc.sel;clearTimeout(k.detectingSelectAll);S&&9<=aa&&b();if($d){Va(a);
var m=function(){ta(window,"mouseup",m);setTimeout(c,20)};L(window,"mouseup",m)}else setTimeout(c,50)}};ja.prototype.readOnlyChanged=function(a){a||this.reset()};ja.prototype.setUneditable=function(){};ja.prototype.needsContentAttribute=!1;(function(a){function b(b,f,k,e){a.defaults[b]=f;k&&(c[b]=e?function(a,b,d){d!=dc&&k(a,b,d)}:k)}var c=a.optionHandlers;a.defineOption=b;a.Init=dc;b("value","",function(a,b){return a.setValue(b)},!0);b("mode",null,function(a,b){a.doc.modeOption=b;Sd(a)},!0);b("indentUnit",
2,Sd,!0);b("indentWithTabs",!1);b("smartIndent",!0);b("tabSize",4,function(a){Ac(a);uc(a);za(a)},!0);b("lineSeparator",null,function(a,b){if(a.doc.lineSep=b){var d=[],c=a.doc.first;a.doc.iter(function(a){for(var f=0;;){var k=a.text.indexOf(b,f);if(-1==k)break;f=k+b.length;d.push(A(c,k))}c++});for(var f=d.length-1;0<=f;f--)$b(a.doc,b,d[f],A(d[f].line,d[f].ch+b.length))}});b("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(a,b,c){a.state.specialChars=
new RegExp(b.source+(b.test("\t")?"":"|\t"),"g");c!=dc&&a.refresh()});b("specialCharPlaceholder",ag,function(a){return a.refresh()},!0);b("electricChars",!0);b("inputStyle",gc?"contenteditable":"textarea",function(){throw Error("inputStyle can not (yet) be changed in a running editor");},!0);b("spellcheck",!1,function(a,b){return a.getInputField().spellcheck=b},!0);b("rtlMoveVisually",!Pg);b("wholeLineUpdateBefore",!0);b("theme","default",function(a){Ff(a);Hc(a)},!0);b("keyMap","default",function(a,
b,c){b=ld(b);(c=c!=dc&&ld(c))&&c.detach&&c.detach(a,b);b.attach&&b.attach(a,c||null)});b("extraKeys",null);b("lineWrapping",!1,Ig,!0);b("gutters",[],function(a){Qd(a.options);Hc(a)},!0);b("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?Gd(a.display)+"px":"0";a.refresh()},!0);b("coverGutterNextToScrollbar",!1,function(a){return Sb(a)},!0);b("scrollbarStyle","native",function(a){Ne(a);Sb(a);a.display.scrollbars.setScrollTop(a.doc.scrollTop);a.display.scrollbars.setScrollLeft(a.doc.scrollLeft)},
!0);b("lineNumbers",!1,function(a){Qd(a.options);Hc(a)},!0);b("firstLineNumber",1,Hc,!0);b("lineNumberFormatter",function(a){return a},Hc,!0);b("showCursorWhenSelecting",!1,vc,!0);b("resetSelectionOnContextMenu",!0);b("lineWiseCopyCut",!0);b("readOnly",!1,function(a,b){"nocursor"==b?(wc(a),a.display.input.blur(),a.display.disabled=!0):a.display.disabled=!1;a.display.input.readOnlyChanged(b)});b("disableInput",!1,function(a,b){b||a.display.input.reset()},!0);b("dragDrop",!0,Hg);b("allowDropFileTypes",
null);b("cursorBlinkRate",530);b("cursorScrollMargin",0);b("cursorHeight",1,vc,!0);b("singleCursorHeightPerLine",!0,vc,!0);b("workTime",100);b("workDelay",100);b("flattenSpans",!0,Ac,!0);b("addModeClass",!1,Ac,!0);b("pollInterval",100);b("undoDepth",200,function(a,b){return a.doc.history.undoDepth=b});b("historyEventDelay",1250);b("viewportMargin",10,function(a){return a.refresh()},!0);b("maxHighlightLength",1E4,Ac,!0);b("moveInputWithCursor",!0,function(a,b){b||a.display.input.resetPosition()});
b("tabindex",null,function(a,b){return a.display.input.getField().tabIndex=b||""});b("autofocus",null);b("direction","ltr",function(a,b){return a.doc.setDirection(b)},!0)})(da);(function(a){var b=a.optionHandlers,c=a.helpers={};a.prototype={constructor:a,focus:function(){window.focus();this.display.input.focus()},setOption:function(a,c){var d=this.options,f=d[a];if(d[a]!=c||"mode"==a)d[a]=c,b.hasOwnProperty(a)&&ma(this,b[a])(this,c,f),ha(this,"optionChange",this,a)},getOption:function(a){return this.options[a]},
getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](ld(a))},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==a||b[c].name==a)return b.splice(c,1),!0},addOverlay:ya(function(b,c){var d=b.token?b:a.getMode(this.options,b);if(d.startState)throw Error("Overlays may not be stateful.");D(this.state.overlays,{mode:d,modeSpec:b,opaque:c&&c.opaque,priority:c&&c.priority||0},function(a){return a.priority});this.state.modeGen++;za(this)}),
removeOverlay:ya(function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var d=b[c].modeSpec;if(d==a||"string"==typeof a&&d.name==a){b.splice(c,1);this.state.modeGen++;za(this);break}}}),indentLine:ya(function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract");tb(this.doc,a)&&Ic(this,a,b,c)}),indentSelection:ya(function(a){for(var b=this.doc.sel.ranges,c=-1,d=0;d<b.length;d++){var e=b[d];if(e.empty())e.head.line>c&&(Ic(this,
e.head.line,a,!0),c=e.head.line,d==this.doc.sel.primIndex&&Tb(this));else{for(var n=e.from(),e=e.to(),g=Math.max(c,n.line),c=Math.min(this.lastLine(),e.line-(e.ch?0:1))+1,e=g;e<c;++e)Ic(this,e,a);e=this.doc.sel.ranges;0==n.ch&&b.length==e.length&&0<e[d].from().ch&&Vd(this.doc,d,new W(n,e[d].to()),Ta)}}}),getTokenAt:function(a,b){return ie(this,a,b)},getLineTokens:function(a,b){return ie(this,A(a),b,!0)},getTokenTypeAt:function(a){a=K(this.doc,a);var b=Vc(this,C(this.doc,a.line)),c=0,d=(b.length-1)/
2;a=a.ch;if(0==a)b=b[2];else for(;;){var e=c+d>>1;if((e?b[2*e-1]:0)>=a)d=e;else if(b[2*e+1]<a)c=e+1;else{b=b[2*e+2];break}}c=b?b.indexOf("overlay "):-1;return 0>c?b:0==c?null:b.slice(0,c-1)},getModeAt:function(b){var c=this.doc.mode;return c.innerMode?a.innerMode(c,this.getTokenAt(b).state).mode:c},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var d=[];if(!c.hasOwnProperty(b))return d;var f=c[b],n=this.getModeAt(a);if("string"==typeof n[b])f[n[b]]&&d.push(f[n[b]]);
else if(n[b])for(var g=0;g<n[b].length;g++){var h=f[n[b][g]];h&&d.push(h)}else n.helperType&&f[n.helperType]?d.push(f[n.helperType]):f[n.name]&&d.push(f[n.name]);for(g=0;g<f._global.length;g++)h=f._global[g],h.pred(n,this)&&-1==e(d,h.val)&&d.push(h.val);return d},getStateAfter:function(a,b){var c=this.doc;a=Math.max(c.first,Math.min(null==a?c.first+c.size-1:a,c.first+c.size-1));return n(this,a+1,b)},cursorCoords:function(a,b){var c;c=this.doc.sel.primary();c=null==a?c.head:"object"==typeof a?K(this.doc,
a):a?c.from():c.to();return Qa(this,c,b||"page")},charCoords:function(a,b){return Zc(this,K(this.doc,a),b||"page")},coordsChar:function(a,b){a=Be(this,a,b||"page");return Fd(this,a.left,a.top)},lineAtHeight:function(a,b){a=Be(this,{top:a,left:0},b||"page").top;return Ya(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b,c){var d=!1;if("number"==typeof a){var f=this.doc.first+this.doc.size-1;a<this.doc.first?a=this.doc.first:a>f&&(a=f,d=!0);a=C(this.doc,a)}return yb(this,a,{top:0,left:0},
b||"page",c||d).top+(d?this.doc.height-wa(a):0)},defaultTextHeight:function(){return Cb(this.display)},defaultCharWidth:function(){return tc(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,e,n){var d=this.display;a=Qa(this,K(this.doc,a));var f=a.bottom,k=a.left;b.style.position="absolute";b.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(b);d.sizer.appendChild(b);if("over"==e)f=a.top;else if("above"==
e||"near"==e){var l=Math.max(d.wrapper.clientHeight,this.doc.height),g=Math.max(d.sizer.clientWidth,d.lineSpace.clientWidth);("above"==e||a.bottom+b.offsetHeight>l)&&a.top>b.offsetHeight?f=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=l&&(f=a.bottom);k+b.offsetWidth>g&&(k=g-b.offsetWidth)}b.style.top=f+"px";b.style.left=b.style.right="";"right"==n?(k=d.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==n?k=0:"middle"==n&&(k=(d.sizer.clientWidth-b.offsetWidth)/2),b.style.left=k+"px");c&&
(a=bd(this,{left:k,top:f,right:k+b.offsetWidth,bottom:f+b.offsetHeight}),null!=a.scrollTop&&xc(this,a.scrollTop),null!=a.scrollLeft&&Rb(this,a.scrollLeft))},triggerOnKeyDown:ya(Af),triggerOnKeyPress:ya(Df),triggerOnKeyUp:Cf,execCommand:function(a){if(nd.hasOwnProperty(a))return nd[a].call(null,this)},triggerElectric:ya(function(a){Jf(this,a)}),findPosH:function(a,b,c,e){var d=1;0>b&&(d=-1,b=-b);a=K(this.doc,a);for(var f=0;f<b&&(a=ee(this.doc,a,d,c,e),!a.hitSide);++f);return a},moveH:ya(function(a,
b){var c=this;this.extendSelectionsBy(function(d){return c.display.shift||c.doc.extend||d.empty()?ee(c.doc,d.head,a,b,c.options.rtlMoveVisually):0>a?d.from():d.to()},Lc)}),deleteH:ya(function(a,b){var c=this.doc;this.doc.sel.somethingSelected()?c.replaceSelection("",null,"+delete"):cc(this,function(d){var f=ee(c,d.head,a,b,!1);return 0>a?{from:f,to:d.head}:{from:d.head,to:f}})}),findPosV:function(a,b,c,e){var d=1;0>b&&(d=-1,b=-b);var f=K(this.doc,a);for(a=0;a<b&&(f=Qa(this,f,"div"),null==e?e=f.left:
f.left=e,f=Of(this,f,d,c),!f.hitSide);++a);return f},moveV:ya(function(a,b){var c=this,d=this.doc,f=[],e=!this.display.shift&&!d.extend&&d.sel.somethingSelected();d.extendSelectionsBy(function(k){if(e)return 0>a?k.from():k.to();var n=Qa(c,k.head,"div");null!=k.goalColumn&&(n.left=k.goalColumn);f.push(n.left);var l=Of(c,n,a,b);"page"==b&&k==d.sel.primary()&&cd(c,null,Zc(c,l,"div").top-n.top);return l},Lc);if(f.length)for(var n=0;n<d.sel.ranges.length;n++)d.sel.ranges[n].goalColumn=f[n]}),findWordAt:function(a){var b=
C(this.doc,a.line).text,c=a.ch,d=a.ch;if(b){var e=this.getHelper(a,"wordChars");"before"!=a.sticky&&d!=b.length||!c?++d:--c;for(var n=b.charAt(c),n=fa(n,e)?function(a){return fa(a,e)}:/\s/.test(n)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!fa(a)};0<c&&n(b.charAt(c-1));)--c;for(;d<b.length&&n(b.charAt(d));)++d}return new W(A(a.line,c),A(a.line,d))},toggleOverwrite:function(a){if(null==a||a!=this.state.overwrite)(this.state.overwrite=!this.state.overwrite)?w(this.display.cursorDiv,
"CodeMirror-overwrite"):Fb(this.display.cursorDiv,"CodeMirror-overwrite"),ha(this,"overwriteToggle",this,this.state.overwrite)},hasFocus:function(){return this.display.input.getField()==z()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:ya(function(a,b){null==a&&null==b||dd(this);null!=a&&(this.curOp.scrollLeft=a);null!=b&&(this.curOp.scrollTop=b)}),getScrollInfo:function(){var a=this.display.scroller;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-
Wa(this)-this.display.barHeight,width:a.scrollWidth-Wa(this)-this.display.barWidth,clientHeight:Bd(this),clientWidth:Ab(this)}},scrollIntoView:ya(function(a,b){null==a?(a={from:this.doc.sel.primary().head,to:null},null==b&&(b=this.options.cursorScrollMargin)):"number"==typeof a?a={from:A(a,0),to:null}:null==a.from&&(a={from:a,to:null});a.to||(a.to=a.from);a.margin=b||0;if(null!=a.from.line)dd(this),this.curOp.scrollToPos=a;else{var c=bd(this,{left:Math.min(a.from.left,a.to.left),top:Math.min(a.from.top,
a.to.top)-a.margin,right:Math.max(a.from.right,a.to.right),bottom:Math.max(a.from.bottom,a.to.bottom)+a.margin});this.scrollTo(c.scrollLeft,c.scrollTop)}}),setSize:ya(function(a,b){var c=this,d=function(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a};null!=a&&(this.display.wrapper.style.width=d(a));null!=b&&(this.display.wrapper.style.height=d(b));this.options.lineWrapping&&ye(this);var f=this.display.viewFrom;this.doc.iter(f,this.display.viewTo,function(a){if(a.widgets)for(var b=0;b<
a.widgets.length;b++)if(a.widgets[b].noHScroll){pb(c,f,"widget");break}++f});this.curOp.forceUpdate=!0;ha(this,"refresh",this)}),operation:function(a){return Ea(this,a)},refresh:ya(function(){var a=this.display.cachedTextHeight;za(this);this.curOp.forceUpdate=!0;uc(this);this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop);Ld(this);(null==a||.5<Math.abs(a-Cb(this.display)))&&Hd(this);ha(this,"refresh",this)}),swapDoc:ya(function(a){var b=this.doc;b.cm=null;Ve(this,a);uc(this);this.display.input.reset();
this.scrollTo(a.scrollLeft,a.scrollTop);this.curOp.forceScroll=!0;pa(this,"swapDoc",this,b);return b}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};Ua(a);a.registerHelper=function(b,f,e){c.hasOwnProperty(b)||(c[b]=a[b]={_global:[]});c[b][f]=e};a.registerGlobalHelper=function(b,f,e,n){a.registerHelper(b,f,n);
c[b]._global.push({pred:e,val:n})}})(da);var Sg="iter insert remove copy getEditor constructor".split(" "),Pc;for(Pc in Aa.prototype)Aa.prototype.hasOwnProperty(Pc)&&0>e(Sg,Pc)&&(da.prototype[Pc]=function(a){return function(){return a.apply(this.doc,arguments)}}(Aa.prototype[Pc]));Ua(Aa);da.inputStyles={textarea:ja,contenteditable:Y};da.defineMode=function(a){da.defaults.mode||"null"==a||(da.defaults.mode=a);pc.apply(this,arguments)};da.defineMIME=function(a,b){Nb[a]=b};da.defineMode("null",function(){return{token:function(a){return a.skipToEnd()}}});
da.defineMIME("text/plain","null");da.defineExtension=function(a,b){da.prototype[a]=b};da.defineDocExtension=function(a,b){Aa.prototype[a]=b};da.fromTextArea=function(a,b){function c(){a.value=g.getValue()}b=b?h(b):{};b.value=a.value;!b.tabindex&&a.tabIndex&&(b.tabindex=a.tabIndex);!b.placeholder&&a.placeholder&&(b.placeholder=a.placeholder);if(null==b.autofocus){var d=z();b.autofocus=d==a||null!=a.getAttribute("autofocus")&&d==document.body}var f;if(a.form&&(L(a.form,"submit",c),!b.leaveSubmitMethodAlone)){var e=
a.form;f=e.submit;try{var n=e.submit=function(){c();e.submit=f;e.submit();e.submit=n}}catch(x){}}b.finishInit=function(b){b.save=c;b.getTextArea=function(){return a};b.toTextArea=function(){b.toTextArea=isNaN;c();a.parentNode.removeChild(b.getWrapperElement());a.style.display="";a.form&&(ta(a.form,"submit",c),"function"==typeof a.form.submit&&(a.form.submit=f))}};a.style.display="none";var g=da(function(b){return a.parentNode.insertBefore(b,a.nextSibling)},b);return g};(function(a){a.off=ta;a.on=
L;a.wheelEventPixels=gg;a.Doc=Aa;a.splitLines=de;a.countColumn=q;a.findColumn=I;a.isWordChar=O;a.Pass=Xd;a.signal=ha;a.Line=Wb;a.changeEnd=qb;a.scrollbarModel=Oe;a.Pos=A;a.cmpPos=M;a.modes=vd;a.mimeModes=Nb;a.resolveMode=zb;a.getMode=mb;a.modeExtensions=Ob;a.extendMode=wd;a.copyState=xa;a.startState=Uc;a.innerMode=nb;a.commands=nd;a.keyMap=Gc;a.keyName=vf;a.isModifierKey=uf;a.lookupKey=bc;a.normalizeKeyMap=wg;a.StringStream=la;a.SharedTextMarker=Fc;a.TextMarker=rb;a.LineWidget=Ec;a.e_preventDefault=
ka;a.e_stopPropagation=cb;a.e_stop=Va;a.addClass=w;a.contains=B;a.rmClass=Fb;a.keyNames=sb})(da);da.version="5.25.3";return da});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],m):m(CodeMirror)})(function(m){function F(m,h,q,e){var I=m.getLineHandle(h.line),g=h.ch-1,I=0<=g&&w[I.text.charAt(g)]||w[I.text.charAt(++g)];if(!I)return null;var p=">"==I.charAt(1)?1:-1;if(q&&0<p!=(g==h.ch))return null;q=m.getTokenTypeAt(z(h.line,g+1));m=E(m,z(h.line,g+(0<p?1:0)),p,q||null,e);return null==m?null:{from:z(h.line,g),
to:m&&m.pos,match:m&&m.ch==I.charAt(0),forward:0<p}}function E(m,h,q,e,I){var g=I&&I.maxScanLineLength||1E4,p=I&&I.maxScanLines||1E3,y=[];I=I&&I.bracketRegex?I.bracketRegex:/[(){}[\]]/;for(var p=0<q?Math.min(h.line+p,m.lastLine()+1):Math.max(m.firstLine()-1,h.line-p),r=h.line;r!=p;r+=q){var v=m.getLine(r);if(v){var t=0<q?0:v.length-1,G=0<q?v.length:-1;if(!(v.length>g))for(r==h.line&&(t=h.ch-(0>q?1:0));t!=G;t+=q){var B=v.charAt(t);if(I.test(B)&&(void 0===e||m.getTokenTypeAt(z(r,t+1))==e))if(">"==w[B].charAt(1)==
0<q)y.push(B);else if(y.length)y.pop();else return{pos:z(r,t),ch:B}}}}return r-q==(0<q?m.lastLine():m.firstLine())?!1:null}function v(m,h,q){for(var e=m.state.matchBrackets.maxHighlightLineLength||1E3,r=[],g=m.listSelections(),p=0;p<g.length;p++){var y=g[p].empty()&&F(m,g[p].head,!1,q);if(y&&m.getLine(y.from.line).length<=e){var w=y.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";r.push(m.markText(y.from,z(y.from.line,y.from.ch+1),{className:w}));y.to&&m.getLine(y.to.line).length<=
e&&r.push(m.markText(y.to,z(y.to.line,y.to.ch+1),{className:w}))}}if(r.length)if(B&&m.state.focused&&m.focus(),q=function(){m.operation(function(){for(var e=0;e<r.length;e++)r[e].clear()})},h)setTimeout(q,800);else return q}function t(m){m.operation(function(){r&&(r(),r=null);r=v(m,!1,m.state.matchBrackets)})}var B=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||8>document.documentMode),z=m.Pos,w={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},r=null;m.defineOption("matchBrackets",
!1,function(w,h,q){q&&q!=m.Init&&(w.off("cursorActivity",t),r&&(r(),r=null));h&&(w.state.matchBrackets="object"==typeof h?h:{},w.on("cursorActivity",t))});m.defineExtension("matchBrackets",function(){v(this,!0)});m.defineExtension("findMatchingBracket",function(m,h,q){return F(this,m,h,q)});m.defineExtension("scanForBracket",function(m,h,q,e){return E(this,m,h,q,e)})});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],m):m(CodeMirror)})(function(m){function F(h,q){this.cm=h;this.options=q;this.widget=null;this.tick=this.debounce=0;this.startPos=this.cm.getCursor("start");this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var e=this;h.on("cursorActivity",this.activityFunc=function(){e.cursorActivity()})}function E(h,
q){function e(e,g){var h;h="string"!=typeof g?function(e){return g(e,q)}:m.hasOwnProperty(g)?m[g]:g;p[e]=h}var m={Up:function(){q.moveFocus(-1)},Down:function(){q.moveFocus(1)},PageUp:function(){q.moveFocus(-q.menuSize()+1,!0)},PageDown:function(){q.moveFocus(q.menuSize()-1,!0)},Home:function(){q.setFocus(0)},End:function(){q.setFocus(q.length-1)},Enter:q.pick,Tab:q.pick,Esc:q.close},g=h.options.customKeys,p=g?{}:m;if(g)for(var y in g)g.hasOwnProperty(y)&&e(y,g[y]);if(g=h.options.extraKeys)for(y in g)g.hasOwnProperty(y)&&
e(y,g[y]);return p}function v(h,q){for(;q&&q!=h;){if("LI"===q.nodeName.toUpperCase()&&q.parentNode==h)return q;q=q.parentNode}}function t(h,q){this.completion=h;this.data=q;this.picked=!1;var e=this,r=h.cm,g=this.hints=document.createElement("ul");g.className="CodeMirror-hints";this.selectedHint=q.selectedHint||0;for(var p=q.list,y=0;y<p.length;++y){var w=g.appendChild(document.createElement("li")),t=p[y],z="CodeMirror-hint"+(y!=this.selectedHint?"":" CodeMirror-hint-active");null!=t.className&&(z=
t.className+" "+z);w.className=z;t.render?t.render(w,q,t):w.appendChild(document.createTextNode(t.displayText||("string"==typeof t?t:t.text)));w.hintId=y}var y=r.cursorCoords(h.options.alignWithWord?q.from:null),B=y.left,G=y.bottom,F=!0;g.style.left=B+"px";g.style.top=G+"px";var w=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),Q=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(h.options.container||document.body).appendChild(g);
var t=g.getBoundingClientRect(),ca=t.bottom-Q,z=g.scrollHeight>g.clientHeight+1,R=r.getScrollInfo();0<ca&&(ca=t.bottom-t.top,0<y.top-(y.bottom-t.top)-ca?(g.style.top=(G=y.top-ca)+"px",F=!1):ca>Q&&(g.style.height=Q-5+"px",g.style.top=(G=y.bottom-t.top)+"px",Q=r.getCursor(),q.from.ch!=Q.ch&&(y=r.cursorCoords(Q),g.style.left=(B=y.left)+"px",t=g.getBoundingClientRect())));Q=t.right-w;0<Q&&(t.right-t.left>w&&(g.style.width=w-5+"px",Q-=t.right-t.left-w),g.style.left=(B=y.left-Q)+"px");if(z)for(y=g.firstChild;y;y=
y.nextSibling)y.style.paddingRight=r.display.nativeBarWidth+"px";r.addKeyMap(this.keyMap=E(h,{moveFocus:function(g,h){e.changeActive(e.selectedHint+g,h)},setFocus:function(g){e.changeActive(g)},menuSize:function(){return e.screenAmount()},length:p.length,close:function(){h.close()},pick:function(){e.pick()},data:q}));if(h.options.closeOnUnfocus){var ga;r.on("blur",this.onBlur=function(){ga=setTimeout(function(){h.close()},100)});r.on("focus",this.onFocus=function(){clearTimeout(ga)})}r.on("scroll",
this.onScroll=function(){var e=r.getScrollInfo(),p=r.getWrapperElement().getBoundingClientRect(),q=G+R.top-e.top,m=q-(window.pageYOffset||(document.documentElement||document.body).scrollTop);F||(m+=g.offsetHeight);if(m<=p.top||m>=p.bottom)return h.close();g.style.top=q+"px";g.style.left=B+R.left-e.left+"px"});m.on(g,"dblclick",function(h){(h=v(g,h.target||h.srcElement))&&null!=h.hintId&&(e.changeActive(h.hintId),e.pick())});m.on(g,"click",function(p){(p=v(g,p.target||p.srcElement))&&null!=p.hintId&&
(e.changeActive(p.hintId),h.options.completeOnSingleClick&&e.pick())});m.on(g,"mousedown",function(){setTimeout(function(){r.focus()},20)});m.signal(q,"select",p[0],g.firstChild);return!0}function B(h,m){if(!h.somethingSelected())return m;for(var e=[],q=0;q<m.length;q++)m[q].supportsSelection&&e.push(m[q]);return e}function z(h,m,e,r){h.async?h(m,r,e):(h=h(m,e))&&h.then?h.then(r):r(h)}m.showHint=function(h,m,e){if(!m)return h.showHint(e);e&&e.async&&(m.async=!0);m={hint:m};if(e)for(var q in e)m[q]=
e[q];return h.showHint(m)};m.defineExtension("showHint",function(h){var q=this.getCursor("start"),e=this.options.hintOptions,r={},g;for(g in G)r[g]=G[g];if(e)for(g in e)void 0!==e[g]&&(r[g]=e[g]);if(h)for(g in h)void 0!==h[g]&&(r[g]=h[g]);r.hint.resolve&&(r.hint=r.hint.resolve(this,q));h=r;q=this.listSelections();if(!(1<q.length)){if(this.somethingSelected()){if(!h.hint.supportsSelection)return;for(g=0;g<q.length;g++)if(q[g].head.line!=q[g].anchor.line)return}this.state.completionActive&&this.state.completionActive.close();
q=this.state.completionActive=new F(this,h);q.options.hint&&(m.signal(this,"startCompletion",this),q.update(!0))}});var w=window.requestAnimationFrame||function(h){return setTimeout(h,1E3/60)},r=window.cancelAnimationFrame||clearTimeout;F.prototype={close:function(){this.active()&&(this.tick=this.cm.state.completionActive=null,this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&m.signal(this.data,"close"),this.widget&&this.widget.close(),m.signal(this.cm,"endCompletion",this.cm))},
active:function(){return this.cm.state.completionActive==this},pick:function(h,q){var e=h.list[q];e.hint?e.hint(this.cm,h,e):this.cm.replaceRange("string"==typeof e?e:e.text,e.from||h.from,e.to||h.to,"complete");m.signal(h,"pick",e);this.close()},cursorActivity:function(){this.debounce&&(r(this.debounce),this.debounce=0);var h=this.cm.getCursor(),m=this.cm.getLine(h.line);if(h.line!=this.startPos.line||m.length-h.ch!=this.startLen-this.startPos.ch||h.ch<this.startPos.ch||this.cm.somethingSelected()||
h.ch&&this.options.closeCharacters.test(m.charAt(h.ch-1)))this.close();else{var e=this;this.debounce=w(function(){e.update()});this.widget&&this.widget.disable()}},update:function(h){if(null!=this.tick){var m=this,e=++this.tick;z(this.options.hint,this.cm,this.options,function(q){m.tick==e&&m.finishUpdate(q,h)})}},finishUpdate:function(h,q){this.data&&m.signal(this.data,"update");var e=this.widget&&this.widget.picked||q&&this.options.completeSingle;this.widget&&this.widget.close();var r;if(r=h&&this.data)r=
this.data,r=0<m.cmpPos(h.from,r.from)&&r.to.ch-r.from.ch!=h.to.ch-h.from.ch;r||(this.data=h)&&h.list.length&&(e&&1==h.list.length?this.pick(h,0):(this.widget=new t(this,h),m.signal(h,"shown")))}};t.prototype={close:function(){if(this.completion.widget==this){this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var h=this.completion.cm;this.completion.options.closeOnUnfocus&&(h.off("blur",this.onBlur),h.off("focus",this.onFocus));h.off("scroll",
this.onScroll)}},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var h=this;this.keyMap={Enter:function(){h.picked=!0}};this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(h,q){h>=this.data.list.length?h=q?this.data.list.length-1:0:0>h&&(h=q?0:this.data.list.length-1);if(this.selectedHint!=h){var e=this.hints.childNodes[this.selectedHint];e.className=e.className.replace(" CodeMirror-hint-active","");e=
this.hints.childNodes[this.selectedHint=h];e.className+=" CodeMirror-hint-active";e.offsetTop<this.hints.scrollTop?this.hints.scrollTop=e.offsetTop-3:e.offsetTop+e.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=e.offsetTop+e.offsetHeight-this.hints.clientHeight+3);m.signal(this.data,"select",this.data.list[this.selectedHint],e)}},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};m.registerHelper("hint","auto",
{resolve:function(h,q){var e=h.getHelpers(q,"hint"),r;if(e.length){var g=function(g,h,m){function p(e){if(e==q.length)return h(null);z(q[e],g,m,function(g){g&&0<g.list.length?h(g):p(e+1)})}var q=B(g,e);p(0)};g.async=!0;g.supportsSelection=!0;return g}return(r=h.getHelper(h.getCursor(),"hintWords"))?function(e){return m.hint.fromList(e,{words:r})}:m.hint.anyword?function(e,g){return m.hint.anyword(e,g)}:function(){}}});m.registerHelper("hint","fromList",function(h,q){var e=h.getCursor(),r=h.getTokenAt(e),
g=m.Pos(e.line,r.end);if(r.string&&/\w/.test(r.string[r.string.length-1]))var p=r.string,e=m.Pos(e.line,r.start);else p="",e=g;for(var r=[],y=0;y<q.words.length;y++){var w=q.words[y];w.slice(0,p.length)==p&&r.push(w)}if(r.length)return{list:r,from:e,to:g}});m.commands.autocomplete=m.showHint;var G={hint:m.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null};m.defineOption("hintOptions",
null)});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],m):m(CodeMirror)})(function(m){var F=m.Pos;m.registerHelper("hint","xml",function(E,v){var t=v&&v.schemaInfo,B=v&&v.quoteChar||'"';if(t){var z=E.getCursor(),w=E.getTokenAt(z);w.end>z.ch&&(w.end=z.ch,w.string=w.string.slice(0,z.ch-w.start));var r=m.innerMode(E.getMode(),w.state);if("xml"==r.mode.name){var G=[],h=!1,q,e=/\btag\b/.test(w.type)&&!/>$/.test(w.string),
I=e&&/^\w/.test(w.string),g;if(I){var p=E.getLine(z.line).slice(Math.max(0,w.start-2),w.start);(p=/<\/$/.test(p)?"close":/<$/.test(p)?"open":null)&&(g=w.start-("close"==p?2:1))}else e&&"<"==w.string?p="open":e&&"</"==w.string&&(p="close");if(!e&&!r.state.tagName||p){I&&(q=w.string);var h=p,r=(B=r.state.context)&&t[B.tagName],y=B?r&&r.children:t["!top"];if(y&&"close"!=p)for(t=0;t<y.length;++t)q&&0!=y[t].lastIndexOf(q,0)||G.push("<"+y[t]);else if("close"!=p)for(var D in t)!t.hasOwnProperty(D)||"!top"==
D||"!attrs"==D||q&&0!=D.lastIndexOf(q,0)||G.push("<"+D);B&&(!q||"close"==p&&0==B.tagName.lastIndexOf(q,0))&&G.push("</"+B.tagName+">")}else{D=(r=t[r.state.tagName])&&r.attrs;t=t["!attrs"];if(!D&&!t)return;if(!D)D=t;else if(t){var p={},H;for(H in t)t.hasOwnProperty(H)&&(p[H]=t[H]);for(H in D)D.hasOwnProperty(H)&&(p[H]=D[H]);D=p}if("string"==w.type||"="==w.string){p=E.getRange(F(z.line,Math.max(0,z.ch-60)),F(z.line,"string"==w.type?w.start:w.end));t=p.match(/([^\s\u00a0=<>\"\']+)=$/);if(!t||!D.hasOwnProperty(t[1])||
!(y=D[t[1]]))return;"function"==typeof y&&(y=y.call(this,E));"string"==w.type&&(q=w.string,h=0,/['"]/.test(w.string.charAt(0))&&(B=w.string.charAt(0),q=w.string.slice(1),h++),t=w.string.length,/['"]/.test(w.string.charAt(t-1))&&(B=w.string.charAt(t-1),q=w.string.substr(h,t-2)),h=!0);for(t=0;t<y.length;++t)q&&0!=y[t].lastIndexOf(q,0)||G.push(B+y[t]+B)}else{"attribute"==w.type&&(q=w.string,h=!0);for(var X in D)!D.hasOwnProperty(X)||q&&0!=X.lastIndexOf(q,0)||G.push(X)}}return{list:G,from:h?F(z.line,
null==g?w.start:g):z,to:h?F(z.line,w.end):z}}}})});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror"),require("./xml-hint")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./xml-hint"],m):m(CodeMirror)})(function(m){function F(e){for(var m in h)h.hasOwnProperty(m)&&(e.attrs[m]=h[m])}var E="ab aa af ak sq am ar an hy as av ae ay az bm ba eu be bn bh bi bs br bg my ca ch ce ny zh cv kw co cr hr cs da dv nl dz en eo et ee fo fj fi fr ff gl ka de el gn gu ht ha he hz hi ho hu ia id ie ga ig ik io is it iu ja jv kl kn kr ks kk km ki rw ky kv kg ko ku kj la lb lg li ln lo lt lu lv gv mk mg ms ml mt mi mr mh mn na nv nb nd ne ng nn no ii nr oc oj cu om or os pa pi fa pl ps pt qu rm rn ro ru sa sc sd se sm sg sr gd sn si sk sl so st es su sw ss sv ta te tg th ti bo tk tl tn to tr ts tt tw ty ug uk ur uz ve vi vo wa cy wo fy xh yi yo za zu".split(" "),v=
["_blank","_self","_top","_parent"],t=["ascii","utf-8","utf-16","latin1","latin1"],B=["get","post","put","delete"],z=["application/x-www-form-urlencoded","multipart/form-data","text/plain"],w="all;screen;print;embossed;braille;handheld;print;projection;screen;tty;tv;speech;3d-glasses;resolution [>][<][=] [X];device-aspect-ratio: X/Y;orientation:portrait;orientation:landscape;device-height: [X];device-width: [X]".split(";"),r={attrs:{}},G={a:{attrs:{href:null,ping:null,type:null,media:w,target:v,hreflang:E}},
abbr:r,acronym:r,address:r,applet:r,area:{attrs:{alt:null,coords:null,href:null,target:null,ping:null,media:w,hreflang:E,type:null,shape:["default","rect","circle","poly"]}},article:r,aside:r,audio:{attrs:{src:null,mediagroup:null,crossorigin:["anonymous","use-credentials"],preload:["none","metadata","auto"],autoplay:["","autoplay"],loop:["","loop"],controls:["","controls"]}},b:r,base:{attrs:{href:null,target:v}},basefont:r,bdi:r,bdo:r,big:r,blockquote:{attrs:{cite:null}},body:r,br:r,button:{attrs:{form:null,
formaction:null,name:null,value:null,autofocus:["","autofocus"],disabled:["","autofocus"],formenctype:z,formmethod:B,formnovalidate:["","novalidate"],formtarget:v,type:["submit","reset","button"]}},canvas:{attrs:{width:null,height:null}},caption:r,center:r,cite:r,code:r,col:{attrs:{span:null}},colgroup:{attrs:{span:null}},command:{attrs:{type:["command","checkbox","radio"],label:null,icon:null,radiogroup:null,command:null,title:null,disabled:["","disabled"],checked:["","checked"]}},data:{attrs:{value:null}},
datagrid:{attrs:{disabled:["","disabled"],multiple:["","multiple"]}},datalist:{attrs:{data:null}},dd:r,del:{attrs:{cite:null,datetime:null}},details:{attrs:{open:["","open"]}},dfn:r,dir:r,div:r,dl:r,dt:r,em:r,embed:{attrs:{src:null,type:null,width:null,height:null}},eventsource:{attrs:{src:null}},fieldset:{attrs:{disabled:["","disabled"],form:null,name:null}},figcaption:r,figure:r,font:r,footer:r,form:{attrs:{action:null,name:null,"accept-charset":t,autocomplete:["on","off"],enctype:z,method:B,novalidate:["",
"novalidate"],target:v}},frame:r,frameset:r,h1:r,h2:r,h3:r,h4:r,h5:r,h6:r,head:{attrs:{},children:"title base link style meta script noscript command".split(" ")},header:r,hgroup:r,hr:r,html:{attrs:{manifest:null},children:["head","body"]},i:r,iframe:{attrs:{src:null,srcdoc:null,name:null,width:null,height:null,sandbox:["allow-top-navigation","allow-same-origin","allow-forms","allow-scripts"],seamless:["","seamless"]}},img:{attrs:{alt:null,src:null,ismap:null,usemap:null,width:null,height:null,crossorigin:["anonymous",
"use-credentials"]}},input:{attrs:{alt:null,dirname:null,form:null,formaction:null,height:null,list:null,max:null,maxlength:null,min:null,name:null,pattern:null,placeholder:null,size:null,src:null,step:null,value:null,width:null,accept:["audio/*","video/*","image/*"],autocomplete:["on","off"],autofocus:["","autofocus"],checked:["","checked"],disabled:["","disabled"],formenctype:z,formmethod:B,formnovalidate:["","novalidate"],formtarget:v,multiple:["","multiple"],readonly:["","readonly"],required:["",
"required"],type:"hidden text search tel url email password datetime date month week time datetime-local number range color checkbox radio file submit image reset button".split(" ")}},ins:{attrs:{cite:null,datetime:null}},kbd:r,keygen:{attrs:{challenge:null,form:null,name:null,autofocus:["","autofocus"],disabled:["","disabled"],keytype:["RSA"]}},label:{attrs:{"for":null,form:null}},legend:r,li:{attrs:{value:null}},link:{attrs:{href:null,type:null,hreflang:E,media:w,sizes:["all","16x16","16x16 32x32",
"16x16 32x32 64x64"]}},map:{attrs:{name:null}},mark:r,menu:{attrs:{label:null,type:["list","context","toolbar"]}},meta:{attrs:{content:null,charset:t,name:"viewport application-name author description generator keywords".split(" "),"http-equiv":["content-language","content-type","default-style","refresh"]}},meter:{attrs:{value:null,min:null,low:null,high:null,max:null,optimum:null}},nav:r,noframes:r,noscript:r,object:{attrs:{data:null,type:null,name:null,usemap:null,form:null,width:null,height:null,
typemustmatch:["","typemustmatch"]}},ol:{attrs:{reversed:["","reversed"],start:null,type:["1","a","A","i","I"]}},optgroup:{attrs:{disabled:["","disabled"],label:null}},option:{attrs:{disabled:["","disabled"],label:null,selected:["","selected"],value:null}},output:{attrs:{"for":null,form:null,name:null}},p:r,param:{attrs:{name:null,value:null}},pre:r,progress:{attrs:{value:null,max:null}},q:{attrs:{cite:null}},rp:r,rt:r,ruby:r,s:r,samp:r,script:{attrs:{type:["text/javascript"],src:null,async:["","async"],
defer:["","defer"],charset:t}},section:r,select:{attrs:{form:null,name:null,size:null,autofocus:["","autofocus"],disabled:["","disabled"],multiple:["","multiple"]}},small:r,source:{attrs:{src:null,type:null,media:null}},span:r,strike:r,strong:r,style:{attrs:{type:["text/css"],media:w,scoped:null}},sub:r,summary:r,sup:r,table:r,tbody:r,td:{attrs:{colspan:null,rowspan:null,headers:null}},textarea:{attrs:{dirname:null,form:null,maxlength:null,name:null,placeholder:null,rows:null,cols:null,autofocus:["",
"autofocus"],disabled:["","disabled"],readonly:["","readonly"],required:["","required"],wrap:["soft","hard"]}},tfoot:r,th:{attrs:{colspan:null,rowspan:null,headers:null,scope:["row","col","rowgroup","colgroup"]}},thead:r,time:{attrs:{datetime:null}},title:r,tr:r,track:{attrs:{src:null,label:null,"default":null,kind:["subtitles","captions","descriptions","chapters","metadata"],srclang:E}},tt:r,u:r,ul:r,"var":r,video:{attrs:{src:null,poster:null,width:null,height:null,crossorigin:["anonymous","use-credentials"],
preload:["auto","metadata","none"],autoplay:["","autoplay"],mediagroup:["movie"],muted:["","muted"],controls:["","controls"]}},wbr:r},h={accesskey:"abcdefghijklmnopqrstuvwxyz0123456789".split(""),"class":null,contenteditable:["true","false"],contextmenu:null,dir:["ltr","rtl","auto"],draggable:["true","false","auto"],dropzone:["copy","move","link","string:","file:"],hidden:["hidden"],id:null,inert:["inert"],itemid:null,itemprop:null,itemref:null,itemscope:["itemscope"],itemtype:null,lang:["en","es"],
spellcheck:["true","false"],style:null,tabindex:"123456789".split(""),title:null,translate:["yes","no"],onclick:null,rel:"stylesheet alternate author bookmark help license next nofollow noreferrer prefetch prev search tag".split(" ")};F(r);for(var q in G)G.hasOwnProperty(q)&&G[q]!=r&&F(G[q]);m.htmlSchema=G;m.registerHelper("hint","html",function(e,h){var g={schemaInfo:G};if(h)for(var p in h)g[p]=h[p];return m.hint.xml(e,g)})});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],m):m(CodeMirror)})(function(m){var F={autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,
dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,
caseFold:!0},E={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,caseFold:!1};m.defineMode("xml",function(v,t){function B(e,g){function h(h){g.tokenize=h;return h(e,g)}var p=e.next();if("<"==p){if(e.eat("!"))return e.eat("[")?e.match("CDATA[")?h(r("atom","]]\x3e")):null:e.match("--")?h(r("comment","--\x3e")):e.match("DOCTYPE",!0,!0)?(e.eatWhile(/[\w\._\-]/),h(G(1))):null;if(e.eat("?"))return e.eatWhile(/[\w\._\-]/),g.tokenize=r("meta","?>"),
"meta";ga=e.eat("/")?"closeTag":"openTag";g.tokenize=z;return"tag bracket"}if("&"==p)return(e.eat("#")?e.eat("x")?e.eatWhile(/[a-fA-F\d]/)&&e.eat(";"):e.eatWhile(/[\d]/)&&e.eat(";"):e.eatWhile(/[\w\.\-:]/)&&e.eat(";"))?"atom":"error";e.eatWhile(/[^&<]/);return null}function z(e,g){var h=e.next();if(">"==h||"/"==h&&e.eat(">"))return g.tokenize=B,ga=">"==h?"endTag":"selfcloseTag","tag bracket";if("="==h)return ga="equals",null;if("<"==h)return g.tokenize=B,g.state=I,g.tagName=g.tagStart=null,(h=g.tokenize(e,
g))?h+" tag error":"tag error";if(/[\'\"]/.test(h))return g.tokenize=w(h),g.stringStartCol=e.column(),g.tokenize(e,g);e.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/);return"word"}function w(e){var g=function(g,h){for(;!g.eol();)if(g.next()==e){h.tokenize=z;break}return"string"};g.isInAttribute=!0;return g}function r(e,g){return function(h,p){for(;!h.eol();){if(h.match(g)){p.tokenize=B;break}h.next()}return e}}function G(e){return function(g,h){for(var p;null!=(p=g.next());){if("<"==p)return h.tokenize=
G(e+1),h.tokenize(g,h);if(">"==p)if(1==e){h.tokenize=B;break}else return h.tokenize=G(e-1),h.tokenize(g,h)}return"meta"}}function h(e,g,h){this.prev=e.context;this.tagName=g;this.indent=e.indented;this.startOfLine=h;if(Q.doNotIndent.hasOwnProperty(g)||e.context&&e.context.noIndent)this.noIndent=!0}function q(e){e.context&&(e.context=e.context.prev)}function e(e,g){for(var h;e.context;){h=e.context.tagName;if(!Q.contextGrabbers.hasOwnProperty(h)||!Q.contextGrabbers[h].hasOwnProperty(g))break;q(e)}}
function I(e,h,m){return"openTag"==e?(m.tagStart=h.column(),g):"closeTag"==e?p:I}function g(e,h,p){if("word"==e)return p.tagName=h.current(),C="tag",H;C="error";return g}function p(e,g,h){if("word"==e){e=g.current();h.context&&h.context.tagName!=e&&Q.implicitlyClosed.hasOwnProperty(h.context.tagName)&&q(h);if(h.context&&h.context.tagName==e||!1===Q.matchClosing)return C="tag",y;C="tag error";return D}C="error";return D}function y(e,g,h){if("endTag"!=e)return C="error",y;q(h);return I}function D(e,
g,h){C="error";return y(e,g,h)}function H(g,p,m){if("word"==g)return C="attribute",X;if("endTag"==g||"selfcloseTag"==g){p=m.tagName;var q=m.tagStart;m.tagName=m.tagStart=null;"selfcloseTag"==g||Q.autoSelfClosers.hasOwnProperty(p)?e(m,p):(e(m,p),m.context=new h(m,p,q==m.indented));return I}C="error";return H}function X(e,g,h){if("equals"==e)return O;Q.allowMissing||(C="error");return H(e,g,h)}function O(e,g,h){if("string"==e)return fa;if("word"==e&&Q.allowUnquoted)return C="string",H;C="error";return H(e,
g,h)}function fa(e,g,h){return"string"==e?fa:H(e,g,h)}var Fa=v.indentUnit,Q={},ca=t.htmlMode?F:E,R;for(R in ca)Q[R]=ca[R];for(R in t)Q[R]=t[R];var ga,C;B.isInText=!0;return{startState:function(e){var g={tokenize:B,state:I,indented:e||0,tagName:null,tagStart:null,context:null};null!=e&&(g.baseIndent=e);return g},token:function(e,g){!g.tagName&&e.sol()&&(g.indented=e.indentation());if(e.eatSpace())return null;ga=null;var h=g.tokenize(e,g);(h||ga)&&"comment"!=h&&(C=null,g.state=g.state(ga||h,e,g),C&&
(h="error"==C?h+" error":C));return h},indent:function(e,g,h){var p=e.context;if(e.tokenize.isInAttribute)return e.tagStart==e.indented?e.stringStartCol+1:e.indented+Fa;if(p&&p.noIndent)return m.Pass;if(e.tokenize!=z&&e.tokenize!=B)return h?h.match(/^(\s*)/)[0].length:0;if(e.tagName)return!1!==Q.multilineTagIndentPastTag?e.tagStart+e.tagName.length+2:e.tagStart+Fa*(Q.multilineTagIndentFactor||1);if(Q.alignCDATA&&/<!\[CDATA\[/.test(g))return 0;if((g=g&&/^<(\/)?([\w_:\.-]*)/.exec(g))&&g[1])for(;p;)if(p.tagName==
g[2]){p=p.prev;break}else if(Q.implicitlyClosed.hasOwnProperty(p.tagName))p=p.prev;else break;else if(g)for(;p;)if((h=Q.contextGrabbers[p.tagName])&&h.hasOwnProperty(g[2]))p=p.prev;else break;for(;p&&p.prev&&!p.startOfLine;)p=p.prev;return p?p.indent+Fa:e.baseIndent||0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"\x3c!--",blockCommentEnd:"--\x3e",configuration:Q.htmlMode?"html":"xml",helperType:Q.htmlMode?"html":"xml",skipAttribute:function(e){e.state==O&&(e.state=H)}}});m.defineMIME("text/xml",
"xml");m.defineMIME("application/xml","xml");m.mimeModes.hasOwnProperty("text/html")||m.defineMIME("text/html",{name:"xml",htmlMode:!0})});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],m):m(CodeMirror)})(function(m){function F(m,v,t){return/^(?:operator|sof|keyword c|case|new|export|default|[\[{}\(,;:]|=>)$/.test(v.lastType)||"quasi"==v.lastType&&/\{\s*$/.test(m.string.slice(0,m.pos-(t||0)))}m.defineMode("javascript",function(E,v){function t(e,g,h){xa=e;nb=h;return g}function B(e,g){var n=e.next();if('"'==n||"'"==
n)return g.tokenize=z(n),g.tokenize(e,g);if("."==n&&e.match(/^\d+(?:[eE][+\-]?\d+)?/))return t("number","number");if("."==n&&e.match(".."))return t("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(n))return t(n);if("="==n&&e.eat(">"))return t("=>","operator");if("0"==n&&e.eat(/x/i))return e.eatWhile(/[\da-f]/i),t("number","number");if("0"==n&&e.eat(/o/i))return e.eatWhile(/[0-7]/i),t("number","number");if("0"==n&&e.eat(/b/i))return e.eatWhile(/[01]/i),t("number","number");if(/\d/.test(n))return e.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),
t("number","number");if("/"==n){if(e.eat("*"))return g.tokenize=w,w(e,g);if(e.eat("/"))return e.skipToEnd(),t("comment","comment");if(F(e,g,1)){a:for(var n=!1,h,p=!1;null!=(h=e.next());){if(!n){if("/"==h&&!p)break a;"["==h?p=!0:p&&"]"==h&&(p=!1)}n=!n&&"\\"==h}e.match(/^\b(([gimyu])(?![gimyu]*\2))+\b/);return t("regexp","string-2")}e.eatWhile(mb);return t("operator","operator",e.current())}if("`"==n)return g.tokenize=r,r(e,g);if("#"==n)return e.skipToEnd(),t("error","error");if(mb.test(n))return">"==
n&&g.lexical&&">"==g.lexical.type||e.eatWhile(mb),t("operator","operator",e.current());if(pc.test(n))return e.eatWhile(pc),n=e.current(),(h=zb.propertyIsEnumerable(n)&&zb[n])&&"."!=g.lastType?t(h.type,h.style,n):t("variable","variable",n)}function z(e){return function(n,g){var h=!1,p;if(Va&&"@"==n.peek()&&n.match(wd))return g.tokenize=B,t("jsonld-keyword","meta");for(;null!=(p=n.next())&&(p!=e||h);)h=!h&&"\\"==p;h||(g.tokenize=B);return t("string","string")}}function w(e,g){for(var n=!1,h;h=e.next();){if("/"==
h&&n){g.tokenize=B;break}n="*"==h}return t("comment","comment")}function r(e,g){for(var n=!1,h;null!=(h=e.next());){if(!n&&("`"==h||"$"==h&&e.eat("{"))){g.tokenize=B;break}n=!n&&"\\"==h}return t("quasi","string-2",e.current())}function G(e,g){g.fatArrowAt&&(g.fatArrowAt=null);var n=e.string.indexOf("=>",e.start);if(!(0>n)){if(La){var h=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(e.string.slice(e.start,n));h&&(n=h.index)}for(var h=0,p=!1,n=n-1;0<=n;--n){var m=e.string.charAt(n),q="([{}])".indexOf(m);
if(0<=q&&3>q){if(!h){++n;break}if(0==--h){"("==m&&(p=!0);break}}else if(3<=q&&6>q)++h;else if(pc.test(m))p=!0;else{if(/["'\/]/.test(m))return;if(p&&!h){++n;break}}}p&&!h&&(g.fatArrowAt=n)}}function h(e,g,h,p,m,q){this.indented=e;this.column=g;this.type=h;this.prev=m;this.info=q;null!=p&&(this.align=p)}function q(){for(var e=arguments.length-1;0<=e;e--)J.cc.push(arguments[e])}function e(){q.apply(null,arguments);return!0}function I(e){function n(n){for(;n;n=n.next)if(n.name==e)return!0;return!1}var g=
J.state;J.marked="def";g.context?n(g.localVars)||(g.localVars={name:e,next:g.localVars}):!n(g.globalVars)&&v.globalVars&&(g.globalVars={name:e,next:g.globalVars})}function g(){J.state.context={prev:J.state.context,vars:J.state.localVars};J.state.localVars=Vc}function p(){J.state.localVars=J.state.context.vars;J.state.context=J.state.context.prev}function y(e,g){var n=function(){var n=J.state,p=n.indented;if("stat"==n.lexical.type)p=n.lexical.indented;else for(var m=n.lexical;m&&")"==m.type&&m.align;m=
m.prev)p=m.indented;n.lexical=new h(p,J.stream.column(),e,null,n.lexical,g)};n.lex=!0;return n}function D(){var e=J.state;e.lexical.prev&&(")"==e.lexical.type&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function H(n){function g(h){return h==n?e():";"==n?q():e(g)}return g}function X(n,h){return"var"==n?e(y("vardef",h.length),sa,H(";"),D):"keyword a"==n?e(y("form"),Fa,X,D):"keyword b"==n?e(y("form"),X,D):"{"==n?e(y("}"),vb,D):";"==n?e():"if"==n?("else"==J.state.lexical.info&&J.state.cc[J.state.cc.length-
1]==D&&J.state.cc.pop()(),e(y("form"),Fa,X,D,Kb)):"function"==n?e(Ca):"for"==n?e(y("form"),Rc,X,D):"variable"==n?La&&"type"==h?(J.marked="keyword",e(ia,H("operator"),ia,H(";"))):e(y("stat"),A):"switch"==n?e(y("form"),Fa,y("}","switch"),H("{"),vb,D,D):"case"==n?e(O,H(":")):"default"==n?e(H(":")):"catch"==n?e(y("form"),g,H("("),lc,H(")"),X,D,p):"class"==n?e(y("form"),Na,D):"export"==n?e(y("stat"),Sc,D):"import"==n?e(y("stat"),ha,D):"module"==n?e(y("form"),ra,y("}"),H("{"),vb,D,D):"async"==n?e(X):"@"==
h?e(O,X):q(y("stat"),O,H(";"),D)}function O(e){return Q(e,!1)}function fa(e){return Q(e,!0)}function Fa(n){return"("!=n?q():e(y(")"),O,H(")"),D)}function Q(n,h){if(J.state.fatArrowAt==J.stream.start){var m=h?T:Ga;if("("==n)return e(g,y(")"),va(ra,")"),D,H("=>"),m,p);if("variable"==n)return q(g,ra,H("=>"),m,p)}m=h?C:ga;return Uc.hasOwnProperty(n)?e(m):"function"==n?e(Ca,m):"class"==n?e(y("form"),mc,D):"keyword c"==n||"async"==n?e(h?R:ca):"("==n?e(y(")"),ca,H(")"),D,m):"operator"==n||"spread"==n?e(h?
fa:O):"["==n?e(y("]"),ka,D,m):"{"==n?K(ub,"}",null,m):"quasi"==n?q(ba,m):"new"==n?e(Ya(h)):e()}function ca(e){return e.match(/[;\}\)\],]/)?q():q(O)}function R(e){return e.match(/[;\}\)\],]/)?q():q(fa)}function ga(n,g){return","==n?e(O):C(n,g,!1)}function C(n,h,m){var r=0==m?ga:C,w=0==m?O:fa;if("=>"==n)return e(g,m?T:Ga,p);if("operator"==n)return/\+\+|--/.test(h)?e(r):"?"==h?e(O,H(":"),w):e(w);if("quasi"==n)return q(ba,r);if(";"!=n){if("("==n)return K(fa,")","call",r);if("."==n)return e(M,r);if("["==
n)return e(y("]"),ca,H("]"),D,r)}}function ba(n,g){return"quasi"!=n?q():"${"!=g.slice(g.length-2)?e(ba):e(O,hc)}function hc(n){if("}"==n)return J.marked="string-2",J.state.tokenize=r,e(ba)}function Ga(e){G(J.stream,J.state);return q("{"==e?X:O)}function T(e){G(J.stream,J.state);return q("{"==e?X:fa)}function Ya(n){return function(g){return"."==g?e(n?ic:tb):q(n?fa:O)}}function tb(n,g){if("target"==g)return J.marked="keyword",e(ga)}function ic(n,g){if("target"==g)return J.marked="keyword",e(C)}function A(n){return":"==
n?e(D,X):q(ga,H(";"),D)}function M(n){if("variable"==n)return J.marked="property",e()}function ub(n,g){if("async"==n)return J.marked="property",e(ub);if("variable"==n||"keyword"==J.style)return J.marked="property","get"==g||"set"==g?e(jc):e(Ma);if("number"==n||"string"==n)return J.marked=Va?"property":J.style+" property",e(Ma);if("jsonld-keyword"==n)return e(Ma);if("modifier"==n)return e(ub);if("["==n)return e(O,H("]"),Ma);if("spread"==n)return e(O);if(":"==n)return q(Ma)}function jc(n){if("variable"!=
n)return q(Ma);J.marked="property";return e(Ca)}function Ma(n){if(":"==n)return e(fa);if("("==n)return q(Ca)}function va(n,g,h){function p(m,r){if(h?-1<h.indexOf(m):","==m){var y=J.state.lexical;"call"==y.info&&(y.pos=(y.pos||0)+1);return e(function(e,h){return e==g||h==g?q():q(n)},p)}return m==g||r==g?e():e(H(g))}return function(h,m){return h==g||m==g?e():q(n,p)}}function K(n,g,h){for(var p=3;p<arguments.length;p++)J.cc.push(arguments[p]);return e(y(g,h),va(n,g),D)}function vb(n){return"}"==n?e():
q(X,vb)}function Za(n,g){if(La){if(":"==n)return e(ia);if("?"==g)return e(Za)}}function ia(n){if("variable"==n)return J.marked="variable-3",e(V);if("string"==n||"number"==n||"atom"==n)return e(V);if("{"==n)return e(y("}"),va(ib,"}",",;"),D);if("("==n)return e(va(jb,")"),Ja)}function Ja(n){if("=>"==n)return e(ia)}function ib(n,g){if("variable"==n||"keyword"==J.style)return J.marked="property",e(ib);if("?"==g)return e(ib);if(":"==n)return e(ia)}function jb(n){if("variable"==n)return e(jb);if(":"==n)return e(ia)}
function V(n,g){if("<"==g)return e(y(">"),va(ia,">"),D,V);if("|"==g||"."==n)return e(ia);if("["==n)return e(H("]"),V)}function sa(){return q(ra,Za,Z,Ka)}function ra(n,g){if("modifier"==n)return e(ra);if("variable"==n)return I(g),e();if("spread"==n)return e(ra);if("["==n)return K(ra,"]");if("{"==n)return K($a,"}")}function $a(n,g){if("variable"==n&&!J.stream.match(/^\s*:/,!1))return I(g),e(Z);"variable"==n&&(J.marked="property");return"spread"==n?e(ra):"}"==n?q():e(H(":"),ra,Z)}function Z(n,g){if("="==
g)return e(fa)}function Ka(n){if(","==n)return e(sa)}function Kb(n,g){if("keyword b"==n&&"else"==g)return e(y("form","else"),X,D)}function Rc(g){if("("==g)return e(y(")"),ab,H(")"),D)}function ab(g){return"var"==g?e(sa,H(";"),wa):";"==g?e(wa):"variable"==g?e(kc):q(O,H(";"),wa)}function kc(g,h){return"in"==h||"of"==h?(J.marked="keyword",e(O)):e(ga,wa)}function wa(g,h){return";"==g?e(wb):"in"==h||"of"==h?(J.marked="keyword",e(O)):q(O,H(";"),wb)}function wb(g){")"!=g&&e(O)}function Ca(n,h){if("*"==h)return J.marked=
"keyword",e(Ca);if("variable"==n)return I(h),e(Ca);if("("==n)return e(g,y(")"),va(lc,")"),D,Za,X,p);if(La&&"<"==h)return e(y(">"),va(ia,">"),D,Ca)}function lc(g){return"spread"==g?e(lc):q(ra,Za,Z)}function mc(e,g){return"variable"==e?Na(e,g):lb(e,g)}function Na(g,h){if("variable"==g)return I(h),e(lb)}function lb(g,h){if("<"==h)return e(y(">"),va(ia,">"),D,lb);if("extends"==h||"implements"==h||La&&","==g)return e(La?ia:O,lb);if("{"==g)return e(y("}"),Oa,D)}function Oa(g,h){if("variable"==g||"keyword"==
J.style){if(("async"==h||"static"==h||"get"==h||"set"==h||La&&("public"==h||"private"==h||"protected"==h||"readonly"==h||"abstract"==h))&&J.stream.match(/^\s+[\w$\xa1-\uffff]/,!1))return J.marked="keyword",e(Oa);J.marked="property";return e(La?xb:Ca,Oa)}if("["==g)return e(O,H("]"),La?xb:Ca,Oa);if("*"==h)return J.marked="keyword",e(Oa);if(";"==g)return e(Oa);if("}"==g)return e();if("@"==h)return e(O,Oa)}function xb(g,h){return"?"==h?e(xb):":"==g?e(ia,Z):"="==h?e(fa):q(Ca)}function Sc(g,h){return"*"==
h?(J.marked="keyword",e(Ua,H(";"))):"default"==h?(J.marked="keyword",e(O,H(";"))):"{"==g?e(va(ta,"}"),Ua,H(";")):q(X)}function ta(g,h){if("as"==h)return J.marked="keyword",e(H("variable"));if("variable"==g)return q(fa,ta)}function ha(g){return"string"==g?e():q(ea,oc,Ua)}function ea(g,h){if("{"==g)return K(ea,"}");"variable"==g&&I(h);"*"==h&&(J.marked="keyword");return e(Da)}function oc(g){if(","==g)return e(ea,oc)}function Da(g,h){if("as"==h)return J.marked="keyword",e(ea)}function Ua(g,h){if("from"==
h)return J.marked="keyword",e(O)}function ka(g){return"]"==g?e():q(va(fa,"]"))}var cb=E.indentUnit,Mb=v.statementIndent,Va=v.jsonld,db=v.json||Va,La=v.typescript,pc=v.wordCharacters||/[\w$\xa1-\uffff]/,zb=function(){function e(e){return{type:e,style:"keyword"}}var g=e("keyword a"),h=e("keyword b"),p=e("keyword c"),m=e("operator"),q={type:"atom",style:"atom"},g={"if":e("if"),"while":g,"with":g,"else":h,"do":h,"try":h,"finally":h,"return":p,"break":p,"continue":p,"new":e("new"),"delete":p,"throw":p,
"debugger":p,"var":e("var"),"const":e("var"),let:e("var"),"function":e("function"),"catch":e("catch"),"for":e("for"),"switch":e("switch"),"case":e("case"),"default":e("default"),"in":m,"typeof":m,"instanceof":m,"true":q,"false":q,"null":q,undefined:q,NaN:q,Infinity:q,"this":e("this"),"class":e("class"),"super":e("atom"),yield:p,"export":e("export"),"import":e("import"),"extends":p,await:p,async:e("async")};if(La){var h={type:"variable",style:"variable-3"},p={"interface":e("class"),"implements":p,
namespace:p,module:e("module"),"enum":e("module"),"public":e("modifier"),"private":e("modifier"),"protected":e("modifier"),"abstract":e("modifier"),as:m,string:h,number:h,"boolean":h,any:h},r;for(r in p)g[r]=p[r]}return g}(),mb=/[+\-*&%=<>!?|~^@]/,wd=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/,xa,nb,Uc={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,"this":!0,"jsonld-keyword":!0},J={state:null,column:null,marked:null,cc:null},Vc={name:"this",next:{name:"arguments"}};
D.lex=!0;return{startState:function(e){e={tokenize:B,lastType:"sof",cc:[],lexical:new h((e||0)-cb,0,"block",!1),localVars:v.localVars,context:v.localVars&&{vars:v.localVars},indented:e||0};v.globalVars&&"object"==typeof v.globalVars&&(e.globalVars=v.globalVars);return e},token:function(e,g){e.sol()&&(g.lexical.hasOwnProperty("align")||(g.lexical.align=!1),g.indented=e.indentation(),G(e,g));if(g.tokenize!=w&&e.eatSpace())return null;var h=g.tokenize(e,g);if("comment"==xa)return h;g.lastType="operator"!=
xa||"++"!=nb&&"--"!=nb?xa:"incdec";a:{var n=xa,p=nb,m=g.cc;J.state=g;J.stream=e;J.marked=null;J.cc=m;J.style=h;g.lexical.hasOwnProperty("align")||(g.lexical.align=!0);for(;;)if((m.length?m.pop():db?O:X)(n,p)){for(;m.length&&m[m.length-1].lex;)m.pop()();if(J.marked){h=J.marked;break a}if(n="variable"==n)b:{for(n=g.localVars;n;n=n.next)if(n.name==p){n=!0;break b}for(m=g.context;m;m=m.prev)for(n=m.vars;n;n=n.next)if(n.name==p){n=!0;break b}n=void 0}if(n){h="variable-2";break a}break a}}return h},indent:function(e,
g){if(e.tokenize==w)return m.Pass;if(e.tokenize!=B)return 0;var h=g&&g.charAt(0),n=e.lexical,p;if(!/^\s*else\b/.test(g))for(var q=e.cc.length-1;0<=q;--q){var r=e.cc[q];if(r==D)n=n.prev;else if(r!=Kb)break}for(;!("stat"!=n.type&&"form"!=n.type||"}"!=h&&(!(p=e.cc[e.cc.length-1])||p!=ga&&p!=C||/^[,\.=+\-*:?[\(]/.test(g)));)n=n.prev;Mb&&")"==n.type&&"stat"==n.prev.type&&(n=n.prev);p=n.type;q=h==p;return"vardef"==p?n.indented+("operator"==e.lastType||","==e.lastType?n.info+1:0):"form"==p&&"{"==h?n.indented:
"form"==p?n.indented+cb:"stat"==p?(h=n.indented,n="operator"==e.lastType||","==e.lastType||mb.test(g.charAt(0))||/[,.]/.test(g.charAt(0)),h+(n?Mb||cb:0)):"switch"!=n.info||q||0==v.doubleIndentSwitch?n.align?n.column+(q?0:1):n.indented+(q?0:cb):n.indented+(/^(?:case|default)\b/.test(g)?cb:2*cb)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:db?null:"/*",blockCommentEnd:db?null:"*/",lineComment:db?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:db?"json":"javascript",
jsonldMode:Va,jsonMode:db,expressionAllowed:F,skipExpression:function(e){var g=e.cc[e.cc.length-1];g!=O&&g!=fa||e.cc.pop()}}});m.registerHelper("wordChars","javascript",/[\w$]/);m.defineMIME("text/javascript","javascript");m.defineMIME("text/ecmascript","javascript");m.defineMIME("application/javascript","javascript");m.defineMIME("application/x-javascript","javascript");m.defineMIME("application/ecmascript","javascript");m.defineMIME("application/json",{name:"javascript",json:!0});m.defineMIME("application/x-json",
{name:"javascript",json:!0});m.defineMIME("application/ld+json",{name:"javascript",jsonld:!0});m.defineMIME("text/typescript",{name:"javascript",typescript:!0});m.defineMIME("application/typescript",{name:"javascript",typescript:!0})});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],m):m(CodeMirror)})(function(m){function F(e){for(var g={},h=0;h<e.length;++h)g[e[h].toLowerCase()]=!0;return g}function E(e,g){for(var h=!1,p;null!=(p=e.next());){if(h&&"/"==p){g.tokenize=null;break}h="*"==p}return["comment","comment"]}m.defineMode("css",function(e,g){function h(e,g){jb=g;return e}function p(e,g){var p=e.next();if(G[p]){var m=
G[p](e,g);if(!1!==m)return m}if("@"==p)return e.eatWhile(/[\w\\\-]/),h("def",e.current());if("="==p||("~"==p||"|"==p)&&e.eat("="))return h(null,"compare");if('"'==p||"'"==p)return g.tokenize=q(p),g.tokenize(e,g);if("#"==p)return e.eatWhile(/[\w\\\-]/),h("atom","hash");if("!"==p)return e.match(/^\s*\w*/),h("keyword","important");if(/\d/.test(p)||"."==p&&e.eat(/\d/))return e.eatWhile(/[\w.%]/),h("number","unit");if("-"===p){if(/[\d.]/.test(e.peek()))return e.eatWhile(/[\w.%]/),h("number","unit");if(e.match(/^-[\w\\\-]+/))return e.eatWhile(/[\w\\\-]/),
e.match(/^\s*:/,!1)?h("variable-2","variable-definition"):h("variable-2","variable");if(e.match(/^\w+-/))return h("meta","meta")}else return/[,+>*\/]/.test(p)?h(null,"select-op"):"."==p&&e.match(/^-?[_a-z][_a-z0-9-]*/i)?h("qualifier","qualifier"):/[:;{}\[\]\(\)]/.test(p)?h(null,p):"u"==p&&e.match(/rl(-prefix)?\(/)||"d"==p&&e.match("omain(")||"r"==p&&e.match("egexp(")?(e.backUp(1),g.tokenize=r,h("property","word")):/[\w\\\-]/.test(p)?(e.eatWhile(/[\w\\\-]/),h("property","word")):h(null,null)}function q(e){return function(g,
p){for(var m=!1,q;null!=(q=g.next());){if(q==e&&!m){")"==e&&g.backUp(1);break}m=!m&&"\\"==q}if(q==e||!m&&")"!=e)p.tokenize=null;return h("string","string")}}function r(e,g){e.next();e.match(/\s*[\"\')]/,!1)?g.tokenize=null:g.tokenize=q(")");return h(null,"(")}function y(e,g,h){this.type=e;this.indent=g;this.prev=h}function w(e,g,h,p){e.context=new y(h,g.indentation()+(!1===p?0:D),e.context);return h}function t(e){e.context.prev&&(e.context=e.context.prev);return e.context.type}function v(e,g,h,p){for(p=
p||1;0<p;p--)h.context=h.context.prev;return sa[h.context.type](e,g,h)}function z(e){e=e.current().toLowerCase();V=ia.hasOwnProperty(e)?"atom":Fa.hasOwnProperty(e)?"keyword":"variable"}var B=g.inline;g.propertyKeywords||(g=m.resolveMode("text/css"));var D=e.indentUnit,G=g.tokenHooks,I=g.documentTypes||{},H=g.mediaTypes||{},F=g.mediaFeatures||{},E=g.mediaValueKeywords||{},fa=g.propertyKeywords||{},O=g.nonStandardPropertyKeywords||{},K=g.fontProperties||{},X=g.counterDescriptors||{},Fa=g.colorKeywords||
{},ia=g.valueKeywords||{},Ja=g.allowNested,ib=!0===g.supportsAtComponent,jb,V,sa={top:function(e,g,h){if("{"==e)return w(h,g,"block");if("}"==e&&h.context.prev)return t(h);if(ib&&/@component/.test(e))return w(h,g,"atComponentBlock");if(/^@(-moz-)?document$/.test(e))return w(h,g,"documentTypes");if(/^@(media|supports|(-moz-)?document|import)$/.test(e))return w(h,g,"atBlock");if(/^@(font-face|counter-style)/.test(e))return h.stateArg=e,"restricted_atBlock_before";if(/^@(-(moz|ms|o|webkit)-)?keyframes$/.test(e))return"keyframes";
if(e&&"@"==e.charAt(0))return w(h,g,"at");if("hash"==e)V="builtin";else if("word"==e)V="tag";else{if("variable-definition"==e)return"maybeprop";if("interpolation"==e)return w(h,g,"interpolation");if(":"==e)return"pseudo";if(Ja&&"("==e)return w(h,g,"parens")}return h.context.type},block:function(e,g,h){if("word"==e){e=g.current().toLowerCase();if(fa.hasOwnProperty(e))return V="property","maybeprop";if(O.hasOwnProperty(e))return V="string-2","maybeprop";if(Ja)return V=g.match(/^\s*:(?:\s|$)/,!1)?"property":
"tag","block";V+=" error";return"maybeprop"}if("meta"==e)return"block";if(Ja||"hash"!=e&&"qualifier"!=e)return sa.top(e,g,h);V="error";return"block"},maybeprop:function(e,g,h){return":"==e?w(h,g,"prop"):sa[h.context.type](e,g,h)},prop:function(e,g,h){if(";"==e)return t(h);if("{"==e&&Ja)return w(h,g,"propBlock");if("}"==e||"{"==e)return v(e,g,h);if("("==e)return w(h,g,"parens");if("hash"==e&&!/^#([0-9a-fA-f]{3,4}|[0-9a-fA-f]{6}|[0-9a-fA-f]{8})$/.test(g.current()))V+=" error";else if("word"==e)z(g);
else if("interpolation"==e)return w(h,g,"interpolation");return"prop"},propBlock:function(e,g,h){return"}"==e?t(h):"word"==e?(V="property","maybeprop"):h.context.type},parens:function(e,g,h){if("{"==e||"}"==e)return v(e,g,h);if(")"==e)return t(h);if("("==e)return w(h,g,"parens");if("interpolation"==e)return w(h,g,"interpolation");"word"==e&&z(g);return"parens"},pseudo:function(e,g,h){return"meta"==e?"pseudo":"word"==e?(V="variable-3",h.context.type):sa[h.context.type](e,g,h)},documentTypes:function(e,
g,h){return"word"==e&&I.hasOwnProperty(g.current())?(V="tag",h.context.type):sa.atBlock(e,g,h)},atBlock:function(e,g,h){if("("==e)return w(h,g,"atBlock_parens");if("}"==e||";"==e)return v(e,g,h);if("{"==e)return t(h)&&w(h,g,Ja?"block":"top");if("interpolation"==e)return w(h,g,"interpolation");"word"==e&&(e=g.current().toLowerCase(),V="only"==e||"not"==e||"and"==e||"or"==e?"keyword":H.hasOwnProperty(e)?"attribute":F.hasOwnProperty(e)?"property":E.hasOwnProperty(e)?"keyword":fa.hasOwnProperty(e)?"property":
O.hasOwnProperty(e)?"string-2":ia.hasOwnProperty(e)?"atom":Fa.hasOwnProperty(e)?"keyword":"error");return h.context.type},atComponentBlock:function(e,g,h){if("}"==e)return v(e,g,h);if("{"==e)return t(h)&&w(h,g,Ja?"block":"top",!1);"word"==e&&(V="error");return h.context.type},atBlock_parens:function(e,g,h){return")"==e?t(h):"{"==e||"}"==e?v(e,g,h,2):sa.atBlock(e,g,h)},restricted_atBlock_before:function(e,g,h){return"{"==e?w(h,g,"restricted_atBlock"):"word"==e&&"@counter-style"==h.stateArg?(V="variable",
"restricted_atBlock_before"):sa[h.context.type](e,g,h)},restricted_atBlock:function(e,g,h){return"}"==e?(h.stateArg=null,t(h)):"word"==e?(V="@font-face"==h.stateArg&&!K.hasOwnProperty(g.current().toLowerCase())||"@counter-style"==h.stateArg&&!X.hasOwnProperty(g.current().toLowerCase())?"error":"property","maybeprop"):"restricted_atBlock"},keyframes:function(e,g,h){return"word"==e?(V="variable","keyframes"):"{"==e?w(h,g,"top"):sa[h.context.type](e,g,h)},at:function(e,g,h){if(";"==e)return t(h);if("{"==
e||"}"==e)return v(e,g,h);"word"==e?V="tag":"hash"==e&&(V="builtin");return"at"},interpolation:function(e,g,h){if("}"==e)return t(h);if("{"==e||";"==e)return v(e,g,h);"word"==e?V="variable":"variable"!=e&&"("!=e&&")"!=e&&(V="error");return"interpolation"}};return{startState:function(e){return{tokenize:null,state:B?"block":"top",stateArg:null,context:new y(B?"block":"top",e||0,null)}},token:function(e,g){if(!g.tokenize&&e.eatSpace())return null;var h=(g.tokenize||p)(e,g);h&&"object"==typeof h&&(jb=
h[1],h=h[0]);V=h;g.state=sa[g.state](jb,e,g);return V},indent:function(e,g){var h=e.context,p=g&&g.charAt(0),m=h.indent;"prop"!=h.type||"}"!=p&&")"!=p||(h=h.prev);if(h.prev)if("}"==p&&("block"==h.type||"top"==h.type||"interpolation"==h.type||"restricted_atBlock"==h.type))h=h.prev,m=h.indent;else if(")"==p&&("parens"==h.type||"atBlock_parens"==h.type)||"{"==p&&("at"==h.type||"atBlock"==h.type))m=Math.max(0,h.indent-D);return m},electricChars:"}",blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:g.lineComment,
fold:"brace"}});var v=["domain","regexp","url","url-prefix"],t=F(v),B="all aural braille handheld print projection screen tty tv embossed".split(" "),z=F(B),w="width min-width max-width height min-height max-height device-width min-device-width max-device-width device-height min-device-height max-device-height aspect-ratio min-aspect-ratio max-aspect-ratio device-aspect-ratio min-device-aspect-ratio max-device-aspect-ratio color min-color max-color color-index min-color-index max-color-index monochrome min-monochrome max-monochrome resolution min-resolution max-resolution scan grid orientation device-pixel-ratio min-device-pixel-ratio max-device-pixel-ratio pointer any-pointer hover any-hover".split(" "),
r=F(w),G="landscape portrait none coarse fine on-demand hover interlace progressive".split(" "),h=F(G),q="align-content align-items align-self alignment-adjust alignment-baseline anchor-point animation animation-delay animation-direction animation-duration animation-fill-mode animation-iteration-count animation-name animation-play-state animation-timing-function appearance azimuth backface-visibility background background-attachment background-blend-mode background-clip background-color background-image background-origin background-position background-repeat background-size baseline-shift binding bleed bookmark-label bookmark-level bookmark-state bookmark-target border border-bottom border-bottom-color border-bottom-left-radius border-bottom-right-radius border-bottom-style border-bottom-width border-collapse border-color border-image border-image-outset border-image-repeat border-image-slice border-image-source border-image-width border-left border-left-color border-left-style border-left-width border-radius border-right border-right-color border-right-style border-right-width border-spacing border-style border-top border-top-color border-top-left-radius border-top-right-radius border-top-style border-top-width border-width bottom box-decoration-break box-shadow box-sizing break-after break-before break-inside caption-side clear clip color color-profile column-count column-fill column-gap column-rule column-rule-color column-rule-style column-rule-width column-span column-width columns content counter-increment counter-reset crop cue cue-after cue-before cursor direction display dominant-baseline drop-initial-after-adjust drop-initial-after-align drop-initial-before-adjust drop-initial-before-align drop-initial-size drop-initial-value elevation empty-cells fit fit-position flex flex-basis flex-direction flex-flow flex-grow flex-shrink flex-wrap float float-offset flow-from flow-into font font-feature-settings font-family font-kerning font-language-override font-size font-size-adjust font-stretch font-style font-synthesis font-variant font-variant-alternates font-variant-caps font-variant-east-asian font-variant-ligatures font-variant-numeric font-variant-position font-weight grid grid-area grid-auto-columns grid-auto-flow grid-auto-rows grid-column grid-column-end grid-column-gap grid-column-start grid-gap grid-row grid-row-end grid-row-gap grid-row-start grid-template grid-template-areas grid-template-columns grid-template-rows hanging-punctuation height hyphens icon image-orientation image-rendering image-resolution inline-box-align justify-content left letter-spacing line-break line-height line-stacking line-stacking-ruby line-stacking-shift line-stacking-strategy list-style list-style-image list-style-position list-style-type margin margin-bottom margin-left margin-right margin-top marks marquee-direction marquee-loop marquee-play-count marquee-speed marquee-style max-height max-width min-height min-width move-to nav-down nav-index nav-left nav-right nav-up object-fit object-position opacity order orphans outline outline-color outline-offset outline-style outline-width overflow overflow-style overflow-wrap overflow-x overflow-y padding padding-bottom padding-left padding-right padding-top page page-break-after page-break-before page-break-inside page-policy pause pause-after pause-before perspective perspective-origin pitch pitch-range play-during position presentation-level punctuation-trim quotes region-break-after region-break-before region-break-inside region-fragment rendering-intent resize rest rest-after rest-before richness right rotation rotation-point ruby-align ruby-overhang ruby-position ruby-span shape-image-threshold shape-inside shape-margin shape-outside size speak speak-as speak-header speak-numeral speak-punctuation speech-rate stress string-set tab-size table-layout target target-name target-new target-position text-align text-align-last text-decoration text-decoration-color text-decoration-line text-decoration-skip text-decoration-style text-emphasis text-emphasis-color text-emphasis-position text-emphasis-style text-height text-indent text-justify text-outline text-overflow text-shadow text-size-adjust text-space-collapse text-transform text-underline-position text-wrap top transform transform-origin transform-style transition transition-delay transition-duration transition-property transition-timing-function unicode-bidi user-select vertical-align visibility voice-balance voice-duration voice-family voice-pitch voice-range voice-rate voice-stress voice-volume volume white-space widows width will-change word-break word-spacing word-wrap z-index clip-path clip-rule mask enable-background filter flood-color flood-opacity lighting-color stop-color stop-opacity pointer-events color-interpolation color-interpolation-filters color-rendering fill fill-opacity fill-rule image-rendering marker marker-end marker-mid marker-start shape-rendering stroke stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-rendering baseline-shift dominant-baseline glyph-orientation-horizontal glyph-orientation-vertical text-anchor writing-mode".split(" "),
e=F(q),I="scrollbar-arrow-color scrollbar-base-color scrollbar-dark-shadow-color scrollbar-face-color scrollbar-highlight-color scrollbar-shadow-color scrollbar-3d-light-color scrollbar-track-color shape-inside searchfield-cancel-button searchfield-decoration searchfield-results-button searchfield-results-decoration zoom".split(" "),g=F(I),p=F("font-family src unicode-range font-variant font-feature-settings font-stretch font-weight font-style".split(" ")),y=F("additive-symbols fallback negative pad prefix range speak-as suffix symbols system".split(" ")),
D="aliceblue antiquewhite aqua aquamarine azure beige bisque black blanchedalmond blue blueviolet brown burlywood cadetblue chartreuse chocolate coral cornflowerblue cornsilk crimson cyan darkblue darkcyan darkgoldenrod darkgray darkgreen darkkhaki darkmagenta darkolivegreen darkorange darkorchid darkred darksalmon darkseagreen darkslateblue darkslategray darkturquoise darkviolet deeppink deepskyblue dimgray dodgerblue firebrick floralwhite forestgreen fuchsia gainsboro ghostwhite gold goldenrod gray grey green greenyellow honeydew hotpink indianred indigo ivory khaki lavender lavenderblush lawngreen lemonchiffon lightblue lightcoral lightcyan lightgoldenrodyellow lightgray lightgreen lightpink lightsalmon lightseagreen lightskyblue lightslategray lightsteelblue lightyellow lime limegreen linen magenta maroon mediumaquamarine mediumblue mediumorchid mediumpurple mediumseagreen mediumslateblue mediumspringgreen mediumturquoise mediumvioletred midnightblue mintcream mistyrose moccasin navajowhite navy oldlace olive olivedrab orange orangered orchid palegoldenrod palegreen paleturquoise palevioletred papayawhip peachpuff peru pink plum powderblue purple rebeccapurple red rosybrown royalblue saddlebrown salmon sandybrown seagreen seashell sienna silver skyblue slateblue slategray snow springgreen steelblue tan teal thistle tomato turquoise violet wheat white whitesmoke yellow yellowgreen".split(" "),
H=F(D),X="above absolute activeborder additive activecaption afar after-white-space ahead alias all all-scroll alphabetic alternate always amharic amharic-abegede antialiased appworkspace arabic-indic armenian asterisks attr auto auto-flow avoid avoid-column avoid-page avoid-region background backwards baseline below bidi-override binary bengali blink block block-axis bold bolder border border-box both bottom break break-all break-word bullets button button-bevel buttonface buttonhighlight buttonshadow buttontext calc cambodian capitalize caps-lock-indicator caption captiontext caret cell center checkbox circle cjk-decimal cjk-earthly-branch cjk-heavenly-stem cjk-ideographic clear clip close-quote col-resize collapse color color-burn color-dodge column column-reverse compact condensed contain content contents content-box context-menu continuous copy counter counters cover crop cross crosshair currentcolor cursive cyclic darken dashed decimal decimal-leading-zero default default-button dense destination-atop destination-in destination-out destination-over devanagari difference disc discard disclosure-closed disclosure-open document dot-dash dot-dot-dash dotted double down e-resize ease ease-in ease-in-out ease-out element ellipse ellipsis embed end ethiopic ethiopic-abegede ethiopic-abegede-am-et ethiopic-abegede-gez ethiopic-abegede-ti-er ethiopic-abegede-ti-et ethiopic-halehame-aa-er ethiopic-halehame-aa-et ethiopic-halehame-am-et ethiopic-halehame-gez ethiopic-halehame-om-et ethiopic-halehame-sid-et ethiopic-halehame-so-et ethiopic-halehame-ti-er ethiopic-halehame-ti-et ethiopic-halehame-tig ethiopic-numeric ew-resize exclusion expanded extends extra-condensed extra-expanded fantasy fast fill fixed flat flex flex-end flex-start footnotes forwards from geometricPrecision georgian graytext grid groove gujarati gurmukhi hand hangul hangul-consonant hard-light hebrew help hidden hide higher highlight highlighttext hiragana hiragana-iroha horizontal hsl hsla hue icon ignore inactiveborder inactivecaption inactivecaptiontext infinite infobackground infotext inherit initial inline inline-axis inline-block inline-flex inline-grid inline-table inset inside intrinsic invert italic japanese-formal japanese-informal justify kannada katakana katakana-iroha keep-all khmer korean-hangul-formal korean-hanja-formal korean-hanja-informal landscape lao large larger left level lighter lighten line-through linear linear-gradient lines list-item listbox listitem local logical loud lower lower-alpha lower-armenian lower-greek lower-hexadecimal lower-latin lower-norwegian lower-roman lowercase ltr luminosity malayalam match matrix matrix3d media-controls-background media-current-time-display media-fullscreen-button media-mute-button media-play-button media-return-to-realtime-button media-rewind-button media-seek-back-button media-seek-forward-button media-slider media-sliderthumb media-time-remaining-display media-volume-slider media-volume-slider-container media-volume-sliderthumb medium menu menulist menulist-button menulist-text menulist-textfield menutext message-box middle min-intrinsic mix mongolian monospace move multiple multiply myanmar n-resize narrower ne-resize nesw-resize no-close-quote no-drop no-open-quote no-repeat none normal not-allowed nowrap ns-resize numbers numeric nw-resize nwse-resize oblique octal opacity open-quote optimizeLegibility optimizeSpeed oriya oromo outset outside outside-shape overlay overline padding padding-box painted page paused persian perspective plus-darker plus-lighter pointer polygon portrait pre pre-line pre-wrap preserve-3d progress push-button radial-gradient radio read-only read-write read-write-plaintext-only rectangle region relative repeat repeating-linear-gradient repeating-radial-gradient repeat-x repeat-y reset reverse rgb rgba ridge right rotate rotate3d rotateX rotateY rotateZ round row row-resize row-reverse rtl run-in running s-resize sans-serif saturation scale scale3d scaleX scaleY scaleZ screen scroll scrollbar scroll-position se-resize searchfield searchfield-cancel-button searchfield-decoration searchfield-results-button searchfield-results-decoration semi-condensed semi-expanded separate serif show sidama simp-chinese-formal simp-chinese-informal single skew skewX skewY skip-white-space slide slider-horizontal slider-vertical sliderthumb-horizontal sliderthumb-vertical slow small small-caps small-caption smaller soft-light solid somali source-atop source-in source-out source-over space space-around space-between spell-out square square-button start static status-bar stretch stroke sub subpixel-antialiased super sw-resize symbolic symbols system-ui table table-caption table-cell table-column table-column-group table-footer-group table-header-group table-row table-row-group tamil telugu text text-bottom text-top textarea textfield thai thick thin threeddarkshadow threedface threedhighlight threedlightshadow threedshadow tibetan tigre tigrinya-er tigrinya-er-abegede tigrinya-et tigrinya-et-abegede to top trad-chinese-formal trad-chinese-informal transform translate translate3d translateX translateY translateZ transparent ultra-condensed ultra-expanded underline unset up upper-alpha upper-armenian upper-greek upper-hexadecimal upper-latin upper-norwegian upper-roman uppercase urdu url var vertical vertical-text visible visibleFill visiblePainted visibleStroke visual w-resize wait wave wider window windowframe windowtext words wrap wrap-reverse x-large x-small xor xx-large xx-small".split(" "),
O=F(X),v=v.concat(B).concat(w).concat(G).concat(q).concat(I).concat(D).concat(X);m.registerHelper("hintWords","css",v);m.defineMIME("text/css",{documentTypes:t,mediaTypes:z,mediaFeatures:r,mediaValueKeywords:h,propertyKeywords:e,nonStandardPropertyKeywords:g,fontProperties:p,counterDescriptors:y,colorKeywords:H,valueKeywords:O,tokenHooks:{"/":function(e,g){if(!e.eat("*"))return!1;g.tokenize=E;return E(e,g)}},name:"css"});m.defineMIME("text/x-scss",{mediaTypes:z,mediaFeatures:r,mediaValueKeywords:h,
propertyKeywords:e,nonStandardPropertyKeywords:g,colorKeywords:H,valueKeywords:O,fontProperties:p,allowNested:!0,lineComment:"//",tokenHooks:{"/":function(e,g){return e.eat("/")?(e.skipToEnd(),["comment","comment"]):e.eat("*")?(g.tokenize=E,E(e,g)):["operator","operator"]},":":function(e){return e.match(/\s*\{/,!1)?[null,null]:!1},$:function(e){e.match(/^[\w-]+/);return e.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"]},"#":function(e){return e.eat("{")?[null,"interpolation"]:
!1}},name:"css",helperType:"scss"});m.defineMIME("text/x-less",{mediaTypes:z,mediaFeatures:r,mediaValueKeywords:h,propertyKeywords:e,nonStandardPropertyKeywords:g,colorKeywords:H,valueKeywords:O,fontProperties:p,allowNested:!0,lineComment:"//",tokenHooks:{"/":function(e,g){return e.eat("/")?(e.skipToEnd(),["comment","comment"]):e.eat("*")?(g.tokenize=E,E(e,g)):["operator","operator"]},"@":function(e){if(e.eat("{"))return[null,"interpolation"];if(e.match(/^(charset|document|font-face|import|(-(moz|ms|o|webkit)-)?keyframes|media|namespace|page|supports)\b/,
!1))return!1;e.eatWhile(/[\w\\\-]/);return e.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"]},"&":function(){return["atom","atom"]}},name:"css",helperType:"less"});m.defineMIME("text/x-gss",{documentTypes:t,mediaTypes:z,mediaFeatures:r,propertyKeywords:e,nonStandardPropertyKeywords:g,fontProperties:p,counterDescriptors:y,colorKeywords:H,valueKeywords:O,supportsAtComponent:!0,tokenHooks:{"/":function(e,g){if(!e.eat("*"))return!1;g.tokenize=E;return E(e,g)}},name:"css",
helperType:"gss"})});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript"),require("../css/css")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../javascript/javascript","../css/css"],m):m(CodeMirror)})(function(m){function F(m){var r=z[m];return r?r:z[m]=new RegExp("\\s+"+m+"\\s*=\\s*('|\")?([^'\"]+)('|\")?\\s*")}function E(m,r){var w=m.match(F(r));return w?/^\s*(.*?)\s*$/.exec(w[2])[1]:""}
function v(m,r){for(var w in m)for(var h=r[w]||(r[w]=[]),q=m[w],e=q.length-1;0<=e;e--)h.unshift(q[e])}function t(m,r){for(var w=0;w<m.length;w++){var h=m[w];if(!h[0]||h[1].test(E(r,h[0])))return h[2]}}var B={script:[["lang",/(javascript|babel)/i,"javascript"],["type",/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^module$|^$/i,"javascript"],["type",/./,"text/plain"],[null,null,"javascript"]],style:[["lang",/^css$/i,"css"],["type",/^(text\/)?(x-)?(stylesheet|css)$/i,"css"],["type",/./,"text/plain"],
[null,null,"css"]]},z={};m.defineMode("htmlmixed",function(w,r){function z(e,p){var g=h.token(e,p.htmlState),r=/\btag\b/.test(g),v;if(r&&!/[<>\s\/]/.test(e.current())&&(v=p.htmlState.tagName&&p.htmlState.tagName.toLowerCase())&&q.hasOwnProperty(v))p.inTag=v+" ";else if(p.inTag&&r&&/>$/.test(e.current())){r=/^([\S]+) (.*)/.exec(p.inTag);p.inTag=null;v=">"==e.current()&&t(q[r[1]],r[2]);v=m.getMode(w,v);var B=new RegExp("^</s*"+r[1]+"s*>","i"),I=new RegExp("</s*"+r[1]+"s*>","i");p.token=function(e,g){if(e.match(B,
!1))return g.token=z,g.localState=g.localMode=null;var h=g.localMode.token(e,g.localState),p=e.current(),m=p.search(I);-1<m?e.backUp(p.length-m):p.match(/<\/?$/)&&(e.backUp(p.length),e.match(I,!1)||e.match(p));return h};p.localMode=v;p.localState=m.startState(v,h.indent(p.htmlState,""))}else p.inTag&&(p.inTag+=e.current(),e.eol()&&(p.inTag+=" "));return g}var h=m.getMode(w,{name:"xml",htmlMode:!0,multilineTagIndentFactor:r.multilineTagIndentFactor,multilineTagIndentPastTag:r.multilineTagIndentPastTag}),
q={},e=r&&r.tags,I=r&&r.scriptTypes;v(B,q);e&&v(e,q);if(I)for(e=I.length-1;0<=e;e--)q.script.unshift(["type",I[e].matches,I[e].mode]);return{startState:function(){var e=m.startState(h);return{token:z,inTag:null,localMode:null,localState:null,htmlState:e}},copyState:function(e){var g;e.localState&&(g=m.copyState(e.localMode,e.localState));return{token:e.token,inTag:e.inTag,localMode:e.localMode,localState:g,htmlState:m.copyState(h,e.htmlState)}},token:function(e,h){return h.token(e,h)},indent:function(e,
p){return!e.localMode||/^\s*<\//.test(p)?h.indent(e.htmlState,p):e.localMode.indent?e.localMode.indent(e.localState,p):m.Pass},innerMode:function(e){return{state:e.localState||e.htmlState,mode:e.localMode||h}}}},"xml","javascript","css");m.defineMIME("text/html","htmlmixed")});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror"),require("../fold/xml-fold")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],m):m(CodeMirror)})(function(m){function F(w){if(w.getOption("disableInput"))return m.Pass;for(var r=w.listSelections(),G=[],h=0;h<r.length;h++){if(!r[h].empty())return m.Pass;var q=r[h].head,e=w.getTokenAt(q),I=m.innerMode(w.getMode(),e.state),g=I.state;if("xml"!=I.mode.name||!g.tagName)return m.Pass;
var p=w.getOption("autoCloseTags"),y="html"==I.mode.configuration,I="object"==typeof p&&p.dontCloseTags||y&&B,y="object"==typeof p&&p.indentTags||y&&z,p=g.tagName;e.end>q.ch&&(p=p.slice(0,p.length-e.end+q.ch));var D=p.toLowerCase();if(!p||"string"==e.type&&(e.end!=q.ch||!/[\"\']/.test(e.string.charAt(e.string.length-1))||1==e.string.length)||"tag"==e.type&&"closeTag"==g.type||e.string.indexOf("/")==e.string.length-1||I&&-1<v(I,D)||t(w,p,q,g,!0))return m.Pass;e=y&&-1<v(y,D);G[h]={indent:e,text:">"+
(e?"\n\n":"")+"</"+p+">",newPos:e?m.Pos(q.line+1,0):m.Pos(q.line,q.ch+1)}}for(h=r.length-1;0<=h;h--)q=G[h],w.replaceRange(q.text,r[h].head,r[h].anchor,"+insert"),e=w.listSelections().slice(0),e[h]={head:q.newPos,anchor:q.newPos},w.setSelections(e),q.indent&&(w.indentLine(q.newPos.line,null,!0),w.indentLine(q.newPos.line+1,null,!0))}function E(w,r){for(var v=w.listSelections(),h=[],q=r?"/":"</",e=0;e<v.length;e++){if(!v[e].empty())return m.Pass;var z=v[e].head,g=w.getTokenAt(z),p=m.innerMode(w.getMode(),
g.state),y=p.state;if(r&&("string"==g.type||"<"!=g.string.charAt(0)||g.start!=z.ch-1))return m.Pass;if("xml"!=p.mode.name)if("htmlmixed"==w.getMode().name&&"javascript"==p.mode.name)p=q+"script";else if("htmlmixed"==w.getMode().name&&"css"==p.mode.name)p=q+"style";else return m.Pass;else{if(!y.context||!y.context.tagName||t(w,y.context.tagName,z,y))return m.Pass;p=q+y.context.tagName}">"!=w.getLine(z.line).charAt(g.end)&&(p+=">");h[e]=p}w.replaceSelections(h);v=w.listSelections();for(e=0;e<v.length;e++)(e==
v.length-1||v[e].head.line<v[e+1].head.line)&&w.indentLine(v[e].head.line)}function v(m,r){if(m.indexOf)return m.indexOf(r);for(var w=0,h=m.length;w<h;++w)if(m[w]==r)return w;return-1}function t(w,r,t,h,q){if(!m.scanForClosingTag)return!1;var e=Math.min(w.lastLine()+1,t.line+500);t=m.scanForClosingTag(w,t,null,e);if(!t||t.tag!=r)return!1;h=h.context;for(q=q?1:0;h&&h.tagName==r;h=h.prev)++q;t=t.to;for(h=1;h<q;h++){t=m.scanForClosingTag(w,t,null,e);if(!t||t.tag!=r)return!1;t=t.to}return!0}m.defineOption("autoCloseTags",
!1,function(w,r,t){t!=m.Init&&t&&w.removeKeyMap("autoCloseTags");if(r){t={name:"autoCloseTags"};if("object"!=typeof r||r.whenClosing)t["'/'"]=function(h){h=h.getOption("disableInput")?m.Pass:E(h,!0);return h};if("object"!=typeof r||r.whenOpening)t["'>'"]=function(h){return F(h)};w.addKeyMap(t)}});var B="area base br col command embed hr img input keygen link meta param source track wbr".split(" "),z="applet blockquote body button div dl fieldset form frameset h1 h2 h3 h4 h5 h6 head html iframe layer legend object ol p select table ul".split(" ");
m.commands.closeTag=function(m){return E(m)}});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],m):m(CodeMirror)})(function(m){function F(e,h){return"pairs"==h&&"string"==typeof e?e:"object"==typeof e&&null!=e[h]?e[h]:G[h]}function E(e){return function(g){return t(g,e)}}function v(e){var g=e.state.closeBrackets;return!g||g.override?g:e.getModeAt(e.getCursor()).closeBrackets||g}function t(e,p){var g=v(e);if(!g||e.getOption("disableInput"))return m.Pass;
var q=F(g,"pairs"),t=q.indexOf(p);if(-1==t)return m.Pass;for(var g=F(g,"triples"),z=q.charAt(t+1)==p,I=e.listSelections(),G=0==t%2,E,Q=0;Q<I.length;Q++){var ca=I[Q],R=ca.head,ga=e.getRange(R,h(R.line,R.ch+1));if(G&&!ca.empty())ca="surround";else if(!z&&G||ga!=p)if(z&&1<R.ch&&0<=g.indexOf(p)&&e.getRange(h(R.line,R.ch-2),R)==p+p&&(2>=R.ch||e.getRange(h(R.line,R.ch-3),h(R.line,R.ch-2))!=p))ca="addFour";else if(z)if(!m.isWordChar(ga)&&w(e,R,p))ca="both";else return m.Pass;else if(G&&(e.getLine(R.line).length==
R.ch||B(ga,q)||/\s/.test(ga)))ca="both";else return m.Pass;else ca=z&&r(e,R)?"both":0<=g.indexOf(p)&&e.getRange(R,h(R.line,R.ch+3))==p+p+p?"skipThree":"skip";if(!E)E=ca;else if(E!=ca)return m.Pass}var C=t%2?q.charAt(t-1):p,ba=t%2?p:q.charAt(t+1);e.operation(function(){if("skip"==E)e.execCommand("goCharRight");else if("skipThree"==E)for(var g=0;3>g;g++)e.execCommand("goCharRight");else if("surround"==E){for(var p=e.getSelections(),g=0;g<p.length;g++)p[g]=C+p[g]+ba;e.replaceSelections(p,"around");p=
e.listSelections().slice();for(g=0;g<p.length;g++){var q=p,r=g,t;t=p[g];var w=0<m.cmpPos(t.anchor,t.head);t={anchor:new h(t.anchor.line,t.anchor.ch+(w?-1:1)),head:new h(t.head.line,t.head.ch+(w?1:-1))};q[r]=t}e.setSelections(p)}else"both"==E?(e.replaceSelection(C+ba,null),e.triggerElectric(C+ba),e.execCommand("goCharLeft")):"addFour"==E&&(e.replaceSelection(C+C+C+C,"before"),e.execCommand("goCharRight"))})}function B(e,h){var g=h.lastIndexOf(e);return-1<g&&1==g%2}function z(e,p){var g=e.getRange(h(p.line,
p.ch-1),h(p.line,p.ch+1));return 2==g.length?g:null}function w(e,h,q){var g=e.getLine(h.line),p=e.getTokenAt(h);if(/\bstring2?\b/.test(p.type)||r(e,h))return!1;q=new m.StringStream(g.slice(0,h.ch)+q+g.slice(h.ch),4);for(q.pos=q.start=p.start;;){g=e.getMode().token(q,p.state);if(q.pos>=h.ch+1)return/\bstring2?\b/.test(g);q.start=q.pos}}function r(e,p){var g=e.getTokenAt(h(p.line,p.ch+1));return/\bstring/.test(g.type)&&g.start==p.ch}var G={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},h=m.Pos;m.defineOption("autoCloseBrackets",
!1,function(g,h,q){q&&q!=m.Init&&(g.removeKeyMap(e),g.state.closeBrackets=null);h&&(g.state.closeBrackets=h,g.addKeyMap(e))});for(var q=G.pairs+"`",e={Backspace:function(e){var g=v(e);if(!g||e.getOption("disableInput"))return m.Pass;for(var q=F(g,"pairs"),g=e.listSelections(),r=0;r<g.length;r++){if(!g[r].empty())return m.Pass;var t=z(e,g[r].head);if(!t||0!=q.indexOf(t)%2)return m.Pass}for(r=g.length-1;0<=r;r--)q=g[r].head,e.replaceRange("",h(q.line,q.ch-1),h(q.line,q.ch+1),"+delete")},Enter:function(e){var g=
v(e),g=g&&F(g,"explode");if(!g||e.getOption("disableInput"))return m.Pass;for(var h=e.listSelections(),q=0;q<h.length;q++){if(!h[q].empty())return m.Pass;var r=z(e,h[q].head);if(!r||0!=g.indexOf(r)%2)return m.Pass}e.operation(function(){e.replaceSelection("\n\n",null);e.execCommand("goCharLeft");h=e.listSelections();for(var g=0;g<h.length;g++){var p=h[g].head.line;e.indentLine(p,null,!0);e.indentLine(p+1,null,!0)}})}},I=0;I<q.length;I++)e["'"+q.charAt(I)+"'"]=E(q.charAt(I))});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],m):m(CodeMirror)})(function(m){function F(m){m.state.selectionPointer.rects=null;E(m)}function E(m){m.state.selectionPointer.willUpdate||(m.state.selectionPointer.willUpdate=!0,setTimeout(function(){var t=m.state.selectionPointer;if(t){if(null==t.rects&&null!=t.mouseX&&(t.rects=[],m.somethingSelected()))for(var v=m.display.selectionDiv.firstChild;v;v=
v.nextSibling)t.rects.push(v.getBoundingClientRect());v=!1;if(null!=t.mouseX)for(var z=0;z<t.rects.length;z++){var w=t.rects[z];w.left<=t.mouseX&&w.right>=t.mouseX&&w.top<=t.mouseY&&w.bottom>=t.mouseY&&(v=!0)}t=v?t.value:"";m.display.lineDiv.style.cursor!=t&&(m.display.lineDiv.style.cursor=t)}m.state.selectionPointer.willUpdate=!1},50))}m.defineOption("selectionPointer",!1,function(v,t){var B=v.state.selectionPointer;B&&(m.off(v.getWrapperElement(),"mousemove",B.mousemove),m.off(v.getWrapperElement(),
"mouseout",B.mouseout),m.off(window,"scroll",B.windowScroll),v.off("cursorActivity",F),v.off("scroll",F),v.state.selectionPointer=null,v.display.lineDiv.style.cursor="");t&&(B=v.state.selectionPointer={value:"string"==typeof t?t:"default",mousemove:function(m){var t=v.state.selectionPointer;(null==m.buttons?m.which:m.buttons)?t.mouseX=t.mouseY=null:(t.mouseX=m.clientX,t.mouseY=m.clientY);E(v)},mouseout:function(m){v.getWrapperElement().contains(m.relatedTarget)||(m=v.state.selectionPointer,m.mouseX=
m.mouseY=null,E(v))},windowScroll:function(){F(v)},rects:null,mouseX:null,mouseY:null,willUpdate:!1},m.on(v.getWrapperElement(),"mousemove",B.mousemove),m.on(v.getWrapperElement(),"mouseout",B.mouseout),m.on(window,"scroll",B.windowScroll),v.on("cursorActivity",F),v.on("scroll",F))})});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror"),require("../fold/xml-fold")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],m):m(CodeMirror)})(function(m){function F(m){m.state.tagHit&&m.state.tagHit.clear();m.state.tagOther&&m.state.tagOther.clear();m.state.tagHit=m.state.tagOther=null}function E(t){t.state.failedTagMatch=!1;t.operation(function(){F(t);if(!t.somethingSelected()){var v=t.getCursor(),z=t.getViewport();
z.from=Math.min(z.from,v.line);z.to=Math.max(v.line+1,z.to);if(v=m.findMatchingTag(t,v,z))t.state.matchBothTags&&(z="open"==v.at?v.open:v.close)&&(t.state.tagHit=t.markText(z.from,z.to,{className:"CodeMirror-matchingtag"})),(v="close"==v.at?v.open:v.close)?t.state.tagOther=t.markText(v.from,v.to,{className:"CodeMirror-matchingtag"}):t.state.failedTagMatch=!0}})}function v(m){m.state.failedTagMatch&&E(m)}m.defineOption("matchTags",!1,function(t,B,z){z&&z!=m.Init&&(t.off("cursorActivity",E),t.off("viewportChange",
v),F(t));B&&(t.state.matchBothTags="object"==typeof B&&B.bothTags,t.on("cursorActivity",E),t.on("viewportChange",v),E(t))});m.commands.toMatchingTag=function(t){var v=m.findMatchingTag(t,t.getCursor());v&&(v="close"==v.at?v.open:v.close)&&t.extendSelection(v.to,v.from)}});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],m):m(CodeMirror)})(function(m){function F(e,h,g,m){this.line=h;this.ch=g;this.cm=e;this.text=e.getLine(h);this.min=m?Math.max(m.from,e.firstLine()):e.firstLine();this.max=m?Math.min(m.to-1,e.lastLine()):e.lastLine()}function E(e,m){var g=e.cm.getTokenTypeAt(h(e.line,m));return g&&/\btag\b/.test(g)}function v(e){if(!(e.line>=e.max))return e.ch=
0,e.text=e.cm.getLine(++e.line),!0}function t(e){if(!(e.line<=e.min))return e.text=e.cm.getLine(--e.line),e.ch=e.text.length,!0}function B(e){for(;;){var h=e.text.indexOf(">",e.ch);if(-1==h)if(v(e))continue;else break;if(E(e,h+1)){var g=e.text.lastIndexOf("/",h),g=-1<g&&!/\S/.test(e.text.slice(g+1,h));e.ch=h+1;return g?"selfClose":"regular"}e.ch=h+1}}function z(e){for(;;){var h=e.ch?e.text.lastIndexOf("<",e.ch-1):-1;if(-1==h)if(t(e))continue;else break;if(E(e,h+1)){q.lastIndex=h;e.ch=h;var g=q.exec(e.text);
if(g&&g.index==h)return g}else e.ch=h}}function w(e){for(;;){q.lastIndex=e.ch;var h=q.exec(e.text);if(!h)if(v(e))continue;else break;if(E(e,h.index+1))return e.ch=h.index+h[0].length,h;e.ch=h.index+1}}function r(e,m){for(var g=[];;){var p=w(e),q,r=e.line,t=e.ch-(p?p[0].length:0);if(!p||!(q=B(e)))break;if("selfClose"!=q)if(p[1]){for(var v=g.length-1;0<=v;--v)if(g[v]==p[2]){g.length=v;break}if(0>v&&(!m||m==p[2]))return{tag:p[2],from:h(r,t),to:h(e.line,e.ch)}}else g.push(p[2])}}function G(e,m){for(var g=
[];;){var p;a:for(p=e;;){var q=p.ch?p.text.lastIndexOf(">",p.ch-1):-1;if(-1==q)if(t(p))continue;else{p=void 0;break a}if(E(p,q+1)){var r=p.text.lastIndexOf("/",q),r=-1<r&&!/\S/.test(p.text.slice(r+1,q));p.ch=q+1;p=r?"selfClose":"regular";break a}else p.ch=q}if(!p)break;if("selfClose"==p)z(e);else{p=e.line;q=e.ch;r=z(e);if(!r)break;if(r[1])g.push(r[2]);else{for(var v=g.length-1;0<=v;--v)if(g[v]==r[2]){g.length=v;break}if(0>v&&(!m||m==r[2]))return{tag:r[2],from:h(e.line,e.ch),to:h(p,q)}}}}}var h=m.Pos,
q=RegExp("<(/?)([A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD-:.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*)","g");m.registerHelper("fold","xml",function(e,m){for(var g=new F(e,m.line,0);;){var p=w(g),
q;if(!p||g.line!=m.line||!(q=B(g)))break;if(!p[1]&&"selfClose"!=q)return q=h(g.line,g.ch),(g=r(g,p[2]))&&{from:q,to:g.from}}});m.findMatchingTag=function(e,m,g){var p=new F(e,m.line,m.ch,g);if(-1!=p.text.indexOf(">")||-1!=p.text.indexOf("<")){var q=B(p),t=q&&h(p.line,p.ch),v=q&&z(p);if(q&&v&&!(0<(p.line-m.line||p.ch-m.ch))){m={from:h(p.line,p.ch),to:t,tag:v[2]};if("selfClose"==q)return{open:m,close:null,at:"open"};if(v[1])return{open:G(p,v[2]),close:m,at:"close"};p=new F(e,t.line,t.ch,g);return{open:m,
close:r(p,v[2]),at:"open"}}}};m.findEnclosingTag=function(e,h,g,m){for(var p=new F(e,h.line,h.ch,g);;){var q=G(p,m);if(!q)break;var t=new F(e,h.line,h.ch,g);if(t=r(t,q.tag))return{open:q,close:t}}};m.scanForClosingTag=function(e,h,g,m){e=new F(e,h.line,h.ch,m?{from:0,to:m}:null);return r(e,g)}});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],m):m(CodeMirror)})(function(m){function F(m){for(var t=0;t<m.state.activeLines.length;t++)m.removeLineClass(m.state.activeLines[t],"wrap","CodeMirror-activeline"),m.removeLineClass(m.state.activeLines[t],"background","CodeMirror-activeline-background"),m.removeLineClass(m.state.activeLines[t],"gutter","CodeMirror-activeline-gutter")}
function E(m,t){if(m.length!=t.length)return!1;for(var v=0;v<m.length;v++)if(m[v]!=t[v])return!1;return!0}function v(m,t){for(var v=[],r=0;r<t.length;r++){var z=t[r],h=m.getOption("styleActiveLine");if("object"==typeof h&&h.nonEmpty?z.anchor.line==z.head.line:z.empty())z=m.getLineHandleVisualStart(z.head.line),v[v.length-1]!=z&&v.push(z)}E(m.state.activeLines,v)||m.operation(function(){F(m);for(var h=0;h<v.length;h++)m.addLineClass(v[h],"wrap","CodeMirror-activeline"),m.addLineClass(v[h],"background",
"CodeMirror-activeline-background"),m.addLineClass(v[h],"gutter","CodeMirror-activeline-gutter");m.state.activeLines=v})}function t(m,t){v(m,t.ranges)}m.defineOption("styleActiveLine",!1,function(B,z,w){w=w==m.Init?!1:w;z!=w&&(w&&(B.off("beforeSelectionChange",t),F(B),delete B.state.activeLines),z&&(B.state.activeLines=[],v(B,B.listSelections()),B.on("beforeSelectionChange",t)))})});
(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],m):m(CodeMirror)})(function(m){function F(m){m.state.placeholder&&(m.state.placeholder.parentNode.removeChild(m.state.placeholder),m.state.placeholder=null)}function E(m){F(m);var t=m.state.placeholder=document.createElement("pre");t.style.cssText="height: 0; overflow: visible";t.className="CodeMirror-placeholder";var r=m.getOption("placeholder");
"string"==typeof r&&(r=document.createTextNode(r));t.appendChild(r);m.display.lineSpace.insertBefore(t,m.display.lineSpace.firstChild)}function v(m){B(m)&&E(m)}function t(m){var t=m.getWrapperElement(),r=B(m);t.className=t.className.replace(" CodeMirror-empty","")+(r?" CodeMirror-empty":"");r?E(m):F(m)}function B(m){return 1===m.lineCount()&&""===m.getLine(0)}m.defineOption("placeholder","",function(z,w,r){r=r&&r!=m.Init;w&&!r?(z.on("blur",v),z.on("change",t),z.on("swapDoc",t),t(z)):!w&&r&&(z.off("blur",
v),z.off("change",t),z.off("swapDoc",t),F(z),r=z.getWrapperElement(),r.className=r.className.replace(" CodeMirror-empty",""));w&&!z.hasFocus()&&v(z)})});




// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";

  var HINT_ELEMENT_CLASS        = "CodeMirror-hint";
  var ACTIVE_HINT_ELEMENT_CLASS = "CodeMirror-hint-active";

  // This is the old interface, kept around for now to stay
  // backwards-compatible.
  CodeMirror.showHint = function(cm, getHints, options) {
    if (!getHints) return cm.showHint(options);
    if (options && options.async) getHints.async = true;
    var newOpts = {hint: getHints};
    if (options) for (var prop in options) newOpts[prop] = options[prop];
    return cm.showHint(newOpts);
  };

  CodeMirror.defineExtension("showHint", function(options) {
    options = parseOptions(this, this.getCursor("start"), options);
    var selections = this.listSelections()
    if (selections.length > 1) return;
    // By default, don't allow completion when something is selected.
    // A hint function can have a `supportsSelection` property to
    // indicate that it can handle selections.
    if (this.somethingSelected()) {
      if (!options.hint.supportsSelection) return;
      // Don't try with cross-line selections
      for (var i = 0; i < selections.length; i++)
        if (selections[i].head.line != selections[i].anchor.line) return;
    }

    if (this.state.completionActive) this.state.completionActive.close();
    var completion = this.state.completionActive = new Completion(this, options);
    if (!completion.options.hint) return;

    CodeMirror.signal(this, "startCompletion", this);
    completion.update(true);
  });

  function Completion(cm, options) {
    this.cm = cm;
    this.options = options;
    this.widget = null;
    this.debounce = 0;
    this.tick = 0;
    this.startPos = this.cm.getCursor("start");
    this.startLen = this.cm.getLine(this.startPos.line).length - this.cm.getSelection().length;

    var self = this;
    cm.on("cursorActivity", this.activityFunc = function() { self.cursorActivity(); });
  }

  var requestAnimationFrame = window.requestAnimationFrame || function(fn) {
    return setTimeout(fn, 1000/60);
  };
  var cancelAnimationFrame = window.cancelAnimationFrame || clearTimeout;

  Completion.prototype = {
    close: function() {
      if (!this.active()) return;
      this.cm.state.completionActive = null;
      this.tick = null;
      this.cm.off("cursorActivity", this.activityFunc);

      if (this.widget && this.data) CodeMirror.signal(this.data, "close");
      if (this.widget) this.widget.close();
      CodeMirror.signal(this.cm, "endCompletion", this.cm);
    },

    active: function() {
      return this.cm.state.completionActive == this;
    },

    pick: function(data, i) {
      var completion = data.list[i];
      if (completion.hint) completion.hint(this.cm, data, completion);
      else this.cm.replaceRange(getText(completion), completion.from || data.from,
                                completion.to || data.to, "complete");
      CodeMirror.signal(data, "pick", completion);
      this.close();
    },

    cursorActivity: function() {
      if (this.debounce) {
        cancelAnimationFrame(this.debounce);
        this.debounce = 0;
      }

      var pos = this.cm.getCursor(), line = this.cm.getLine(pos.line);
      if (pos.line != this.startPos.line || line.length - pos.ch != this.startLen - this.startPos.ch ||
          pos.ch < this.startPos.ch || this.cm.somethingSelected() ||
          (pos.ch && this.options.closeCharacters.test(line.charAt(pos.ch - 1)))) {
        this.close();
      } else {
        var self = this;
        this.debounce = requestAnimationFrame(function() {self.update();});
        if (this.widget) this.widget.disable();
      }
    },

    update: function(first) {
      if (this.tick == null) return
      var self = this, myTick = ++this.tick
      fetchHints(this.options.hint, this.cm, this.options, function(data) {
        if (self.tick == myTick) self.finishUpdate(data, first)
      })
    },

    finishUpdate: function(data, first) {
      if (this.data) CodeMirror.signal(this.data, "update");

      var picked = (this.widget && this.widget.picked) || (first && this.options.completeSingle);
      if (this.widget) this.widget.close();

      this.data = data;

      if (data && data.list.length) {
        if (picked && data.list.length == 1) {
          this.pick(data, 0);
        } else {
          this.widget = new Widget(this, data);
          CodeMirror.signal(data, "shown");
        }
      }
    }
  };

  function parseOptions(cm, pos, options) {
    var editor = cm.options.hintOptions;
    var out = {};
    for (var prop in defaultOptions) out[prop] = defaultOptions[prop];
    if (editor) for (var prop in editor)
      if (editor[prop] !== undefined) out[prop] = editor[prop];
    if (options) for (var prop in options)
      if (options[prop] !== undefined) out[prop] = options[prop];
    if (out.hint.resolve) out.hint = out.hint.resolve(cm, pos)
    return out;
  }

  function getText(completion) {
    if (typeof completion == "string") return completion;
    else return completion.text;
  }

  function buildKeyMap(completion, handle) {
    var baseMap = {
      Up: function() {handle.moveFocus(-1);},
      Down: function() {handle.moveFocus(1);},
      PageUp: function() {handle.moveFocus(-handle.menuSize() + 1, true);},
      PageDown: function() {handle.moveFocus(handle.menuSize() - 1, true);},
      Home: function() {handle.setFocus(0);},
      End: function() {handle.setFocus(handle.length - 1);},
      Enter: handle.pick,
      Tab: handle.pick,
      Esc: handle.close
    };
    var custom = completion.options.customKeys;
    var ourMap = custom ? {} : baseMap;
    function addBinding(key, val) {
      var bound;
      if (typeof val != "string")
        bound = function(cm) { return val(cm, handle); };
      // This mechanism is deprecated
      else if (baseMap.hasOwnProperty(val))
        bound = baseMap[val];
      else
        bound = val;
      ourMap[key] = bound;
    }
    if (custom)
      for (var key in custom) if (custom.hasOwnProperty(key))
        addBinding(key, custom[key]);
    var extra = completion.options.extraKeys;
    if (extra)
      for (var key in extra) if (extra.hasOwnProperty(key))
        addBinding(key, extra[key]);
    return ourMap;
  }

  function getHintElement(hintsElement, el) {
    while (el && el != hintsElement) {
      if (el.nodeName.toUpperCase() === "LI" && el.parentNode == hintsElement) return el;
      el = el.parentNode;
    }
  }

  function Widget(completion, data) {
    this.completion = completion;
    this.data = data;
    this.picked = false;
    var widget = this, cm = completion.cm;

    var hints = this.hints = document.createElement("ul");
    hints.className = "CodeMirror-hints";
    this.selectedHint = data.selectedHint || 0;

    var completions = data.list;
    for (var i = 0; i < completions.length; ++i) {
      var elt = hints.appendChild(document.createElement("li")), cur = completions[i];
      var className = HINT_ELEMENT_CLASS + (i != this.selectedHint ? "" : " " + ACTIVE_HINT_ELEMENT_CLASS);
      if (cur.className != null) className = cur.className + " " + className;
      elt.className = className;
      if (cur.render) cur.render(elt, data, cur);
      else elt.appendChild(document.createTextNode(cur.displayText || getText(cur)));
      elt.hintId = i;
    }

    var pos = cm.cursorCoords(completion.options.alignWithWord ? data.from : null);
    var left = pos.left, top = pos.bottom, below = true;
    hints.style.left = left + "px";
    hints.style.top = top + "px";
    // If we're at the edge of the screen, then we want the menu to appear on the left of the cursor.
    var winW = window.innerWidth || Math.max(document.body.offsetWidth, document.documentElement.offsetWidth);
    var winH = window.innerHeight || Math.max(document.body.offsetHeight, document.documentElement.offsetHeight);
    (completion.options.container || document.body).appendChild(hints);
    var box = hints.getBoundingClientRect(), overlapY = box.bottom - winH;
    var scrolls = hints.scrollHeight > hints.clientHeight + 1
    var startScroll = cm.getScrollInfo();

    if (overlapY > 0) {
      var height = box.bottom - box.top, curTop = pos.top - (pos.bottom - box.top);
      if (curTop - height > 0) { // Fits above cursor
        hints.style.top = (top = pos.top - height) + "px";
        below = false;
      } else if (height > winH) {
        hints.style.height = (winH - 5) + "px";
        hints.style.top = (top = pos.bottom - box.top) + "px";
        var cursor = cm.getCursor();
        if (data.from.ch != cursor.ch) {
          pos = cm.cursorCoords(cursor);
          hints.style.left = (left = pos.left) + "px";
          box = hints.getBoundingClientRect();
        }
      }
    }
    var overlapX = box.right - winW;
    if (overlapX > 0) {
      if (box.right - box.left > winW) {
        hints.style.width = (winW - 5) + "px";
        overlapX -= (box.right - box.left) - winW;
      }
      hints.style.left = (left = pos.left - overlapX) + "px";
    }
    if (scrolls) for (var node = hints.firstChild; node; node = node.nextSibling)
      node.style.paddingRight = cm.display.nativeBarWidth + "px"

    cm.addKeyMap(this.keyMap = buildKeyMap(completion, {
      moveFocus: function(n, avoidWrap) { widget.changeActive(widget.selectedHint + n, avoidWrap); },
      setFocus: function(n) { widget.changeActive(n); },
      menuSize: function() { return widget.screenAmount(); },
      length: completions.length,
      close: function() { completion.close(); },
      pick: function() { widget.pick(); },
      data: data
    }));

    if (completion.options.closeOnUnfocus) {
      var closingOnBlur;
      cm.on("blur", this.onBlur = function() { closingOnBlur = setTimeout(function() { completion.close(); }, 100); });
      cm.on("focus", this.onFocus = function() { clearTimeout(closingOnBlur); });
    }

    cm.on("scroll", this.onScroll = function() {
      var curScroll = cm.getScrollInfo(), editor = cm.getWrapperElement().getBoundingClientRect();
      var newTop = top + startScroll.top - curScroll.top;
      var point = newTop - (window.pageYOffset || (document.documentElement || document.body).scrollTop);
      if (!below) point += hints.offsetHeight;
      if (point <= editor.top || point >= editor.bottom) return completion.close();
      hints.style.top = newTop + "px";
      hints.style.left = (left + startScroll.left - curScroll.left) + "px";
    });

    CodeMirror.on(hints, "dblclick", function(e) {
      var t = getHintElement(hints, e.target || e.srcElement);
      if (t && t.hintId != null) {widget.changeActive(t.hintId); widget.pick();}
    });

    CodeMirror.on(hints, "click", function(e) {
      var t = getHintElement(hints, e.target || e.srcElement);
      if (t && t.hintId != null) {
        widget.changeActive(t.hintId);
        if (completion.options.completeOnSingleClick) widget.pick();
      }
    });

    CodeMirror.on(hints, "mousedown", function() {
      setTimeout(function(){cm.focus();}, 20);
    });

    CodeMirror.signal(data, "select", completions[this.selectedHint], hints.childNodes[this.selectedHint]);
    return true;
  }

  Widget.prototype = {
    close: function() {
      if (this.completion.widget != this) return;
      this.completion.widget = null;
      this.hints.parentNode.removeChild(this.hints);
      this.completion.cm.removeKeyMap(this.keyMap);

      var cm = this.completion.cm;
      if (this.completion.options.closeOnUnfocus) {
        cm.off("blur", this.onBlur);
        cm.off("focus", this.onFocus);
      }
      cm.off("scroll", this.onScroll);
    },

    disable: function() {
      this.completion.cm.removeKeyMap(this.keyMap);
      var widget = this;
      this.keyMap = {Enter: function() { widget.picked = true; }};
      this.completion.cm.addKeyMap(this.keyMap);
    },

    pick: function() {
      this.completion.pick(this.data, this.selectedHint);
    },

    changeActive: function(i, avoidWrap) {
      if (i >= this.data.list.length)
        i = avoidWrap ? this.data.list.length - 1 : 0;
      else if (i < 0)
        i = avoidWrap ? 0  : this.data.list.length - 1;
      if (this.selectedHint == i) return;
      var node = this.hints.childNodes[this.selectedHint];
      node.className = node.className.replace(" " + ACTIVE_HINT_ELEMENT_CLASS, "");
      node = this.hints.childNodes[this.selectedHint = i];
      node.className += " " + ACTIVE_HINT_ELEMENT_CLASS;
      if (node.offsetTop < this.hints.scrollTop)
        this.hints.scrollTop = node.offsetTop - 3;
      else if (node.offsetTop + node.offsetHeight > this.hints.scrollTop + this.hints.clientHeight)
        this.hints.scrollTop = node.offsetTop + node.offsetHeight - this.hints.clientHeight + 3;
      CodeMirror.signal(this.data, "select", this.data.list[this.selectedHint], node);
    },

    screenAmount: function() {
      return Math.floor(this.hints.clientHeight / this.hints.firstChild.offsetHeight) || 1;
    }
  };

  function applicableHelpers(cm, helpers) {
    if (!cm.somethingSelected()) return helpers
    var result = []
    for (var i = 0; i < helpers.length; i++)
      if (helpers[i].supportsSelection) result.push(helpers[i])
    return result
  }

  function fetchHints(hint, cm, options, callback) {
    if (hint.async) {
      hint(cm, callback, options)
    } else {
      var result = hint(cm, options)
      if (result && result.then) result.then(callback)
      else callback(result)
    }
  }

  function resolveAutoHints(cm, pos) {
    var helpers = cm.getHelpers(pos, "hint"), words
    if (helpers.length) {
      var resolved = function(cm, callback, options) {
        var app = applicableHelpers(cm, helpers);
        function run(i) {
          if (i == app.length) return callback(null)
          fetchHints(app[i], cm, options, function(result) {
            if (result && result.list.length > 0) callback(result)
            else run(i + 1)
          })
        }
        run(0)
      }
      resolved.async = true
      resolved.supportsSelection = true
      return resolved
    } else if (words = cm.getHelper(cm.getCursor(), "hintWords")) {
      return function(cm) { return CodeMirror.hint.fromList(cm, {words: words}) }
    } else if (CodeMirror.hint.anyword) {
      return function(cm, options) { return CodeMirror.hint.anyword(cm, options) }
    } else {
      return function() {}
    }
  }

  CodeMirror.registerHelper("hint", "auto", {
    resolve: resolveAutoHints
  });

  CodeMirror.registerHelper("hint", "fromList", function(cm, options) {
    var cur = cm.getCursor(), token = cm.getTokenAt(cur);
    var to = CodeMirror.Pos(cur.line, token.end);
    if (token.string && /\w/.test(token.string[token.string.length - 1])) {
      var term = token.string, from = CodeMirror.Pos(cur.line, token.start);
    } else {
      var term = "", from = to;
    }
    var found = [];
    for (var i = 0; i < options.words.length; i++) {
      var word = options.words[i];
      if (word.slice(0, term.length) == term)
        found.push(word);
    }

    if (found.length) return {list: found, from: from, to: to};
  });

  CodeMirror.commands.autocomplete = CodeMirror.showHint;

  var defaultOptions = {
    hint: CodeMirror.hint.auto,
    completeSingle: true,
    alignWithWord: true,
    closeCharacters: /[\s()\[\]{};:>,]/,
    closeOnUnfocus: true,
    completeOnSingleClick: true,
    container: null,
    customKeys: null,
    extraKeys: null
  };

  CodeMirror.defineOption("hintOptions", null);
});



// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  var Pos = CodeMirror.Pos;

  function forEach(arr, f) {
    for (var i = 0, e = arr.length; i < e; ++i) f(arr[i]);
  }

  function arrayContains(arr, item) {
    if (!Array.prototype.indexOf) {
      var i = arr.length;
      while (i--) {
        if (arr[i] === item) {
          return true;
        }
      }
      return false;
    }
    return arr.indexOf(item) != -1;
  }

  function scriptHint(editor, keywords, getToken, options) {
    // Find the token at the cursor
    var cur = editor.getCursor(), token = getToken(editor, cur);
    if (/\b(?:string|comment)\b/.test(token.type)) return;
    token.state = CodeMirror.innerMode(editor.getMode(), token.state).state;

    // If it's not a 'word-style' token, ignore the token.
    if (!/^[\w$_]*$/.test(token.string)) {
      token = {start: cur.ch, end: cur.ch, string: "", state: token.state,
               type: token.string == "." ? "property" : null};
    } else if (token.end > cur.ch) {
      token.end = cur.ch;
      token.string = token.string.slice(0, cur.ch - token.start);
    }

    var tprop = token;
    // If it is a property, find out what it is a property of.
    while (tprop.type == "property") {
      tprop = getToken(editor, Pos(cur.line, tprop.start));
      if (tprop.string != ".") return;
      tprop = getToken(editor, Pos(cur.line, tprop.start));
      if (!context) var context = [];
      context.push(tprop);
    }
    return {list: getCompletions(token, context, keywords, options),
            from: Pos(cur.line, token.start),
            to: Pos(cur.line, token.end)};
  }

  function javascriptHint(editor, options) {
    return scriptHint(editor, javascriptKeywords,
                      function (e, cur) {return e.getTokenAt(cur);},
                      options);
  };
  CodeMirror.registerHelper("hint", "javascript", javascriptHint);

  function getCoffeeScriptToken(editor, cur) {
  // This getToken, it is for coffeescript, imitates the behavior of
  // getTokenAt method in javascript.js, that is, returning "property"
  // type and treat "." as indepenent token.
    var token = editor.getTokenAt(cur);
    if (cur.ch == token.start + 1 && token.string.charAt(0) == '.') {
      token.end = token.start;
      token.string = '.';
      token.type = "property";
    }
    else if (/^\.[\w$_]*$/.test(token.string)) {
      token.type = "property";
      token.start++;
      token.string = token.string.replace(/\./, '');
    }
    return token;
  }

  function coffeescriptHint(editor, options) {
    return scriptHint(editor, coffeescriptKeywords, getCoffeeScriptToken, options);
  }
  CodeMirror.registerHelper("hint", "coffeescript", coffeescriptHint);

  var stringProps = ("charAt charCodeAt indexOf lastIndexOf substring substr slice trim trimLeft trimRight " +
                     "toUpperCase toLowerCase split concat match replace search").split(" ");
  var arrayProps = ("length concat join splice push pop shift unshift slice reverse sort indexOf " +
                    "lastIndexOf every some filter forEach map reduce reduceRight ").split(" ");
  var funcProps = "prototype apply call bind".split(" ");
  var javascriptKeywords = ("break case catch continue debugger default delete do else false finally for function " +
                  "if in instanceof new null return switch throw true try typeof var void while with").split(" ");
  var coffeescriptKeywords = ("and break catch class continue delete do else extends false finally for " +
                  "if in instanceof isnt new no not null of off on or return switch then throw true try typeof until void while with yes").split(" ");

  function forAllProps(obj, callback) {
    if (!Object.getOwnPropertyNames || !Object.getPrototypeOf) {
      for (var name in obj) callback(name)
    } else {
      for (var o = obj; o; o = Object.getPrototypeOf(o))
        Object.getOwnPropertyNames(o).forEach(callback)
    }
  }

  function getCompletions(token, context, keywords, options) {
    var found = [], start = token.string, global = options && options.globalScope || window;
    function maybeAdd(str) {
      if (str.lastIndexOf(start, 0) == 0 && !arrayContains(found, str)) found.push(str);
    }
    function gatherCompletions(obj) {
      if (typeof obj == "string") forEach(stringProps, maybeAdd);
      else if (obj instanceof Array) forEach(arrayProps, maybeAdd);
      else if (obj instanceof Function) forEach(funcProps, maybeAdd);
      forAllProps(obj, maybeAdd)
    }

    if (context && context.length) {
      // If this is a property, see if it belongs to some object we can
      // find in the current environment.
      var obj = context.pop(), base;
      if (obj.type && obj.type.indexOf("variable") === 0) {
        if (options && options.additionalContext)
          base = options.additionalContext[obj.string];
        if (!options || options.useGlobalScope !== false)
          base = base || global[obj.string];
      } else if (obj.type == "string") {
        base = "";
      } else if (obj.type == "atom") {
        base = 1;
      } else if (obj.type == "function") {
        if (global.jQuery != null && (obj.string == '$' || obj.string == 'jQuery') &&
            (typeof global.jQuery == 'function'))
          base = global.jQuery();
        else if (global._ != null && (obj.string == '_') && (typeof global._ == 'function'))
          base = global._();
      }
      while (base != null && context.length)
        base = base[context.pop().string];
      if (base != null) gatherCompletions(base);
    } else {
      // If not, just look in the global object and any local scope
      // (reading into JS mode internals to get at the local and global variables)
      for (var v = token.state.localVars; v; v = v.next) maybeAdd(v.name);
      for (var v = token.state.globalVars; v; v = v.next) maybeAdd(v.name);
      if (!options || options.useGlobalScope !== false)
        gatherCompletions(global);
      forEach(keywords, maybeAdd);
    }
    return found;
  }
});



// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"), require("./xml-hint"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror", "./xml-hint"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";

  var langs = "ab aa af ak sq am ar an hy as av ae ay az bm ba eu be bn bh bi bs br bg my ca ch ce ny zh cv kw co cr hr cs da dv nl dz en eo et ee fo fj fi fr ff gl ka de el gn gu ht ha he hz hi ho hu ia id ie ga ig ik io is it iu ja jv kl kn kr ks kk km ki rw ky kv kg ko ku kj la lb lg li ln lo lt lu lv gv mk mg ms ml mt mi mr mh mn na nv nb nd ne ng nn no ii nr oc oj cu om or os pa pi fa pl ps pt qu rm rn ro ru sa sc sd se sm sg sr gd sn si sk sl so st es su sw ss sv ta te tg th ti bo tk tl tn to tr ts tt tw ty ug uk ur uz ve vi vo wa cy wo fy xh yi yo za zu".split(" ");
  var targets = ["_blank", "_self", "_top", "_parent"];
  var charsets = ["ascii", "utf-8", "utf-16", "latin1", "latin1"];
  var methods = ["get", "post", "put", "delete"];
  var encs = ["application/x-www-form-urlencoded", "multipart/form-data", "text/plain"];
  var media = ["all", "screen", "print", "embossed", "braille", "handheld", "print", "projection", "screen", "tty", "tv", "speech",
               "3d-glasses", "resolution [>][<][=] [X]", "device-aspect-ratio: X/Y", "orientation:portrait",
               "orientation:landscape", "device-height: [X]", "device-width: [X]"];
  var s = { attrs: {} }; // Simple tag, reused for a whole lot of tags

  var data = {
    a: {
      attrs: {
        href: null, ping: null, type: null,
        media: media,
        target: targets,
        hreflang: langs
      }
    },
    abbr: s,
    acronym: s,
    address: s,
    applet: s,
    area: {
      attrs: {
        alt: null, coords: null, href: null, target: null, ping: null,
        media: media, hreflang: langs, type: null,
        shape: ["default", "rect", "circle", "poly"]
      }
    },
    article: s,
    aside: s,
    audio: {
      attrs: {
        src: null, mediagroup: null,
        crossorigin: ["anonymous", "use-credentials"],
        preload: ["none", "metadata", "auto"],
        autoplay: ["", "autoplay"],
        loop: ["", "loop"],
        controls: ["", "controls"]
      }
    },
    b: s,
    base: { attrs: { href: null, target: targets } },
    basefont: s,
    bdi: s,
    bdo: s,
    big: s,
    blockquote: { attrs: { cite: null } },
    body: s,
    br: s,
    button: {
      attrs: {
        form: null, formaction: null, name: null, value: null,
        autofocus: ["", "autofocus"],
        disabled: ["", "autofocus"],
        formenctype: encs,
        formmethod: methods,
        formnovalidate: ["", "novalidate"],
        formtarget: targets,
        type: ["submit", "reset", "button"]
      }
    },
    canvas: { attrs: { width: null, height: null } },
    caption: s,
    center: s,
    cite: s,
    code: s,
    col: { attrs: { span: null } },
    colgroup: { attrs: { span: null } },
    command: {
      attrs: {
        type: ["command", "checkbox", "radio"],
        label: null, icon: null, radiogroup: null, command: null, title: null,
        disabled: ["", "disabled"],
        checked: ["", "checked"]
      }
    },
    data: { attrs: { value: null } },
    datagrid: { attrs: { disabled: ["", "disabled"], multiple: ["", "multiple"] } },
    datalist: { attrs: { data: null } },
    dd: s,
    del: { attrs: { cite: null, datetime: null } },
    details: { attrs: { open: ["", "open"] } },
    dfn: s,
    dir: s,
    div: s,
    dl: s,
    dt: s,
    em: s,
    embed: { attrs: { src: null, type: null, width: null, height: null } },
    eventsource: { attrs: { src: null } },
    fieldset: { attrs: { disabled: ["", "disabled"], form: null, name: null } },
    figcaption: s,
    figure: s,
    font: s,
    footer: s,
    form: {
      attrs: {
        action: null, name: null,
        "accept-charset": charsets,
        autocomplete: ["on", "off"],
        enctype: encs,
        method: methods,
        novalidate: ["", "novalidate"],
        target: targets
      }
    },
    frame: s,
    frameset: s,
    h1: s, h2: s, h3: s, h4: s, h5: s, h6: s,
    head: {
      attrs: {},
      children: ["title", "base", "link", "style", "meta", "script", "noscript", "command"]
    },
    header: s,
    hgroup: s,
    hr: s,
    html: {
      attrs: { manifest: null },
      children: ["head", "body"]
    },
    i: s,
    iframe: {
      attrs: {
        src: null, srcdoc: null, name: null, width: null, height: null,
        sandbox: ["allow-top-navigation", "allow-same-origin", "allow-forms", "allow-scripts"],
        seamless: ["", "seamless"]
      }
    },
    img: {
      attrs: {
        alt: null, src: null, ismap: null, usemap: null, width: null, height: null,
        crossorigin: ["anonymous", "use-credentials"]
      }
    },
    input: {
      attrs: {
        alt: null, dirname: null, form: null, formaction: null,
        height: null, list: null, max: null, maxlength: null, min: null,
        name: null, pattern: null, placeholder: null, size: null, src: null,
        step: null, value: null, width: null,
        accept: ["audio/*", "video/*", "image/*"],
        autocomplete: ["on", "off"],
        autofocus: ["", "autofocus"],
        checked: ["", "checked"],
        disabled: ["", "disabled"],
        formenctype: encs,
        formmethod: methods,
        formnovalidate: ["", "novalidate"],
        formtarget: targets,
        multiple: ["", "multiple"],
        readonly: ["", "readonly"],
        required: ["", "required"],
        type: ["hidden", "text", "search", "tel", "url", "email", "password", "datetime", "date", "month",
               "week", "time", "datetime-local", "number", "range", "color", "checkbox", "radio",
               "file", "submit", "image", "reset", "button"]
      }
    },
    ins: { attrs: { cite: null, datetime: null } },
    kbd: s,
    keygen: {
      attrs: {
        challenge: null, form: null, name: null,
        autofocus: ["", "autofocus"],
        disabled: ["", "disabled"],
        keytype: ["RSA"]
      }
    },
    label: { attrs: { "for": null, form: null } },
    legend: s,
    li: { attrs: { value: null } },
    link: {
      attrs: {
        href: null, type: null,
        hreflang: langs,
        media: media,
        sizes: ["all", "16x16", "16x16 32x32", "16x16 32x32 64x64"]
      }
    },
    map: { attrs: { name: null } },
    mark: s,
    menu: { attrs: { label: null, type: ["list", "context", "toolbar"] } },
    meta: {
      attrs: {
        content: null,
        charset: charsets,
        name: ["viewport", "application-name", "author", "description", "generator", "keywords"],
        "http-equiv": ["content-language", "content-type", "default-style", "refresh"]
      }
    },
    meter: { attrs: { value: null, min: null, low: null, high: null, max: null, optimum: null } },
    nav: s,
    noframes: s,
    noscript: s,
    object: {
      attrs: {
        data: null, type: null, name: null, usemap: null, form: null, width: null, height: null,
        typemustmatch: ["", "typemustmatch"]
      }
    },
    ol: { attrs: { reversed: ["", "reversed"], start: null, type: ["1", "a", "A", "i", "I"] } },
    optgroup: { attrs: { disabled: ["", "disabled"], label: null } },
    option: { attrs: { disabled: ["", "disabled"], label: null, selected: ["", "selected"], value: null } },
    output: { attrs: { "for": null, form: null, name: null } },
    p: s,
    param: { attrs: { name: null, value: null } },
    pre: s,
    progress: { attrs: { value: null, max: null } },
    q: { attrs: { cite: null } },
    rp: s,
    rt: s,
    ruby: s,
    s: s,
    samp: s,
    script: {
      attrs: {
        type: ["text/javascript"],
        src: null,
        async: ["", "async"],
        defer: ["", "defer"],
        charset: charsets
      }
    },
    section: s,
    select: {
      attrs: {
        form: null, name: null, size: null,
        autofocus: ["", "autofocus"],
        disabled: ["", "disabled"],
        multiple: ["", "multiple"]
      }
    },
    small: s,
    source: { attrs: { src: null, type: null, media: null } },
    span: s,
    strike: s,
    strong: s,
    style: {
      attrs: {
        type: ["text/css"],
        media: media,
        scoped: null
      }
    },
    sub: s,
    summary: s,
    sup: s,
    table: s,
    tbody: s,
    td: { attrs: { colspan: null, rowspan: null, headers: null } },
    textarea: {
      attrs: {
        dirname: null, form: null, maxlength: null, name: null, placeholder: null,
        rows: null, cols: null,
        autofocus: ["", "autofocus"],
        disabled: ["", "disabled"],
        readonly: ["", "readonly"],
        required: ["", "required"],
        wrap: ["soft", "hard"]
      }
    },
    tfoot: s,
    th: { attrs: { colspan: null, rowspan: null, headers: null, scope: ["row", "col", "rowgroup", "colgroup"] } },
    thead: s,
    time: { attrs: { datetime: null } },
    title: s,
    tr: s,
    track: {
      attrs: {
        src: null, label: null, "default": null,
        kind: ["subtitles", "captions", "descriptions", "chapters", "metadata"],
        srclang: langs
      }
    },
    tt: s,
    u: s,
    ul: s,
    "var": s,
    video: {
      attrs: {
        src: null, poster: null, width: null, height: null,
        crossorigin: ["anonymous", "use-credentials"],
        preload: ["auto", "metadata", "none"],
        autoplay: ["", "autoplay"],
        mediagroup: ["movie"],
        muted: ["", "muted"],
        controls: ["", "controls"]
      }
    },
    wbr: s
  };

  var globalAttrs = {
    accesskey: ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9"],
    "class": null,
    contenteditable: ["true", "false"],
    contextmenu: null,
    dir: ["ltr", "rtl", "auto"],
    draggable: ["true", "false", "auto"],
    dropzone: ["copy", "move", "link", "string:", "file:"],
    hidden: ["hidden"],
    id: null,
    inert: ["inert"],
    itemid: null,
    itemprop: null,
    itemref: null,
    itemscope: ["itemscope"],
    itemtype: null,
    lang: ["en", "es"],
    spellcheck: ["true", "false"],
    style: null,
    tabindex: ["1", "2", "3", "4", "5", "6", "7", "8", "9"],
    title: null,
    translate: ["yes", "no"],
    onclick: null,
    rel: ["stylesheet", "alternate", "author", "bookmark", "help", "license", "next", "nofollow", "noreferrer", "prefetch", "prev", "search", "tag"]
  };
  function populate(obj) {
    for (var attr in globalAttrs) if (globalAttrs.hasOwnProperty(attr))
      obj.attrs[attr] = globalAttrs[attr];
  }

  populate(s);
  for (var tag in data) if (data.hasOwnProperty(tag) && data[tag] != s)
    populate(data[tag]);

  CodeMirror.htmlSchema = data;
  function htmlHint(cm, options) {
    var local = {schemaInfo: data};
    if (options) for (var opt in options) local[opt] = options[opt];
    return CodeMirror.hint.xml(cm, local);
  }
  CodeMirror.registerHelper("hint", "html", htmlHint);
});




// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"), require("../../mode/css/css"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror", "../../mode/css/css"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";

  var pseudoClasses = {link: 1, visited: 1, active: 1, hover: 1, focus: 1,
                       "first-letter": 1, "first-line": 1, "first-child": 1,
                       before: 1, after: 1, lang: 1};

  CodeMirror.registerHelper("hint", "css", function(cm) {
    var cur = cm.getCursor(), token = cm.getTokenAt(cur);
    var inner = CodeMirror.innerMode(cm.getMode(), token.state);
    if (inner.mode.name != "css") return;

    if (token.type == "keyword" && "!important".indexOf(token.string) == 0)
      return {list: ["!important"], from: CodeMirror.Pos(cur.line, token.start),
              to: CodeMirror.Pos(cur.line, token.end)};

    var start = token.start, end = cur.ch, word = token.string.slice(0, end - start);
    if (/[^\w$_-]/.test(word)) {
      word = ""; start = end = cur.ch;
    }

    var spec = CodeMirror.resolveMode("text/css");

    var result = [];
    function add(keywords) {
      for (var name in keywords)
        if (!word || name.lastIndexOf(word, 0) == 0)
          result.push(name);
    }

    var st = inner.state.state;
    if (st == "pseudo" || token.type == "variable-3") {
      add(pseudoClasses);
    } else if (st == "block" || st == "maybeprop") {
      add(spec.propertyKeywords);
    } else if (st == "prop" || st == "parens" || st == "at" || st == "params") {
      add(spec.valueKeywords);
      add(spec.colorKeywords);
    } else if (st == "media" || st == "media_parens") {
      add(spec.mediaTypes);
      add(spec.mediaFeatures);
    }

    if (result.length) return {
      list: result,
      from: CodeMirror.Pos(cur.line, start),
      to: CodeMirror.Pos(cur.line, end)
    };
  });
});




// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"),  require("../../addon/mode/multiplex"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror", "../../addon/mode/multiplex"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";

  CodeMirror.defineMode("twig:inner", function() {
    var keywords = ["and", "as", "autoescape", "endautoescape", "block", "do", "endblock", "else", "elseif", "extends", "for", "endfor", "embed", "endembed", "filter", "endfilter", "flush", "from", "if", "endif", "in", "is", "include", "import", "not", "or", "set", "spaceless", "endspaceless", "with", "endwith", "trans", "endtrans", "blocktrans", "endblocktrans", "macro", "endmacro", "use", "verbatim", "endverbatim"],
        operator = /^[+\-*&%=<>!?|~^]/,
        sign = /^[:\[\(\{]/,
        atom = ["true", "false", "null", "empty", "defined", "divisibleby", "divisible by", "even", "odd", "iterable", "sameas", "same as"],
        number = /^(\d[+\-\*\/])?\d+(\.\d+)?/;

    keywords = new RegExp("((" + keywords.join(")|(") + "))\\b");
    atom = new RegExp("((" + atom.join(")|(") + "))\\b");

    function tokenBase (stream, state) {
      var ch = stream.peek();

      //Comment
      if (state.incomment) {
        if (!stream.skipTo("#}")) {
          stream.skipToEnd();
        } else {
          stream.eatWhile(/\#|}/);
          state.incomment = false;
        }
        return "comment";
      //Tag
      } else if (state.intag) {
        //After operator
        if (state.operator) {
          state.operator = false;
          if (stream.match(atom)) {
            return "atom";
          }
          if (stream.match(number)) {
            return "number";
          }
        }
        //After sign
        if (state.sign) {
          state.sign = false;
          if (stream.match(atom)) {
            return "atom";
          }
          if (stream.match(number)) {
            return "number";
          }
        }

        if (state.instring) {
          if (ch == state.instring) {
            state.instring = false;
          }
          stream.next();
          return "string";
        } else if (ch == "'" || ch == '"') {
          state.instring = ch;
          stream.next();
          return "string";
        } else if (stream.match(state.intag + "}") || stream.eat("-") && stream.match(state.intag + "}")) {
          state.intag = false;
          return "tag";
        } else if (stream.match(operator)) {
          state.operator = true;
          return "operator";
        } else if (stream.match(sign)) {
          state.sign = true;
        } else {
          if (stream.eat(" ") || stream.sol()) {
            if (stream.match(keywords)) {
              return "keyword";
            }
            if (stream.match(atom)) {
              return "atom";
            }
            if (stream.match(number)) {
              return "number";
            }
            if (stream.sol()) {
              stream.next();
            }
          } else {
            stream.next();
          }

        }
        return "variable";
      } else if (stream.eat("{")) {
        if (stream.eat("#")) {
          state.incomment = true;
          if (!stream.skipTo("#}")) {
            stream.skipToEnd();
          } else {
            stream.eatWhile(/\#|}/);
            state.incomment = false;
          }
          return "comment";
        //Open tag
        } else if (ch = stream.eat(/\{|%/)) {
          //Cache close tag
          state.intag = ch;
          if (ch == "{") {
            state.intag = "}";
          }
          stream.eat("-");
          return "tag";
        }
      }
      stream.next();
    };

    return {
      startState: function () {
        return {};
      },
      token: function (stream, state) {
        return tokenBase(stream, state);
      }
    };
  });

  CodeMirror.defineMode("twig", function(config, parserConfig) {
    var twigInner = CodeMirror.getMode(config, "twig:inner");
    if (!parserConfig || !parserConfig.base) return twigInner;
    return CodeMirror.multiplexingMode(
      CodeMirror.getMode(config, parserConfig.base), {
        open: /\{[{#%]/, close: /[}#%]\}/, mode: twigInner, parseDelimiters: true
      }
    );
  });
  CodeMirror.defineMIME("text/x-twig", "twig");
});



// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

// Utility function that allows modes to be combined. The mode given
// as the base argument takes care of most of the normal mode
// functionality, but a second (typically simple) mode is used, which
// can override the style of text. Both modes get to parse all of the
// text, but when both assign a non-null style to a piece of code, the
// overlay wins, unless the combine argument was true and not overridden,
// or state.overlay.combineTokens was true, in which case the styles are
// combined.

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
"use strict";

CodeMirror.overlayMode = function(base, overlay, combine) {
  return {
    startState: function() {
      return {
        base: CodeMirror.startState(base),
        overlay: CodeMirror.startState(overlay),
        basePos: 0, baseCur: null,
        overlayPos: 0, overlayCur: null,
        streamSeen: null
      };
    },
    copyState: function(state) {
      return {
        base: CodeMirror.copyState(base, state.base),
        overlay: CodeMirror.copyState(overlay, state.overlay),
        basePos: state.basePos, baseCur: null,
        overlayPos: state.overlayPos, overlayCur: null
      };
    },

    token: function(stream, state) {
      if (stream != state.streamSeen ||
          Math.min(state.basePos, state.overlayPos) < stream.start) {
        state.streamSeen = stream;
        state.basePos = state.overlayPos = stream.start;
      }

      if (stream.start == state.basePos) {
        state.baseCur = base.token(stream, state.base);
        state.basePos = stream.pos;
      }
      if (stream.start == state.overlayPos) {
        stream.pos = stream.start;
        state.overlayCur = overlay.token(stream, state.overlay);
        state.overlayPos = stream.pos;
      }
      stream.pos = Math.min(state.basePos, state.overlayPos);

      // state.overlay.combineTokens always takes precedence over combine,
      // unless set to null
      if (state.overlayCur == null) return state.baseCur;
      else if (state.baseCur != null &&
               state.overlay.combineTokens ||
               combine && state.overlay.combineTokens == null)
        return state.baseCur + " " + state.overlayCur;
      else return state.overlayCur;
    },

    indent: base.indent && function(state, textAfter) {
      return base.indent(state.base, textAfter);
    },
    electricChars: base.electricChars,

    innerMode: function(state) { return {state: state.base, mode: base}; },

    blankLine: function(state) {
      var baseToken, overlayToken;
      if (base.blankLine) baseToken = base.blankLine(state.base);
      if (overlay.blankLine) overlayToken = overlay.blankLine(state.overlay);

      return overlayToken == null ?
        baseToken :
        (combine && baseToken != null ? baseToken + " " + overlayToken : overlayToken);
    }
  };
};

});



// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

// A rough approximation of Sublime Text's keybindings
// Depends on addon/search/searchcursor.js and optionally addon/dialog/dialogs.js

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../lib/codemirror"), require("../addon/search/searchcursor"), require("../addon/edit/matchbrackets"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../lib/codemirror", "../addon/search/searchcursor", "../addon/edit/matchbrackets"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";

  var map = CodeMirror.keyMap.sublime = {fallthrough: "default"};
  var cmds = CodeMirror.commands;
  var Pos = CodeMirror.Pos;
  var mac = CodeMirror.keyMap["default"] == CodeMirror.keyMap.macDefault;
  var ctrl = mac ? "Cmd-" : "Ctrl-";

  // This is not exactly Sublime's algorithm. I couldn't make heads or tails of that.
  function findPosSubword(doc, start, dir) {
    if (dir < 0 && start.ch == 0) return doc.clipPos(Pos(start.line - 1));
    var line = doc.getLine(start.line);
    if (dir > 0 && start.ch >= line.length) return doc.clipPos(Pos(start.line + 1, 0));
    var state = "start", type;
    for (var pos = start.ch, e = dir < 0 ? 0 : line.length, i = 0; pos != e; pos += dir, i++) {
      var next = line.charAt(dir < 0 ? pos - 1 : pos);
      var cat = next != "_" && CodeMirror.isWordChar(next) ? "w" : "o";
      if (cat == "w" && next.toUpperCase() == next) cat = "W";
      if (state == "start") {
        if (cat != "o") { state = "in"; type = cat; }
      } else if (state == "in") {
        if (type != cat) {
          if (type == "w" && cat == "W" && dir < 0) pos--;
          if (type == "W" && cat == "w" && dir > 0) { type = "w"; continue; }
          break;
        }
      }
    }
    return Pos(start.line, pos);
  }

  function moveSubword(cm, dir) {
    cm.extendSelectionsBy(function(range) {
      if (cm.display.shift || cm.doc.extend || range.empty())
        return findPosSubword(cm.doc, range.head, dir);
      else
        return dir < 0 ? range.from() : range.to();
    });
  }

  var goSubwordCombo = mac ? "Ctrl-" : "Alt-";

  cmds[map[goSubwordCombo + "Left"] = "goSubwordLeft"] = function(cm) { moveSubword(cm, -1); };
  cmds[map[goSubwordCombo + "Right"] = "goSubwordRight"] = function(cm) { moveSubword(cm, 1); };

  if (mac) map["Cmd-Left"] = "goLineStartSmart";

  var scrollLineCombo = mac ? "Ctrl-Alt-" : "Ctrl-";

  cmds[map[scrollLineCombo + "Up"] = "scrollLineUp"] = function(cm) {
    var info = cm.getScrollInfo();
    if (!cm.somethingSelected()) {
      var visibleBottomLine = cm.lineAtHeight(info.top + info.clientHeight, "local");
      if (cm.getCursor().line >= visibleBottomLine)
        cm.execCommand("goLineUp");
    }
    cm.scrollTo(null, info.top - cm.defaultTextHeight());
  };
  cmds[map[scrollLineCombo + "Down"] = "scrollLineDown"] = function(cm) {
    var info = cm.getScrollInfo();
    if (!cm.somethingSelected()) {
      var visibleTopLine = cm.lineAtHeight(info.top, "local")+1;
      if (cm.getCursor().line <= visibleTopLine)
        cm.execCommand("goLineDown");
    }
    cm.scrollTo(null, info.top + cm.defaultTextHeight());
  };

  cmds[map["Shift-" + ctrl + "L"] = "splitSelectionByLine"] = function(cm) {
    var ranges = cm.listSelections(), lineRanges = [];
    for (var i = 0; i < ranges.length; i++) {
      var from = ranges[i].from(), to = ranges[i].to();
      for (var line = from.line; line <= to.line; ++line)
        if (!(to.line > from.line && line == to.line && to.ch == 0))
          lineRanges.push({anchor: line == from.line ? from : Pos(line, 0),
                           head: line == to.line ? to : Pos(line)});
    }
    cm.setSelections(lineRanges, 0);
  };

  map["Shift-Tab"] = "indentLess";

  cmds[map["Esc"] = "singleSelectionTop"] = function(cm) {
    var range = cm.listSelections()[0];
    cm.setSelection(range.anchor, range.head, {scroll: false});
  };

  cmds[map[ctrl + "L"] = "selectLine"] = function(cm) {
    var ranges = cm.listSelections(), extended = [];
    for (var i = 0; i < ranges.length; i++) {
      var range = ranges[i];
      extended.push({anchor: Pos(range.from().line, 0),
                     head: Pos(range.to().line + 1, 0)});
    }
    cm.setSelections(extended);
  };

  map["Shift-Ctrl-K"] = "deleteLine";

  function insertLine(cm, above) {
    if (cm.isReadOnly()) return CodeMirror.Pass
    cm.operation(function() {
      var len = cm.listSelections().length, newSelection = [], last = -1;
      for (var i = 0; i < len; i++) {
        var head = cm.listSelections()[i].head;
        if (head.line <= last) continue;
        var at = Pos(head.line + (above ? 0 : 1), 0);
        cm.replaceRange("\n", at, null, "+insertLine");
        cm.indentLine(at.line, null, true);
        newSelection.push({head: at, anchor: at});
        last = head.line + 1;
      }
      cm.setSelections(newSelection);
    });
    cm.execCommand("indentAuto");
  }

  cmds[map[ctrl + "Enter"] = "insertLineAfter"] = function(cm) { return insertLine(cm, false); };

  cmds[map["Shift-" + ctrl + "Enter"] = "insertLineBefore"] = function(cm) { return insertLine(cm, true); };

  function wordAt(cm, pos) {
    var start = pos.ch, end = start, line = cm.getLine(pos.line);
    while (start && CodeMirror.isWordChar(line.charAt(start - 1))) --start;
    while (end < line.length && CodeMirror.isWordChar(line.charAt(end))) ++end;
    return {from: Pos(pos.line, start), to: Pos(pos.line, end), word: line.slice(start, end)};
  }

  cmds[map[ctrl + "D"] = "selectNextOccurrence"] = function(cm) {
    var from = cm.getCursor("from"), to = cm.getCursor("to");
    var fullWord = cm.state.sublimeFindFullWord == cm.doc.sel;
    if (CodeMirror.cmpPos(from, to) == 0) {
      var word = wordAt(cm, from);
      if (!word.word) return;
      cm.setSelection(word.from, word.to);
      fullWord = true;
    } else {
      var text = cm.getRange(from, to);
      var query = fullWord ? new RegExp("\\b" + text + "\\b") : text;
      var cur = cm.getSearchCursor(query, to);
      var found = cur.findNext();
      if (!found) {
        cur = cm.getSearchCursor(query, Pos(cm.firstLine(), 0));
        found = cur.findNext();
      }
      if (!found || isSelectedRange(cm.listSelections(), cur.from(), cur.to()))
        return CodeMirror.Pass
      cm.addSelection(cur.from(), cur.to());
    }
    if (fullWord)
      cm.state.sublimeFindFullWord = cm.doc.sel;
  };

  function isSelectedRange(ranges, from, to) {
    for (var i = 0; i < ranges.length; i++)
      if (ranges[i].from() == from && ranges[i].to() == to) return true
    return false
  }

  var mirror = "(){}[]";
  function selectBetweenBrackets(cm) {
    var ranges = cm.listSelections(), newRanges = []
    for (var i = 0; i < ranges.length; i++) {
      var range = ranges[i], pos = range.head, opening = cm.scanForBracket(pos, -1);
      if (!opening) return false;
      for (;;) {
        var closing = cm.scanForBracket(pos, 1);
        if (!closing) return false;
        if (closing.ch == mirror.charAt(mirror.indexOf(opening.ch) + 1)) {
          newRanges.push({anchor: Pos(opening.pos.line, opening.pos.ch + 1),
                          head: closing.pos});
          break;
        }
        pos = Pos(closing.pos.line, closing.pos.ch + 1);
      }
    }
    cm.setSelections(newRanges);
    return true;
  }

  cmds[map["Shift-" + ctrl + "Space"] = "selectScope"] = function(cm) {
    selectBetweenBrackets(cm) || cm.execCommand("selectAll");
  };
  cmds[map["Shift-" + ctrl + "M"] = "selectBetweenBrackets"] = function(cm) {
    if (!selectBetweenBrackets(cm)) return CodeMirror.Pass;
  };

  cmds[map[ctrl + "M"] = "goToBracket"] = function(cm) {
    cm.extendSelectionsBy(function(range) {
      var next = cm.scanForBracket(range.head, 1);
      if (next && CodeMirror.cmpPos(next.pos, range.head) != 0) return next.pos;
      var prev = cm.scanForBracket(range.head, -1);
      return prev && Pos(prev.pos.line, prev.pos.ch + 1) || range.head;
    });
  };

  var swapLineCombo = mac ? "Cmd-Ctrl-" : "Shift-Ctrl-";

  cmds[map[swapLineCombo + "Up"] = "swapLineUp"] = function(cm) {
    if (cm.isReadOnly()) return CodeMirror.Pass
    var ranges = cm.listSelections(), linesToMove = [], at = cm.firstLine() - 1, newSels = [];
    for (var i = 0; i < ranges.length; i++) {
      var range = ranges[i], from = range.from().line - 1, to = range.to().line;
      newSels.push({anchor: Pos(range.anchor.line - 1, range.anchor.ch),
                    head: Pos(range.head.line - 1, range.head.ch)});
      if (range.to().ch == 0 && !range.empty()) --to;
      if (from > at) linesToMove.push(from, to);
      else if (linesToMove.length) linesToMove[linesToMove.length - 1] = to;
      at = to;
    }
    cm.operation(function() {
      for (var i = 0; i < linesToMove.length; i += 2) {
        var from = linesToMove[i], to = linesToMove[i + 1];
        var line = cm.getLine(from);
        cm.replaceRange("", Pos(from, 0), Pos(from + 1, 0), "+swapLine");
        if (to > cm.lastLine())
          cm.replaceRange("\n" + line, Pos(cm.lastLine()), null, "+swapLine");
        else
          cm.replaceRange(line + "\n", Pos(to, 0), null, "+swapLine");
      }
      cm.setSelections(newSels);
      cm.scrollIntoView();
    });
  };

  cmds[map[swapLineCombo + "Down"] = "swapLineDown"] = function(cm) {
    if (cm.isReadOnly()) return CodeMirror.Pass
    var ranges = cm.listSelections(), linesToMove = [], at = cm.lastLine() + 1;
    for (var i = ranges.length - 1; i >= 0; i--) {
      var range = ranges[i], from = range.to().line + 1, to = range.from().line;
      if (range.to().ch == 0 && !range.empty()) from--;
      if (from < at) linesToMove.push(from, to);
      else if (linesToMove.length) linesToMove[linesToMove.length - 1] = to;
      at = to;
    }
    cm.operation(function() {
      for (var i = linesToMove.length - 2; i >= 0; i -= 2) {
        var from = linesToMove[i], to = linesToMove[i + 1];
        var line = cm.getLine(from);
        if (from == cm.lastLine())
          cm.replaceRange("", Pos(from - 1), Pos(from), "+swapLine");
        else
          cm.replaceRange("", Pos(from, 0), Pos(from + 1, 0), "+swapLine");
        cm.replaceRange(line + "\n", Pos(to, 0), null, "+swapLine");
      }
      cm.scrollIntoView();
    });
  };

  cmds[map[ctrl + "/"] = "toggleCommentIndented"] = function(cm) {
    cm.toggleComment({ indent: true });
  }

  cmds[map[ctrl + "J"] = "joinLines"] = function(cm) {
    var ranges = cm.listSelections(), joined = [];
    for (var i = 0; i < ranges.length; i++) {
      var range = ranges[i], from = range.from();
      var start = from.line, end = range.to().line;
      while (i < ranges.length - 1 && ranges[i + 1].from().line == end)
        end = ranges[++i].to().line;
      joined.push({start: start, end: end, anchor: !range.empty() && from});
    }
    cm.operation(function() {
      var offset = 0, ranges = [];
      for (var i = 0; i < joined.length; i++) {
        var obj = joined[i];
        var anchor = obj.anchor && Pos(obj.anchor.line - offset, obj.anchor.ch), head;
        for (var line = obj.start; line <= obj.end; line++) {
          var actual = line - offset;
          if (line == obj.end) head = Pos(actual, cm.getLine(actual).length + 1);
          if (actual < cm.lastLine()) {
            cm.replaceRange(" ", Pos(actual), Pos(actual + 1, /^\s*/.exec(cm.getLine(actual + 1))[0].length));
            ++offset;
          }
        }
        ranges.push({anchor: anchor || head, head: head});
      }
      cm.setSelections(ranges, 0);
    });
  };

  cmds[map["Shift-" + ctrl + "D"] = "duplicateLine"] = function(cm) {
    cm.operation(function() {
      var rangeCount = cm.listSelections().length;
      for (var i = 0; i < rangeCount; i++) {
        var range = cm.listSelections()[i];
        if (range.empty())
          cm.replaceRange(cm.getLine(range.head.line) + "\n", Pos(range.head.line, 0));
        else
          cm.replaceRange(cm.getRange(range.from(), range.to()), range.from());
      }
      cm.scrollIntoView();
    });
  };

  if (!mac) map[ctrl + "T"] = "transposeChars";

  function sortLines(cm, caseSensitive) {
    if (cm.isReadOnly()) return CodeMirror.Pass
    var ranges = cm.listSelections(), toSort = [], selected;
    for (var i = 0; i < ranges.length; i++) {
      var range = ranges[i];
      if (range.empty()) continue;
      var from = range.from().line, to = range.to().line;
      while (i < ranges.length - 1 && ranges[i + 1].from().line == to)
        to = ranges[++i].to().line;
      if (!ranges[i].to().ch) to--;
      toSort.push(from, to);
    }
    if (toSort.length) selected = true;
    else toSort.push(cm.firstLine(), cm.lastLine());

    cm.operation(function() {
      var ranges = [];
      for (var i = 0; i < toSort.length; i += 2) {
        var from = toSort[i], to = toSort[i + 1];
        var start = Pos(from, 0), end = Pos(to);
        var lines = cm.getRange(start, end, false);
        if (caseSensitive)
          lines.sort();
        else
          lines.sort(function(a, b) {
            var au = a.toUpperCase(), bu = b.toUpperCase();
            if (au != bu) { a = au; b = bu; }
            return a < b ? -1 : a == b ? 0 : 1;
          });
        cm.replaceRange(lines, start, end);
        if (selected) ranges.push({anchor: start, head: Pos(to + 1, 0)});
      }
      if (selected) cm.setSelections(ranges, 0);
    });
  }

  cmds[map["F9"] = "sortLines"] = function(cm) { sortLines(cm, true); };
  cmds[map[ctrl + "F9"] = "sortLinesInsensitive"] = function(cm) { sortLines(cm, false); };

  cmds[map["F2"] = "nextBookmark"] = function(cm) {
    var marks = cm.state.sublimeBookmarks;
    if (marks) while (marks.length) {
      var current = marks.shift();
      var found = current.find();
      if (found) {
        marks.push(current);
        return cm.setSelection(found.from, found.to);
      }
    }
  };

  cmds[map["Shift-F2"] = "prevBookmark"] = function(cm) {
    var marks = cm.state.sublimeBookmarks;
    if (marks) while (marks.length) {
      marks.unshift(marks.pop());
      var found = marks[marks.length - 1].find();
      if (!found)
        marks.pop();
      else
        return cm.setSelection(found.from, found.to);
    }
  };

  cmds[map[ctrl + "F2"] = "toggleBookmark"] = function(cm) {
    var ranges = cm.listSelections();
    var marks = cm.state.sublimeBookmarks || (cm.state.sublimeBookmarks = []);
    for (var i = 0; i < ranges.length; i++) {
      var from = ranges[i].from(), to = ranges[i].to();
      var found = cm.findMarks(from, to);
      for (var j = 0; j < found.length; j++) {
        if (found[j].sublimeBookmark) {
          found[j].clear();
          for (var k = 0; k < marks.length; k++)
            if (marks[k] == found[j])
              marks.splice(k--, 1);
          break;
        }
      }
      if (j == found.length)
        marks.push(cm.markText(from, to, {sublimeBookmark: true, clearWhenEmpty: false}));
    }
  };

  cmds[map["Shift-" + ctrl + "F2"] = "clearBookmarks"] = function(cm) {
    var marks = cm.state.sublimeBookmarks;
    if (marks) for (var i = 0; i < marks.length; i++) marks[i].clear();
    marks.length = 0;
  };

  cmds[map["Alt-F2"] = "selectBookmarks"] = function(cm) {
    var marks = cm.state.sublimeBookmarks, ranges = [];
    if (marks) for (var i = 0; i < marks.length; i++) {
      var found = marks[i].find();
      if (!found)
        marks.splice(i--, 0);
      else
        ranges.push({anchor: found.from, head: found.to});
    }
    if (ranges.length)
      cm.setSelections(ranges, 0);
  };

  map["Alt-Q"] = "wrapLines";

  var cK = ctrl + "K ";

  function modifyWordOrSelection(cm, mod) {
    cm.operation(function() {
      var ranges = cm.listSelections(), indices = [], replacements = [];
      for (var i = 0; i < ranges.length; i++) {
        var range = ranges[i];
        if (range.empty()) { indices.push(i); replacements.push(""); }
        else replacements.push(mod(cm.getRange(range.from(), range.to())));
      }
      cm.replaceSelections(replacements, "around", "case");
      for (var i = indices.length - 1, at; i >= 0; i--) {
        var range = ranges[indices[i]];
        if (at && CodeMirror.cmpPos(range.head, at) > 0) continue;
        var word = wordAt(cm, range.head);
        at = word.from;
        cm.replaceRange(mod(word.word), word.from, word.to);
      }
    });
  }

  map[cK + ctrl + "Backspace"] = "delLineLeft";

  cmds[map["Backspace"] = "smartBackspace"] = function(cm) {
    if (cm.somethingSelected()) return CodeMirror.Pass;

    cm.operation(function() {
      var cursors = cm.listSelections();
      var indentUnit = cm.getOption("indentUnit");

      for (var i = cursors.length - 1; i >= 0; i--) {
        var cursor = cursors[i].head;
        var toStartOfLine = cm.getRange({line: cursor.line, ch: 0}, cursor);
        var column = CodeMirror.countColumn(toStartOfLine, null, cm.getOption("tabSize"));

        // Delete by one character by default
        var deletePos = cm.findPosH(cursor, -1, "char", false);

        if (toStartOfLine && !/\S/.test(toStartOfLine) && column % indentUnit == 0) {
          var prevIndent = new Pos(cursor.line,
            CodeMirror.findColumn(toStartOfLine, column - indentUnit, indentUnit));

          // Smart delete only if we found a valid prevIndent location
          if (prevIndent.ch != cursor.ch) deletePos = prevIndent;
        }

        cm.replaceRange("", deletePos, cursor, "+delete");
      }
    });
  };

  cmds[map[cK + ctrl + "K"] = "delLineRight"] = function(cm) {
    cm.operation(function() {
      var ranges = cm.listSelections();
      for (var i = ranges.length - 1; i >= 0; i--)
        cm.replaceRange("", ranges[i].anchor, Pos(ranges[i].to().line), "+delete");
      cm.scrollIntoView();
    });
  };

  cmds[map[cK + ctrl + "U"] = "upcaseAtCursor"] = function(cm) {
    modifyWordOrSelection(cm, function(str) { return str.toUpperCase(); });
  };
  cmds[map[cK + ctrl + "L"] = "downcaseAtCursor"] = function(cm) {
    modifyWordOrSelection(cm, function(str) { return str.toLowerCase(); });
  };

  cmds[map[cK + ctrl + "Space"] = "setSublimeMark"] = function(cm) {
    if (cm.state.sublimeMark) cm.state.sublimeMark.clear();
    cm.state.sublimeMark = cm.setBookmark(cm.getCursor());
  };
  cmds[map[cK + ctrl + "A"] = "selectToSublimeMark"] = function(cm) {
    var found = cm.state.sublimeMark && cm.state.sublimeMark.find();
    if (found) cm.setSelection(cm.getCursor(), found);
  };
  cmds[map[cK + ctrl + "W"] = "deleteToSublimeMark"] = function(cm) {
    var found = cm.state.sublimeMark && cm.state.sublimeMark.find();
    if (found) {
      var from = cm.getCursor(), to = found;
      if (CodeMirror.cmpPos(from, to) > 0) { var tmp = to; to = from; from = tmp; }
      cm.state.sublimeKilled = cm.getRange(from, to);
      cm.replaceRange("", from, to);
    }
  };
  cmds[map[cK + ctrl + "X"] = "swapWithSublimeMark"] = function(cm) {
    var found = cm.state.sublimeMark && cm.state.sublimeMark.find();
    if (found) {
      cm.state.sublimeMark.clear();
      cm.state.sublimeMark = cm.setBookmark(cm.getCursor());
      cm.setCursor(found);
    }
  };
  cmds[map[cK + ctrl + "Y"] = "sublimeYank"] = function(cm) {
    if (cm.state.sublimeKilled != null)
      cm.replaceSelection(cm.state.sublimeKilled, null, "paste");
  };

  map[cK + ctrl + "G"] = "clearBookmarks";
  cmds[map[cK + ctrl + "C"] = "showInCenter"] = function(cm) {
    var pos = cm.cursorCoords(null, "local");
    cm.scrollTo(null, (pos.top + pos.bottom) / 2 - cm.getScrollInfo().clientHeight / 2);
  };

  var selectLinesCombo = mac ? "Ctrl-Shift-" : "Ctrl-Alt-";
  cmds[map[selectLinesCombo + "Up"] = "selectLinesUpward"] = function(cm) {
    cm.operation(function() {
      var ranges = cm.listSelections();
      for (var i = 0; i < ranges.length; i++) {
        var range = ranges[i];
        if (range.head.line > cm.firstLine())
          cm.addSelection(Pos(range.head.line - 1, range.head.ch));
      }
    });
  };
  cmds[map[selectLinesCombo + "Down"] = "selectLinesDownward"] = function(cm) {
    cm.operation(function() {
      var ranges = cm.listSelections();
      for (var i = 0; i < ranges.length; i++) {
        var range = ranges[i];
        if (range.head.line < cm.lastLine())
          cm.addSelection(Pos(range.head.line + 1, range.head.ch));
      }
    });
  };

  function getTarget(cm) {
    var from = cm.getCursor("from"), to = cm.getCursor("to");
    if (CodeMirror.cmpPos(from, to) == 0) {
      var word = wordAt(cm, from);
      if (!word.word) return;
      from = word.from;
      to = word.to;
    }
    return {from: from, to: to, query: cm.getRange(from, to), word: word};
  }

  function findAndGoTo(cm, forward) {
    var target = getTarget(cm);
    if (!target) return;
    var query = target.query;
    var cur = cm.getSearchCursor(query, forward ? target.to : target.from);

    if (forward ? cur.findNext() : cur.findPrevious()) {
      cm.setSelection(cur.from(), cur.to());
    } else {
      cur = cm.getSearchCursor(query, forward ? Pos(cm.firstLine(), 0)
                                              : cm.clipPos(Pos(cm.lastLine())));
      if (forward ? cur.findNext() : cur.findPrevious())
        cm.setSelection(cur.from(), cur.to());
      else if (target.word)
        cm.setSelection(target.from, target.to);
    }
  };
  cmds[map[ctrl + "F3"] = "findUnder"] = function(cm) { findAndGoTo(cm, true); };
  cmds[map["Shift-" + ctrl + "F3"] = "findUnderPrevious"] = function(cm) { findAndGoTo(cm,false); };
  cmds[map["Alt-F3"] = "findAllUnder"] = function(cm) {
    var target = getTarget(cm);
    if (!target) return;
    var cur = cm.getSearchCursor(target.query);
    var matches = [];
    var primaryIndex = -1;
    while (cur.findNext()) {
      matches.push({anchor: cur.from(), head: cur.to()});
      if (cur.from().line <= target.from.line && cur.from().ch <= target.from.ch)
        primaryIndex++;
    }
    cm.setSelections(matches, primaryIndex);
  };

  map["Shift-" + ctrl + "["] = "fold";
  map["Shift-" + ctrl + "]"] = "unfold";
  map[cK + ctrl + "0"] = map[cK + ctrl + "J"] = "unfoldAll";

  map[ctrl + "I"] = "findIncremental";
  map["Shift-" + ctrl + "I"] = "findIncrementalReverse";
  map[ctrl + "H"] = "replace";
  map["F3"] = "findNext";
  map["Shift-F3"] = "findPrev";

  CodeMirror.normalizeKeyMap(map);
});





// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";
  var Pos = CodeMirror.Pos;

  function SearchCursor(doc, query, pos, caseFold) {
    this.atOccurrence = false; this.doc = doc;
    if (caseFold == null && typeof query == "string") caseFold = false;

    pos = pos ? doc.clipPos(pos) : Pos(0, 0);
    this.pos = {from: pos, to: pos};

    // The matches method is filled in based on the type of query.
    // It takes a position and a direction, and returns an object
    // describing the next occurrence of the query, or null if no
    // more matches were found.
    if (typeof query != "string") { // Regexp match
      if (!query.global) query = new RegExp(query.source, query.ignoreCase ? "ig" : "g");
      this.matches = function(reverse, pos) {
        if (reverse) {
          query.lastIndex = 0;
          var line = doc.getLine(pos.line).slice(0, pos.ch), cutOff = 0, match, start;
          for (;;) {
            query.lastIndex = cutOff;
            var newMatch = query.exec(line);
            if (!newMatch) break;
            match = newMatch;
            start = match.index;
            cutOff = match.index + (match[0].length || 1);
            if (cutOff == line.length) break;
          }
          var matchLen = (match && match[0].length) || 0;
          if (!matchLen) {
            if (start == 0 && line.length == 0) {match = undefined;}
            else if (start != doc.getLine(pos.line).length) {
              matchLen++;
            }
          }
        } else {
          query.lastIndex = pos.ch;
          var line = doc.getLine(pos.line), match = query.exec(line);
          var matchLen = (match && match[0].length) || 0;
          var start = match && match.index;
          if (start + matchLen != line.length && !matchLen) matchLen = 1;
        }
        if (match && matchLen)
          return {from: Pos(pos.line, start),
                  to: Pos(pos.line, start + matchLen),
                  match: match};
      };
    } else { // String query
      var origQuery = query;
      if (caseFold) query = query.toLowerCase();
      var fold = caseFold ? function(str){return str.toLowerCase();} : function(str){return str;};
      var target = query.split("\n");
      // Different methods for single-line and multi-line queries
      if (target.length == 1) {
        if (!query.length) {
          // Empty string would match anything and never progress, so
          // we define it to match nothing instead.
          this.matches = function() {};
        } else {
          this.matches = function(reverse, pos) {
            if (reverse) {
              var orig = doc.getLine(pos.line).slice(0, pos.ch), line = fold(orig);
              var match = line.lastIndexOf(query);
              if (match > -1) {
                match = adjustPos(orig, line, match);
                return {from: Pos(pos.line, match), to: Pos(pos.line, match + origQuery.length)};
              }
             } else {
               var orig = doc.getLine(pos.line).slice(pos.ch), line = fold(orig);
               var match = line.indexOf(query);
               if (match > -1) {
                 match = adjustPos(orig, line, match) + pos.ch;
                 return {from: Pos(pos.line, match), to: Pos(pos.line, match + origQuery.length)};
               }
            }
          };
        }
      } else {
        var origTarget = origQuery.split("\n");
        this.matches = function(reverse, pos) {
          var last = target.length - 1;
          if (reverse) {
            if (pos.line - (target.length - 1) < doc.firstLine()) return;
            if (fold(doc.getLine(pos.line).slice(0, origTarget[last].length)) != target[target.length - 1]) return;
            var to = Pos(pos.line, origTarget[last].length);
            for (var ln = pos.line - 1, i = last - 1; i >= 1; --i, --ln)
              if (target[i] != fold(doc.getLine(ln))) return;
            var line = doc.getLine(ln), cut = line.length - origTarget[0].length;
            if (fold(line.slice(cut)) != target[0]) return;
            return {from: Pos(ln, cut), to: to};
          } else {
            if (pos.line + (target.length - 1) > doc.lastLine()) return;
            var line = doc.getLine(pos.line), cut = line.length - origTarget[0].length;
            if (fold(line.slice(cut)) != target[0]) return;
            var from = Pos(pos.line, cut);
            for (var ln = pos.line + 1, i = 1; i < last; ++i, ++ln)
              if (target[i] != fold(doc.getLine(ln))) return;
            if (fold(doc.getLine(ln).slice(0, origTarget[last].length)) != target[last]) return;
            return {from: from, to: Pos(ln, origTarget[last].length)};
          }
        };
      }
    }
  }

  SearchCursor.prototype = {
    findNext: function() {return this.find(false);},
    findPrevious: function() {return this.find(true);},

    find: function(reverse) {
      var self = this, pos = this.doc.clipPos(reverse ? this.pos.from : this.pos.to);
      function savePosAndFail(line) {
        var pos = Pos(line, 0);
        self.pos = {from: pos, to: pos};
        self.atOccurrence = false;
        return false;
      }

      for (;;) {
        if (this.pos = this.matches(reverse, pos)) {
          this.atOccurrence = true;
          return this.pos.match || true;
        }
        if (reverse) {
          if (!pos.line) return savePosAndFail(0);
          pos = Pos(pos.line-1, this.doc.getLine(pos.line-1).length);
        }
        else {
          var maxLine = this.doc.lineCount();
          if (pos.line == maxLine - 1) return savePosAndFail(maxLine);
          pos = Pos(pos.line + 1, 0);
        }
      }
    },

    from: function() {if (this.atOccurrence) return this.pos.from;},
    to: function() {if (this.atOccurrence) return this.pos.to;},

    replace: function(newText, origin) {
      if (!this.atOccurrence) return;
      var lines = CodeMirror.splitLines(newText);
      this.doc.replaceRange(lines, this.pos.from, this.pos.to, origin);
      this.pos.to = Pos(this.pos.from.line + lines.length - 1,
                        lines[lines.length - 1].length + (lines.length == 1 ? this.pos.from.ch : 0));
    }
  };

  // Maps a position in a case-folded line back to a position in the original line
  // (compensating for codepoints increasing in number during folding)
  function adjustPos(orig, folded, pos) {
    if (orig.length == folded.length) return pos;
    for (var pos1 = Math.min(pos, orig.length);;) {
      var len1 = orig.slice(0, pos1).toLowerCase().length;
      if (len1 < pos) ++pos1;
      else if (len1 > pos) --pos1;
      else return pos1;
    }
  }

  CodeMirror.defineExtension("getSearchCursor", function(query, pos, caseFold) {
    return new SearchCursor(this.doc, query, pos, caseFold);
  });
  CodeMirror.defineDocExtension("getSearchCursor", function(query, pos, caseFold) {
    return new SearchCursor(this, query, pos, caseFold);
  });

  CodeMirror.defineExtension("selectMatches", function(query, caseFold) {
    var ranges = [];
    var cur = this.getSearchCursor(query, this.getCursor("from"), caseFold);
    while (cur.findNext()) {
      if (CodeMirror.cmpPos(cur.to(), this.getCursor("to")) > 0) break;
      ranges.push({anchor: cur.from(), head: cur.to()});
    }
    if (ranges.length)
      this.setSelections(ranges, 0);
  });
});





// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

// Define search commands. Depends on dialog.js or another
// implementation of the openDialog method.

// Replace works a little oddly -- it will do the replace on the next
// Ctrl-G (or whatever is bound to findNext) press. You prevent a
// replace by making sure the match is no longer selected when hitting
// Ctrl-G.

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"), require("./searchcursor"), require("../dialog/dialog"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror", "./searchcursor", "../dialog/dialog"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";

  function searchOverlay(query, caseInsensitive) {
    if (typeof query == "string")
      query = new RegExp(query.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&"), caseInsensitive ? "gi" : "g");
    else if (!query.global)
      query = new RegExp(query.source, query.ignoreCase ? "gi" : "g");

    return {token: function(stream) {
      query.lastIndex = stream.pos;
      var match = query.exec(stream.string);
      if (match && match.index == stream.pos) {
        stream.pos += match[0].length || 1;
        return "searching";
      } else if (match) {
        stream.pos = match.index;
      } else {
        stream.skipToEnd();
      }
    }};
  }

  function SearchState() {
    this.posFrom = this.posTo = this.lastQuery = this.query = null;
    this.overlay = null;
  }

  function getSearchState(cm) {
    return cm.state.search || (cm.state.search = new SearchState());
  }

  function queryCaseInsensitive(query) {
    return typeof query == "string" && query == query.toLowerCase();
  }

  function getSearchCursor(cm, query, pos) {
    // Heuristic: if the query string is all lowercase, do a case insensitive search.
    return cm.getSearchCursor(query, pos, queryCaseInsensitive(query));
  }

  function persistentDialog(cm, text, deflt, onEnter, onKeyDown) {
    cm.openDialog(text, onEnter, {
      value: deflt,
      selectValueOnOpen: true,
      closeOnEnter: false,
      onClose: function() { clearSearch(cm); },
      onKeyDown: onKeyDown
    });
  }

  function dialog(cm, text, shortText, deflt, f) {
    if (cm.openDialog) cm.openDialog(text, f, {value: deflt, selectValueOnOpen: true});
    else f(prompt(shortText, deflt));
  }

  function confirmDialog(cm, text, shortText, fs) {
    if (cm.openConfirm) cm.openConfirm(text, fs);
    else if (confirm(shortText)) fs[0]();
  }

  function parseString(string) {
    return string.replace(/\\(.)/g, function(_, ch) {
      if (ch == "n") return "\n"
      if (ch == "r") return "\r"
      return ch
    })
  }

  function parseQuery(query) {
    var isRE = query.match(/^\/(.*)\/([a-z]*)$/);
    if (isRE) {
      try { query = new RegExp(isRE[1], isRE[2].indexOf("i") == -1 ? "" : "i"); }
      catch(e) {} // Not a regular expression after all, do a string search
    } else {
      query = parseString(query)
    }
    if (typeof query == "string" ? query == "" : query.test(""))
      query = /x^/;
    return query;
  }

  var queryDialog =
    '<span class="CodeMirror-search-label">Search:</span> <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>';

  function startSearch(cm, state, query) {
    state.queryText = query;
    state.query = parseQuery(query);
    cm.removeOverlay(state.overlay, queryCaseInsensitive(state.query));
    state.overlay = searchOverlay(state.query, queryCaseInsensitive(state.query));
    cm.addOverlay(state.overlay);
    if (cm.showMatchesOnScrollbar) {
      if (state.annotate) { state.annotate.clear(); state.annotate = null; }
      state.annotate = cm.showMatchesOnScrollbar(state.query, queryCaseInsensitive(state.query));
    }
  }

  function doSearch(cm, rev, persistent, immediate) {
    var state = getSearchState(cm);
    if (state.query) return findNext(cm, rev);
    var q = cm.getSelection() || state.lastQuery;
    if (persistent && cm.openDialog) {
      var hiding = null
      var searchNext = function(query, event) {
        CodeMirror.e_stop(event);
        if (!query) return;
        if (query != state.queryText) {
          startSearch(cm, state, query);
          state.posFrom = state.posTo = cm.getCursor();
        }
        if (hiding) hiding.style.opacity = 1
        findNext(cm, event.shiftKey, function(_, to) {
          var dialog
          if (to.line < 3 && document.querySelector &&
              (dialog = cm.display.wrapper.querySelector(".CodeMirror-dialog")) &&
              dialog.getBoundingClientRect().bottom - 4 > cm.cursorCoords(to, "window").top)
            (hiding = dialog).style.opacity = .4
        })
      };
      persistentDialog(cm, queryDialog, q, searchNext, function(event, query) {
        var keyName = CodeMirror.keyName(event)
        var cmd = CodeMirror.keyMap[cm.getOption("keyMap")][keyName]
        if (!cmd) cmd = cm.getOption('extraKeys')[keyName]
        if (cmd == "findNext" || cmd == "findPrev" ||
          cmd == "findPersistentNext" || cmd == "findPersistentPrev") {
          CodeMirror.e_stop(event);
          startSearch(cm, getSearchState(cm), query);
          cm.execCommand(cmd);
        } else if (cmd == "find" || cmd == "findPersistent") {
          CodeMirror.e_stop(event);
          searchNext(query, event);
        }
      });
      if (immediate && q) {
        startSearch(cm, state, q);
        findNext(cm, rev);
      }
    } else {
      dialog(cm, queryDialog, "Search for:", q, function(query) {
        if (query && !state.query) cm.operation(function() {
          startSearch(cm, state, query);
          state.posFrom = state.posTo = cm.getCursor();
          findNext(cm, rev);
        });
      });
    }
  }

  function findNext(cm, rev, callback) {cm.operation(function() {
    var state = getSearchState(cm);
    var cursor = getSearchCursor(cm, state.query, rev ? state.posFrom : state.posTo);
    if (!cursor.find(rev)) {
      cursor = getSearchCursor(cm, state.query, rev ? CodeMirror.Pos(cm.lastLine()) : CodeMirror.Pos(cm.firstLine(), 0));
      if (!cursor.find(rev)) return;
    }
    cm.setSelection(cursor.from(), cursor.to());
    cm.scrollIntoView({from: cursor.from(), to: cursor.to()}, 20);
    state.posFrom = cursor.from(); state.posTo = cursor.to();
    if (callback) callback(cursor.from(), cursor.to())
  });}

  function clearSearch(cm) {cm.operation(function() {
    var state = getSearchState(cm);
    state.lastQuery = state.query;
    if (!state.query) return;
    state.query = state.queryText = null;
    cm.removeOverlay(state.overlay);
    if (state.annotate) { state.annotate.clear(); state.annotate = null; }
  });}

  var replaceQueryDialog =
    ' <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>';
  var replacementQueryDialog = '<span class="CodeMirror-search-label">With:</span> <input type="text" style="width: 10em" class="CodeMirror-search-field"/>';
  var doReplaceConfirm = '<span class="CodeMirror-search-label">Replace?</span> <button>Yes</button> <button>No</button> <button>All</button> <button>Stop</button>';

  function replaceAll(cm, query, text) {
    cm.operation(function() {
      for (var cursor = getSearchCursor(cm, query); cursor.findNext();) {
        if (typeof query != "string") {
          var match = cm.getRange(cursor.from(), cursor.to()).match(query);
          cursor.replace(text.replace(/\$(\d)/g, function(_, i) {return match[i];}));
        } else cursor.replace(text);
      }
    });
  }

  function replace(cm, all) {
    if (cm.getOption("readOnly")) return;
    var query = cm.getSelection() || getSearchState(cm).lastQuery;
    var dialogText = '<span class="CodeMirror-search-label">' + (all ? 'Replace all:' : 'Replace:') + '</span>';
    dialog(cm, dialogText + replaceQueryDialog, dialogText, query, function(query) {
      if (!query) return;
      query = parseQuery(query);
      dialog(cm, replacementQueryDialog, "Replace with:", "", function(text) {
        text = parseString(text)
        if (all) {
          replaceAll(cm, query, text)
        } else {
          clearSearch(cm);
          var cursor = getSearchCursor(cm, query, cm.getCursor("from"));
          var advance = function() {
            var start = cursor.from(), match;
            if (!(match = cursor.findNext())) {
              cursor = getSearchCursor(cm, query);
              if (!(match = cursor.findNext()) ||
                  (start && cursor.from().line == start.line && cursor.from().ch == start.ch)) return;
            }
            cm.setSelection(cursor.from(), cursor.to());
            cm.scrollIntoView({from: cursor.from(), to: cursor.to()});
            confirmDialog(cm, doReplaceConfirm, "Replace?",
                          [function() {doReplace(match);}, advance,
                           function() {replaceAll(cm, query, text)}]);
          };
          var doReplace = function(match) {
            cursor.replace(typeof query == "string" ? text :
                           text.replace(/\$(\d)/g, function(_, i) {return match[i];}));
            advance();
          };
          advance();
        }
      });
    });
  }

  CodeMirror.commands.find = function(cm) {clearSearch(cm); doSearch(cm);};
  CodeMirror.commands.findPersistent = function(cm) {clearSearch(cm); doSearch(cm, false, true);};
  CodeMirror.commands.findPersistentNext = function(cm) {doSearch(cm, false, true, true);};
  CodeMirror.commands.findPersistentPrev = function(cm) {doSearch(cm, true, true, true);};
  CodeMirror.commands.findNext = doSearch;
  CodeMirror.commands.findPrev = function(cm) {doSearch(cm, true);};
  CodeMirror.commands.clearSearch = clearSearch;
  CodeMirror.commands.replace = replace;
  CodeMirror.commands.replaceAll = function(cm) {replace(cm, true);};
});




// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";

  var noOptions = {};
  var nonWS = /[^\s\u00a0]/;
  var Pos = CodeMirror.Pos;

  function firstNonWS(str) {
    var found = str.search(nonWS);
    return found == -1 ? 0 : found;
  }

  CodeMirror.commands.toggleComment = function(cm) {
    cm.toggleComment();
  };

  CodeMirror.defineExtension("toggleComment", function(options) {
    if (!options) options = noOptions;
    var cm = this;
    var minLine = Infinity, ranges = this.listSelections(), mode = null;
    for (var i = ranges.length - 1; i >= 0; i--) {
      var from = ranges[i].from(), to = ranges[i].to();
      if (from.line >= minLine) continue;
      if (to.line >= minLine) to = Pos(minLine, 0);
      minLine = from.line;
      if (mode == null) {
        if (cm.uncomment(from, to, options)) mode = "un";
        else { cm.lineComment(from, to, options); mode = "line"; }
      } else if (mode == "un") {
        cm.uncomment(from, to, options);
      } else {
        cm.lineComment(from, to, options);
      }
    }
  });

  // Rough heuristic to try and detect lines that are part of multi-line string
  function probablyInsideString(cm, pos, line) {
    return /\bstring\b/.test(cm.getTokenTypeAt(Pos(pos.line, 0))) && !/^[\'\"\`]/.test(line)
  }

  function getMode(cm, pos) {
    var mode = cm.getMode()
    return mode.useInnerComments === false || !mode.innerMode ? mode : cm.getModeAt(pos)
  }

  CodeMirror.defineExtension("lineComment", function(from, to, options) {
    if (!options) options = noOptions;
    var self = this, mode = getMode(self, from);
    var firstLine = self.getLine(from.line);
    if (firstLine == null || probablyInsideString(self, from, firstLine)) return;

    var commentString = options.lineComment || mode.lineComment;
    if (!commentString) {
      if (options.blockCommentStart || mode.blockCommentStart) {
        options.fullLines = true;
        self.blockComment(from, to, options);
      }
      return;
    }

    var end = Math.min(to.ch != 0 || to.line == from.line ? to.line + 1 : to.line, self.lastLine() + 1);
    var pad = options.padding == null ? " " : options.padding;
    var blankLines = options.commentBlankLines || from.line == to.line;

    self.operation(function() {
      if (options.indent) {
        var baseString = null;
        for (var i = from.line; i < end; ++i) {
          var line = self.getLine(i);
          var whitespace = line.slice(0, firstNonWS(line));
          if (baseString == null || baseString.length > whitespace.length) {
            baseString = whitespace;
          }
        }
        for (var i = from.line; i < end; ++i) {
          var line = self.getLine(i), cut = baseString.length;
          if (!blankLines && !nonWS.test(line)) continue;
          if (line.slice(0, cut) != baseString) cut = firstNonWS(line);
          self.replaceRange(baseString + commentString + pad, Pos(i, 0), Pos(i, cut));
        }
      } else {
        for (var i = from.line; i < end; ++i) {
          if (blankLines || nonWS.test(self.getLine(i)))
            self.replaceRange(commentString + pad, Pos(i, 0));
        }
      }
    });
  });

  CodeMirror.defineExtension("blockComment", function(from, to, options) {
    if (!options) options = noOptions;
    var self = this, mode = getMode(self, from);
    var startString = options.blockCommentStart || mode.blockCommentStart;
    var endString = options.blockCommentEnd || mode.blockCommentEnd;
    if (!startString || !endString) {
      if ((options.lineComment || mode.lineComment) && options.fullLines != false)
        self.lineComment(from, to, options);
      return;
    }
    if (/\bcomment\b/.test(self.getTokenTypeAt(Pos(from.line, 0)))) return

    var end = Math.min(to.line, self.lastLine());
    if (end != from.line && to.ch == 0 && nonWS.test(self.getLine(end))) --end;

    var pad = options.padding == null ? " " : options.padding;
    if (from.line > end) return;

    self.operation(function() {
      if (options.fullLines != false) {
        var lastLineHasText = nonWS.test(self.getLine(end));
        self.replaceRange(pad + endString, Pos(end));
        self.replaceRange(startString + pad, Pos(from.line, 0));
        var lead = options.blockCommentLead || mode.blockCommentLead;
        if (lead != null) for (var i = from.line + 1; i <= end; ++i)
          if (i != end || lastLineHasText)
            self.replaceRange(lead + pad, Pos(i, 0));
      } else {
        self.replaceRange(endString, to);
        self.replaceRange(startString, from);
      }
    });
  });

  CodeMirror.defineExtension("uncomment", function(from, to, options) {
    if (!options) options = noOptions;
    var self = this, mode = getMode(self, from);
    var end = Math.min(to.ch != 0 || to.line == from.line ? to.line : to.line - 1, self.lastLine()), start = Math.min(from.line, end);

    // Try finding line comments
    var lineString = options.lineComment || mode.lineComment, lines = [];
    var pad = options.padding == null ? " " : options.padding, didSomething;
    lineComment: {
      if (!lineString) break lineComment;
      for (var i = start; i <= end; ++i) {
        var line = self.getLine(i);
        var found = line.indexOf(lineString);
        if (found > -1 && !/comment/.test(self.getTokenTypeAt(Pos(i, found + 1)))) found = -1;
        if (found == -1 && nonWS.test(line)) break lineComment;
        if (found > -1 && nonWS.test(line.slice(0, found))) break lineComment;
        lines.push(line);
      }
      self.operation(function() {
        for (var i = start; i <= end; ++i) {
          var line = lines[i - start];
          var pos = line.indexOf(lineString), endPos = pos + lineString.length;
          if (pos < 0) continue;
          if (line.slice(endPos, endPos + pad.length) == pad) endPos += pad.length;
          didSomething = true;
          self.replaceRange("", Pos(i, pos), Pos(i, endPos));
        }
      });
      if (didSomething) return true;
    }

    // Try block comments
    var startString = options.blockCommentStart || mode.blockCommentStart;
    var endString = options.blockCommentEnd || mode.blockCommentEnd;
    if (!startString || !endString) return false;
    var lead = options.blockCommentLead || mode.blockCommentLead;
    var startLine = self.getLine(start), open = startLine.indexOf(startString)
    if (open == -1) return false
    var endLine = end == start ? startLine : self.getLine(end)
    var close = endLine.indexOf(endString, end == start ? open + startString.length : 0);
    if (close == -1 && start != end) {
      endLine = self.getLine(--end);
      close = endLine.indexOf(endString);
    }
    var insideStart = Pos(start, open + 1), insideEnd = Pos(end, close + 1)
    if (close == -1 ||
        !/comment/.test(self.getTokenTypeAt(insideStart)) ||
        !/comment/.test(self.getTokenTypeAt(insideEnd)) ||
        self.getRange(insideStart, insideEnd, "\n").indexOf(endString) > -1)
      return false;

    // Avoid killing block comments completely outside the selection.
    // Positions of the last startString before the start of the selection, and the first endString after it.
    var lastStart = startLine.lastIndexOf(startString, from.ch);
    var firstEnd = lastStart == -1 ? -1 : startLine.slice(0, from.ch).indexOf(endString, lastStart + startString.length);
    if (lastStart != -1 && firstEnd != -1 && firstEnd + endString.length != from.ch) return false;
    // Positions of the first endString after the end of the selection, and the last startString before it.
    firstEnd = endLine.indexOf(endString, to.ch);
    var almostLastStart = endLine.slice(to.ch).lastIndexOf(startString, firstEnd - to.ch);
    lastStart = (firstEnd == -1 || almostLastStart == -1) ? -1 : to.ch + almostLastStart;
    if (firstEnd != -1 && lastStart != -1 && lastStart != to.ch) return false;

    self.operation(function() {
      self.replaceRange("", Pos(end, close - (pad && endLine.slice(close - pad.length, close) == pad ? pad.length : 0)),
                        Pos(end, close + endString.length));
      var openEnd = open + startString.length;
      if (pad && startLine.slice(openEnd, openEnd + pad.length) == pad) openEnd += pad.length;
      self.replaceRange("", Pos(start, open), Pos(start, openEnd));
      if (lead) for (var i = start + 1; i <= end; ++i) {
        var line = self.getLine(i), found = line.indexOf(lead);
        if (found == -1 || nonWS.test(line.slice(0, found))) continue;
        var foundEnd = found + lead.length;
        if (pad && line.slice(foundEnd, foundEnd + pad.length) == pad) foundEnd += pad.length;
        self.replaceRange("", Pos(i, found), Pos(i, foundEnd));
      }
    });
    return true;
  });
});



// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  var modes = ["clike", "css", "javascript"];

  for (var i = 0; i < modes.length; ++i)
    CodeMirror.extendMode(modes[i], {blockCommentContinue: " * "});

  function continueComment(cm) {
    if (cm.getOption("disableInput")) return CodeMirror.Pass;
    var ranges = cm.listSelections(), mode, inserts = [];
    for (var i = 0; i < ranges.length; i++) {
      var pos = ranges[i].head, token = cm.getTokenAt(pos);
      if (token.type != "comment") return CodeMirror.Pass;
      var modeHere = CodeMirror.innerMode(cm.getMode(), token.state).mode;
      if (!mode) mode = modeHere;
      else if (mode != modeHere) return CodeMirror.Pass;

      var insert = null;
      if (mode.blockCommentStart && mode.blockCommentContinue) {
        var end = token.string.indexOf(mode.blockCommentEnd);
        var full = cm.getRange(CodeMirror.Pos(pos.line, 0), CodeMirror.Pos(pos.line, token.end)), found;
        if (end != -1 && end == token.string.length - mode.blockCommentEnd.length && pos.ch >= end) {
          // Comment ended, don't continue it
        } else if (token.string.indexOf(mode.blockCommentStart) == 0) {
          insert = full.slice(0, token.start);
          if (!/^\s*$/.test(insert)) {
            insert = "";
            for (var j = 0; j < token.start; ++j) insert += " ";
          }
        } else if ((found = full.indexOf(mode.blockCommentContinue)) != -1 &&
                   found + mode.blockCommentContinue.length > token.start &&
                   /^\s*$/.test(full.slice(0, found))) {
          insert = full.slice(0, found);
        }
        if (insert != null) insert += mode.blockCommentContinue;
      }
      if (insert == null && mode.lineComment && continueLineCommentEnabled(cm)) {
        var line = cm.getLine(pos.line), found = line.indexOf(mode.lineComment);
        if (found > -1) {
          insert = line.slice(0, found);
          if (/\S/.test(insert)) insert = null;
          else insert += mode.lineComment + line.slice(found + mode.lineComment.length).match(/^\s*/)[0];
        }
      }
      if (insert == null) return CodeMirror.Pass;
      inserts[i] = "\n" + insert;
    }

    cm.operation(function() {
      for (var i = ranges.length - 1; i >= 0; i--)
        cm.replaceRange(inserts[i], ranges[i].from(), ranges[i].to(), "+insert");
    });
  }

  function continueLineCommentEnabled(cm) {
    var opt = cm.getOption("continueComments");
    if (opt && typeof opt == "object")
      return opt.continueLineComment !== false;
    return true;
  }

  CodeMirror.defineOption("continueComments", null, function(cm, val, prev) {
    if (prev && prev != CodeMirror.Init)
      cm.removeKeyMap("continueComment");
    if (val) {
      var key = "Enter";
      if (typeof val == "string")
        key = val;
      else if (typeof val == "object" && val.key)
        key = val.key;
      var map = {name: "continueComment"};
      map[key] = continueComment;
      cm.addKeyMap(map);
    }
  });
});


// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

// Open simple dialogs on top of an editor. Relies on dialog.css.

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  function dialogDiv(cm, template, bottom) {
    var wrap = cm.getWrapperElement();
    var dialog;
    dialog = wrap.appendChild(document.createElement("div"));
    if (bottom)
      dialog.className = "CodeMirror-dialog CodeMirror-dialog-bottom";
    else
      dialog.className = "CodeMirror-dialog CodeMirror-dialog-top";

    if (typeof template == "string") {
      dialog.innerHTML = template;
    } else { // Assuming it's a detached DOM element.
      dialog.appendChild(template);
    }
    return dialog;
  }

  function closeNotification(cm, newVal) {
    if (cm.state.currentNotificationClose)
      cm.state.currentNotificationClose();
    cm.state.currentNotificationClose = newVal;
  }

  CodeMirror.defineExtension("openDialog", function(template, callback, options) {
    if (!options) options = {};

    closeNotification(this, null);

    var dialog = dialogDiv(this, template, options.bottom);
    var closed = false, me = this;
    function close(newVal) {
      if (typeof newVal == 'string') {
        inp.value = newVal;
      } else {
        if (closed) return;
        closed = true;
        dialog.parentNode.removeChild(dialog);
        me.focus();

        if (options.onClose) options.onClose(dialog);
      }
    }

    var inp = dialog.getElementsByTagName("input")[0], button;
    if (inp) {
      inp.focus();

      if (options.value) {
        inp.value = options.value;
        if (options.selectValueOnOpen !== false) {
          inp.select();
        }
      }

      if (options.onInput)
        CodeMirror.on(inp, "input", function(e) { options.onInput(e, inp.value, close);});
      if (options.onKeyUp)
        CodeMirror.on(inp, "keyup", function(e) {options.onKeyUp(e, inp.value, close);});

      CodeMirror.on(inp, "keydown", function(e) {
        if (options && options.onKeyDown && options.onKeyDown(e, inp.value, close)) { return; }
        if (e.keyCode == 27 || (options.closeOnEnter !== false && e.keyCode == 13)) {
          inp.blur();
          CodeMirror.e_stop(e);
          close();
        }
        if (e.keyCode == 13) callback(inp.value, e);
      });

      if (options.closeOnBlur !== false) CodeMirror.on(inp, "blur", close);
    } else if (button = dialog.getElementsByTagName("button")[0]) {
      CodeMirror.on(button, "click", function() {
        close();
        me.focus();
      });

      if (options.closeOnBlur !== false) CodeMirror.on(button, "blur", close);

      button.focus();
    }
    return close;
  });

  CodeMirror.defineExtension("openConfirm", function(template, callbacks, options) {
    closeNotification(this, null);
    var dialog = dialogDiv(this, template, options && options.bottom);
    var buttons = dialog.getElementsByTagName("button");
    var closed = false, me = this, blurring = 1;
    function close() {
      if (closed) return;
      closed = true;
      dialog.parentNode.removeChild(dialog);
      me.focus();
    }
    buttons[0].focus();
    for (var i = 0; i < buttons.length; ++i) {
      var b = buttons[i];
      (function(callback) {
        CodeMirror.on(b, "click", function(e) {
          CodeMirror.e_preventDefault(e);
          close();
          if (callback) callback(me);
        });
      })(callbacks[i]);
      CodeMirror.on(b, "blur", function() {
        --blurring;
        setTimeout(function() { if (blurring <= 0) close(); }, 200);
      });
      CodeMirror.on(b, "focus", function() { ++blurring; });
    }
  });

  /*
   * openNotification
   * Opens a notification, that can be closed with an optional timer
   * (default 5000ms timer) and always closes on click.
   *
   * If a notification is opened while another is opened, it will close the
   * currently opened one and open the new one immediately.
   */
  CodeMirror.defineExtension("openNotification", function(template, options) {
    closeNotification(this, close);
    var dialog = dialogDiv(this, template, options && options.bottom);
    var closed = false, doneTimer;
    var duration = options && typeof options.duration !== "undefined" ? options.duration : 5000;

    function close() {
      if (closed) return;
      closed = true;
      clearTimeout(doneTimer);
      dialog.parentNode.removeChild(dialog);
    }

    CodeMirror.on(dialog, 'click', function(e) {
      CodeMirror.e_preventDefault(e);
      close();
    });

    if (duration)
      doneTimer = setTimeout(close, duration);

    return close;
  });
});


// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

// Defines jumpToLine command. Uses dialog.js if present.

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"), require("../dialog/dialog"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror", "../dialog/dialog"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";

  function dialog(cm, text, shortText, deflt, f) {
    if (cm.openDialog) cm.openDialog(text, f, {value: deflt, selectValueOnOpen: true});
    else f(prompt(shortText, deflt));
  }

  var jumpDialog =
      'Jump to line: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use line:column or scroll% syntax)</span>';

  function interpretLine(cm, string) {
    var num = Number(string)
    if (/^[-+]/.test(string)) return cm.getCursor().line + num
    else return num - 1
  }

  CodeMirror.commands.jumpToLine = function(cm) {
    var cur = cm.getCursor();
    dialog(cm, jumpDialog, "Jump to line:", (cur.line + 1) + ":" + cur.ch, function(posStr) {
      if (!posStr) return;

      var match;
      if (match = /^\s*([\+\-]?\d+)\s*\:\s*(\d+)\s*$/.exec(posStr)) {
        cm.setCursor(interpretLine(cm, match[1]), Number(match[2]))
      } else if (match = /^\s*([\+\-]?\d+(\.\d+)?)\%\s*/.exec(posStr)) {
        var line = Math.round(cm.lineCount() * Number(match[1]) / 100);
        if (/^[-+]/.test(match[1])) line = cur.line + line + 1;
        cm.setCursor(line - 1, cur.ch);
      } else if (match = /^\s*\:?\s*([\+\-]?\d+)\s*/.exec(posStr)) {
        cm.setCursor(interpretLine(cm, match[1]), cur.ch);
      }
    });
  };

  CodeMirror.keyMap["default"]["Alt-G"] = "jumpToLine";
});




(function(mod) {
    if (typeof exports == "object" && typeof module == "object") // CommonJS
        mod(require("codemirror"));
    else if (typeof define == "function" && define.amd) // AMD
        define(["codemirror" ], mod);
    else // Plain browser env
        mod(CodeMirror);
})(function(CodeMirror) {

    CodeMirror.defineExtension("colorpicker", function () {

        var cm  = this;

        var color = {

            trim : function (str) {
                return str.replace(/^\s+|\s+$/g, '');
            },

            /**
             * @method format
             *
             * convert color to format string
             *
             *     // hex
             *     color.format({ r : 255, g : 255, b : 255 }, 'hex')  // #FFFFFF
             *
             *     // rgb
             *     color.format({ r : 255, g : 255, b : 255 }, 'rgb') // rgba(255, 255, 255, 0.5);
             *
             *     // rgba
             *     color.format({ r : 255, g : 255, b : 255, a : 0.5 }, 'rgb') // rgba(255, 255, 255, 0.5);
             *
             * @param {Object} obj  obj has r, g, b and a attributes
             * @param {"hex"/"rgb"} type  format string type
             * @returns {*}
             */
            format : function(obj, type) {
                if (type == 'hex') {
                    var r = obj.r.toString(16);
                    if (obj.r < 16) r = "0" + r;

                    var g = obj.g.toString(16);
                    if (obj.g < 16) g = "0" + g;

                    var b = obj.b.toString(16);
                    if (obj.b < 16) b = "0" + b;

                    return "#" + [r, g, b].join("");
                } else if (type == 'rgb') {
                    if (typeof obj.a == 'undefined') {
                        return "rgb(" + [obj.r, obj.g, obj.b].join(",") + ")";
                    } else {
                        return "rgba(" + [obj.r, obj.g, obj.b, obj.a].join(",") + ")";
                    }
                } else if (type == 'hsl') {
                    if (typeof obj.a == 'undefined') {
                        return "hsl(" + [obj.h, obj.s + '%', obj.l + '%'].join(",") + ")";
                    } else {
                        return "hsla(" + [obj.h, obj.s + '%', obj.l + '%', obj.a].join(",") + ")";
                    }
                }

                return obj;
            },

            /**
             * @method rgb
             *
             * parse string to rgb color
             *
             * 		color.rgb("#FF0000") === { r : 255, g : 0, b : 0 }
             *
             * 		color.rgb("rgb(255, 0, 0)") == { r : 255, g : 0, b : }
             *
             * @param {String} str color string
             * @returns {Object}  rgb object
             */
            parse : function (str) {
                if (typeof str == 'string') {
                    if (str.indexOf("rgb(") > -1) {
                        var arr = str.replace("rgb(", "").replace(")","").split(",");

                        for(var i = 0, len = arr.length; i < len; i++) {
                            arr[i] = parseInt(color.trim(arr[i]), 10);
                        }

                        return { type : 'rgb', r : arr[0], g : arr[1], b : arr[2], a : 1	};
                    } else if (str.indexOf("rgba(") > -1) {
                        var arr = str.replace("rgba(", "").replace(")", "").split(",");

                        for (var i = 0, len = arr.length; i < len; i++) {

                            if (len - 1 == i) {
                                arr[i] = parseFloat(color.trim(arr[i]));
                            } else {
                                arr[i] = parseInt(color.trim(arr[i]), 10);
                            }
                        }

                        return {type: 'rgb', r: arr[0], g: arr[1], b: arr[2], a: arr[3]};
                    } else if (str.indexOf("hsl(") > -1) {
                        var arr = str.replace("hsl(", "").replace(")","").split(",");

                        for(var i = 0, len = arr.length; i < len; i++) {
                            arr[i] = parseInt(color.trim(arr[i]), 10);
                        }

                        var obj = { type : 'hsl', h : arr[0], s : arr[1], l : arr[2], a : 1	};

                        var temp = color.HSLtoRGB(obj.h, obj.s, obj.l);

                        obj.r = temp.r;
                        obj.g = temp.g;
                        obj.b = temp.b;

                        return obj;
                    } else if (str.indexOf("hsla(") > -1) {
                        var arr = str.replace("hsla(", "").replace(")", "").split(",");

                        for (var i = 0, len = arr.length; i < len; i++) {

                            if (len - 1 == i) {
                                arr[i] = parseFloat(color.trim(arr[i]));
                            } else {
                                arr[i] = parseInt(color.trim(arr[i]), 10);
                            }
                        }

                        var obj = {type: 'hsl', h: arr[0], s: arr[1], l: arr[2], a: arr[3]};

                        var temp = color.HSLtoRGB(obj.h, obj.s, obj.l);

                        obj.r = temp.r;
                        obj.g = temp.g;
                        obj.b = temp.b;

                        return obj;
                    } else if (str.indexOf("#") == 0) {

                        str = str.replace("#", "");

                        var arr = [];
                        if (str.length == 3) {
                            for(var i = 0, len = str.length; i < len; i++) {
                                var char = str.substr(i, 1);
                                arr.push(parseInt(char+char, 16));
                            }
                        } else {
                            for(var i = 0, len = str.length; i < len; i+=2) {
                                arr.push(parseInt(str.substr(i, 2), 16));
                            }
                        }

                        return { type : 'hex', r : arr[0], g : arr[1], b : arr[2], a : 1	};
                    }
                }

                return str;

            },

            /**
             * @method HSVtoRGB
             *
             * convert hsv to rgb
             *
             * 		color.HSVtoRGB(0,0,1) === #FFFFF === { r : 255, g : 0, b : 0 }
             *
             * @param {Number} H  hue color number  (min : 0, max : 360)
             * @param {Number} S  Saturation number  (min : 0, max : 1)
             * @param {Number} V  Value number 		(min : 0, max : 1 )
             * @returns {Object}
             */
            HSVtoRGB : function (H, S, V) {

                if (H == 360) {
                    H = 0;
                }

                var C = S * V;
                var X = C * (1 -  Math.abs((H/60) % 2 -1)  );
                var m = V - C;

                var temp = [];

                if (0 <= H && H < 60) { temp = [C, X, 0]; }
                else if (60 <= H && H < 120) { temp = [X, C, 0]; }
                else if (120 <= H && H < 180) { temp = [0, C, X]; }
                else if (180 <= H && H < 240) { temp = [0, X, C]; }
                else if (240 <= H && H < 300) { temp = [X, 0, C]; }
                else if (300 <= H && H < 360) { temp = [C, 0, X]; }

                return {
                    r : Math.ceil((temp[0] + m) * 255),
                    g : Math.ceil((temp[1] + m) * 255),
                    b : Math.ceil((temp[2] + m) * 255)
                };
            },

            /**
             * @method RGBtoHSV
             *
             * convert rgb to hsv
             *
             * 		color.RGBtoHSV(0, 0, 255) === { h : 240, s : 1, v : 1 } === '#FFFF00'
             *
             * @param {Number} R  red color value
             * @param {Number} G  green color value
             * @param {Number} B  blue color value
             * @return {Object}  hsv color code
             */
            RGBtoHSV : function (R, G, B) {

                var R1 = R / 255;
                var G1 = G / 255;
                var B1 = B / 255;

                var MaxC = Math.max(R1, G1, B1);
                var MinC = Math.min(R1, G1, B1);

                var DeltaC = MaxC - MinC;

                var H = 0;

                if (DeltaC == 0) { H = 0; }
                else if (MaxC == R1) {
                    H = 60 * (( (G1 - B1) / DeltaC) % 6);
                } else if (MaxC == G1) {
                    H  = 60 * (( (B1 - R1) / DeltaC) + 2);
                } else if (MaxC == B1) {
                    H  = 60 * (( (R1 - G1) / DeltaC) + 4);
                }

                if (H < 0) {
                    H = 360 + H;
                }

                var S = 0;

                if (MaxC == 0) S = 0;
                else S = DeltaC / MaxC;

                var V = MaxC;

                return { h : H, s : S, v :  V };
            },

            RGBtoHSL : function (r, g, b) {
                r /= 255, g /= 255, b /= 255;
                var max = Math.max(r, g, b), min = Math.min(r, g, b);
                var h, s, l = (max + min) / 2;

                if(max == min){
                    h = s = 0; // achromatic
                }else{
                    var d = max - min;
                    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                    switch(max){
                        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                        case g: h = (b - r) / d + 2; break;
                        case b: h = (r - g) / d + 4; break;
                    }
                    h /= 6;
                }

                return { h : Math.round(h * 360) , s : Math.round(s * 100), l : Math.round(l * 100)};
            },

            HUEtoRGB : function (p, q, t) {
                if(t < 0) t += 1;
                if(t > 1) t -= 1;
                if(t < 1/6) return p + (q - p) * 6 * t;
                if(t < 1/2) return q;
                if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                return p;
            },

            HSLtoRGB : function (h, s, l) {
                var r, g, b;

                h /= 360;
                s /= 100;
                l /= 100;

                if(s == 0){
                    r = g = b = l; // achromatic
                }else{
                    var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                    var p = 2 * l - q;
                    r = this.HUEtoRGB(p, q, h + 1/3);
                    g = this.HUEtoRGB(p, q, h);
                    b = this.HUEtoRGB(p, q, h - 1/3);
                }

                return { r : r * 255, g : g * 255, b : b * 255 };
            }
        };

        var hue_color = [
            { rgb : '#ff0000', start : .0 },
            { rgb : '#ffff00', start : .17 },
            { rgb : '#00ff00', start : .33 },
            { rgb : '#00ffff', start : .50 },
            { rgb : '#0000ff', start : .67 },
            { rgb : '#ff00ff', start : .83 },
            { rgb : '#ff0000', start : 1 }
        ];

        var $body, $root, $hue, $color, $value, $saturation, $drag_pointer, $drag_bar,
            $control, $controlPattern, $controlColor, $hueContainer, $opacity, $opacityContainer, $opacityColorBar, $formatChangeButton,
            $opacity_drag_bar, $information, $informationChange;

        var currentA, currentH, currentS, currentV;
        var $hexCode;
        var $rgb_r, $rgb_g, $rgb_b, $rgb_a;
        var $hsl_h, $hsl_s, $hsl_l, $hsl_a;
        var cssPrefix = getCssValuePrefix();

        var colorpickerCallback = function () {};
        var counter = 0;
        var cached = {};
        var isColorPickerShow = false;
        var isShortCut = false;
        var hideDelay = 2000;

        function dom(tag, className, attr) {

            if (typeof tag != 'string') {
                this.el = tag;
            } else {

                var el  = document.createElement(tag);

                this.uniqId = counter++;

                el.className = className;

                attr = attr || {};

                for(var k in attr) {
                    el.setAttribute(k, attr[k]);
                }

                this.el = el;
            }
        }

        dom.prototype.closest = function (cls) {

            var temp = this;
            var checkCls = false;

            while(!(checkCls = temp.hasClass(cls))) {
                if (temp.el.parentNode) {
                    temp = new dom(temp.el.parentNode);
                } else {
                    return null;
                }
            }

            if (checkCls) {
                return temp;
            }

            return null;
        }

        dom.prototype.removeClass = function (cls) {
            this.el.className = color.trim((" " + this.el.className + " ").replace(' ' + cls + ' ', ' '));
        }

        dom.prototype.hasClass = function (cls) {
            if (!this.el.className)
            {
                return false;
            } else {
                var newClass = ' ' + this.el.className + ' ';
                return newClass.indexOf(' ' + cls + ' ') > -1;
            }
        }

        dom.prototype.addClass = function (cls) {
            if (!this.hasClass(cls)) {
                this.el.className = this.el.className + " " + cls;
            }

        }

        dom.prototype.html = function (html) {
            this.el.innerHTML = html;

            return this;
        }

        dom.prototype.empty = function () {
            return this.html('');
        }

        dom.prototype.append = function (el) {

            if (typeof el == 'string') {
                this.el.appendChild(document.createTextNode(el));
            } else {
                this.el.appendChild(el.el || el);
            }

            return this;
        }

        dom.prototype.appendTo = function (target) {
            var t = target.el ? target.el : target;

            t.appendChild(this.el);

            return this;
        }

        dom.prototype.remove = function () {
            if (this.el.parentNode) {
                this.el.parentNode.removeChild(this.el);
            }

            return this;
        }

        dom.prototype.text = function () {
            return this.el.textContent;
        }

        dom.prototype.css = function (key, value) {
            if (arguments.length == 2) {
                this.el.style[key] = value;
            } else if (arguments.length == 1) {

                if (typeof key == 'string') {
                    return getComputedStyle(this.el)[key];
                } else {
                    var keys = key || {};
                    for(var k in keys) {
                        this.el.style[k] = keys[k];
                    }
                }

            }

            return this;
        }

        dom.prototype.offset = function () {
            var rect = this.el.getBoundingClientRect();

            return {
                top: rect.top + document.body.scrollTop,
                left: rect.left + document.body.scrollLeft
            };
        }

        dom.prototype.position = function () {
            return {
                top: parseFloat(this.el.style.top),
                left: parseFloat(this.el.style.left)
            };
        }

        dom.prototype.width = function () {
            return this.el.offsetWidth;
        }

        dom.prototype.height = function () {
            return this.el.offsetHeight;
        }

        dom.prototype.dataKey = function (key) {
            return this.uniqId + '.' + key;
        }

        dom.prototype.data = function (key, value) {
            if (arguments.length == 2) {
                cached[this.dataKey(key)] = value;
            } else if (arguments.length == 1) {
                return cached[this.dataKey(key)];
            } else {
                var keys = Object.keys(cached);

                var uniqId = this.uniqId + ".";
                return keys.filter(function (key) {
                    if (key.indexOf(uniqId) == 0) {
                        return true;
                    }

                    return false;
                }).map(function (value) {
                    return cached[value];
                })
            }

            return this;
        }

        dom.prototype.val = function (value) {
            if (arguments.length == 0) {
                return this.el.value;
            } else if (arguments.length == 1) {
                this.el.value = value;
            }

            return this;
        }

        dom.prototype.int = function () {
            return parseInt(this.val(), 10);
        }

        dom.prototype.show = function () {
            return this.css('display', 'block');
        }

        dom.prototype.hide = function () {
            return this.css('display', 'none');
        }

        function setRGBInput(r, g, b) {
            $rgb_r.val(r);
            $rgb_g.val(g);
            $rgb_b.val(b);
            $rgb_a.val(currentA);
        }

        function setHSLInput(h, s, l) {
            $hsl_h.val(h);
            $hsl_s.val(s + '%');
            $hsl_l.val(l + '%');
            $hsl_a.val(currentA);
        }

        function getHexFormat() {
            return color.format({
                r : $rgb_r.int(),
                g : $rgb_g.int(),
                b : $rgb_b.int()
            }, 'hex');
        }

        function convertRGB() {
            return color.HSVtoRGB(currentH, currentS, currentV);
        }

        function convertHEX() {
            return color.format(convertRGB(), 'hex');
        }

        function convertHSL() {
            var rgb = color.HSVtoRGB(currentH, currentS, currentV);
            return color.RGBtoHSL(rgb.r, rgb.g, rgb.b);
        }

        function getFormattedColor (format) {
            format = format || 'hex';

            if (format == 'rgb') {
                var rgb = convertRGB();
                rgb.a = currentA == 1 ? undefined : currentA;
                return color.format(rgb, 'rgb');
            } else if (format == 'hsl') {
                var hsl = convertHSL();
                hsl.a = currentA == 1 ? undefined : currentA;
                return color.format(hsl, 'hsl');
            } else {
                var rgb = convertRGB();
                return color.format(rgb, 'hex');
            }
        }

        function setControlColor (color) {
            $controlColor.css('background-color', color);
        }

        function setInputColor() {

            var format = $information.data('format') || 'hex';

            var rgb = null;
            if (format == 'hex') {
                $hexCode.val(convertHEX());
            } else if (format == 'rgb') {
                var rgb = convertRGB();
                setRGBInput(rgb.r, rgb.g, rgb.b);
            } else if (format == 'hsl') {
                var hsl = convertHSL();
                setHSLInput(hsl.h, hsl.s, hsl.l);
            }

            // set background
            setControlColor(getFormattedColor('rgb'));

            var rgb = convertRGB();
            var colorString = color.format(rgb, 'rgb');
            setOpacityColorBar(colorString);

            if (typeof colorpickerCallback == 'function') {

                if (!isNaN(currentA)) {
                    colorpickerCallback(getFormattedColor(format));
                }

            }
        }

        function setMainColor(e) {
            e.preventDefault();
            var pos = $root.position();         // position for screen
            var w = $color.width();
            var h = $color.height();

            var x = e.clientX - pos.left;
            var y = e.clientY - pos.top;

            if (x < 0) x = 0;
            else if (x > w) x = w;

            if (y < 0) y = 0;
            else if (y > h) y = h;

            $drag_pointer.css({
                left: (x - 5) + 'px',
                top: (y - 5) + 'px'
            });

            $drag_pointer.data('pos', { x: x, y : y});

            caculateHSV()
            setInputColor();
        }

        function scale (startColor, endColor, t) {
            var obj = {
                r : parseInt(startColor.r + (endColor.r - startColor.r) * t, 10) ,
                g : parseInt(startColor.g + (endColor.g - startColor.g) * t, 10),
                b : parseInt(startColor.b + (endColor.b - startColor.b) * t, 10)
            };

            return color.format(obj, 'hex');

        }

        function checkHueColor(p) {
            var startColor, endColor;

            for(var i = 0; i < hue_color.length;i++) {
                if (hue_color[i].start >= p) {
                    startColor = hue_color[i-1];
                    endColor = hue_color[i];
                    break;
                }
            }

            if (startColor && endColor) {
                return scale(startColor, endColor, (p - startColor.start)/(endColor.start - startColor.start));
            }

            return hue_color[0].rgb;
        }

        function setBackgroundColor (color) {
            $color.css("background-color", color);
        }

        function setCurrentH (h) {
            currentH = h;
        }

        function setHueColor(e) {
            var min = $hueContainer.offset().left;
            var max = min + $hueContainer.width();
            var current = e ? pos(e).clientX : min + (max - min) * (currentH / 360);

            var dist;
            if (current < min) {
                dist = 0;
            } else if (current > max) {
                dist = 100;
            } else {
                dist = (current - min) / (max - min) * 100;
            }

            var x = ($hueContainer.width() * (dist/100));

            $drag_bar.css({
                left: (x -Math.ceil($drag_bar.width()/2)) + 'px'
            });

            $drag_bar.data('pos', { x : x});

            var hueColor = checkHueColor(dist/100);

            setBackgroundColor(hueColor);
            setCurrentH((dist/100) * 360);
            setInputColor();
        }

        function getCssValuePrefix()
        {
            var rtrnVal = '';//default to standard syntax
            var prefixes = ['', '-o-', '-ms-', '-moz-', '-webkit-'];

            // Create a temporary DOM object for testing
            var dom = document.createElement('div');

            for (var i = 0; i < prefixes.length; i++)
            {
                // Attempt to set the style
                dom.style.background = prefixes[i] + 'linear-gradient(#000000, #ffffff)';

                // Detect if the style was successfully set
                if (dom.style.background)
                {
                    rtrnVal = prefixes[i];
                }
            }

            dom = null;
            delete dom;

            return rtrnVal;
        }

        function setOpacityColorBar(hueColor) {
            var rgb = color.parse(hueColor);

            rgb.a = 0;
            var start = color.format(rgb, 'rgb');

            rgb.a = 1;
            var end = color.format(rgb, 'rgb');

            var prefix = cssPrefix;
            $opacityColorBar.css('background',  'linear-gradient(to right, ' + start + ', ' + end + ')');
        }

        function setOpacity(e) {
            var min = $opacityContainer.offset().left;
            var max = min + $opacityContainer.width();
            var current = pos(e).clientX;
            var dist;

            if (current < min) {
                dist = 0;
            } else if (current > max) {
                dist = 100;
            } else {
                dist = (current - min) / (max - min) * 100;
            }

            var x = ($opacityContainer.width() * (dist/100));

            $opacity_drag_bar.css({
                left: (x -Math.ceil($opacity_drag_bar.width()/2)) + 'px'
            });

            $opacity_drag_bar.data('pos', { x : x });

            caculateOpacity();
            currentFormat();
            setInputColor();
        }

        function caculateOpacity() {
            var opacityPos = $opacity_drag_bar.data('pos') || { x : 0 };
            var a = Math.round((opacityPos.x / $opacityContainer.width()) * 100) / 100;

            currentA = isNaN(a) ? 1 : a;
        }

        function caculateHSV() {
            var pos = $drag_pointer.data('pos') || { x : 0, y : 0 };
            var huePos = $drag_bar.data('pos') || { x : 0 };

            var width = $color.width();
            var height = $color.height();

            var h = (huePos.x / $hueContainer.width()) * 360;
            var s = (pos.x / width);
            var v = ((height - pos.y) / height);

            if (width == 0) {
                h = 0;
                s = 0;
                v = 0;
            }

            currentH = h;
            currentS = s;
            currentV = v;
        }

        function pos(e) {
            if (e.touches && e.touches[0]) {
                return e.touches[0];
            }

            return e;
        }

        function checkNumberKey(e) {
            var code = e.which,
                isExcept = false;

            if(code == 37 || code == 39 || code == 8 || code == 46 || code == 9)
                isExcept = true;

            if(!isExcept && (code < 48 || code > 57))
                return false;

            return true;
        }

        function setRGBtoHexColor(e) {
            var r = $rgb_r.val(),
                g = $rgb_g.val(),
                b = $rgb_b.val();

            if(r == "" || g == "" || b == "") return;

            if(parseInt(r) > 255) $rgb_r.val(255);
            else $rgb_r.val(parseInt(r));

            if(parseInt(g) > 255) $rgb_g.val(255);
            else $rgb_g.val(parseInt(g));

            if(parseInt(b) > 255) $rgb_b.val(255);
            else $rgb_b.val(parseInt(b));

            initColor(getHexFormat());
        }

        function setColorUI() {
            var  x = $color.width() * currentS, y = $color.height() * ( 1 - currentV );

            $drag_pointer.css({
                left : (x - 5) + "px",
                top : (y - 5) + "px"
            });

            $drag_pointer.data('pos', { x  : x, y : y });

            var hueX = $hueContainer.width() * (currentH / 360);

            $drag_bar.css({
                left : (hueX - 7.5) + 'px'
            });

            $drag_bar.data('pos', { x : hueX });

            var opacityX = $opacityContainer.width() * (currentA || 0);

            $opacity_drag_bar.css({
                left : (opacityX - 7.5) + 'px'
            });

            $opacity_drag_bar.data('pos', { x : opacityX });
        }

        function setCurrentHSV (h, s, v, a) {
            currentA = a;
            currentH = h;
            currentS = s;
            currentV = v;
        }

        function setCurrentFormat (format) {
            $information.data('format', format);
            initFormat();
        }



        function initColor(newColor) {
            var c = newColor || "#FF0000", colorObj = color.parse(c);

            setCurrentFormat(colorObj.type);
            setBackgroundColor(c);

            var hsv = color.RGBtoHSV(colorObj.r, colorObj.g, colorObj.b);

            setCurrentHSV(hsv.h, hsv.s, hsv.v, colorObj.a);
            setColorUI();
            setHueColor();
            setInputColor();
        }

        function addEvent (dom, eventName, callback) {
            dom.addEventListener(eventName, callback);
        }

        function removeEvent(dom, eventName, callback) {
            dom.removeEventListener(eventName, callback);
        }

        function EventColorMouseDown(e) {
            $color.data('isDown', true);
            setMainColor(e);
        }

        function EventColorMouseUp(e) {
            $color.data('isDown', false);
        }

        function EventDragBarMouseDown (e) {
            e.preventDefault();
            $hue.data('isDown', true);
        }

        function EventOpacityDragBarMouseDown(e) {
            e.preventDefault();
            $opacity.data('isDown', true);
        }

        function EventHueMouseDown (e) {
            $hue.data('isDown', true);
            setHueColor(e);
        }

        function EventOpacityMouseDown (e) {
            $opacity.data('isDown', true);
            setOpacity(e);
        }

        function EventHexCodeKeyDown(e) {
            if(e.which < 65 || e.which > 70) {
                return checkNumberKey(e);
            }
        }

        function EventHexCodeKeyUp (e) {
            var code = $hexCode.val();

            if(code.charAt(0) == '#' && code.length == 7) {
                initColor(code);
            }
        }

        function EventFormatChangeClick(e) {
            nextFormat();
        }

        function initEvent() {
            addEvent($color.el, 'mousedown', EventColorMouseDown);
            addEvent($color.el, 'mouseup', EventColorMouseUp);
            addEvent($drag_bar.el, 'mousedown', EventDragBarMouseDown);
            addEvent($opacity_drag_bar.el, 'mousedown', EventOpacityDragBarMouseDown);
            addEvent($hueContainer.el, 'mousedown', EventHueMouseDown);
            addEvent($opacityContainer.el, 'mousedown', EventOpacityMouseDown);
            addEvent($hexCode.el, 'keydown', EventHexCodeKeyDown);
            addEvent($hexCode.el, 'keyup', EventHexCodeKeyUp);

            addEvent($rgb_r.el, 'keydown', checkNumberKey);
            addEvent($rgb_r.el, 'keyup', setRGBtoHexColor);
            addEvent($rgb_g.el, 'keydown', checkNumberKey);
            addEvent($rgb_g.el, 'keyup', setRGBtoHexColor);
            addEvent($rgb_b.el, 'keydown', checkNumberKey);
            addEvent($rgb_b.el, 'keyup', setRGBtoHexColor);

            addEvent(document, 'mouseup', EventDocumentMouseUp);
            addEvent(document, 'mousemove', EventDocumentMouseMove);

            addEvent($formatChangeButton.el, 'click', EventFormatChangeClick)
        }

        function checkColorPickerClass(el) {
            var hasColorView = new dom(el).closest('codemirror-colorview');
            var hasColorPicker = new dom(el).closest('codemirror-colorpicker');
            var hasCodeMirror = new dom(el).closest('CodeMirror');
            var IsInHtml = el.nodeName == 'HTML';

            return !!(hasColorPicker || hasColorView || hasCodeMirror);
        }

        function checkInHtml (el) {
            var IsInHtml = el.nodeName == 'HTML';

            return IsInHtml;
        }

        function EventDocumentMouseUp (e) {
            $color.data('isDown', false);
            $hue.data('isDown', false);
            $opacity.data('isDown', false);

            // when color picker clicked in outside
            if (checkInHtml(e.target)) {
                //setHideDelay(hideDelay);
            } else if (checkColorPickerClass(e.target) == false ) {
                hide();
            }

        }

        function EventDocumentMouseMove(e) {
            if ($color.data('isDown')) {
                setMainColor(e);
            }

            if ($hue.data('isDown')) {
                setHueColor(e);
            }

            if ($opacity.data('isDown')) {
                setOpacity(e);
            }
        }

        function destroy() {
            removeEvent($color.el, 'mousedown', EventColorMouseDown);
            removeEvent($color.el, 'mouseup', EventColorMouseUp);
            removeEvent($drag_bar.el, 'mousedown', EventDragBarMouseDown);
            removeEvent($opacity_drag_bar.el, 'mousedown', EventOpacityDragBarMouseDown);
            removeEvent($hueContainer.el, 'mousedown', EventHueMouseDown);
            removeEvent($opacityContainer.el, 'mousedown', EventOpacityMouseDown);
            removeEvent($hexCode.el, 'keydown', EventHexCodeKeyDown);
            removeEvent($hexCode.el, 'keyup', EventHexCodeKeyUp);
            removeEvent($rgb_r.el, 'keydown', checkNumberKey);
            removeEvent($rgb_r.el, 'keyup', setRGBtoHexColor);
            removeEvent($rgb_g.el, 'keydown', checkNumberKey);
            removeEvent($rgb_g.el, 'keyup', setRGBtoHexColor);
            removeEvent($rgb_b.el, 'keydown', checkNumberKey);
            removeEvent($rgb_b.el, 'keyup', setRGBtoHexColor);
            removeEvent(document, 'mouseup', EventDocumentMouseUp);
            removeEvent(document, 'mousemove', EventDocumentMouseMove);
            removeEvent($formatChangeButton.el, 'click', EventFormatChangeClick);

            // remove color picker callback
            colorpickerCallback = undefined;
        }

        function currentFormat () {
            var current_format = $information.data('format') || 'hex';
            if (currentA < 1 && current_format == 'hex' ) {
                var next_format = 'rgb';
                $information.removeClass(current_format);
                $information.addClass(next_format);
                $information.data('format', next_format);

                setInputColor();
            }
        }

        function initFormat () {
            var current_format = $information.data('format') || 'hex';

            $information.removeClass('hex');
            $information.removeClass('rgb');
            $information.removeClass('hsl');
            $information.addClass(current_format);
        }

        function nextFormat() {
            var current_format = $information.data('format') || 'hex';

            var next_format = 'hex';
            if (current_format == 'hex') {
                next_format = 'rgb';
            } else if (current_format == 'rgb') {
                next_format = 'hsl';
            } else if (current_format == 'hsl') {
                if (currentA == 1) {
                    next_format = 'hex';
                } else {
                    next_format = 'rgb';
                }
            }

            $information.removeClass(current_format);
            $information.addClass(next_format);
            $information.data('format', next_format);

            setInputColor();
        }

        function makeInputField(type) {
            var item = new dom('div', 'information-item '+ type);

            if (type == 'hex') {
                var field = new dom('div', 'input-field hex');

                $hexCode = new dom('input', 'input', { type : 'text' });

                field.append($hexCode);
                field.append(new dom('div', 'title').html('HEX'));

                item.append(field);

            } else if (type == 'rgb') {
                var field = new dom('div', 'input-field rgb-r');
                $rgb_r = new dom('input', 'input', { type : 'text' });

                field.append($rgb_r);
                field.append(new dom('div', 'title').html('R'));

                item.append(field);

                field = new dom('div', 'input-field rgb-g');
                $rgb_g = new dom('input', 'input', { type : 'text' });

                field.append($rgb_g);
                field.append(new dom('div', 'title').html('G'));

                item.append(field);

                field = new dom('div', 'input-field rgb-b');
                $rgb_b = new dom('input', 'input', { type : 'text' });

                field.append($rgb_b);
                field.append(new dom('div', 'title').html('B'));

                item.append(field);

                // rgba
                field = new dom('div', 'input-field rgb-a');
                $rgb_a = new dom('input', 'input', { type : 'text' });

                field.append($rgb_a);
                field.append(new dom('div', 'title').html('A'));

                item.append(field);

            } else if (type == 'hsl') {
                var field = new dom('div', 'input-field hsl-h');
                $hsl_h = new dom('input', 'input', { type : 'text' });

                field.append($hsl_h);
                field.append(new dom('div', 'title').html('H'));

                item.append(field);

                field = new dom('div', 'input-field hsl-s');
                $hsl_s = new dom('input', 'input', { type : 'text' });

                field.append($hsl_s);
                field.append(new dom('div', 'title').html('S'));

                item.append(field);

                field = new dom('div', 'input-field hsl-l');
                $hsl_l = new dom('input', 'input', { type : 'text' });

                field.append($hsl_l);
                field.append(new dom('div', 'title').html('L'));

                item.append(field);

                // rgba
                field = new dom('div', 'input-field hsl-a');
                $hsl_a = new dom('input', 'input', { type : 'text' });

                field.append($hsl_a);
                field.append(new dom('div', 'title').html('A'));

                item.append(field);
            }

            return item;
        }

        function init() {
            $body = new dom(document.body);

            $root = new dom('div', 'codemirror-colorpicker');
            $color = new dom('div', 'color');
            $drag_pointer = new dom('div', 'drag-pointer' );
            $value = new dom( 'div', 'value' );
            $saturation = new dom('div', 'saturation' );

            $control = new dom('div', 'control' );
            $controlPattern = new dom('div', 'empty' );
            $controlColor = new dom('div', 'color' );
            $hue = new dom('div', 'hue' );
            $hueContainer = new dom('div', 'hue-container' );
            $drag_bar = new dom('div', 'drag-bar' );
            $opacity = new dom('div', 'opacity' );
            $opacityContainer = new dom('div', 'opacity-container' );
            $opacityColorBar = new dom('div', 'color-bar' );

            $opacity_drag_bar = new dom('div', 'drag-bar2' );

            $information = new dom('div', 'information hex' );

            $informationChange = new dom('div', 'information-change');

            $formatChangeButton = new dom('button', 'format-change-button', { type : 'button'}).html('↔');
            $informationChange.append($formatChangeButton);


            $information.append(makeInputField('hex'));
            $information.append(makeInputField('rgb'));
            $information.append(makeInputField('hsl'));
            $information.append($informationChange);


            $value.append($drag_pointer);
            $saturation.append($value);
            $color.append($saturation);

            $hueContainer.append($drag_bar);
            $hue.append($hueContainer);

            $opacityContainer.append($opacityColorBar);
            $opacityContainer.append($opacity_drag_bar);
            $opacity.append($opacityContainer);

            $control.append($hue);
            $control.append($opacity);
            $control.append($controlPattern);
            $control.append($controlColor);

            $root.append($color);
            $root.append($control);
            $root.append($information);

            initHueColors();
            //initEvent();
            initColor();
        };

        function initHueColors () {
            for(var i = 0, len = hue_color.length; i < len; i++) {
                var hue = hue_color[i];

                var obj = color.parse(hue.rgb);

                hue.r = obj.r;
                hue.g = obj.g;
                hue.b = obj.b;
            }
        }

        /**
         * public methods
         */
        function setColor(value) {
            if(typeof(value) == "object") {
                if(!value.r || !value.g || !value.b)
                    return;

                initColor(color.format(value, "hex"));
            } else if(typeof(value) == "string") {
                if(value.charAt(0) != "#")
                    return;

                initColor(value);
            }
        }

        function getColor(type) {
            caculateHSV();
            var rgb = convertRGB();

            if (type) {
                return color.format(rgb, type);
            }

            return rgb;
        }

        function definePostion (opt) {

            var width = $root.width();
            var height = $root.height();

            // set left position for color picker
            var elementScreenLeft = opt.left - $body.el.scrollLeft ;
            if (width + elementScreenLeft > window.innerWidth) {
                elementScreenLeft -= (width + elementScreenLeft) - window.innerWidth;
            }
            if (elementScreenLeft < 0) { elementScreenLeft = 0; }

            // set top position for color picker
            var elementScreenTop = opt.top - $body.el.scrollTop ;
            if (height + elementScreenTop > window.innerHeight) {
                elementScreenTop -= (height + elementScreenTop) - window.innerHeight;
            }
            if (elementScreenTop < 0) { elementScreenTop = 0; }

            // set position
            $root.css({
                left : elementScreenLeft + 'px',
                top : elementScreenTop + 'px'
            });
        }

        function show (opt, color,  callback) {
            destroy();
            initEvent();
            $root.appendTo(document.body);

            $root.css({
                position: 'fixed',  // color picker has fixed position
                left : '-10000px',
                top : '-10000px'
            });

            $root.show();

            definePostion(opt);

            isColorPickerShow = true;

            isShortCut = opt.isShortCut || false;

            initColor(color);

            // define colorpicker callback
            colorpickerCallback = function (colorString) {
                callback(colorString);
            }

            // define hide delay
            hideDelay = opt.hideDelay || 2000;
            if (hideDelay > 0) {
                setHideDelay(hideDelay);
            }

        }


        var timerCloseColorPicker;
        function setHideDelay (delayTime) {
            delayTime = delayTime || 0;
            removeEvent($root.el, 'mouseenter');
            removeEvent($root.el, 'mouseleave');

            addEvent($root.el, 'mouseenter', function () {
               clearTimeout(timerCloseColorPicker);
            });

            addEvent($root.el, 'mouseleave', function () {
                clearTimeout(timerCloseColorPicker);
                timerCloseColorPicker = setTimeout(hide, delayTime);
            });

            clearTimeout(timerCloseColorPicker);
            timerCloseColorPicker = setTimeout(hide, delayTime);
        }

        function hide () {
            if (isColorPickerShow) {
                destroy();
                $root.hide();
                $root.remove();
                isColorPickerShow = false;
            }

        }

        init();

        return {
            isShortCut : function () {
                return isShortCut;
            },
            $root: $root,
            show: show,
            hide: hide,
            setColor: setColor,
            getColor: getColor
        }
    })

});


(function(mod) {
    if (typeof exports == "object" && typeof module == "object") // CommonJS
        mod(require("codemirror"));
    else if (typeof define == "function" && define.amd) // AMD
        define(["codemirror"], mod);
    else // Plain browser env
        mod(CodeMirror);
})(function(CodeMirror) {
    "use strict";

    // color names
    var color_names={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb(0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb(95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(237, 20, 61)",cyan:"rgb(0, 255, 255)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgrey:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb(0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",grey:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",greenyellow:"rgb(173, 255, 47)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb(75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgreen:"rgb(144, 238, 144)",lightgray:"rgb(211, 211, 211)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb(0, 255, 0)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",rebeccapurple:"rgb(102, 51, 153)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb(65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb(0, 255, 127)",steelblue:"rgb(70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb(0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",turquoise:"rgb(64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)",transparent:"rgba(0, 0, 0, 0)"};

    var colorpicker_class = 'codemirror-colorview';
    var colorpicker_background_class = 'codemirror-colorview-background';

    CodeMirror.defineOption("colorpicker", false, function (cm, val, old) {

        if (old && old != CodeMirror.Init) {

            if (cm.state.colorpicker)
            {
                cm.state.colorpicker.destroy();
                cm.state.colorpicker = null;

            }
            // remove event listener
        }

        if (val)
        {
            cm.state.colorpicker = new codemirror_colorpicker(cm, val);
        }
    });

    function onChange(cm, evt) {
        if (evt.origin == 'setValue') {  // if content is changed by setValue method, it initialize markers
            cm.state.colorpicker.close_color_picker();
            cm.state.colorpicker.init_color_update();
            cm.state.colorpicker.style_color_update();
        } else {
            cm.state.colorpicker.style_color_update(cm.getCursor().line);
        }

    }

    function onUpdate(cm, evt) {
        if (!cm.state.colorpicker.isUpdate) {
            cm.state.colorpicker.isUpdate = true;
            cm.state.colorpicker.close_color_picker();
            cm.state.colorpicker.init_color_update();
            cm.state.colorpicker.style_color_update();
        }
    }

    function onRefresh(cm, evt) {
        onChange(cm, { origin : 'setValue'});
    }

    function onKeyup(cm, evt) {
        cm.state.colorpicker.keyup(evt);
    }

    function onMousedown(cm, evt) {
        if (cm.state.colorpicker.is_edit_mode())
        {
            cm.state.colorpicker.check_mousedown(evt);
        }
    }

    function onPaste (cm, evt) {
        onChange(cm, { origin : 'setValue'});
    }

    function onScroll (cm) {
        cm.state.colorpicker.close_color_picker();
    }

    function debounce (callback, delay) {

        var t = undefined;

        return function (cm, e) {
            if (t) {
                clearTimeout(t);
            }

            t = setTimeout(function () {
                callback(cm, e);
            }, delay || 300);
        }
    }

    function has_class(el, cls) {
        if (!el || !el.className) {
            return false;
        } else {
            var newClass = ' ' + el.className + ' ';
            return newClass.indexOf(' ' + cls + ' ') > -1;
        }
    }

    function codemirror_colorpicker (cm, opt) {
        var self = this;

        if (typeof opt == 'boolean')
        {
            opt = { mode : 'view' };
        } else {
            opt = Object.assign({ mode: 'view' }, opt || {});
        }

        this.opt = opt;
        this.cm = cm;
        this.markers = {};

        if (this.cm.colorpicker) {
            this.colorpicker = this.cm.colorpicker();
        } else if (this.opt.colorpicker) {
            this.colorpicker = this.opt.colorpicker;
        }

        this.init_event();

    }

    codemirror_colorpicker.prototype.init_event = function () {

        this.cm.on('mousedown', onMousedown);
        this.cm.on('keyup', onKeyup);
        this.cm.on('change', onChange);
        this.cm.on('update', onUpdate);
        this.cm.on('refresh', onRefresh);

        // create paste callback
        this.onPasteCallback = (function (cm, callback) {
            return  function (evt) {
                callback.call(this, cm, evt);
            }
        })(this.cm, onPaste);

        this.cm.getWrapperElement().addEventListener('paste', this.onPasteCallback);

        if (this.is_edit_mode())
        {
            this.cm.on('scroll', debounce(onScroll, 50));
        }

    }

    codemirror_colorpicker.prototype.is_edit_mode = function () {
        return this.opt.mode == 'edit';
    }

    codemirror_colorpicker.prototype.is_view_mode = function () {
        return this.opt.mode == 'view';
    }

    codemirror_colorpicker.prototype.destroy = function () {
        this.cm.off('mousedown', onMousedown);
        this.cm.off('keyup', onKeyup);
        this.cm.off('change', onChange)
        this.cm.getWrapperElement().removeEventListener('paste', this.onPasteCallback);

        if (this.is_edit_mode())
        {
            this.cm.off('scroll');
        }
    }

    codemirror_colorpicker.prototype.hasClass = function (el, className) {
        if (!el.className)
        {
            return false;
        } else {
            var newClass = ' ' + el.className + ' ';
            return newClass.indexOf(' ' + className + ' ') > -1;
        }
    }

    codemirror_colorpicker.prototype.check_mousedown = function (evt) {
        if (this.hasClass(evt.target, colorpicker_background_class) )
        {
            this.open_color_picker(evt.target.parentNode);
        } else {
            this.close_color_picker();
        }
    }

    codemirror_colorpicker.prototype.popup_color_picker = function (defalutColor) {
        var cursor = this.cm.getCursor();
        var self = this;
        var colorMarker = {
            lineNo : cursor.line,
            ch : cursor.ch,
            color: defalutColor || '#FFFFFF',
            isShortCut : true
        };

        Object.keys(this.markers).forEach(function(key) {
            var searchKey = "#" + key;
            if (searchKey.indexOf( "#" + colorMarker.lineNo + ":") > -1) {
                var marker = self.markers[key];

                if (marker.ch <= colorMarker.ch && colorMarker.ch <= marker.ch + marker.color.length) {
                    // when cursor has marker
                    colorMarker.ch = marker.ch;
                    colorMarker.color = marker.color;
                    colorMarker.nameColor = marker.nameColor;
                }

            }
        });

        this.open_color_picker(colorMarker);
    }

    codemirror_colorpicker.prototype.open_color_picker = function (el) {
        var lineNo = el.lineNo;
        var ch = el.ch;
        var nameColor = el.nameColor;
        var color = el.color;


        if (this.colorpicker) {
            var self = this;
            var prevColor = color;
            var pos = this.cm.charCoords({line : lineNo, ch : ch });
            this.colorpicker.show({
                left : pos.left,
                top : pos.bottom,
                isShortCut : el.isShortCut || false,
                hideDelay : self.opt.hideDelay || 2000
            }, nameColor || color, function (newColor) {
                self.cm.replaceRange(newColor, { line : lineNo, ch : ch } , { line : lineNo, ch : ch + prevColor.length }, '*colorpicker');
                prevColor = newColor;
            });

        }

    }

    codemirror_colorpicker.prototype.close_color_picker = function (el) {
        if (this.colorpicker)
        {
            this.colorpicker.hide();
        }
    }

    codemirror_colorpicker.prototype.key = function (lineNo, ch) {
        return [lineNo, ch].join(":");
    }


    codemirror_colorpicker.prototype.keyup = function (evt) {

        if (this.colorpicker ) {
            if (evt.key == 'Escape') {
                this.colorpicker.hide();
            } else if (this.colorpicker.isShortCut() == false) {
                this.colorpicker.hide();
            }
        }
    }

    codemirror_colorpicker.prototype.init_color_update = function () {
        this.markers = {};  // initialize marker list
    }

    codemirror_colorpicker.prototype.style_color_update = function (lineHandle) {

        if (lineHandle) {
            this.match(lineHandle);
        } else {
            var max = this.cm.lineCount();

            for(var lineNo = 0; lineNo < max; lineNo++) {
                this.match(lineNo);
            }
        }

    }

    codemirror_colorpicker.prototype.empty_marker = function (lineNo, lineHandle) {
        var list = lineHandle.markedSpans || [];

        for(var i = 0, len = list.length; i < len; i++) {
            var key = this.key(lineNo, list[i].from);

            if (key && has_class(list[i].marker.replacedWith, colorpicker_class)) {
                delete this.markers[key];
                list[i].marker.clear();
            }

        }
    }

    codemirror_colorpicker.prototype.color_regexp = /(#(?:[\da-f]{3}){1,2}|rgb\((?:\s*\d{1,3},\s*){2}\d{1,3}\s*\)|rgba\((?:\s*\d{1,3},\s*){3}\d*\.?\d+\s*\)|hsl\(\s*\d{1,3}(?:,\s*\d{1,3}%){2}\s*\)|hsla\(\s*\d{1,3}(?:,\s*\d{1,3}%){2},\s*\d*\.?\d+\s*\)|(\w+))/gi;
    
    codemirror_colorpicker.prototype.match_result = function (lineHandle) {
        return lineHandle.text.match(this.color_regexp);
    }

    codemirror_colorpicker.prototype.match = function (lineNo) {
        var lineHandle = this.cm.getLineHandle(lineNo);

        this.empty_marker(lineNo, lineHandle);

        var result = this.match_result(lineHandle);
        if (result)
        {
            var obj = { next : 0 };
            for(var i = 0, len = result.length; i < len; i++) {

                if (result[i].indexOf('#') > -1 || result[i].indexOf('rgb') > -1 || result[i].indexOf('hsl') > -1) {
                    this.render(obj, lineNo, lineHandle, result[i]);
                } else {
                    var nameColor = color_names[result[i]];
                    if (nameColor) {
                        this.render(obj, lineNo, lineHandle, result[i], nameColor);
                    }
                }
            }
        }
    }

    codemirror_colorpicker.prototype.make_element = function () {
        var el = document.createElement('div');

        el.className = colorpicker_class;

        if (this.is_edit_mode())
        {
            el.title ="open color picker";
        } else {
            el.title ="";
        }

        el.back_element = this.make_background_element();
        el.appendChild(el.back_element);

        return el;
    }

    codemirror_colorpicker.prototype.make_background_element = function () {
        var el = document.createElement('div');

        el.className = colorpicker_background_class;

        return el;
    }

    codemirror_colorpicker.prototype.set_state = function (lineNo, start, color, nameColor) {
        var marker = this.create_marker(lineNo, start);


        marker.lineNo = lineNo;
        marker.ch = start;
        marker.color = color;
        marker.nameColor = nameColor;

        return marker;
    }

    codemirror_colorpicker.prototype.create_marker = function (lineNo, start) {

        var key = this.key(lineNo,start);

        if (!this.markers[key]) {
            this.markers[key] = this.make_element();
        }


        return this.markers[key];

    }

    codemirror_colorpicker.prototype.has_marker = function (lineNo, start) {
        var key = this.key(lineNo,start);
        return !!(this.markers[key])
    }

    codemirror_colorpicker.prototype.update_element = function (el, color) {
        el.back_element.style.backgroundColor = color;
    }

    codemirror_colorpicker.prototype.set_mark = function (line, ch, el) {
        this.cm.setBookmark({ line : line, ch : ch}, { widget : el, handleMouseEvents : true} );

    }

    codemirror_colorpicker.prototype.render = function (cursor, lineNo, lineHandle, color, nameColor) {
        var start = lineHandle.text.indexOf(color, cursor.next);

        cursor.next = start + color.length;

        if (this.has_marker(lineNo, start))
        {
            this.update_element(this.create_marker(lineNo, start), nameColor || color);
            this.set_state(lineNo, start, color, nameColor);
            return;
        }

        var el  = this.create_marker(lineNo, start);

        this.update_element(el, nameColor || color);
        this.set_state(lineNo, start, color, nameColor || color);
        this.set_mark(lineNo, start, el);
    }
});

